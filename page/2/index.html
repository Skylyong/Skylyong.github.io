<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ailyong.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Keep go on">
<meta property="og:type" content="website">
<meta property="og:title" content="Lyong&#39;s blog">
<meta property="og:url" content="https://ailyong.cn/page/2/index.html">
<meta property="og:site_name" content="Lyong&#39;s blog">
<meta property="og:description" content="Keep go on">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Lyong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ailyong.cn/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Lyong's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Lyong's blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lyong's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">勇往直前</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/14/wei-xin-biao-qian-zheng-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/14/wei-xin-biao-qian-zheng-li/" class="post-title-link" itemprop="url">微信标签整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-14 01:06:28 / 修改时间：01:08:04" itemprop="dateCreated datePublished" datetime="2021-08-14T01:06:28+08:00">2021-08-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>最近对微信通讯录做了一次比较彻底的整理，记录一下。</p>
</blockquote>
<p>我根据兴趣、人生阶段、亲疏关系和生活四个维度来分类，每个维度的具体分类标签如下：</p>
<ul>
<li>按兴趣： 兴趣-户外，兴趣-跑步，兴趣-阅读，兴趣-美食等</li>
<li>按人生阶段划分为：中学，本科，研究生，兼职等，每一个阶段又可以做进一步划分。<ul>
<li>中学-同学，中学-校友，中学-老师</li>
<li>本科-同学，本科-校友，本科-老师</li>
<li>研究生-同学，研究生-校友，研究生-老师</li>
<li>兼职-同事，兼职-同行</li>
</ul>
</li>
<li>按亲疏关系可分为：<ul>
<li>家人</li>
<li>亲戚</li>
<li>朋友</li>
<li>有缘相逢</li>
</ul>
</li>
<li>生活涉及的东西比较杂，我是把“照相、打印和水电等”都放在了“生活便利”这一个标签里面，然后在名字上面做备注，比如“张三|打印”。此外，我把医生、法律人士做了单独的标签，最后加了一个“大佬”标签，方便时刻关注大佬的动态、向大佬靠齐。<ul>
<li>生活便利</li>
<li>生活-医务</li>
<li>生活-法律</li>
<li>大佬</li>
</ul>
</li>
</ul>
<p>分好之后才感觉这种二级分类有点繁琐，先用一段时间看看，不行的话再做优化。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/14/gong-ju-xiang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/14/gong-ju-xiang/" class="post-title-link" itemprop="url">工具箱</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-14 01:01:38" itemprop="dateCreated datePublished" datetime="2021-08-14T01:01:38+08:00">2021-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-06 14:02:40" itemprop="dateModified" datetime="2025-01-06T14:02:40+08:00">2025-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%94%B6%E8%97%8F/" itemprop="url" rel="index"><span itemprop="name">收藏</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><a target="_blank" rel="noopener" href="https://www.jibing57.com/2019/03/24/share-ShadowsocksX-NG-to-iOS/">Mac下共享ShadowsocksX-NG的梯子给iOS</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jserhub/p/11770585.html">GitHub 设置和取消代理，加速 git clone</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zxgj.cn/g/rznl">在线智商测试</a></li>
</ul>
<ul>
<li><a href="https://ailyong.cn/2022/09/07/mac-xi-tong-zhi-zuo-win10-qi-dong-u-pan/">Mac系统制作win10启动U盘</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/13/jiao-shi-zi-ge-zheng-kao-shi-xue-xi-bi-ji/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/jiao-shi-zi-ge-zheng-kao-shi-xue-xi-bi-ji/" class="post-title-link" itemprop="url">教师资格证考试学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-13 23:00:04" itemprop="dateCreated datePublished" datetime="2021-08-13T23:00:04+08:00">2021-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-14 00:52:25" itemprop="dateModified" datetime="2021-08-14T00:52:25+08:00">2021-08-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="科目一"><a href="#科目一" class="headerlink" title="科目一"></a><a href="">科目一</a></h3><h3 id="科目二"><a href="#科目二" class="headerlink" title="科目二"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=7">科目二</a></h3><h4 id="P2-教育的定义属性和功能"><a href="#P2-教育的定义属性和功能" class="headerlink" title="P2 教育的定义属性和功能"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=2">P2 教育的定义属性和功能</a></h4><ul>
<li><p>教育的定义</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210813230300.png" alt="img" style="zoom:50%;" /></li>
</ul>
<ul>
<li><p>教育的属性</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225203354.png" alt="20210225203354" style="zoom:50%;" /></li>
<li><p>教育的功能</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225203732.png" alt="20210225203732" style="zoom:50%;" /></li>
</ul>
<h4 id="P3-教育的起源和发展"><a href="#P3-教育的起源和发展" class="headerlink" title="P3 教育的起源和发展"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=3">P3 教育的起源和发展</a></h4><ul>
<li><p>教育的起源</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225204527.png" alt="20210225204527" style="zoom:50%;" />

<p> 最古老的教育起源论是：神话起源论；第一个正式学说：生物起源论；现代广泛认可的学说：劳动起源论。</p>
</li>
<li><p>教育的发展</p>
<ul>
<li><p>原始社会</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225205341.png" alt="20210225205341" style="zoom:50%;" /></li>
<li><p>古代社会</p>
<ul>
<li>奴隶社会</li>
</ul>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225205938.png" alt="20210225205938" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225210046.png" alt="20210225210046" style="zoom:50%;" />


<ul>
<li><p>封建社会</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225210603.png" alt="20210225210603" style="zoom:67%;" />

<ul>
<li>近现代教育</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225210924.png" alt="20210225210924" style="zoom: 50%;" />

<h4 id="P4-教育学的产生与发展"><a href="#P4-教育学的产生与发展" class="headerlink" title="P4 教育学的产生与发展"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=4&spm_id_from=pageDriver">P4 教育学的产生与发展</a></h4><ul>
<li>教育学的概念</li>
</ul>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225211556.png" alt="20210225211556" style="zoom:50%;" />  



<ul>
<li><p>教育学的萌芽阶段</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225212025.png" alt="20210225212025" style="zoom:50%;" />

 <img src="https://raw.githubusercontent.com/Skylyong/i/main/20210225212534.png" alt="20210225212534" style="zoom:50%;" /></li>
</ul>
<h4 id="P5-教育学的产生与发展"><a href="#P5-教育学的产生与发展" class="headerlink" title="P5 教育学的产生与发展"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=5&spm_id_from=pageDriver">P5 教育学的产生与发展</a></h4><ul>
<li>学习目标：掌握并识记教育学独立发展阶段及多样化发展阶段代表人物及其著作、教育思想。</li>
</ul>
<h4 id="P6"><a href="#P6" class="headerlink" title="P6"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=6&spm_id_from=pageDriver">P6</a></h4><h4 id="P7-教育与社会发展"><a href="#P7-教育与社会发展" class="headerlink" title="P7 教育与社会发展"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=7">P7 教育与社会发展</a></h4><h4 id="P8-教育与人的发展"><a href="#P8-教育与人的发展" class="headerlink" title="P8 教育与人的发展"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=8&spm_id_from=pageDriver">P8 教育与人的发展</a></h4><h4 id="P9-教育制度"><a href="#P9-教育制度" class="headerlink" title="P9 教育制度"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=9&spm_id_from=pageDriver">P9 教育制度</a></h4><ul>
<li><p>教育制度的概念</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210228232341.png" alt="20210228232341" style="zoom:50%;" />

<p>教育制度的概念分为广义教育制度和狭义教育制度，其中广义教育制度主要指国民教育制度，狭义的教育制度指学校教育制度，简称学制。</p>
</li>
<li><p>建立学制的依据</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210228233027.png" alt="20210228233027" style="zoom:50%;" /></li>
<li><p>学制的形式发展</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210228233313.png" alt="20210228233313" style="zoom:50%;" />

<ul>
<li><p>现代学制的类型</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210228233821.png" alt="20210228233821" style="zoom:50%;" />

<p>分支制：初中之后分支。</p>
</li>
<li><p>我国现代学制的沿革</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210228234156.png" alt="20210228234156" style="zoom:50%;" /></li>
</ul>
<p>《钦定学堂章程》是第一个现代学制，但是它没有实施；《凑定学堂章程》第一个实行的现代学制，提出“中学为体，西学为用”的思想。</p>
<ul>
<li>现代教育制度发展趋势<ul>
<li>义务教育</li>
<li>终身教育</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="P10-教育目的"><a href="#P10-教育目的" class="headerlink" title="P10 教育目的"></a><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1sk4y1q7pM?p=10&spm_id_from=pageDriver">P10 教育目的</a></h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/13/google-fang-wen-zhu-shou-an-zhuang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/google-fang-wen-zhu-shou-an-zhuang/" class="post-title-link" itemprop="url">Google访问助手安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-13 22:54:55 / 修改时间：22:58:03" itemprop="dateCreated datePublished" datetime="2021-08-13T22:54:55+08:00">2021-08-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B9%B2%E8%B4%A7/" itemprop="url" rel="index"><span itemprop="name">干货</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Google访问助手安装"><a href="#Google访问助手安装" class="headerlink" title="Google访问助手安装"></a>Google访问助手安装</h3><p>今天用图书馆电脑的时候发现不能访问google，非常不方便搜索文献，因此研究了一下google上网助手，记录一下。</p>
<ul>
<li><h3 id="IGG谷歌访问助手"><a href="#IGG谷歌访问助手" class="headerlink" title="IGG谷歌访问助手"></a><a target="_blank" rel="noopener" href="https://iguge.app/">IGG谷歌访问助手</a></h3><blockquote>
<p>该助手具有如下特点：</p>
<ul>
<li>免费提供谷歌搜索</li>
<li>微软onedrive加速</li>
<li>不包含YouTube，谷歌网盘</li>
</ul>
</blockquote>
</li>
<li><h3 id="google上网助手"><a href="#google上网助手" class="headerlink" title="google上网助手"></a><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/%E8%B0%B7%E6%AD%8C%E4%B8%8A%E7%BD%91%E5%8A%A9%E6%89%8B/nonmafimegllfoonjgplbabhmgfanaka?utm_source=chrome-ntp-icon">google上网助手</a></h3><blockquote>
<p>该助手具备IGG谷歌访问助手的特点，但是安装的时候需要登录Chrome商店才能够下载，如果没有KX上网，建议读者选择安装“IGG谷歌访问助手”方式访问谷歌。</p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/13/chang-yong-shu-ju-ji-zheng-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/chang-yong-shu-ju-ji-zheng-li/" class="post-title-link" itemprop="url">常用数据集整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-13 22:48:02 / 修改时间：22:53:44" itemprop="dateCreated datePublished" datetime="2021-08-13T22:48:02+08:00">2021-08-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E9%9B%86/" itemprop="url" rel="index"><span itemprop="name">数据集</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="常用数据集整理"><a href="#常用数据集整理" class="headerlink" title="常用数据集整理"></a>常用数据集整理</h3><p>前沿：所谓”巧妇难为无米之炊“，作为人工智能领域的学习者，免不了要跟数据打交道，有时候我们不得不耗费大量的精力来收集相关数据集。因此， 整理一些常用的数据集，以便不时之需。</p>
<h4 id="对话数据集"><a href="#对话数据集" class="headerlink" title="对话数据集"></a>对话数据集</h4><h4 id="nlp方向的生物医学"><a href="#nlp方向的生物医学" class="headerlink" title="nlp方向的生物医学"></a>nlp方向的生物医学</h4><ul>
<li>Symcat’s database</li>
<li>mz database</li>
<li>dxy database</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/13/tu-de-chuang-jian-he-bian-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/tu-de-chuang-jian-he-bian-li/" class="post-title-link" itemprop="url">【课程设计】图的创建和遍历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-13 22:41:02 / 修改时间：22:47:11" itemprop="dateCreated datePublished" datetime="2021-08-13T22:41:02+08:00">2021-08-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>本课程设计主要完成邻接矩阵和邻接表两种不同存储方式的图的建立和遍历，其中遍历部分分别进行了DFS和BFS两种不同形式的遍历。</p>
<h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#include&lt;stdio.h></span>
<span class="token comment" spellcheck="true">#include&lt;stdlib.h></span>
<span class="token comment" spellcheck="true">#include&lt;string.h> </span>
<span class="token comment" spellcheck="true">#include&lt;stack></span>
<span class="token comment" spellcheck="true">#include&lt;queue></span>
using namespace std<span class="token punctuation">;</span>
 
<span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>图的存储结构定义<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token comment" spellcheck="true">#define MaxVerNum 30           </span>
<span class="token comment" spellcheck="true">#define Vextype char</span>
<span class="token comment" spellcheck="true">#define EdgeInfoType int</span>
 
<span class="token comment" spellcheck="true">#define INF 999      //无穷大 </span>
<span class="token comment" spellcheck="true">#define MAXSIZE 100</span>
 
typedef  struct
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    Vextype  vexs<span class="token punctuation">[</span>MaxVerNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    EdgeInfoType edges<span class="token punctuation">[</span>MaxVerNum<span class="token punctuation">]</span><span class="token punctuation">[</span>MaxVerNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    int n<span class="token punctuation">,</span> e<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;MGragh;</span>
 
typedef  struct node
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int adjvex<span class="token punctuation">;</span>
    EdgeInfoType  Info<span class="token punctuation">;</span>
    struct node <span class="token operator">*</span> next<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;EdgeNode;</span>
 
typedef struct vnode
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    Vextype  vertex<span class="token punctuation">;</span>
    EdgeNode <span class="token operator">*</span>firstedge<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;VertexNode;</span>
 
typedef  struct
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    VertexNode  adjlist<span class="token punctuation">[</span>MaxVerNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    int   n<span class="token punctuation">,</span> e<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;ALGraph;</span>
 
int visited<span class="token punctuation">[</span>MaxVerNum<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token operator">//</span>顶点访问标记 
 
<span class="token operator">/</span><span class="token operator">*</span>建立图G的邻接矩阵  <span class="token operator">*</span><span class="token operator">/</span>
int returnId<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">,</span> char c<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
<span class="token operator">//</span>返回c在数组中的下标
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>MaxVerNum<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
void CreateGraph<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    scanf<span class="token punctuation">(</span><span class="token string">"%d %d\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>g<span class="token operator">-</span><span class="token operator">></span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    char c<span class="token punctuation">;</span>
    int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> getchar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    Vextype s<span class="token punctuation">,</span> e<span class="token punctuation">;</span>
    EdgeInfoType cost<span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            g<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>e<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        scanf<span class="token punctuation">(</span><span class="token string">"%c %c %d\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cost<span class="token punctuation">)</span><span class="token punctuation">;</span>
        g<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>returnId<span class="token punctuation">(</span>g<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>returnId<span class="token punctuation">(</span>g<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> cost<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">/</span><span class="token operator">*</span> 根据图的邻接矩阵建立图的邻接表 <span class="token operator">*</span><span class="token operator">/</span>
void CreateALGraph<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>mg<span class="token punctuation">,</span> ALGraph <span class="token operator">*</span>alg<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    alg<span class="token operator">-</span><span class="token operator">></span>n <span class="token operator">=</span> mg<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> alg<span class="token operator">-</span><span class="token operator">></span>e <span class="token operator">=</span> mg<span class="token operator">-</span><span class="token operator">></span>e<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>alg<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        alg<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>vertex <span class="token operator">=</span> mg<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    int i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    EdgeNode <span class="token operator">*</span>s<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> alg<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> alg<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>j<span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mg<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
                s <span class="token operator">=</span> <span class="token punctuation">(</span>EdgeNode<span class="token operator">*</span><span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>sizeof<span class="token punctuation">(</span>EdgeNode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                s<span class="token operator">-</span><span class="token operator">></span>adjvex <span class="token operator">=</span> j<span class="token punctuation">;</span>
                s<span class="token operator">-</span><span class="token operator">></span>Info <span class="token operator">=</span> mg<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                s<span class="token operator">-</span><span class="token operator">></span>next <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
                EdgeNode<span class="token operator">*</span>p <span class="token operator">=</span> alg<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge<span class="token punctuation">;</span>
                s<span class="token operator">-</span><span class="token operator">></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
                alg<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge <span class="token operator">=</span> s<span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>打印图<span class="token punctuation">(</span>邻接矩阵<span class="token punctuation">)</span> 
void printGragh<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    printf<span class="token punctuation">(</span><span class="token string">"\n图G的邻接矩阵\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"顶点：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        printf<span class="token punctuation">(</span><span class="token string">"%c\t"</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    printf<span class="token punctuation">(</span><span class="token string">"\n邻接矩阵：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            printf<span class="token punctuation">(</span><span class="token string">"%d\t"</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
        printf<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>打印图<span class="token punctuation">(</span>邻接表<span class="token punctuation">)</span> 
void printALGragh<span class="token punctuation">(</span>ALGraph <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    printf<span class="token punctuation">(</span><span class="token string">"\n图G的邻接表\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        printf<span class="token punctuation">(</span><span class="token string">"%c:"</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        EdgeNode<span class="token operator">*</span> edge <span class="token operator">=</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>edge<span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            printf<span class="token punctuation">(</span><span class="token string">"-->"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            printf<span class="token punctuation">(</span><span class="token string">"%d:%d\t"</span><span class="token punctuation">,</span> edge<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">,</span> edge<span class="token operator">-</span><span class="token operator">></span>Info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            edge <span class="token operator">=</span> edge<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
        printf<span class="token punctuation">(</span><span class="token string">"%\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
 
 
<span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>DFS<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">//</span>从顶点v开始图<span class="token punctuation">(</span>邻接矩阵<span class="token punctuation">)</span>的深度遍历 
void DFS_MG<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">,</span> int v<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int j<span class="token punctuation">;</span>
    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>j<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span>  <span class="token operator">&amp;</span><span class="token operator">&amp;</span>  !visited<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            DFS_MG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>图的<span class="token punctuation">(</span>邻接矩阵<span class="token punctuation">)</span>的深度遍历 
void DFSTranverse_MG<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token operator">//</span>初始化访问数组visited的元素值为false
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; //节点尚未访问</span>
            DFS_MG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>从顶点v开始图<span class="token punctuation">(</span>邻接表<span class="token punctuation">)</span>的深度遍历
void DFS_ALG<span class="token punctuation">(</span>ALGraph <span class="token operator">*</span>g<span class="token punctuation">,</span> int v<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    EdgeNode <span class="token operator">*</span>p <span class="token operator">=</span>g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            DFS_ALG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>递归深度遍历
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
        p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>图<span class="token punctuation">(</span>邻接表<span class="token punctuation">)</span>的深度遍历
void DFSTranverse_ALG<span class="token punctuation">(</span>ALGraph <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token operator">//</span>初始化访问数组visited的元素值为false
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; //节点尚未访问</span>
            DFS_ALG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>BFS<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">/</span>
 
<span class="token operator">//</span>从顶点v开始图<span class="token punctuation">(</span>邻接矩阵<span class="token punctuation">)</span>的广度遍历 
void BFS_MG<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">,</span> int v<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
 
    int j<span class="token punctuation">;</span>
    queue<span class="token operator">&lt;</span>int<span class="token operator">></span> Q<span class="token punctuation">;</span>
    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    Q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">while</span> <span class="token punctuation">(</span>!Q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            
        v <span class="token operator">=</span> Q<span class="token punctuation">.</span>front<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>j<span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> g<span class="token operator">-</span><span class="token operator">></span>edges<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">//</span> INFINITY<span class="token punctuation">)</span>
            <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
                visited<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>vexs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>图<span class="token punctuation">(</span>邻接矩阵<span class="token punctuation">)</span>的广度遍历
void BFSTranverse_MG<span class="token punctuation">(</span>MGragh <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token operator">//</span>初始化访问数组visited的元素值为false
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; //节点尚未访问</span>
            BFS_MG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>从顶点v开始图<span class="token punctuation">(</span>邻接表<span class="token punctuation">)</span>的广度遍历 
void BFS_ALG<span class="token punctuation">(</span>ALGraph <span class="token operator">*</span>g<span class="token punctuation">,</span> int v<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    queue<span class="token operator">&lt;</span>int <span class="token operator">></span> Q<span class="token punctuation">;</span>
    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
    Q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>!Q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;     </span>
        v <span class="token operator">=</span> Q<span class="token punctuation">.</span>front<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        EdgeNode <span class="token operator">*</span>p <span class="token operator">=</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            visited<span class="token punctuation">[</span>p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            printf<span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span> g<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">]</span><span class="token punctuation">.</span>vertex<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            Q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">></span>adjvex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
            p <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">//</span>图<span class="token punctuation">(</span>邻接表<span class="token punctuation">)</span>的广度遍历 
void BFSTranverse_ALG<span class="token punctuation">(</span>ALGraph <span class="token operator">*</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    int i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token operator">//</span>初始化访问数组visited的元素值为false
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>g<span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>!visited<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123; //节点尚未访问</span>
            BFS_ALG<span class="token punctuation">(</span>g<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>初始化与销毁<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">/</span>
MGragh <span class="token operator">*</span>init_MGraph<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    MGragh <span class="token operator">*</span>mg <span class="token operator">=</span> <span class="token punctuation">(</span>MGragh <span class="token operator">*</span><span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>sizeof<span class="token punctuation">(</span>MGragh<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mg<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        mg<span class="token operator">-</span><span class="token operator">></span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        mg<span class="token operator">-</span><span class="token operator">></span>e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
    <span class="token keyword">return</span> mg<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
ALGraph <span class="token operator">*</span>init_ALGraph<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    ALGraph <span class="token operator">*</span>alg <span class="token operator">=</span> <span class="token punctuation">(</span>ALGraph <span class="token operator">*</span><span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>sizeof<span class="token punctuation">(</span>ALGraph<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>alg<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        alg<span class="token operator">-</span><span class="token operator">></span>n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        alg<span class="token operator">-</span><span class="token operator">></span>e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>MaxVerNum<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
            alg<span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
    <span class="token keyword">return</span> alg<span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
void destroy_MGraph<span class="token punctuation">(</span>MGragh <span class="token operator">**</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        free<span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>g <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
void destroy_ALGraph<span class="token punctuation">(</span>ALGraph <span class="token operator">**</span>g<span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>n<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        EdgeNode <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>adjlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>firstedge<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
            EdgeNode <span class="token operator">*</span>q <span class="token operator">=</span> p<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span>
            free<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
            p <span class="token operator">=</span> q<span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
        free<span class="token punctuation">(</span><span class="token operator">*</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>g <span class="token operator">=</span> NULL<span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
 
<span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span>main函数<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token operator">/</span>
int main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    freopen<span class="token punctuation">(</span><span class="token string">"数据.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span> stdin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">//</span>创建图（邻接矩阵） 
    MGragh <span class="token operator">*</span>mG <span class="token operator">=</span> init_MGraph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CreateGraph<span class="token punctuation">(</span>mG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    printGragh<span class="token punctuation">(</span>mG<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token operator">//</span>创建图（邻接表） 
    ALGraph <span class="token operator">*</span>alG <span class="token operator">=</span> init_ALGraph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CreateALGraph<span class="token punctuation">(</span>mG<span class="token punctuation">,</span> alG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    printALGragh<span class="token punctuation">(</span>alG<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    
    <span class="token operator">//</span>DFS遍历
    printf<span class="token punctuation">(</span><span class="token string">"\nDFS遍历:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"邻接矩阵:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DFSTranverse_MG<span class="token punctuation">(</span>mG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"\n邻接表:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    DFSTranverse_ALG<span class="token punctuation">(</span>alG<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token operator">//</span>BFS遍历
    printf<span class="token punctuation">(</span><span class="token string">"\n\nBFS遍历:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"邻接矩阵:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BFSTranverse_MG<span class="token punctuation">(</span>mG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    printf<span class="token punctuation">(</span><span class="token string">"\n邻接表:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BFSTranverse_ALG<span class="token punctuation">(</span>alG<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token operator">//</span>销毁图
    destroy_MGraph<span class="token punctuation">(</span><span class="token operator">&amp;</span>mG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    destroy_ALGraph<span class="token punctuation">(</span><span class="token operator">&amp;</span>alG<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token operator">//</span>运行成功 <span class="token number">2019</span>年<span class="token number">5</span>月<span class="token number">14</span>日<span class="token number">0</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">36</span>
</code></pre>
<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210813224449.png" alt="img" style="zoom: 67%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/09/svm-xue-xi-bi-ji/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/09/svm-xue-xi-bi-ji/" class="post-title-link" itemprop="url">SVM学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-09 21:50:37" itemprop="dateCreated datePublished" datetime="2021-08-09T21:50:37+08:00">2021-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-07 10:10:42" itemprop="dateModified" datetime="2025-01-07T10:10:42+08:00">2025-01-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SVM学习笔记"><a href="#SVM学习笔记" class="headerlink" title="SVM学习笔记"></a>SVM学习笔记</h2><p><a target="_blank" rel="noopener" href="https://www.deeplearningbook.org/">https://www.deeplearningbook.org/</a></p>
<p><a target="_blank" rel="noopener" href="http://page.mi.fu-berlin.de/rojas/neural/neuron.pdf">http://page.mi.fu-berlin.de/rojas/neural/neuron.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://www.svm-tutorial.com/2014/11/svm-understanding-math-part-1/">https://www.svm-tutorial.com/2014/11/svm-understanding-math-part-1/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/06/pandas-xue-xi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/06/pandas-xue-xi/" class="post-title-link" itemprop="url">Pandas学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-06 21:35:53 / 修改时间：22:12:48" itemprop="dateCreated datePublished" datetime="2021-08-06T21:35:53+08:00">2021-08-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Video url: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=vmEHCJofslg">https://www.youtube.com/watch?v=vmEHCJofslg</a></p>
<p>Pandas document: <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html#api">https://pandas.pydata.org/pandas-docs/stable/reference/index.html#api</a></p>
<p>Pracice Pandas:   <a target="_blank" rel="noopener" href="https://stratascratch.com/?via=keith">https://stratascratch.com/?via=keith</a></p>
</blockquote>
<h3 id="1-Loading-data-into-Pandas"><a href="#1-Loading-data-into-Pandas" class="headerlink" title="1. Loading data into Pandas"></a>1. Loading data into Pandas</h3><blockquote>
<p>1.1 Loading data from csv format file</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># read data from csv format file</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pokemon_data.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<blockquote>
<p> 1.2 Loading data from txt format file</p>
</blockquote>
<blockquote>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># read data from txt format file</span>
df_txt <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pokemon_data.txt'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df_txt<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="2-Read-Data-in-Pandas"><a href="#2-Read-Data-in-Pandas" class="headerlink" title="2. Read Data in Pandas"></a>2. Read Data in Pandas</h3><blockquote>
<p>2.1 Read head</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">)</span>
</code></pre>
<p>2.2 Read each Column</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>Name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Type 1'</span><span class="token punctuation">,</span> <span class="token string">'HP'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>2.3 Read each Row</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># print the top 4 rows</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>2.4 Read a specific location(R,C)</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="3-Sorting-Describing-Data"><a href="#3-Sorting-Describing-Data" class="headerlink" title="3. Sorting/Describing Data"></a>3. Sorting/Describing Data</h3><blockquote>
<p> 3.1 View data describe</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>3.2 Sorting</p>
<pre class=" language-python"><code class="language-python">sort_res <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">,</span><span class="token string">'HP'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="4-Making-changes-to-the-data"><a href="#4-Making-changes-to-the-data" class="headerlink" title="4. Making changes to the data"></a>4. Making changes to the data</h3><blockquote>
<p>4.1 Create a new column</p>
<pre class=" language-python"><code class="language-python">df<span class="token punctuation">[</span><span class="token string">'Total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'HP'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df<span class="token punctuation">[</span><span class="token string">'Attack'</span><span class="token punctuation">]</span>
df<span class="token punctuation">[</span><span class="token string">'Total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p>4.2 Delete one column</p>
<pre class=" language-python"><code class="language-python">df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="5-Save-data-to-file"><a href="#5-Save-data-to-file" class="headerlink" title="5. Save data to file"></a>5. Save data to file</h3><blockquote>
<pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'new_data.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="6-Filtering-Data"><a href="#6-Filtering-Data" class="headerlink" title="6. Filtering Data"></a>6. Filtering Data</h3><blockquote>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 过滤出满足条件的数据，过滤出来的数据会保留原来的序号</span>
new_df <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Type 1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'Grass'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Type 2'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'Poison'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 将过滤出来的数据的序号进行重置</span>
new_df<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 过滤出“Name”列中包含“Mega”字段的数据</span>
new_df <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">~</span>df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>str<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'Mega'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 过滤出“Type 1”列中包含“first”和“grass”字段是数据，并且不区别大小写</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Type 1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>str<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'fire|Grass'</span><span class="token punctuation">,</span>flags<span class="token operator">=</span>re<span class="token punctuation">.</span>I<span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># Ignore case</span>

<span class="token comment" spellcheck="true"># 用正则表达式过滤“Name”列中满足条件的数据</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>str<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'^pi[a-z]*'</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>I<span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
</blockquote>
<h3 id="7-Conditional-changes"><a href="#7-Conditional-changes" class="headerlink" title="7. Conditional changes"></a>7. Conditional changes</h3><blockquote>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 把type 1 列中满足条件(等于'Fire')的内容改为Flamer</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'Type 1'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'Fire'</span><span class="token punctuation">,</span> <span class="token string">'Type 1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Flamer'</span>
</code></pre>
</blockquote>
<h3 id="8-Aggregate-Statistics-Groupby"><a href="#8-Aggregate-Statistics-Groupby" class="headerlink" title="8. Aggregate Statistics(Groupby)"></a>8. Aggregate Statistics(Groupby)</h3><blockquote>
<pre class=" language-python"><code class="language-python">res <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Type 1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'HP'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="9-Working-with-large-amounts-of-data"><a href="#9-Working-with-large-amounts-of-data" class="headerlink" title="9. Working with large amounts of data"></a>9. Working with large amounts of data</h3><blockquote>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 分批读取数据，一次读100行</span>
<span class="token keyword">for</span> df <span class="token keyword">in</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pokemon_data.csv'</span><span class="token punctuation">,</span> chunk_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/08/05/pytorch-xue-xi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/05/pytorch-xue-xi/" class="post-title-link" itemprop="url">Pytorch学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-05 21:50:37 / 修改时间：23:04:48" itemprop="dateCreated datePublished" datetime="2021-08-05T21:50:37+08:00">2021-08-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- ## Pytorch 框架学习 -->

<p>课程[链接](https: // <a target="_blank" rel="noopener" href="http://www.youtube.com/">www.youtube.com</a> / watch?v = c36lUUr864M)</p>
<h3 id="1-Tensor"><a href="#1-Tensor" class="headerlink" title="1. Tensor"></a>1. Tensor</h3><h4 id="1-1-How-to-create-tensor"><a href="#1-1-How-to-create-tensor" class="headerlink" title="1.1 How to create tensor"></a>1.1 How to create tensor</h4><blockquote>
<p>构造tensor的方法主要有六种，分别如下：</p>
<ol>
<li><p>x = torch.ones(3, 5, dtype=torch.float, requires_grad = True )</p>
</li>
<li><p>x = torch.zeros(3, 5, dtype=torch.float, requires_grad = True )</p>
</li>
<li><p>x = torch.rand(3, 5, dtype=torch.float, requires_grad = True )</p>
</li>
<li><p>x = torch.empty(3, 5, dtype=torch.float, requires_grad = True )</p>
</li>
<li><p>x = torch.tensor([1,2,3], dtype=torch.float, requires_grad = True )</p>
</li>
<li><p>x_numpy = np.array([1,2,3])<br>x = torch.from_numpy(x_numpy)</p>
</li>
</ol>
</blockquote>
<h4 id="1-2-对Tensor的各种操作"><a href="#1-2-对Tensor的各种操作" class="headerlink" title="1.2 对Tensor的各种操作"></a>1.2 对Tensor的各种操作</h4><blockquote>
<ol>
<li><p>查看数据类型：x.dtype</p>
</li>
<li><p>查看size：x.size()</p>
</li>
<li><p>如果tensor只有一个值，查看实数值：x.item()</p>
</li>
<li><p>改变tensor的形状大小：x = x.view(num_row, num_col)</p>
</li>
<li><p>将tensor转为numpy: z = x.detach().numpy()</p>
</li>
</ol>
<p> ​       注意：numpy只能存放到cpu上面,并且不能是包含梯度的tensor，转换之后共享相同的内存</p>
<ol start="6">
<li>构造新的不包含梯度的tensor：z = x.detach()</li>
</ol>
<ol start="7">
<li>对tensor进行各种转换： .to() eg: x.to(int)</li>
</ol>
</blockquote>
<h4 id="1-3-基本运算"><a href="#1-3-基本运算" class="headerlink" title="1.3 基本运算"></a>1.3 基本运算</h4><blockquote>
<ol>
<li>add: z = x+y</li>
<li>minus: z = x-y</li>
<li>multi: z = x*y</li>
<li>div: z = x/y</li>
<li>切片操作：切片操作十分灵活，用到的时候查询文档</li>
</ol>
</blockquote>
<h3 id="2-Autograd"><a href="#2-Autograd" class="headerlink" title="2. Autograd"></a>2. Autograd</h3><h4 id="2-1-Calculate-the-gradients"><a href="#2-1-Calculate-the-gradients" class="headerlink" title="2.1 Calculate the gradients"></a>2.1 Calculate the gradients</h4><blockquote>
<p>用 z.backward() 来计算z关于变量的梯度，如果正向计算出来的z是一个实数值，则backward的参数为默认值就好，如果z是一个向量，则调用backward()的时候需要传入一个与z的size相同的向量.</p>
<p>  如下面的示例所示。</p>
</blockquote>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">,</span> requires_grad <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>x<span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token operator">+</span><span class="token number">5</span>
z <span class="token operator">=</span> torch<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
z<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># dz/dx jacobian matrix to get the grad</span>
<span class="token comment" spellcheck="true"># z.backward()这一步是用雅可比矩阵来计算梯度，如果正向计算出来的z是</span>
<span class="token comment" spellcheck="true"># 一个实数值，则backward的参数为默认值就好，如果z是一个向量，则调用</span>
<span class="token comment" spellcheck="true"># backward()的时候需要传入一个与z的size相同的向量</span>
<span class="token comment" spellcheck="true"># </span>
<span class="token comment" spellcheck="true"># y = x*x*2+x</span>
<span class="token comment" spellcheck="true"># v = torch.tensor([1.00,0.10,0.200], dtype=torch.float32)</span>
<span class="token comment" spellcheck="true"># y.backward(v)</span>
<span class="token comment" spellcheck="true"># </span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
</code></pre>
<h4 id="2-2-How-to-prevent-pytorch-from-tracking-the-history-and-calculating-this-grad-fn-attribute"><a href="#2-2-How-to-prevent-pytorch-from-tracking-the-history-and-calculating-this-grad-fn-attribute" class="headerlink" title="2.2 How to prevent pytorch from tracking the history and calculating this grad fn attribute."></a>2.2 How to prevent pytorch from tracking the history and calculating this grad fn attribute.</h4><blockquote>
<p>一共有三种方法让tensor不被计算图追踪梯度，分别是：</p>
<p>1） x.requires_grad_(False)</p>
<p>2） x.detach()</p>
<p>3） with torch.no_grad(): pass</p>
<p>具体示例如下所示：</p>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> requires_grad <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 让张量x不在追踪梯度的方法有三种</span>
<span class="token comment" spellcheck="true"># x.requires_grad_(False)</span>
<span class="token comment" spellcheck="true"># x.detach()</span>
<span class="token comment" spellcheck="true"># with torch.no_grad():</span>

<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y <span class="token operator">=</span> x<span class="token operator">+</span><span class="token number">2</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># x with grad</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># y without grad</span>
</code></pre>
</blockquote>
<h4 id="2-3-梯度累积"><a href="#2-3-梯度累积" class="headerlink" title="2.3 梯度累积"></a>2.3 梯度累积</h4><blockquote>
<p>调用backward()来计算梯度的时候，当前轮次的梯度，是之前所有轮次梯度的累积和，在梯度下降学习中这是我们不想看到的，可以调用zero_()函数来将梯度变为0.</p>
<p>示例如下：</p>
<pre class=" language-python"><code class="language-python">weights <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model_output <span class="token operator">=</span> <span class="token punctuation">(</span>weights<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model_output<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>weights<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#     weights.grad.zero_()</span>
    
<span class="token comment" spellcheck="true"># 输出结果为：</span>
<span class="token comment" spellcheck="true"># tensor([3., 3., 3.])</span>
<span class="token comment" spellcheck="true"># tensor([6., 6., 6.])</span>
<span class="token comment" spellcheck="true"># 第一个epoch为3，第二个epoch为6，说明梯度在累加</span>
<span class="token comment" spellcheck="true"># 因为梯度累积是我们不希望看到的，所以每次迭代的时候我们希望梯度</span>
<span class="token comment" spellcheck="true"># 能够清零，梯度清零用.grad.zero_()函数</span>
</code></pre>
</blockquote>
<h3 id="3-Backpropagation"><a href="#3-Backpropagation" class="headerlink" title="3. Backpropagation"></a>3. Backpropagation</h3><blockquote>
<p>调用backward()函数来进行反向传播，计算梯度，示例如下：</p>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
w <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

loss <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">*</span>w<span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">## output:</span>
<span class="token comment" spellcheck="true"># tensor(1., grad_fn=&lt;PowBackward0>)</span>
<span class="token comment" spellcheck="true"># tensor(-2.)</span>
</code></pre>
</blockquote>
<h3 id="4-Optimize-model-with-automatic-gradient-computation"><a href="#4-Optimize-model-with-automatic-gradient-computation" class="headerlink" title="4. Optimize model with automatic gradient computation"></a>4. Optimize model with automatic gradient computation</h3><h4 id="4-1-用numpy实现回归算法"><a href="#4-1-用numpy实现回归算法" class="headerlink" title="4.1 用numpy实现回归算法"></a>4.1 用numpy实现回归算法</h4><blockquote>
<p>实现回归算法分为如下几步：</p>
<p>​    1） 数据准备</p>
<p>​    2）定义function</p>
<p>​    3）定义loss function</p>
<p>​    4） 定义梯度计算公式</p>
<p>​    5） 编写training loop部分代码</p>
<p>实现代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># f = w * x </span>

<span class="token comment" spellcheck="true"># f = 2 * x</span>
<span class="token comment" spellcheck="true"># 1. 用numpy手动实现</span>

<span class="token comment" spellcheck="true"># prepare dataset</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

w <span class="token operator">=</span> <span class="token number">0.0</span>

<span class="token comment" spellcheck="true"># model prediction</span>
<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> w<span class="token operator">*</span>x

<span class="token comment" spellcheck="true"># loss = MSE</span>
<span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y_pred <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># gradient</span>
<span class="token keyword">def</span> <span class="token function">gradient</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>x<span class="token operator">*</span><span class="token punctuation">(</span>y_pred <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction before training: f(5) = &amp;#123;forward(5):.5f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Training</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.1</span>
n_iters <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n_iters<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> forward<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    dw <span class="token operator">=</span> gradient<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    w <span class="token operator">-=</span> learning_rate<span class="token operator">*</span>dw
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch &amp;#123;i+1&amp;#125;: w = &amp;#123;w:.3f&amp;#125;, loss = &amp;#123;l:.10f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction after training: f(5) = &amp;#123;forward(5):.5f&amp;#125;'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h4 id="4-2-用pytorch替换数据类型和梯度计算"><a href="#4-2-用pytorch替换数据类型和梯度计算" class="headerlink" title="4.2 用pytorch替换数据类型和梯度计算"></a>4.2 用pytorch替换数据类型和梯度计算</h4><blockquote>
<p>代码实现思路与4.1一样，没有做任何变化。</p>
<p>示例代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 2. Do with pytorch</span>
X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

w <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> requires_grad <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># model prediction</span>
<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> w<span class="token operator">*</span>x

<span class="token comment" spellcheck="true"># loss = MSE</span>
<span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>y_pred <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction before training: f(5) = &amp;#123;forward(5):.5f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Training</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.0001</span>
n_iters <span class="token operator">=</span> <span class="token number">10000</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n_iters<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> forward<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    
    l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    
    l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        w <span class="token operator">-=</span> learning_rate<span class="token operator">*</span>w<span class="token punctuation">.</span>grad
    
    w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch &amp;#123;i+1&amp;#125;: w = &amp;#123;w:.3f&amp;#125;, loss = &amp;#123;l:.10f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction after training: f(5) = &amp;#123;forward(5):.5f&amp;#125;'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h4 id="4-3-用pytorch来做梯度计算和优化"><a href="#4-3-用pytorch来做梯度计算和优化" class="headerlink" title="4.3 用pytorch来做梯度计算和优化"></a>4.3 用pytorch来做梯度计算和优化</h4><blockquote>
<p>4.2 我们用了backward()函数来自动计算梯度，但是梯度下降优化算法依然是我们在4.1版本中的手工编写的公式，这里我们在之前的基础上面更进一步，用pytorch框架中的optimizer来替换掉手工编写的梯度下降方法，代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1） Design model (input, output size, forward pass)</span>
<span class="token comment" spellcheck="true"># 2) Construct loss and optimizer</span>
<span class="token comment" spellcheck="true"># 3) Training loop</span>
<span class="token comment" spellcheck="true">#    - forward pass: compute prediction</span>
<span class="token comment" spellcheck="true">#    - backward pass: gradients</span>
<span class="token comment" spellcheck="true">#    - update weight</span>

<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
x_test <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

n_samples<span class="token punctuation">,</span> n_features <span class="token operator">=</span> X<span class="token punctuation">.</span>shape
<span class="token keyword">print</span><span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span>

input_size <span class="token operator">=</span> n_features
output_size <span class="token operator">=</span> n_features

model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction before training: f(5) = &amp;#123;model(x_test).item():.5f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Training</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
n_iters <span class="token operator">=</span> <span class="token number">1000</span>

loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n_iters<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    
    l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    
    l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
<span class="token comment" spellcheck="true">#     w.grad.zero_()</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>w<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch &amp;#123;i+1&amp;#125;: w = &amp;#123;w[0][0].item():.3f&amp;#125;, loss = &amp;#123;l:.10f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction after training: f(5) = &amp;#123;model(x_test).item():.5f&amp;#125;'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h4 id="4-4-定义更加复杂的模型"><a href="#4-4-定义更加复杂的模型" class="headerlink" title="4.4 定义更加复杂的模型"></a>4.4 定义更加复杂的模型</h4><blockquote>
<p>4.3 及其之前的工作，我们对model的定义都及其的简单，这里我们对model进行改进，通过自定义一个LinearRegress对象来定义一个包含两层全连接的网络建模我们的model，隐藏层的激活函数我们选用了relu()激活函数。代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1） Design model (input, output size, forward pass)</span>
<span class="token comment" spellcheck="true"># 2) Construct loss and optimizer</span>
<span class="token comment" spellcheck="true"># 3) Training loop</span>
<span class="token comment" spellcheck="true">#    - forward pass: compute prediction</span>
<span class="token comment" spellcheck="true">#    - backward pass: gradients</span>
<span class="token comment" spellcheck="true">#    - update weight</span>

<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
x_test <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

n_samples<span class="token punctuation">,</span> n_features <span class="token operator">=</span> X<span class="token punctuation">.</span>shape
<span class="token keyword">print</span><span class="token punctuation">(</span>n_samples<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span>

input_size <span class="token operator">=</span> n_features
output_size <span class="token operator">=</span> n_features

<span class="token comment" spellcheck="true"># model = nn.Linear(input_size, output_size)</span>

<span class="token keyword">class</span> <span class="token class-name">LinearRegress</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> output_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>LinearRegress<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># define layers</span>
        self<span class="token punctuation">.</span>lin1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lin2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span>  self<span class="token punctuation">.</span>lin1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> torch<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>lin2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        

model <span class="token operator">=</span> LinearRegress<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction before training: f(5) = &amp;#123;model(x_test).item():.5f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Training</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
n_iters <span class="token operator">=</span> <span class="token number">1000</span>

loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n_iters<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    
    l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span>
    
    l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
<span class="token comment" spellcheck="true">#     w.grad.zero_()</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
<span class="token comment" spellcheck="true">#         [w, b] = model.parameters()</span>
<span class="token comment" spellcheck="true">#         print(f'epoch &amp;#123;i+1&amp;#125;: parameters = &amp;#123;model.parameters()&amp;#125;, loss = &amp;#123;l:.10f&amp;#125;')</span>
        <span class="token keyword">for</span> parameters <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span>
        
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Prediction after training: f(5) = &amp;#123;model(x_test).item():.5f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Now pytorch can do most of the work for us, of course we still have to design our model</span>
<span class="token comment" spellcheck="true"># and have to know which loss and optimizer we want to use but we don't have to worry about</span>
<span class="token comment" spellcheck="true"># the underlying algorithms anymore.</span>
</code></pre>
</blockquote>
<h4 id="4-5-综合示例1"><a href="#4-5-综合示例1" class="headerlink" title="4.5 综合示例1"></a>4.5 综合示例1</h4><blockquote>
<p>学习完了4.1-4.3的内容，我们对如何手工建模一个模型有了初步的了解，并且知道了pytorch建模深度学习的一般过程，以及它对应的每一个部分的作用，下面我们通过一个综合的示例来加深对所学知识的理解。</p>
<p>在该示例中，我们首先调用sklearn的datasets库来构建带噪声的逻辑回归数据集，然后构造一个线性模型，并对线性模型进行训练。代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 5. 综合示例1</span>

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment" spellcheck="true"># 0) create data</span>
x_numpy<span class="token punctuation">,</span> y_numpy <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_regression<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> n_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> noise<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

x<span class="token punctuation">,</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x_numpy<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>y_numpy<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(x.shape)</span>
<span class="token comment" spellcheck="true"># print(y.shape)</span>
y <span class="token operator">=</span> y<span class="token punctuation">.</span>view<span class="token punctuation">(</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print(y.shape)</span>
n_sample<span class="token punctuation">,</span> n_features <span class="token operator">=</span> x<span class="token punctuation">.</span>shape

<span class="token comment" spellcheck="true"># 1) model</span>
input_size <span class="token operator">=</span> n_features
output_size <span class="token operator">=</span> <span class="token number">1</span>
model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> output_size<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 2）loss and optimizer</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 3) training loop</span>
num_epochs <span class="token operator">=</span> <span class="token number">1000</span>
num_iter <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token comment" spellcheck="true"># foreard pass and loss</span>
 y_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
 loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
 <span class="token comment" spellcheck="true"># backward pass</span>
 loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token comment" spellcheck="true"># updata</span>
 optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

 optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">if</span><span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>num_iter <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
     <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch:&amp;#123;epoch+1&amp;#125;, loss=&amp;#123;loss.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># plot</span>
predicted <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_numpy<span class="token punctuation">,</span> y_numpy<span class="token punctuation">,</span> <span class="token string">'ro'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x_numpy<span class="token punctuation">,</span> predicted<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>运行结果如下：</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805210347.png" alt="image-20210805210341931" style="zoom:50%;" />
</blockquote>
<h4 id="4-6-综合示例2"><a href="#4-6-综合示例2" class="headerlink" title="4.6  综合示例2"></a>4.6  综合示例2</h4><blockquote>
<p>之前的示例中我们没有对训练后的模型进行测试，在这个例子中我们增加了模型测试，并且调用sklearn中内置的“乳腺癌”数据集来完成示例，并且对输入特征做了归一化处理。</p>
<p>代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 5. 综合示例2</span>

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

<span class="token comment" spellcheck="true"># 0) prepare data</span>
bc <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_breast_cancer<span class="token punctuation">(</span><span class="token punctuation">)</span>
X<span class="token punctuation">,</span>y <span class="token operator">=</span> bc<span class="token punctuation">.</span>data<span class="token punctuation">,</span> bc<span class="token punctuation">.</span>target

n_samples<span class="token punctuation">,</span> n_features <span class="token operator">=</span> X<span class="token punctuation">.</span>shape
<span class="token comment" spellcheck="true"># print(X.shape)</span>
<span class="token comment" spellcheck="true"># print(y.shape)</span>

X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1234</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># scale 对每一列的特征做均值方差归一化处理，如果不做的话学习出来的模型的准确率大大降低</span>
sc <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print('X_test before transform:', X_test)</span>
X_train <span class="token operator">=</span> sc<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
X_test <span class="token operator">=</span> sc<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print('X_test after transform:', X_test.mean(), X_test.std())</span>

X_train <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
X_test <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>X_test<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
y_train <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>y_train<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
y_test <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>y_test<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>

y_train <span class="token operator">=</span> y_train<span class="token punctuation">.</span>view<span class="token punctuation">(</span>y_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
y_test <span class="token operator">=</span> y_test<span class="token punctuation">.</span>view<span class="token punctuation">(</span>y_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 1) model</span>
<span class="token comment" spellcheck="true"># f = wx + b, sigmoid at the end</span>
<span class="token keyword">class</span> <span class="token class-name">LogisticRegression</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n_input_features<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>LogisticRegression<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>n_input_features<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> y_pred
    
model <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>n_features<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 2) loss and optimizer</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.001</span>

criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>BCELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr <span class="token operator">=</span> learning_rate<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 3) training loop</span>
num_epochs <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># foreard pass and loss</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>y_pred<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># backward pass</span>
    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment" spellcheck="true"># updates</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch:&amp;#123;epoch+1&amp;#125;, loss = &amp;#123;loss.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>
        
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
    y_pred_cls <span class="token operator">=</span> y_pred<span class="token punctuation">.</span>round<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 对sigmoid出来的值进行四舍五入</span>
<span class="token comment" spellcheck="true">#     print(f'y_pred=&amp;#123;y_pred&amp;#125;, y_pred_cls=&amp;#123;y_pred_cls&amp;#125;')</span>
    acc <span class="token operator">=</span> y_pred_cls<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>y_test<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>float<span class="token punctuation">(</span>y_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'acc = &amp;#123;acc:.4f&amp;#125;'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="5-Dataset-and-Dataload-Class"><a href="#5-Dataset-and-Dataload-Class" class="headerlink" title="5. Dataset and Dataload Class"></a>5. Dataset and Dataload Class</h3><h4 id="5-1-Dataset-and-Dataload"><a href="#5-1-Dataset-and-Dataload" class="headerlink" title="5.1 Dataset and Dataload"></a>5.1 Dataset and Dataload</h4><blockquote>
<p>pytorch中由dataset类管理数据集，可以通过继承dataset类来自定义数据集，代码模板如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">return</span> a signel data

<span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">return</span> length of dataset
</code></pre>
<p>定义好dataset之后，可以通过DataLoader来构造可供训练的迭代器，代码如下：</p>
<pre class=" language-python"><code class="language-python">dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<p>示例如下所示：</p>
<pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">'''
epoch = 1 forward and backward pass of ALL training samples

bach_size = number of training samples in one forward &amp; backward pass

number of iterations = number of passes, each pass using [batch_size] number of samples

e.g. 100 samples, batch_size = 20 --> 100/20 = 5 iterations for 1 epoch
'''</span>

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> Dataset<span class="token punctuation">,</span> DataLoader
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math
<span class="token keyword">import</span> os

<span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'pytorchLearning'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
 os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'/Desktop/pytorchLearning'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># print (os.getcwd())</span>

<span class="token keyword">class</span> <span class="token class-name">WineDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>

 <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment" spellcheck="true"># data loading</span>
     xy <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'./data/wine/wine.csv'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
     self<span class="token punctuation">.</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     self<span class="token punctuation">.</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     self<span class="token punctuation">.</span>n_samples <span class="token operator">=</span> xy<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

 <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

 <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> self<span class="token punctuation">.</span>n_samples
<span class="token comment" spellcheck="true"># # How we can use dataset</span>
<span class="token comment" spellcheck="true"># dataset = WineDataset()</span>
<span class="token comment" spellcheck="true"># first_data = dataset[0]</span>
<span class="token comment" spellcheck="true"># features, label = first_data</span>
<span class="token comment" spellcheck="true"># print(features, label)</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># # How we can use dataload</span>
<span class="token comment" spellcheck="true"># dataloader = DataLoader(dataset=dataset, batch_size=4, shuffle=True, num_workers=2)</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># dataiter = iter(dataloader)</span>
<span class="token comment" spellcheck="true"># data = dataiter.next()</span>
<span class="token comment" spellcheck="true"># features, label = data</span>
<span class="token comment" spellcheck="true"># print(features, label)</span>

dataset <span class="token operator">=</span> WineDataset<span class="token punctuation">(</span><span class="token punctuation">)</span>
dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># training loop</span>
num_epochs<span class="token operator">=</span><span class="token number">2</span>
total_samples <span class="token operator">=</span> len<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
n_iterations <span class="token operator">=</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>total_samples<span class="token operator">/</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>total_samples<span class="token punctuation">,</span> n_iterations<span class="token punctuation">)</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
 <span class="token keyword">for</span> i<span class="token punctuation">,</span><span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> label<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token comment" spellcheck="true"># forward backward, update</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch &amp;#123;epoch+1&amp;#125;/&amp;#123;num_epochs&amp;#125;, step &amp;#123;i+1&amp;#125;/&amp;#123;n_iterations&amp;#125;, inputs &amp;#123;inputs.shape&amp;#125;'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h4 id="5-2-Transforms-for-the-dataset"><a href="#5-2-Transforms-for-the-dataset" class="headerlink" title="5.2 Transforms for the dataset"></a>5.2 Transforms for the dataset</h4><blockquote>
<p>pytorch通过传入transforms类来对输入的数据进行某种变化，transforms类可以调用库定义好的，也可以根据需要自定义。</p>
<p>示例代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">'''
Transforms can be applied to PIL images, tensor, ndarrays, or custom data
during criterion of the dataset

complete list of built-in transforms:
https://pytorch.org/docs/stable/torchvision/transforms.html

On images
---------
CenterCrop, Grayscale, Pad, RandomAffine,
RandomCrop, RandomHorizontalFlip, RandomHorizon
Resize, scale

On Tensors
----------
LinearTransformation, Normalize, RandomErasing

Conversion
----------
ToPILIamage: from tensor or ndarray
ToTensor: from numpy.ndarray or PILImage

Generic
-------
Use Lambda

Custom
------
Write own Class

Compose mutiple Transforms
--------------------------
composed = transforms.Compose([Rescale(256),
                                RandomCrop(224)])
torchvision.transforms.Rescale(256)
torchvision.transforms.ToTensor()
'''</span>
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> Dataset
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">WineDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> transform<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        xy <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'./data/wine/wine.csv'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>n_samples <span class="token operator">=</span> xy<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token comment" spellcheck="true"># note that we do not convert to tensor here</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> xy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sample <span class="token operator">=</span> self<span class="token punctuation">.</span>x<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">:</span>
            sample <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>sample<span class="token punctuation">)</span>

        <span class="token keyword">return</span> sample

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>n_samples

<span class="token keyword">class</span> <span class="token class-name">ToTensor</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sample<span class="token punctuation">)</span><span class="token punctuation">:</span>
        inputs<span class="token punctuation">,</span> targets <span class="token operator">=</span> sample
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>targets<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">MulTransform</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>factor <span class="token operator">=</span> factor

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sample<span class="token punctuation">)</span><span class="token punctuation">:</span>
        inputs<span class="token punctuation">,</span> target <span class="token operator">=</span> sample
        inputs <span class="token operator">*=</span> self<span class="token punctuation">.</span>factor
        <span class="token keyword">return</span> inputs<span class="token punctuation">,</span> target

dataset <span class="token operator">=</span> WineDataset<span class="token punctuation">(</span>transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
first_data <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
features<span class="token punctuation">,</span> label <span class="token operator">=</span> first_data
<span class="token keyword">print</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>


composed <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MulTransform<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 把两个transforms合并一起应用</span>
dataset <span class="token operator">=</span> WineDataset<span class="token punctuation">(</span>transform<span class="token operator">=</span>composed<span class="token punctuation">)</span>
first_data <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
features<span class="token punctuation">,</span> label <span class="token operator">=</span> first_data
<span class="token keyword">print</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="6-Softmax-and-Cross-Entropy"><a href="#6-Softmax-and-Cross-Entropy" class="headerlink" title="6. Softmax and Cross-Entropy"></a>6. Softmax and Cross-Entropy</h3><h4 id="6-1-Softmax"><a href="#6-1-Softmax" class="headerlink" title="6.1 Softmax"></a>6.1 Softmax</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Softmax</span>
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">softmax</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
outputs <span class="token operator">=</span> softmax<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'softmax numpy:'</span><span class="token punctuation">,</span> outputs<span class="token punctuation">)</span>

x <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
outputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'softmax torch:'</span><span class="token punctuation">,</span> outputs<span class="token punctuation">)</span>
</code></pre>
<h4 id="6-2-Cross-entropy"><a href="#6-2-Cross-entropy" class="headerlink" title="6.2 Cross entropy"></a>6.2 Cross entropy</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Cross entropy</span>

<span class="token keyword">def</span> <span class="token function">cross_entropy</span><span class="token punctuation">(</span>actual<span class="token punctuation">,</span> predicted<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>actual<span class="token operator">*</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>predicted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># y must be one hot encoded</span>
<span class="token comment" spellcheck="true"># if class 0: [1 0 0]</span>
<span class="token comment" spellcheck="true"># if class 1: [0 1 0]</span>
<span class="token comment" spellcheck="true"># if class 2: [0 0 1]</span>
Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># y_pred has probabilities</span>
y_pred_good <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred_bad <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
l1 <span class="token operator">=</span> cross_entropy<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> y_pred_good<span class="token punctuation">)</span>
l2 <span class="token operator">=</span> cross_entropy<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> y_pred_bad<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss1 numpy:&amp;#123;l1:.4f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss2 numpy:&amp;#123;l2:.4f&amp;#125;'</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># cross entropy by pytorch</span>
<span class="token comment" spellcheck="true"># in pytorch: Use nn.CrossEntropyLoss()</span>
<span class="token comment" spellcheck="true"># No softmax at the end!</span>
loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># nsamples x nclasses = 1x3</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred_good <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred_bad <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

l1 <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_pred_good<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
l2 <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_pred_bad<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss1 numpy:&amp;#123;l1:.4f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss2 numpy:&amp;#123;l2:.4f&amp;#125;'</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span> prediction1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>y_pred_good<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span> prediction2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>y_pred_bad<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prediction1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prediction2<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># 3 samples</span>
y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred_good <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_pred_bad <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

l1 <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_pred_good<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
l2 <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_pred_bad<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss1 numpy:&amp;#123;l1.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Loss2 numpy:&amp;#123;l2.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span> prediction1 <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>y_pred_good<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span> prediction2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>y_pred_bad<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prediction1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>prediction2<span class="token punctuation">)</span>
</code></pre>
<h3 id="7-Activation-function"><a href="#7-Activation-function" class="headerlink" title="7. Activation function"></a>7. Activation function</h3><blockquote>
<p>Activation functions apply a non-linear transform and decide whether a neural should be activated or not.</p>
<h4 id="Most-popular-activation-functions"><a href="#Most-popular-activation-functions" class="headerlink" title="Most popular activation functions"></a>Most popular activation functions</h4><ol>
<li>Step function –&gt; Not used in practice</li>
<li>Sigmoid</li>
<li>TanH</li>
<li>ReLU</li>
<li>Leaky ReLU</li>
<li>Softmax</li>
</ol>
</blockquote>
<h3 id="8-综合练习-MNIST"><a href="#8-综合练习-MNIST" class="headerlink" title="8. 综合练习 MNIST"></a>8. 综合练习 MNIST</h3><blockquote>
<ol>
<li><p>MNIST</p>
</li>
<li><p>DataLoader, Transformation</p>
</li>
<li><p>Multilayer Neural Net, activation function</p>
</li>
<li><p>Loss and Optimizer</p>
</li>
<li><p>Tra</p>
<p>代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torchvision
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> math
                                 
<span class="token comment" spellcheck="true"># device config</span>
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> optimizer
                                 
device <span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>
                                 
<span class="token comment" spellcheck="true"># hyper parameters</span>
input_size <span class="token operator">=</span> <span class="token number">784</span> <span class="token comment" spellcheck="true"># 28x28</span>
hidden_size <span class="token operator">=</span> <span class="token number">128</span>
num_classes <span class="token operator">=</span> <span class="token number">10</span>
num_epochs <span class="token operator">=</span> <span class="token number">2</span>
batch_size <span class="token operator">=</span> <span class="token number">100</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.001</span>
                                 
<span class="token comment" spellcheck="true"># MNIST DataSet</span>
train_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                           transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                           transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
train_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>train_dataset<span class="token punctuation">,</span>batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                           shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>test_dataset<span class="token punctuation">,</span>batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                           shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
examples <span class="token operator">=</span> iter<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
features<span class="token punctuation">,</span> label <span class="token operator">=</span> examples<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
                                 
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                 
<span class="token comment" spellcheck="true"># model</span>
<span class="token keyword">class</span> <span class="token class-name">NeuralNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>NeuralNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>l1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>l2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>
                                 
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        out <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>l1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>l2<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        <span class="token keyword">return</span> out
                                 
model <span class="token operator">=</span> NeuralNet<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># loss and optimizer</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>
                                 
<span class="token comment" spellcheck="true"># training loop</span>
n_total_steps <span class="token operator">=</span> len<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>images<span class="token punctuation">,</span> label<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 100, 1, 28, 28</span>
        <span class="token comment" spellcheck="true"># 100, 784</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        label <span class="token operator">=</span> label<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
                                 
        <span class="token comment" spellcheck="true"># forward</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
                                 
        <span class="token comment" spellcheck="true"># backward</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'epoch &amp;#123;epoch+1&amp;#125; / &amp;#123;num_epochs&amp;#125;, step &amp;#123;i+1&amp;#125; / &amp;#123;n_total_steps&amp;#125;, loss &amp;#123;loss.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>
                                 
<span class="token comment" spellcheck="true"># test</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_correct <span class="token operator">=</span> <span class="token number">0</span>
    n_sample <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> images<span class="token punctuation">,</span> label <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        label <span class="token operator">=</span> label<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(outputs)</span>
                                 
        <span class="token comment" spellcheck="true"># value, index</span>
        _<span class="token punctuation">,</span> prdiction <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        n_correct <span class="token operator">+=</span> torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>eq<span class="token punctuation">(</span>prdiction<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        n_sample <span class="token operator">+=</span> label<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                                 
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Acc: &amp;#123;100.0*n_correct / n_sample&amp;#125;'</span><span class="token punctuation">)</span>
                                 
</code></pre>
<p>运行结果：</p>
<img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805213343.png" alt="image-20210805213343033" style="zoom:50%;" /></li>
</ol>
</blockquote>
<h3 id="9-Convolutional-Neural-Net-CNN"><a href="#9-Convolutional-Neural-Net-CNN" class="headerlink" title="9.  Convolutional Neural Net(CNN)"></a>9.  Convolutional Neural Net(CNN)</h3><blockquote>
<p>这里我们通过构造CNN模型并对图片进行分类，采用“CIFAR10”数据集，然后自定义Model，调用“交叉熵损失函数”和“SGD”优化器来对模型训练，模型训练结束之后对分类器的分类准确率进行了测试。</p>
<p>实验代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torchvision
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token comment" spellcheck="true"># device config</span>
device <span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># hyper parameters</span>
num_epochs <span class="token operator">=</span> <span class="token number">4</span>
batch_size <span class="token operator">=</span> <span class="token number">4</span>
learning_rate <span class="token operator">=</span><span class="token number">0.001</span>

<span class="token comment" spellcheck="true"># dataset has PILImage images of range[0,1]</span>
<span class="token comment" spellcheck="true"># We transform them to Tensor of normalised range[-1, 1]</span>
transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

train_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                             download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
test_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                             download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>
train_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>train_dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                           shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
test_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>test_dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                           shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

classes <span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'plane'</span><span class="token punctuation">,</span> <span class="token string">'car'</span><span class="token punctuation">,</span><span class="token string">'bird'</span><span class="token punctuation">,</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'deer'</span><span class="token punctuation">,</span><span class="token string">'dog'</span><span class="token punctuation">,</span><span class="token string">'frog'</span><span class="token punctuation">,</span>
          <span class="token string">'horse'</span><span class="token punctuation">,</span><span class="token string">'ship'</span><span class="token punctuation">,</span><span class="token string">'truck'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">imshow</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span> img <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.5</span>  <span class="token comment" spellcheck="true"># unnormalize</span>
    npimg <span class="token operator">=</span> img<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>np<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>npimg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># model</span>
<span class="token keyword">class</span> <span class="token class-name">ConvNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>ConvNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pool <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x


model <span class="token operator">=</span> ConvNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

n_total_steps <span class="token operator">=</span> len<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> labels<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># origin shape:[4,3,32,32] = 4,3, 1024</span>
        <span class="token comment" spellcheck="true"># input_layer:3 input channels, 6 output channels, 5 kernel size</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        labels <span class="token operator">=</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Forward pass</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Backward and optimizer</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Epoch [&amp;#123;epoch+1&amp;#125;/&amp;#123;num_epochs&amp;#125;], Step [&amp;#123;i+1&amp;#125;/&amp;#123;n_total_steps&amp;#125;], Loss: &amp;#123;loss.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># test</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_correct <span class="token operator">=</span> <span class="token number">0</span>
    n_samples <span class="token operator">=</span> <span class="token number">0</span>
    n_class_correct <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    n_class_samples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> images<span class="token punctuation">,</span> labels <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        labels <span class="token operator">=</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># max returns (value ,index)</span>
        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        n_samples <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        n_correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
            label <span class="token operator">=</span> labels<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            pred <span class="token operator">=</span> predicted<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>label <span class="token operator">==</span> pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
                n_class_correct<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            n_class_samples<span class="token punctuation">[</span>label<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

    acc <span class="token operator">=</span> <span class="token number">100.0</span> <span class="token operator">*</span> n_correct <span class="token operator">/</span> n_samples
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Accuracy of the network: &amp;#123;acc&amp;#125; %'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        acc <span class="token operator">=</span> <span class="token number">100.0</span> <span class="token operator">*</span> n_class_correct<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> n_class_samples<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Accuracy of &amp;#123;classes[i]&amp;#125;: &amp;#123;acc&amp;#125; %'</span><span class="token punctuation">)</span>
</code></pre>
</blockquote>
<h3 id="10-Transfer-Learning"><a href="#10-Transfer-Learning" class="headerlink" title="10. Transfer Learning"></a>10. Transfer Learning</h3><blockquote>
<p>这里我们学习迁移学习，主要学习如下三个知识点：</p>
<ol>
<li><p>ImageFolder: how we can use ImageFolder</p>
</li>
<li><p>Scheduler: how we use a scheduler to change the learning rate</p>
</li>
<li><p>Transfer Learning</p>
<p>迁移学习是指在某一个任务上训练好模型，然后将训练好的模型迁移到另外一个任务中，固定模型的某些参数，对另外一些参数进行学习，以便模型能够适应新的任务。</p>
<p>实验代码如下：</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Transfer Learning</span>
                                 
<span class="token comment" spellcheck="true"># 1) ImageFolder: how we can use ImageFolder</span>
<span class="token comment" spellcheck="true"># 2) Scheduler: how we use a scheduler to change the learning rate</span>
<span class="token comment" spellcheck="true"># 3) Transfer Learning:</span>
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> lr_scheduler
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> models<span class="token punctuation">,</span> transforms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">import</span> copy
                                 
<span class="token comment" spellcheck="true"># device config</span>
device <span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>
                                 
mean <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
std <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                 
data_transforms <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token string">'train'</span><span class="token punctuation">:</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
        transforms<span class="token punctuation">.</span>RandomResizedCrop<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>RandomHorizontalFlip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'val'</span><span class="token punctuation">:</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
        transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
                                 
<span class="token comment" spellcheck="true"># import data</span>
data_dir <span class="token operator">=</span> <span class="token string">'data/hymenoptera_data'</span>
sets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span>
image_datasets <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;x:datasets.ImageFolder(os.path.join(data_dir, x),</span>
                                         data_transforms<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
dataloaders <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;x: torch.utils.data.DataLoader(image_datasets[x], batch_size=4,</span>
                                            shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
               <span class="token keyword">for</span> x <span class="token keyword">in</span> sets<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
dataset_sizes <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;x: len(image_datasets[x]) for x in sets&amp;#125;</span>
class_names <span class="token operator">=</span> image_datasets<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>classes
<span class="token keyword">print</span><span class="token punctuation">(</span>class_names<span class="token punctuation">)</span>
                             
<span class="token keyword">def</span> <span class="token function">imshow</span><span class="token punctuation">(</span>inp<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Imshow for Tensor."""</span>
    inp <span class="token operator">=</span> inp<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    inp <span class="token operator">=</span> std <span class="token operator">*</span> inp <span class="token operator">+</span> mean
    inp <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>inp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>inp<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
                              
<span class="token comment" spellcheck="true"># Get a batch of training data</span>
inputs<span class="token punctuation">,</span> classes <span class="token operator">=</span> next<span class="token punctuation">(</span>iter<span class="token punctuation">(</span>dataloaders<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                              
<span class="token comment" spellcheck="true"># Make a grid from batch</span>
out <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
                              
imshow<span class="token punctuation">(</span>out<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token punctuation">[</span>class_names<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> classes<span class="token punctuation">]</span><span class="token punctuation">)</span>
                              
<span class="token keyword">def</span> <span class="token function">train_model</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> scheduler<span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    since <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
                              
    best_model_wts <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    best_acc <span class="token operator">=</span> <span class="token number">0.0</span>
                                  
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Epoch &amp;#123;epoch+1&amp;#125; / &amp;#123;num_epochs&amp;#125;'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">15</span><span class="token punctuation">)</span>
                                  
        <span class="token comment" spellcheck="true"># Each epoch has a training and validation phase</span>
        <span class="token keyword">for</span> phase <span class="token keyword">in</span> sets<span class="token punctuation">:</span>
            <span class="token keyword">if</span> phase <span class="token operator">==</span><span class="token string">'train'</span><span class="token punctuation">:</span>
                model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                  
            running_loss <span class="token operator">=</span> <span class="token number">0.0</span>
            running_correct <span class="token operator">=</span> <span class="token number">0.0</span>
                                  
            <span class="token comment" spellcheck="true"># Iterate over data.</span>
            <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> dataloaders<span class="token punctuation">[</span>phase<span class="token punctuation">]</span><span class="token punctuation">:</span>
                inputs <span class="token operator">=</span> inputs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
                labels <span class="token operator">=</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
                                  
                <span class="token comment" spellcheck="true"># forward</span>
                <span class="token comment" spellcheck="true"># track history if only training</span>
                <span class="token keyword">with</span> torch<span class="token punctuation">.</span>set_grad_enabled<span class="token punctuation">(</span>phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
                    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
                    _<span class="token punctuation">,</span> preds <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                  
                    <span class="token comment" spellcheck="true"># backward + optimizer only if in training phase</span>
                    <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">:</span>
                        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                  
                <span class="token comment" spellcheck="true"># statistics</span>
                running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>inputs<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                running_correct <span class="token operator">+=</span> torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>preds <span class="token operator">==</span> labels<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                                  
            <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">:</span>
                scheduler<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                  
            epoch_loss <span class="token operator">=</span> running_loss <span class="token operator">/</span> dataset_sizes<span class="token punctuation">[</span>phase<span class="token punctuation">]</span>
            epoch_acc <span class="token operator">=</span> running_correct<span class="token punctuation">.</span>double<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> dataset_sizes<span class="token punctuation">[</span>phase<span class="token punctuation">]</span>
                                  
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'&amp;#123;phase&amp;#125; Loss: &amp;#123;epoch_loss:.4f&amp;#125; Acc: &amp;#123;epoch_acc:.4f&amp;#125;'</span><span class="token punctuation">)</span>
                                  
            <span class="token comment" spellcheck="true"># deep copy the model to</span>
            <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'val'</span> <span class="token operator">and</span> epoch_acc <span class="token operator">></span> best_acc<span class="token punctuation">:</span>
                best_acc <span class="token operator">=</span> epoch_acc
                best_model_wts <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                  
    time_elapsed <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>since
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Training complete in &amp;#123;time_elapsed//60:.0f&amp;#125;m &amp;#123;time_elapsed%60:.0fs&amp;#125;'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Best val Acc: &amp;#123;best_acc:4f&amp;#125;'</span><span class="token punctuation">)</span>
                                  
    <span class="token comment" spellcheck="true">#load best model weights</span>
    model<span class="token punctuation">.</span>load_state_dic<span class="token punctuation">(</span>best_model_wts<span class="token punctuation">)</span>
    <span class="token keyword">return</span> model
                              
model <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                              
<span class="token comment" spellcheck="true"># Here, we need to freeze all the network except the final layer.</span>
<span class="token comment" spellcheck="true"># We need to set requires_grad == False to freeze the parameters so that the gradients are not computed in backward()</span>
<span class="token keyword">for</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    param<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span>
                              
num_ftrs <span class="token operator">=</span> model<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>in_features
                              
model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_ftrs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
                              
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
                              
<span class="token comment" spellcheck="true"># Observe that all parameters are being optimized</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>
                              
<span class="token comment" spellcheck="true"># scheduler</span>
step_lr_schedule <span class="token operator">=</span> lr_scheduler<span class="token punctuation">.</span>StepLR<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> step_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Every 7 step， learning rate multiple by 0.1</span>
                              
model <span class="token operator">=</span> train_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> step_lr_schedule<span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span>
</code></pre>
</li>
</ol>
</blockquote>
<h3 id="11-Tensorboard"><a href="#11-Tensorboard" class="headerlink" title="11. Tensorboard"></a>11. Tensorboard</h3><blockquote>
<p>Tensorbard是很好的可视化工具，具体可以参考如下的代码。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Tensorboard</span>

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torchvision
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment" spellcheck="true">############## TENSORBOARD ########################</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>tensorboard <span class="token keyword">import</span> SummaryWriter

<span class="token comment" spellcheck="true"># default `log_dir` is "runs" - we'll be more specific here</span>
writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token string">'runs/mnist1'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">###################################################</span>

<span class="token comment" spellcheck="true"># Device configuration</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Hyper-parameters</span>
input_size <span class="token operator">=</span> <span class="token number">784</span>  <span class="token comment" spellcheck="true"># 28x28</span>
hidden_size <span class="token operator">=</span> <span class="token number">500</span>
num_classes <span class="token operator">=</span> <span class="token number">10</span>
num_epochs <span class="token operator">=</span> <span class="token number">1</span>
batch_size <span class="token operator">=</span> <span class="token number">64</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.001</span>

<span class="token comment" spellcheck="true"># MNIST dataset</span>
train_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span>
                                           train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                           transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                           download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

test_dataset <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./data'</span><span class="token punctuation">,</span>
                                          train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                          transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Data loader</span>
train_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>train_dataset<span class="token punctuation">,</span>
                                           batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                           shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

test_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token operator">=</span>test_dataset<span class="token punctuation">,</span>
                                          batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
                                          shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

examples <span class="token operator">=</span> iter<span class="token punctuation">(</span>test_loader<span class="token punctuation">)</span>
example_data<span class="token punctuation">,</span> example_targets <span class="token operator">=</span> examples<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>example_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># plt.show()</span>

<span class="token comment" spellcheck="true">############## TENSORBOARD ########################</span>
img_grid <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>make_grid<span class="token punctuation">(</span>example_data<span class="token punctuation">)</span>
writer<span class="token punctuation">.</span>add_image<span class="token punctuation">(</span><span class="token string">'mnist_images'</span><span class="token punctuation">,</span> img_grid<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true"># writer.close()</span>
<span class="token comment" spellcheck="true"># sys.exit()</span>
<span class="token comment" spellcheck="true">###################################################</span>

<span class="token comment" spellcheck="true"># Fully connected neural network with one hidden layer</span>
<span class="token keyword">class</span> <span class="token class-name">NeuralNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">:</span>
        super<span class="token punctuation">(</span>NeuralNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>input_size <span class="token operator">=</span> input_size
        self<span class="token punctuation">.</span>l1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>l2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>l1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        out <span class="token operator">=</span> self<span class="token punctuation">.</span>l2<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># no activation and no softmax at the end</span>
        <span class="token keyword">return</span> out


model <span class="token operator">=</span> NeuralNet<span class="token punctuation">(</span>input_size<span class="token punctuation">,</span> hidden_size<span class="token punctuation">,</span> num_classes<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Loss and optimizer</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">############## TENSORBOARD ########################</span>
writer<span class="token punctuation">.</span>add_graph<span class="token punctuation">(</span>model<span class="token punctuation">,</span> example_data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># writer.close()</span>
<span class="token comment" spellcheck="true"># sys.exit()</span>
<span class="token comment" spellcheck="true">###################################################</span>

<span class="token comment" spellcheck="true"># Train the model</span>
running_loss <span class="token operator">=</span> <span class="token number">0.0</span>
running_correct <span class="token operator">=</span> <span class="token number">0</span>
n_total_steps <span class="token operator">=</span> len<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>images<span class="token punctuation">,</span> labels<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># origin shape: [100, 1, 28, 28]</span>
        <span class="token comment" spellcheck="true"># resized: [100, 784]</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        labels <span class="token operator">=</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Forward pass</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># Backward and optimize</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>

        running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        running_correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Epoch [&amp;#123;epoch + 1&amp;#125;/&amp;#123;num_epochs&amp;#125;], Step [&amp;#123;i + 1&amp;#125;/&amp;#123;n_total_steps&amp;#125;], Loss: &amp;#123;loss.item():.4f&amp;#125;'</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">############## TENSORBOARD ########################</span>
            writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'training loss'</span><span class="token punctuation">,</span> running_loss <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> epoch <span class="token operator">*</span> n_total_steps <span class="token operator">+</span> i<span class="token punctuation">)</span>
            running_accuracy <span class="token operator">=</span> running_correct <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">/</span> predicted<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'accuracy'</span><span class="token punctuation">,</span> running_accuracy<span class="token punctuation">,</span> epoch <span class="token operator">*</span> n_total_steps <span class="token operator">+</span> i<span class="token punctuation">)</span>
            running_correct <span class="token operator">=</span> <span class="token number">0</span>
            running_loss <span class="token operator">=</span> <span class="token number">0.0</span>
            <span class="token comment" spellcheck="true">###################################################</span>

<span class="token comment" spellcheck="true"># Test the model</span>
<span class="token comment" spellcheck="true"># In test phase, we don't need to compute gradients (for memory efficiency)</span>
class_labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
class_preds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_correct <span class="token operator">=</span> <span class="token number">0</span>
    n_samples <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> images<span class="token punctuation">,</span> labels <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        labels <span class="token operator">=</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># max returns (value ,index)</span>
        values<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span>max<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        n_samples <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        n_correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

        class_probs_batch <span class="token operator">=</span> <span class="token punctuation">[</span>F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> output <span class="token keyword">in</span> outputs<span class="token punctuation">]</span>

        class_preds<span class="token punctuation">.</span>append<span class="token punctuation">(</span>class_probs_batch<span class="token punctuation">)</span>
        class_labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>predicted<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># 10000, 10, and 10000, 1</span>
    <span class="token comment" spellcheck="true"># stack concatenates tensors along a new dimension</span>
    <span class="token comment" spellcheck="true"># cat concatenates tensors in the given dimension</span>
    class_preds <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>batch<span class="token punctuation">)</span> <span class="token keyword">for</span> batch <span class="token keyword">in</span> class_preds<span class="token punctuation">]</span><span class="token punctuation">)</span>
    class_labels <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>class_labels<span class="token punctuation">)</span>

    acc <span class="token operator">=</span> <span class="token number">100.0</span> <span class="token operator">*</span> n_correct <span class="token operator">/</span> n_samples
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Accuracy of the network on the 10000 test images: &amp;#123;acc&amp;#125; %'</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">############## TENSORBOARD ########################</span>
    classes <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> classes<span class="token punctuation">:</span>
        labels_i <span class="token operator">=</span> class_labels <span class="token operator">==</span> i
        preds_i <span class="token operator">=</span> class_preds<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>
        writer<span class="token punctuation">.</span>add_pr_curve<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> labels_i<span class="token punctuation">,</span> preds_i<span class="token punctuation">,</span> global_step<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">###################################################</span>
</code></pre>
</blockquote>
<h3 id="12-Saving-and-Loading-model"><a href="#12-Saving-and-Loading-model" class="headerlink" title="12. Saving and Loading model"></a>12. Saving and Loading model</h3><blockquote>
<pre><code>
2 DIFFERENT WAYS OF SAVING
# 1) lazy way: save whole model
torch.save(model, PATH)

# model class must be defined somewhere
model = torch.load(PATH)
model.eval()

# 2) recommended way: save only the state_dict
torch.save(model.state_dict(), PATH)

# model must be created again with parameters
model = Model(*args, **kwargs)
model.load_state_dict(torch.load(PATH))
model.eval()
</code></pre>
<p> 示例代码如下:</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

<span class="token keyword">class</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n_input_features<span class="token punctuation">)</span><span class="token punctuation">:</span>
    super<span class="token punctuation">(</span>Model<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>n_input_features<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_pred <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> y_pred

model <span class="token operator">=</span> Model<span class="token punctuation">(</span>n_input_features<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># train your model...</span>

<span class="token comment" spellcheck="true">####################save all ######################################</span>
<span class="token keyword">for</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># save and load entire model</span>

FILE <span class="token operator">=</span> <span class="token string">"model.pth"</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> FILE<span class="token punctuation">)</span>

loaded_model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>FILE<span class="token punctuation">)</span>
loaded_model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> param <span class="token keyword">in</span> loaded_model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">############save only state dict #########################</span>

<span class="token comment" spellcheck="true"># save only state dict</span>
FILE <span class="token operator">=</span> <span class="token string">"model.pth"</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FILE<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
loaded_model <span class="token operator">=</span> Model<span class="token punctuation">(</span>n_input_features<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
loaded_model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>FILE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># it takes the loaded dictionary, not the path file itself</span>
loaded_model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>loaded_model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">###########load checkpoint#####################</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>

checkpoint <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
<span class="token string">"epoch"</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span>
<span class="token string">"model_state"</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">"optim_state"</span><span class="token punctuation">:</span> optimizer<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
FILE <span class="token operator">=</span> <span class="token string">"checkpoint.pth"</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>checkpoint<span class="token punctuation">,</span> FILE<span class="token punctuation">)</span>

model <span class="token operator">=</span> Model<span class="token punctuation">(</span>n_input_features<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

checkpoint <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>FILE<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>checkpoint<span class="token punctuation">[</span><span class="token string">'model_state'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
optimizer<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>checkpoint<span class="token punctuation">[</span><span class="token string">'optim_state'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
epoch <span class="token operator">=</span> checkpoint<span class="token punctuation">[</span><span class="token string">'epoch'</span><span class="token punctuation">]</span>

model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># - or -</span>
<span class="token comment" spellcheck="true"># model.train()</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Remember that you must call model.eval() to set dropout and batch normalization layers </span>
<span class="token comment" spellcheck="true"># to evaluation mode before running inference. Failing to do this will yield </span>
<span class="token comment" spellcheck="true"># inconsistent inference results. If you wish to resuming training, </span>
<span class="token comment" spellcheck="true"># call model.train() to ensure these layers are in training mode.</span>

<span class="token triple-quoted-string string">""" SAVING ON GPU/CPU 

# 1) Save on GPU, Load on CPU
device = torch.device("cuda")
model.to(device)
torch.save(model.state_dict(), PATH)

device = torch.device('cpu')
model = Model(*args, **kwargs)
model.load_state_dict(torch.load(PATH, map_location=device))

# 2) Save on GPU, Load on GPU
device = torch.device("cuda")
model.to(device)
torch.save(model.state_dict(), PATH)

model = Model(*args, **kwargs)
model.load_state_dict(torch.load(PATH))
model.to(device)

# Note: Be sure to use the .to(torch.device('cuda')) function 
# on all model inputs, too!

# 3) Save on CPU, Load on GPU
torch.save(model.state_dict(), PATH)

device = torch.device("cuda")
model = Model(*args, **kwargs)
model.load_state_dict(torch.load(PATH, map_location="cuda:0"))  # Choose whatever GPU device number you want
model.to(device)

# This loads the model to a given GPU device. 
# Next, be sure to call model.to(torch.device('cuda')) to convert the model’s parameter tensors to CUDA tensors
"""</span>
</code></pre>
</blockquote>
<h3 id="13-Summary"><a href="#13-Summary" class="headerlink" title="13. Summary"></a>13. Summary</h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805230250.png" alt="pytorch" style="zoom:50%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/07/20/li-bao-chun-writing-perfect-papers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/20/li-bao-chun-writing-perfect-papers/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-20 22:52:09" itemprop="dateCreated datePublished" datetime="2021-07-20T22:52:09+08:00">2021-07-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="李葆春——Writing-Perfect-Papers"><a href="#李葆春——Writing-Perfect-Papers" class="headerlink" title="李葆春——Writing Perfect Papers"></a>李葆春——<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV18v411n7mr?share_source=copy_web">Writing Perfect Papers</a></h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210720225101.png" alt="WechatIMG19487" style="zoom:200%;" />
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/07/01/huggingface-yu-xun-lian-mo-xing-quan-chong-xia-zai-de-wen-ti/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/01/huggingface-yu-xun-lian-mo-xing-quan-chong-xia-zai-de-wen-ti/" class="post-title-link" itemprop="url">Huggingface 预训练模型权重下载的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-07-01 01:44:09 / 修改时间：02:48:11" itemprop="dateCreated datePublished" datetime="2021-07-01T01:44:09+08:00">2021-07-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv8231417">Hugging face预训练模型</a>和<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1745037">Huggingface 预训练模型权重下载的问题</a></p>
</blockquote>
<p>Hugging face是一个专注于NLP的公司，拥有一个开源的预训练模型库 Transformers ，里面囊括了非常多的模型例如 BERT GPT 等.</p>
<h4 id="模型库"><a href="#模型库" class="headerlink" title="模型库"></a>模型库</h4><p>官网的模型库的地址如下：<a target="_blank" rel="noopener" href="https://huggingface.co/models">https://huggingface.co/models</a> </p>
<h4 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h4><p>首先需要安装transformers库，使用以下命令安装：</p>
<pre class=" language-bash"><code class="language-bash">pip <span class="token function">install</span> transformers
</code></pre>
<p>接下来在代码中调用 <font color=red> AutoTokenizer.from_pretrained</font> 和 <font color=red> AutoModel.from_pretrained </font>即可, 例如：</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> <span class="token operator">*</span>
model_name <span class="token operator">=</span> <span class="token string">'hfl/chinese-xlnet-base'</span>
tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
model <span class="token operator">=</span> AutoModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
</code></pre>
<p>运行后系统会自动下载相关的模型文件并存放在电脑中。使用Windows模型保存的路径在 <font color=red> C:\Users[用户名].cache\torch\transformers</font>目录下，根据模型的不同下载的东西也不相同</p>
<p>使用Linux模型保存的路径在 <font color=red> ~/.cache/torch/transformers/ </font>目录下。</p>
<h4 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h4><p>这些前提是你的电脑有网络可以直接使用代码下载相应的模型文件，但是问题是有些机器是没有外网连接权限或者下载速度非常慢。</p>
<p>这时候就需要把模型文件下载后在导入代码中，还是以刚才的  <font color=red> hfl/chinese-xlnet-base </font>模型为例，直接在官网搜索模型，点击进入模型的详情界面</p>
<p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210701024119.png" alt="20210701024119"></p>
<p>在界面中找到 Files</p>
<p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210701024235.png" alt="20210701024235"></p>
<p>把弹窗内的文件全部下载下来</p>
<p>我们假设文件保存在<font color=red> E:\models\hfl\chinese-xlnet-base\ </font>目录下</p>
<p>我们只需要把<font color=red>model_name </font>修改为下载的文件夹即可</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> <span class="token operator">*</span>
model_name <span class="token operator">=</span> <span class="token string">'E:/models/hfl/chinese-xlnet-base/'</span>
tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
model <span class="token operator">=</span> AutoModel<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span>
</code></pre>
<p>这样问题就解决了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ailyong.cn/2021/06/21/jupyter-notebook-ben-di-fu-wu-qi-da-jian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lyong">
      <meta itemprop="description" content="Keep go on">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lyong's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/21/jupyter-notebook-ben-di-fu-wu-qi-da-jian/" class="post-title-link" itemprop="url">jupyter notebook 本地服务器搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-21 00:36:40 / 修改时间：00:56:36" itemprop="dateCreated datePublished" datetime="2021-06-21T00:36:40+08:00">2021-06-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%88%AC%E5%9D%91%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">爬坑总结</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天在实验室的服务器主机上面搭建了jupyter notebook服务器，记录一下搭建步骤，方便以后查看。</p>
<h4 id="服务器端操作"><a href="#服务器端操作" class="headerlink" title="服务器端操作"></a>服务器端操作</h4><h5 id="生成Jupyter-Notebook配置文件"><a href="#生成Jupyter-Notebook配置文件" class="headerlink" title="生成Jupyter Notebook配置文件"></a>生成Jupyter Notebook配置文件</h5><pre class=" language-bash"><code class="language-bash">$ jupyter notebook --generate-config
</code></pre>
<h5 id="设置登录密码"><a href="#设置登录密码" class="headerlink" title="设置登录密码"></a>设置登录密码</h5><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在命令行输入python命令，进入python交互界面，输入如下命令</span>
from notebook.auth <span class="token function">import</span> <span class="token function">passwd</span>
passwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
Enter password:
Verify password:
Out<span class="token punctuation">[</span>2<span class="token punctuation">]</span>: <span class="token string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span>
</code></pre>
<p>将生成的代码添加到配置文件中</p>
<pre class=" language-bash"><code class="language-bash">c.NotebookApp.password <span class="token operator">=</span> u<span class="token string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span>
</code></pre>
<h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><pre class=" language-bash"><code class="language-bash">$ vim ~/.jupyter/jupyter_notebook_config.py
</code></pre>
<p>在配置文件中添加如下内容</p>
<pre class=" language-bash"><code class="language-bash">c.NotebookApp.allow_origin <span class="token operator">=</span> <span class="token string">'*'</span>
c.NotebookApp.ip <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span> <span class="token comment" spellcheck="true">#所有绑定服务器的IP都能访问，若想只在特定ip访问，输入ip地址即可</span>
c.NotebookApp.port <span class="token operator">=</span> 2021 <span class="token comment" spellcheck="true">#将端口设置为自己喜欢的吧，默认是8888</span>
c.NotebookApp.open_browser <span class="token operator">=</span> False <span class="token comment" spellcheck="true">#我们并不想在服务器上直接打开Jupyter Notebook，所以设置成False</span>
c.NotebookApp.notebook_dir <span class="token operator">=</span> <span class="token string">'/home/jupyter_projects'</span> <span class="token comment" spellcheck="true">#这里是设置Jupyter的根目录，若不设置将默认root的根目录，不安全</span>
c.NotebookApp.allow_root <span class="token operator">=</span> True <span class="token comment" spellcheck="true"># 为了安全，Jupyter默认不允许以root权限启动jupyter</span>
c.NotebookApp.allow_remote_access <span class="token operator">=</span> True
c.NotebookApp.password <span class="token operator">=</span> u<span class="token string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span>
</code></pre>
<h5 id="启动jupyter-notebook"><a href="#启动jupyter-notebook" class="headerlink" title="启动jupyter notebook"></a>启动jupyter notebook</h5><p>在终端输入如下命令启动jupyter notebook：</p>
<pre class=" language-bash"><code class="language-bash">jupyter notebook
</code></pre>
<h4 id="客服端电脑操作"><a href="#客服端电脑操作" class="headerlink" title="客服端电脑操作"></a>客服端电脑操作</h4><pre class=" language-bash"><code class="language-bash">
<span class="token function">ssh</span> username@ipaddress -L 2021:127.0.0.1:2021
</code></pre>
<p>最后在本地浏览器输入地址：127.0.0.1:2021 访问</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lyong</p>
  <div class="site-description" itemprop="description">Keep go on</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lyong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
