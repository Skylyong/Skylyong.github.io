<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>通过docker运行EasyConnect等VPN软件</title>
      <link href="/2025/09/29/tong-guo-docker-yun-xing-easyconnect-deng-vpn-ruan-jian/"/>
      <url>/2025/09/29/tong-guo-docker-yun-xing-easyconnect-deng-vpn-ruan-jian/</url>
      
        <content type="html"><![CDATA[<p>复旦VPN登录<a href="https://yangzhang.site/Note/Fudan/stuvpn/">教程</a></p><p>项目github<a href="https://github.com/docker-easyconnect/docker-easyconnect">地址</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>全局配置Docker客户端代理</title>
      <link href="/2025/09/28/quan-ju-pei-zhi-docker-ke-hu-duan-dai-li/"/>
      <url>/2025/09/28/quan-ju-pei-zhi-docker-ke-hu-duan-dai-li/</url>
      
        <content type="html"><![CDATA[<p>我们下载镜像的时候需要科学上网，下面介绍一下全局配置Docker客户端代理的方法，配置好<br>以后所有 docker build, docker pull, docker run 等命令都可以直接使用代理。</p><h2 id="1-编辑配置目录"><a href="#1-编辑配置目录" class="headerlink" title="1. 编辑配置目录"></a>1. 编辑配置目录</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line"><span class="built_in">sudo</span> vim /etc/systemd/system/docker.service.d/proxy.conf</span><br></pre></td></tr></tbody></table></figure><h2 id="2-写入内容-（根据你的代理地址和端口改）"><a href="#2-写入内容-（根据你的代理地址和端口改）" class="headerlink" title="2. 写入内容 （根据你的代理地址和端口改）"></a>2. 写入内容 （根据你的代理地址和端口改）</h2><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span>   </span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"HTTP_PROXY=http://YOUR_PROXY_IP:YOUR_PROXY_PORT"</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"HTTPS_PROXY=http://YOUR_PROXY_IP:YOUR_PROXY_PORT"</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">"NO_PROXY=localhost,127.0.0.1,registry.local,.internal"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-重载配置并重启docker服务"><a href="#3-重载配置并重启docker服务" class="headerlink" title="3. 重载配置并重启docker服务"></a>3. 重载配置并重启docker服务</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><h2 id="4-验证"><a href="#4-验证" class="headerlink" title="4. 验证"></a>4. 验证</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl show --property=Environment docker</span><br></pre></td></tr></tbody></table></figure><p>如果看到你刚才设置的环境变量就说明配置成功了。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux磁盘管理及MinIO服务配置</title>
      <link href="/2025/09/16/linux-ci-pan-guan-li-ji-minio-fu-wu-pei-zhi/"/>
      <url>/2025/09/16/linux-ci-pan-guan-li-ji-minio-fu-wu-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="一、使用-lsblk-获取磁盘内容"><a href="#一、使用-lsblk-获取磁盘内容" class="headerlink" title="一、使用 lsblk 获取磁盘内容"></a>一、使用 <code>lsblk</code> 获取磁盘内容</h2><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250916204000.png" alt="image-20250916203941166"><br>可以看到：</p><ul><li><strong>sda</strong> 和 <strong>sdc</strong> 是空盘  </li><li><strong>sdb</strong> 是系统盘</li></ul><hr><h2 id="二、磁盘分区和格式化"><a href="#二、磁盘分区和格式化" class="headerlink" title="二、磁盘分区和格式化"></a>二、磁盘分区和格式化</h2><p>以下脚本将一个大容量磁盘（如 3.6T）分为两个相等大小的分区，并格式化为 <code>ext4</code> 文件系统。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment"># 脚本功能：在 Linux 上将一个大容量磁盘（例如 3.6T）分为两个</span></span><br><span class="line"><span class="comment">#          相等大小的分区，并格式化为 ext4 文件系统。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 使用前注意事项：</span></span><br><span class="line"><span class="comment"># 1. 请将 DISK="/dev/sdX" 修改为实际磁盘设备，例如 /dev/sdb。</span></span><br><span class="line"><span class="comment"># 2. 脚本执行会清空磁盘上的所有数据，包括分区表和文件系统。</span></span><br><span class="line"><span class="comment"># 3. 确认磁盘没有挂载，否则可能导致数据丢失或系统异常。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 脚本步骤：</span></span><br><span class="line"><span class="comment"># 1. 清除磁盘上的所有文件系统签名。</span></span><br><span class="line"><span class="comment"># 2. 清除磁盘上的 GPT/MBR 元数据。</span></span><br><span class="line"><span class="comment"># 3. 创建 GPT 分区表。</span></span><br><span class="line"><span class="comment"># 4. 计算磁盘总大小，确定每个分区大小的一半。</span></span><br><span class="line"><span class="comment"># 5. 创建两个主分区，大小相等。</span></span><br><span class="line"><span class="comment"># 6. 将两个分区格式化为 ext4 文件系统。</span></span><br><span class="line"><span class="comment"># 7. 输出完成提示。</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 磁盘设备，请修改为你的实际设备</span></span><br><span class="line">DISK=<span class="string">"/dev/sdc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 警告：会清空磁盘所有数据</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"正在清空磁盘 <span class="variable">$DISK</span> ..."</span></span><br><span class="line"><span class="built_in">sudo</span> wipefs -a <span class="variable">$DISK</span></span><br><span class="line"><span class="built_in">sudo</span> sgdisk --zap-all <span class="variable">$DISK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 GPT 分区表</span></span><br><span class="line"><span class="built_in">sudo</span> parted -s <span class="variable">$DISK</span> mklabel gpt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取磁盘总大小（GiB）</span></span><br><span class="line">DISK_SIZE_GB=$(lsblk -b -dn -o SIZE <span class="variable">$DISK</span>)</span><br><span class="line">DISK_SIZE_GB=$((DISK_SIZE_GB / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个分区大小的一半</span></span><br><span class="line">PART_SIZE_GB=$((DISK_SIZE_GB / <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"磁盘总大小: <span class="variable">${DISK_SIZE_GB}</span>G，每个分区: <span class="variable">${PART_SIZE_GB}</span>G"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建两个分区</span></span><br><span class="line"><span class="built_in">sudo</span> parted -s <span class="variable">$DISK</span> mkpart primary 0G <span class="variable">${PART_SIZE_GB}</span>G</span><br><span class="line"><span class="built_in">sudo</span> parted -s <span class="variable">$DISK</span> mkpart primary <span class="variable">${PART_SIZE_GB}</span>G 100%</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化为 ext4 文件系统</span></span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 <span class="variable">${DISK}</span>1</span><br><span class="line"><span class="built_in">sudo</span> mkfs.ext4 <span class="variable">${DISK}</span>2</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"分区完成，分别为 <span class="variable">${DISK}</span>1 和 <span class="variable">${DISK}</span>2"</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="三、挂载磁盘分区"><a href="#三、挂载磁盘分区" class="headerlink" title="三、挂载磁盘分区"></a>三、挂载磁盘分区</h2><p>下面的脚本用于将分区挂载到 <code>/mnt</code> 下对应目录。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment"># 脚本功能：在 Linux 系统上，将已有分区挂载到 /mnt 下对应目录</span></span><br><span class="line"><span class="comment">#          并自动创建挂载点。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 使用说明：</span></span><br><span class="line"><span class="comment"># 1. 脚本只挂载分区，不修改 /etc/fstab，不做开机自动挂载。</span></span><br><span class="line"><span class="comment"># 2. 脚本会检测挂载点是否存在，如果不存在会自动创建。</span></span><br><span class="line"><span class="comment"># 3. 脚本会检测分区是否已经挂载，避免重复挂载。</span></span><br><span class="line"><span class="comment"># 4. 脚本假设分区已有文件系统（如 ext4、xfs 等）。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 磁盘分区和挂载点对应关系：</span></span><br><span class="line"><span class="comment"># /dev/sda1 -&gt; /mnt/sda1</span></span><br><span class="line"><span class="comment"># /dev/sda2 -&gt; /mnt/sda2</span></span><br><span class="line"><span class="comment"># /dev/sdc1 -&gt; /mnt/sdc1</span></span><br><span class="line"><span class="comment"># /dev/sdc2 -&gt; /mnt/sdc2</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区和挂载点对应关系</span></span><br><span class="line"><span class="built_in">declare</span> -A partitions=(</span><br><span class="line">  [<span class="string">"/dev/sda1"</span>]=<span class="string">"/mnt/sda1"</span></span><br><span class="line">  [<span class="string">"/dev/sda2"</span>]=<span class="string">"/mnt/sda2"</span></span><br><span class="line">  [<span class="string">"/dev/sdc1"</span>]=<span class="string">"/mnt/sdc1"</span></span><br><span class="line">  [<span class="string">"/dev/sdc2"</span>]=<span class="string">"/mnt/sdc2"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历分区并挂载</span></span><br><span class="line"><span class="keyword">for</span> part <span class="keyword">in</span> <span class="string">"<span class="variable">${!partitions[@]}</span>"</span>; <span class="keyword">do</span></span><br><span class="line">    mount_point=<span class="string">"<span class="variable">${partitions[$part]}</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建挂载点</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$mount_point</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p <span class="string">"<span class="variable">$mount_point</span>"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"创建挂载点 <span class="variable">$mount_point</span>"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查分区是否已经挂载</span></span><br><span class="line">    <span class="keyword">if</span> mount | grep -q <span class="string">"<span class="variable">$part</span>"</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$part</span> 已经挂载"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment"># 挂载分区</span></span><br><span class="line">        <span class="built_in">sudo</span> mount <span class="string">"<span class="variable">$part</span>"</span> <span class="string">"<span class="variable">$mount_point</span>"</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"挂载 <span class="variable">$part</span> 到 <span class="variable">$mount_point</span> 完成"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"所有分区挂载完成"</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="四、设置-MinIO-服务"><a href="#四、设置-MinIO-服务" class="headerlink" title="四、设置 MinIO 服务"></a>四、设置 MinIO 服务</h2><h3 id="1-查看服务状态"><a href="#1-查看服务状态" class="headerlink" title="1. 查看服务状态"></a>1. 查看服务状态</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl status minio</span><br></pre></td></tr></tbody></table></figure><h3 id="2-编辑配置文件"><a href="#2-编辑配置文件" class="headerlink" title="2. 编辑配置文件"></a>2. 编辑配置文件</h3><p>根据配置文件所在路径修改参数，修改配置参数之后，加载配置。</p><h3 id="3-加载配置"><a href="#3-加载配置" class="headerlink" title="3. 加载配置"></a>3. 加载配置</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br></pre></td></tr></tbody></table></figure><h3 id="4-重启服务"><a href="#4-重启服务" class="headerlink" title="4. 重启服务"></a>4. 重启服务</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start minio</span><br></pre></td></tr></tbody></table></figure><h3 id="5-配置文件说明"><a href="#5-配置文件说明" class="headerlink" title="5. 配置文件说明"></a>5. 配置文件说明</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- MINIO_ROOT_USER 长度必须 ≥ 3</span><br><span class="line">- MINIO_ROOT_PASSWORD 长度必须 ≥ 8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置目录权限</span></span><br><span class="line"><span class="built_in">chown</span> -R minio:minio /mnt/sda2 /mnt/sda1 /mnt/sdc1 /mnt/sdc2</span><br><span class="line"><span class="built_in">chmod</span> -R 750 /mnt/sda2 /mnt/sda1 /mnt/sdc1 /mnt/sdc2</span><br></pre></td></tr></tbody></table></figure><blockquote><p>⚠️ 注意：这里可能会遇到一些 bug，可以结合 GPT 帮助解决。</p></blockquote><hr><h2 id="五、MinIO-配置"><a href="#五、MinIO-配置" class="headerlink" title="五、MinIO 配置"></a>五、MinIO 配置</h2><h3 id="1-配置-alias"><a href="#1-配置-alias" class="headerlink" title="1. 配置 alias"></a>1. 配置 alias</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc <span class="built_in">alias</span> <span class="built_in">set</span> myminio http://127.0.0.1:9000 {user} {key}</span><br></pre></td></tr></tbody></table></figure><h3 id="2-添加用户"><a href="#2-添加用户" class="headerlink" title="2. 添加用户"></a>2. 添加用户</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc admin user add myminio {new_name} {key}</span><br></pre></td></tr></tbody></table></figure><h3 id="3-创建-bucket"><a href="#3-创建-bucket" class="headerlink" title="3. 创建 bucket"></a>3. 创建 bucket</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc mb myminio/{bucket_name}</span><br></pre></td></tr></tbody></table></figure><h3 id="4-定义权限策略"><a href="#4-定义权限策略" class="headerlink" title="4. 定义权限策略"></a>4. 定义权限策略</h3><p>创建文件 <code>tcmkg-policy.json</code>, 假设 <code>bucket</code> 的名字为 <code>tcmkg-data</code>：</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"Version"</span><span class="punctuation">:</span> <span class="string">"2012-10-17"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"Statement"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"Effect"</span><span class="punctuation">:</span> <span class="string">"Allow"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"Action"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"s3:GetBucketLocation"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"s3:ListBucket"</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"Resource"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"arn:aws:s3:::tcmkg-data"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"Effect"</span><span class="punctuation">:</span> <span class="string">"Allow"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"Action"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"s3:GetObject"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">"s3:PutObject"</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"Resource"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"arn:aws:s3:::tcmkg-data/*"</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>说明：</p><ul><li><strong>s3:GetBucketLocation</strong> + <strong>s3:ListBucket</strong> → 允许查看 bucket 信息、列出对象  </li><li><strong>s3:GetObject</strong> → 允许下载对象  </li><li><strong>s3:PutObject</strong> → 允许上传对象  </li><li>不包含 <strong>s3:DeleteObject</strong> → 用户不能删除对象</li></ul><h3 id="5-应用策略"><a href="#5-应用策略" class="headerlink" title="5. 应用策略"></a>5. 应用策略</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mc admin policy create myminio tcmkg-policy ./tcmkg-policy.json</span><br><span class="line">mc admin policy attach myminio tcmkg-policy --user tcmkg</span><br></pre></td></tr></tbody></table></figure><h3 id="6-Web-端测试"><a href="#6-Web-端测试" class="headerlink" title="6. Web 端测试"></a>6. Web 端测试</h3><p>切换用户进行测试，检查配置是否生效。  </p><hr><p>✅ 这样，你就完成了 <strong>磁盘管理 + MinIO 服务安装与配置</strong> 的全过程。  </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>不动点和压缩映射</title>
      <link href="/2025/08/10/bu-dong-dian-he-ya-suo-ying-she/"/>
      <url>/2025/08/10/bu-dong-dian-he-ya-suo-ying-she/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>矩阵范数</title>
      <link href="/2025/08/10/ju-zhen-fan-shu/"/>
      <url>/2025/08/10/ju-zhen-fan-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是矩阵范数"><a href="#什么是矩阵范数" class="headerlink" title="什么是矩阵范数"></a>什么是矩阵范数</h1><p>矩阵范数（matrix norm）是将一个矩阵映射到非负实数的<strong>函数:  $|\cdot| $</strong>，用来度量矩阵的“大小”或“长度”。矩阵范数需要满足以下三个性质：</p><ul><li><p><strong>非负性：</strong><br>对任意矩阵 $A$，有<br>$$<br>|A| \geq 0<br>$$<br>且当且仅当 $A$ 是零矩阵时，$|A| = 0$。</p></li><li><p><strong>齐次性（正齐次）：</strong><br>对任意标量 $\alpha$ 和矩阵 $A$，有<br>$$<br>|\alpha A| = |\alpha| \cdot |A|<br>$$</p></li><li><p><strong>三角不等式：</strong><br>对任意矩阵 $A$ 和 $B$，有<br>$$<br>|A + B| \leq |A| + |B|<br>$$</p></li></ul><h1 id="矩阵范数的几种常见类型"><a href="#矩阵范数的几种常见类型" class="headerlink" title="矩阵范数的几种常见类型"></a>矩阵范数的几种常见类型</h1><p>常见矩阵范数分两类：</p><h2 id="A-非算子范数（entry-based）"><a href="#A-非算子范数（entry-based）" class="headerlink" title="(A) 非算子范数（entry-based）"></a>(A) 非算子范数（entry-based）</h2><p>直接用矩阵元素来定义：</p><ul><li><p><strong>Frobenius 范数（欧几里得范数）</strong><br>$$<br>|A|<em>F = \sqrt{\sum</em>{i,j} |a_{ij}|^2}<br>$$<br>就是把矩阵当成一个长向量，再取 2 范数。<br>几何意义：像是测量“矩阵中所有元素的能量”。</p></li><li><p><strong>最大行和范数</strong><br>$$<br>|A|<em>{\infty} = \max_i \sum_j |a</em>{ij}|<br>$$<br>行绝对值和最大的那一行的和。</p></li><li><p><strong>最大列和范数</strong><br>$$<br>|A|<em>1 = \max_j \sum_i |a</em>{ij}|<br>$$<br>列绝对值和最大的那一列的和。</p></li></ul><hr><h2 id="B-算子范数（operator-norm）"><a href="#B-算子范数（operator-norm）" class="headerlink" title="(B) 算子范数（operator norm）"></a>(B) 算子范数（operator norm）</h2><p>算子范数（operator norm），也叫矩阵范数 induced norm（诱导范数），是一类由向量范数诱导出来的矩阵范数。它刻画了矩阵作为线性变换对向量的“放大能力”。其定义为：</p><p>$$<br>|A| = \sup_{x \neq 0} \frac{|Ax|}{|x|} = \sup_{|x|=1} |Ax|<br>$$</p><p>这里：</p><ul><li>𝑥是任意非零向量；</li><li>$|A|$ 就是“对所有单位向量 x, Ax 的最大伸缩因子。</li></ul><h3 id="为什么算子范数重要？"><a href="#为什么算子范数重要？" class="headerlink" title="为什么算子范数重要？"></a>为什么算子范数重要？</h3><ul><li><p>它反映了矩阵作为线性变换时的最大“放大效应”。</p></li><li><p>是矩阵稳定性分析、误差估计、数值分析的重要工具。</p></li><li><p>在解线性方程组、优化和控制理论中广泛应用。</p></li></ul><br><h3 id="算子范数与向量范数的关系"><a href="#算子范数与向量范数的关系" class="headerlink" title="算子范数与向量范数的关系"></a>算子范数与向量范数的关系</h3><p>不同的向量范数会诱导出不同的算子范数。常见的向量范数及其对应的算子范数包括：</p><ul><li><p>$\ell_1$ 范数（元素绝对值和）：$|A|<em>1 = \max</em>{1 \le j \le n} \sum_{i=1}^m |a_{ij}|$</p></li><li><p>$\ell_\infty$ 范数（元素绝对值最大值）： $|A|<em>\infty = \max</em>{1 \le i \le m} \sum_{j=1}^n |a_{ij}|$ </p></li><li><p>$\ell_2$ 范数（欧几里得范数）： $|A|<em>2 = \sigma</em>{\max}(A)$，即矩阵 $A$ 的最大奇异值</p></li></ul><br><h3 id="以-ell-2-范数为例的算子范数解析"><a href="#以-ell-2-范数为例的算子范数解析" class="headerlink" title="以 $\ell_2$ 范数为例的算子范数解析"></a>以 $\ell_2$ 范数为例的算子范数解析</h3><p>假设我们用的向量范数是 $\ell_2$ 范数（欧几里得范数）：</p><p>$$<br>|x|_2 = \sqrt{\sum_i |x_i|^2}<br>$$</p><p>此时算子范数定义为：</p><p>$$<br>|A|<em>2 = \sup</em>{|x|_2=1} |Ax|_2<br>$$</p><ul><li><p>这是矩阵 $A$ 对单位球面上的向量的最大伸缩率。</p></li><li><p>其值等于 $A$ 的最大奇异值，即奇异值分解（SVD）中最大的奇异值 $\sigma_{\max}$。</p></li><li><p>几何上，这个范数是 $A$ 作为线性映射从输入空间的单位球映射到输出空间时包络外接球的半径。</p></li></ul><h3 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h3><p>假设</p><p>$$<br>A = \begin{bmatrix}<br>1 &amp; 2 \<br>3 &amp; 4<br>\end{bmatrix}<br>$$</p><ul><li>$\ell_1$ 算子范数是列绝对值和最大值：</li></ul><p>$$<br>|A|_1 = \max { |1| + |3|, ; |2| + |4| } = \max {4, 6} = 6<br>$$</p><ul><li>$\ell_\infty$ 算子范数是行绝对值和最大值：</li></ul><p>$$<br>|A|_\infty = \max { |1| + |2|, ; |3| + |4| } = \max {3, 7} = 7<br>$$</p><ul><li>$\ell_2$ 算子范数是最大奇异值（可用 SVD 求出，大约是 5.47）</li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>向量范数</title>
      <link href="/2025/08/10/xiang-liang-fan-shu/"/>
      <url>/2025/08/10/xiang-liang-fan-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="向量范数的定义"><a href="#向量范数的定义" class="headerlink" title="向量范数的定义"></a>向量范数的定义</h2><p>数学上，向量范数是一个函数 $|\cdot|$，它把向量映射成一个非负实数，并满足以下三个条件（任何合法的范数都要满足）：</p><h3 id="非负性"><a href="#非负性" class="headerlink" title="非负性"></a>非负性</h3><p>$$<br>|x| \geq 0 \quad \text{且} \quad |x| = 0 \iff x = 0<br>$$</p><p>向量的长度不可能是负的，只有零向量长度为零。</p><h3 id="齐次性（homogeneity-scalability）"><a href="#齐次性（homogeneity-scalability）" class="headerlink" title="齐次性（homogeneity / scalability）"></a>齐次性（homogeneity / scalability）</h3><p>$$<br>|\alpha x| = |\alpha| \cdot |x|<br>$$</p><p>缩放向量，长度也按比例缩放。</p><h3 id="三角不等式"><a href="#三角不等式" class="headerlink" title="三角不等式"></a>三角不等式</h3><p>$$<br>|x + y| \leq |x| + |y|<br>$$</p><p>两个向量相加的“长度”不会超过它们长度之和（几何上就是三角形不等式）。</p><hr><h2 id="常见的向量范数"><a href="#常见的向量范数" class="headerlink" title="常见的向量范数"></a>常见的向量范数</h2><h3 id="欧几里得范数（2范数）"><a href="#欧几里得范数（2范数）" class="headerlink" title="欧几里得范数（2范数）"></a>欧几里得范数（2范数）</h3><p>$$<br>|x|_2 = \sqrt{x_1^2 + x_2^2 + \cdots + x_n^2}<br>$$</p><p>就是普通的直线距离。</p><h3 id="1范数"><a href="#1范数" class="headerlink" title="1范数"></a>1范数</h3><p>$$<br>|x|_1 = |x_1| + |x_2| + \cdots + |x_n|<br>$$</p><p>像是“走格子”的距离（曼哈顿距离）。</p><h3 id="无穷范数（∞范数）"><a href="#无穷范数（∞范数）" class="headerlink" title="无穷范数（∞范数）"></a>无穷范数（∞范数）</h3><p>$$<br>|x|_{\infty} = \max_i |x_i|<br>$$</p><p>取坐标里绝对值最大的那一项。</p><h2 id="对欧几里得距离和曼哈顿距离的理解"><a href="#对欧几里得距离和曼哈顿距离的理解" class="headerlink" title="对欧几里得距离和曼哈顿距离的理解"></a>对欧几里得距离和曼哈顿距离的理解</h2><p>假设你在一个城市的街区网格里走路，比如纽约曼哈顿区。街道是按规则的直线网格分布，不能直接穿过建筑物，所以你不能用“直线距离”穿墙过去。</p><p><strong>欧几里得距离（直线距离）</strong>：是你两点之间“飞过去”的最短距离，类似鸟儿直接从一点飞到另一点。</p><p><strong>曼哈顿距离（1范数）</strong>：是你只能沿着街道（水平或垂直方向）走的最短路径距离。比如你从一个路口走到另一个路口，你只能沿着横街和纵街走，走的路径就像在走棋盘上的格子一样。</p><p>用公式来说，两个点  $x = (x_1, x_2, \dots, x_n)$ 和 $y = (y_1, y_2, \dots, y_n)$ 的曼哈顿距离是：</p><p>$$<br>\sum_{i=1}^n |x_i - y_i|<br>$$</p><p>这就像你先沿着第一条街走几格，再沿着第二条街走几格，两个方向的路程加起来，就是总路程。</p><p>所以“走格子”的意思是：你走的路径只能是水平方向和垂直方向的格子线段的总和，而不是两点间的直线。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>范数的基本概念</title>
      <link href="/2025/08/10/fan-shu-de-ji-ben-gai-nian/"/>
      <url>/2025/08/10/fan-shu-de-ji-ben-gai-nian/</url>
      
        <content type="html"><![CDATA[<p>范数（norm）本质上就是一种 <strong>“长度”或“大小”的度量方法</strong>。</p><ul><li><p>对向量来说，范数告诉你“这个向量有多长”。</p></li><li><p>对矩阵来说，范数告诉你“这个矩阵能把向量拉伸多少”或“矩阵自身有多大”。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数学中的齐次性理解</title>
      <link href="/2025/08/10/shu-xue-zhong-de-qi-ci-xing-li-jie/"/>
      <url>/2025/08/10/shu-xue-zhong-de-qi-ci-xing-li-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是齐次性？"><a href="#什么是齐次性？" class="headerlink" title="什么是齐次性？"></a>什么是齐次性？</h2><p>在数学中，<strong>齐次性（Homogeneity）</strong> 通常指函数或方程在输入按比例缩放时，输出也按某个幂次比例缩放的性质。</p><h3 id="齐次函数"><a href="#齐次函数" class="headerlink" title="齐次函数"></a>齐次函数</h3><p>一个映射  $ f: \mathbb{R}^n \to \mathbb{R} $ ，如果对于任意标量 $ \lambda $ 和输入向量 $ x \in \mathbb{R}^n $，满足：</p><p>$$<br>f(\lambda x) = \lambda^k f(x)<br>$$</p><p>则称该映射为<strong>k次齐次函数</strong>。这里，$ k $ 被称为齐次次数（degree of homogeneity）。</p><p><strong>示例：</strong><br>函数 $ f(x,y) = x^2 + y^2 $ 是二次齐次函数，因为</p><p>$$<br>f(\lambda x, \lambda y) = (\lambda x)^2 + (\lambda y)^2 = \lambda^2 (x^2 + y^2) = \lambda^2 f(x,y).<br>$$</p><h2 id="齐次性的重要性"><a href="#齐次性的重要性" class="headerlink" title="齐次性的重要性"></a>齐次性的重要性</h2><ol><li><strong>理解尺度变化行为</strong><br>齐次性说明当输入放大或缩小时，输出会按照确定的幂次比例变化。这个性质帮助我们理解函数对“尺度”变化<br>的敏感度，在建模和分析中非常有用。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Claude-Code学习记录</title>
      <link href="/2025/07/28/claude-code-xue-xi-ji-lu/"/>
      <url>/2025/07/28/claude-code-xue-xi-ji-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="Claude-Code-安装"><a href="#Claude-Code-安装" class="headerlink" title="Claude Code 安装"></a>Claude Code 安装</h2><p>根据官方教程，照着操作就好了: <a href="https://docs.anthropic.com/en/docs/claude-code/setup">https://docs.anthropic.com/en/docs/claude-code/setup</a></p><h2 id="接入-Kimi-K2"><a href="#接入-Kimi-K2" class="headerlink" title="接入 Kimi K2"></a>接入 Kimi K2</h2><p>国内访问 <code>Claude</code> 困难，因此有了Kimi K2 平替方法，下面是操作步骤：</p><p>首先到<a href="https://platform.moonshot.cn/console/api-keys">这里</a>申请一个API， 然后设置环境变量：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ANTHROPIC_BASE_URL=<span class="string">"https://api.moonshot.cn/anthropic/"</span></span><br><span class="line"><span class="built_in">export</span> ANTHROPIC_API_KEY=<span class="string">"你的APY KEY"</span></span><br><span class="line"><span class="built_in">export</span> ANTHROPIC_SMALL_FAST_MODEL=<span class="string">"kimi-k2-turbo-preview"</span> <span class="comment"># claude v 2.0 不指定模型，则会调用默认模型，会报错</span></span><br><span class="line"><span class="built_in">export</span> ANTHROPIC_MODEL=<span class="string">"kimi-k2-turbo-preview"</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>最后，由于 <code>Claude code</code> 设置了地域限制，需要绕过初始登录验证，操作如下。<br>打开 Claude code 的配置文件: <code>vim ~/.claude.json</code>，修改 <code>hasCompletedOnboarding</code> 为 <code>true</code>, 如果没有 <code>hasCompletedOnboarding</code> 则添加。 <strong>这里要注意： <code>hasCompletedOnboarding</code> 不能放在 project里面</strong>。</p><h2 id="使用-Claude-Code"><a href="#使用-Claude-Code" class="headerlink" title="使用 Claude Code"></a>使用 Claude Code</h2><p>在命令行切换到 <code>工作目录</code> ，输入 <code>claude</code> 命令，结合上面的教程，根据提示进行操作即可。</p><h2 id="自定义设置"><a href="#自定义设置" class="headerlink" title="自定义设置"></a>自定义设置</h2><ol><li>创建 <code>CLAUDE.md</code> 文件<br><code>CLAUDE.md</code>&nbsp;是一个特殊文件，Claude 在发起对话时会自动将其拉入上下文中。可以在该文件内指定如下的内容：<ul><li>常用 bash 命令</li><li>核心文件和实用函数</li><li>代码风格指南</li><li>测试说明</li><li>仓库规则（如，分支命名，merge 和 rebase等）</li><li>开发者环境设置（例如，pyenv 的使用、哪些编译器可以工作）</li><li>项目特有的任何意外行为或警告</li><li>希望 Claude 记住的其他信息<br><code>CLAUDE.md</code>&nbsp;文件没有格式要求。建议保持其简洁易读。例如：</li></ul><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Bash commands</span></span><br><span class="line"><span class="bullet">-</span> npm run build: Build the project</span><br><span class="line"><span class="bullet">-</span> npm run typecheck: Run the typechecker</span><br><span class="line"></span><br><span class="line"><span class="section"># Code style</span></span><br><span class="line"><span class="bullet">-</span> Use ES modules (import/export) syntax, not CommonJS (require)</span><br><span class="line"><span class="bullet">-</span> Destructure imports when possible (eg. import { foo } from 'bar')</span><br><span class="line"></span><br><span class="line"><span class="section"># Workflow</span></span><br><span class="line"><span class="bullet">-</span> Be sure to typecheck when you're done making a series of code changes</span><br><span class="line"><span class="bullet">-</span> Prefer running single tests, and not the whole test suite, for performance</span><br></pre></td></tr></tbody></table></figure></li></ol><p>可以将&nbsp;<code>CLAUDE.md</code>&nbsp;文件放在多个位置：</p><ul><li><strong>仓库根目录</strong>&nbsp;，或者你运行&nbsp;<code>claude</code>&nbsp;的任何地方（最常见的用法）。将其命名为&nbsp;<code>CLAUDE.md</code>&nbsp;并将其提交到 git，以便你可以在不同会话之间以及与你的团队共享它（推荐）；或者将其命名为&nbsp;<code>CLAUDE.local.md</code>&nbsp;并&nbsp;<code>.gitignore</code>&nbsp;忽略它。</li><li>运行&nbsp;<code>claude</code>&nbsp;<strong>目录的任何父目录</strong>&nbsp;。这对于 <code>单一代码库</code> 最有用，你可以在&nbsp;<code>root/foo</code>&nbsp;中运行&nbsp;<code>claude</code>&nbsp;，并在&nbsp;<code>root/CLAUDE.md</code>&nbsp;和&nbsp;<code>root/foo/CLAUDE.md</code>&nbsp;中都有&nbsp;<code>CLAUDE.md</code>&nbsp;文件。这两个目录都会自动被拉入上下文。</li><li>运行&nbsp;<code>claude</code>&nbsp;<strong>的目录的任何子目录</strong>&nbsp;。这与上面的操作相反，只会从子目录中的 CLAUDE.md 文件中提取上下文</li><li>用户<strong>主文件夹</strong>&nbsp;（&nbsp;<code>~/.claude/CLAUDE.md</code>&nbsp;），这会将其应用于所有的 claude 会话<br>运行&nbsp;<code>/init</code>&nbsp;命令时，Claude 会自动为你生成一个&nbsp;<code>CLAUDE.md</code>&nbsp;。</li></ul><ol start="2"><li>调整&nbsp;<code>CLAUDE.md</code>&nbsp;文件<br>   <code>CLAUDE.md</code>&nbsp;文件将成为 Claude 提示的一部分，因此应该对其进行优化改进。一个常见的错误是添加大量内容，而没有对其有效性进行迭代。这里需要花时间进行实验，以便确定哪些提示词能够使得模型生成最佳的指令遵循。</li></ol><p>   可以手动将内容添加到&nbsp;<code>CLAUDE.md</code>&nbsp;中，也可以按&nbsp;<code>#</code>&nbsp;键向 Claude 发出指令，使其自动合并到相关的&nbsp;<code>CLAUDE.md</code>&nbsp;中。在 Anthropic，工程师们偶尔会通过修改提示词，来提高模型的指令依从性，比如使用”重要”或”必须”来强调。</p><ol start="3"><li><p>整理 Claude 允许使用的工具列表<br>在默认情况下， 当 Claude Code 进行任何有可能修改系统的操作时，将会请求用户给予权限。这是为了优先考虑安全性的保守做法。使用者可以自定义允许的列表，以允许认为安全的工具，或者允许可能不安全但易于撤销的工具，如文件编辑、git commit等。<br>以下四种方法用于管理工具的许可：</p><ul><li>在会话期间出现提示时，&nbsp;<strong>选择“始终允许”</strong>&nbsp;。</li><li>使用 <strong><code>/permissions</code></strong> : 启动 Claude Code 后，可以添加或移除允许列表中的工具。例如，可以添加&nbsp;<code>Edit</code>&nbsp;以始终允许文件编辑，添加&nbsp;<code>Bash(git commit:*)</code>&nbsp;以允许 git 提交，或添加“&nbsp;<code>mcp__puppeteer__puppeteer_navigate</code>&nbsp;”以允许使用 Puppeteer MCP 服务器进行导航。</li><li><strong>手动编辑</strong>&nbsp;<code>.claude/settings.json</code>&nbsp;或&nbsp;<code>~/.claude.json</code></li><li><strong>使用&nbsp;<code>--allowedTools</code>&nbsp;CLI flag</strong> 获取特定于会话的权限。</li></ul></li><li><p>如果使用 GitHub , 请安装 <code>gh CLI</code><br>Claude 知道如何使用&nbsp;<code>gh</code>&nbsp;CLI 与 GitHub 交互，例如创建问题、提交拉取请求、阅读评论等等。即使没有安装&nbsp;<code>gh</code>&nbsp;，Claude 仍然可以使用 GitHub API 或 MCP 服务器（如果您已安装）。</p></li></ol><h2 id="给-Claude-更多工具"><a href="#给-Claude-更多工具" class="headerlink" title="给 Claude 更多工具"></a>给 Claude 更多工具</h2><ol><li>让 Claude 使用 bash 工具<br><code>Claude Code</code> 会继承你的Bash环境，使其能够访问你所有的工具。虽然Claude可以识别 <code>unix tools</code> 和 <code>gh</code> 等常用工具，但如果没有指令，它就无法识别你自定义的 <code>Bash</code> 工具：<ul><li>告诉 <code>Claude</code> 工具的名称和使用示例</li><li>告诉 <code>Claude</code> 运行 <code>--help</code> 来查看工具的使用文档</li><li>在 <code>CLAUDE.md</code> 中记录常用工具</li></ul></li><li>让 Claude 使用 MCP<br><code>Claude Code</code> 即可以作为 MCP 服务器，也可以作为客户端，作为客户端，它可以连接任意数量的MCP服务器，并通过三种方式访问服务器工具。</li><li>自定义命令<br>对于重复的工作流，可以通过设置提示模版，自定义工作流命令，从而通过 / 访问</li></ol><h2 id="尝试常见的工作流"><a href="#尝试常见的工作流" class="headerlink" title="尝试常见的工作流"></a>尝试常见的工作流</h2><ol><li>探索、规划、编码、提交<br>探索阶段： 告诉 Claude 读取文件，但是不进行任何编码<br>规划阶段： 让 Claude 制定一个解决特殊问题的计划<br>编码阶段： 要求 Claude 在代码中实现其解决方案<br>提交阶段： git维护，readme维护，日志维护以及解释操作<br>📢注意：前面两个步骤至关重要，如果没有这些步骤，<code>Claude</code> 会直接开始编写解决方案，但是如果有前面两个步骤，可以显著提高需要深入思考的问题的效率。</li><li>编写测试，提交；编码，迭代，提交<br>a. 让 Claude 根据预期的输入 输出对编写测试，明确说明你正在进行测试驱动开发。<br>b. 告诉 Claude 运行测试并确认它们是成功还是失败，明确告诉它在此阶段不要编写任何实现代码通常会有所帮助。<br>c. 当对测试满意时，请 Claude 提交测试<br>d. 要求 Claude 编写通过测试的代码，并提示它不要修改测试。<br>e. 对更改满意后，要求 Claude 提交代码</li><li>编写代码，截图结果，迭代</li><li>使用 YOLO模式<br>可以使用 <code>claude --dangerously-skip-permissions</code> 绕过所有权限检查，让 <code>Claude</code> 不间断地工作直至完成。但是这个模式有风险，为了降低风险，最好在没有互联网连接的容器中使用。</li><li>代码库问答<br>在新加入代码库时，可以使用 <code>Claude Code</code> 进行学习和探索，常见问题如下：<br>a. 日志记录如何工作<br>b. 如何创建新的API端点<br>c. 第xx行的作用是什么<br>💡提示： 在 <code>Anthropic</code> , 以这种方式使用 <code>Claude Code</code> 已经成为核心入职工作流程，显著缩短了上手时间，并减轻了其他工程师的负担。</li><li>使用 Claude 与git交互<br> Claude 可以高效地处理许多 git 操作，比如：<br> a. 搜索 git 历史记录来回答诸如”哪些更改导致了 v1.2.3版本”<br> b. 编写提交消息，Claude将自动查看更改和最近的历史记录,并根据所有相关上下文编写一条消息<br> c. 处理复杂的git操作，例如恢复文件、解决rebase等</li><li>使用 Claude 与 GitHub交互</li><li>使用 Claude 来操作 Jupyter Notebook</li></ol><h2 id="优化工作流"><a href="#优化工作流" class="headerlink" title="优化工作流"></a>优化工作流</h2><ol><li>指示要具体</li><li>给 Claude 图片或者图表： 将图像直接拖放到提示输入中，或者提供图像的文件路径</li><li>指定希望Claude查看或处理的文件</li><li>为 Claude 提供URL: 将特定的 url 放在提示词中，以便于 Claude 获取并读取，为了避免出现权限问题，可以将url添加到允许的列表中</li><li>尽早并经常性的纠正错误</li><li>使用 /CLEAR 保持上下文聚焦： 在任务之间用 /clear 命令来重置上下文</li><li>使用清单来处理复杂的工作流</li><li>如何将数据传入 Claude</li></ol><h2 id="使用-headless-mode-实现-infra-的自动化"><a href="#使用-headless-mode-实现-infra-的自动化" class="headerlink" title="使用 headless mode 实现 infra 的自动化"></a>使用 <code>headless mode</code> 实现 <code>infra</code> 的自动化</h2><h2 id="使用多-Claude-来对工作流进行升级"><a href="#使用多-Claude-来对工作流进行升级" class="headerlink" title="使用多 Claude 来对工作流进行升级"></a>使用多 Claude 来对工作流进行升级</h2><ol><li>让一个 Claude 编写代码，另外一个Claude来验证<br>通过启动多个终端，从而实现多个 Claude 的启动</li></ol><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><p>官方教程： <a href="https://www.anthropic.com/engineering/claude-code-best-practices">https://www.anthropic.com/engineering/claude-code-best-practices</a></p></li><li><p>避坑总结： <a href="https://www.bilibili.com/video/BV14SuFzHEof/?spm_id_from=333.337.search-card.all.click&amp;vd_source=23a5f90103c28e0016184059a052d467">https://www.bilibili.com/video/BV14SuFzHEof/?spm_id_from=333.337.search-card.all.click&amp;vd_source=23a5f90103c28e0016184059a052d467</a></p></li><li><p>教程1： <a href="https://www.bilibili.com/video/BV1S8u2zDE5p/?spm_id_from=333.337.search-card.all.click&amp;vd_source=23a5f90103c28e0016184059a052d467">https://www.bilibili.com/video/BV1S8u2zDE5p/?spm_id_from=333.337.search-card.all.click&amp;vd_source=23a5f90103c28e0016184059a052d467</a></p></li><li><p>教程2： <a href="https://www.bilibili.com/video/BV1VkMTzjEhy?spm_id_from=333.788.recommend_more_video.0&amp;vd_source=23a5f90103c28e0016184059a052d467">https://www.bilibili.com/video/BV1VkMTzjEhy?spm_id_from=333.788.recommend_more_video.0&amp;vd_source=23a5f90103c28e0016184059a052d467</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> claude-code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uv常用操作</title>
      <link href="/2025/07/25/uv-chang-yong-cao-zuo/"/>
      <url>/2025/07/25/uv-chang-yong-cao-zuo/</url>
      
        <content type="html"><![CDATA[<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><ol><li>创建一个新的 Python 项目</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uv init hello-world</span><br><span class="line"><span class="built_in">cd</span> hello-world</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>在已有的工作目录中初始化一个项目</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> hello-world</span><br><span class="line"><span class="built_in">cd</span> hello-world</span><br><span class="line">uv init</span><br></pre></td></tr></tbody></table></figure><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>一个完整的项目列表如下所示：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── .venv</span><br><span class="line">│   ├── bin</span><br><span class="line">│   ├── lib</span><br><span class="line">│   └── pyvenv.cfg</span><br><span class="line">├── .python-version</span><br><span class="line">├── README.md</span><br><span class="line">├── main.py</span><br><span class="line">├── pyproject.toml</span><br><span class="line">└── uv.lock</span><br></pre></td></tr></tbody></table></figure><ul><li><code>pyproject.toml</code> 包含有关项目的元数据，如下所示，可以用该文件来指定依赖项目以及项目的详细信息：</li></ul><figure class="highlight toml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[project]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">"hello-world"</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">"0.1.0"</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">"Add your description here"</span></span><br><span class="line"><span class="attr">readme</span> = <span class="string">"README.md"</span></span><br><span class="line"><span class="attr">dependencies</span> = []</span><br></pre></td></tr></tbody></table></figure><ul><li><p><code>.python-version</code> 包含项目的默认Python版本。告诉 <code>uv</code> 在创建项目虚拟环境时使用哪个Python版本。</p></li><li><p><code>.venv</code> 包含项目的虚拟环境，这是一个与系统其他部分隔离的 Python 环境，<code>uv</code> 将在这里安装项目的依赖项。</p></li><li><p><code>uv.lock</code> 是一个跨平台的锁文件，其中包含项目依赖项的精确信息。与用于指定项目总体需求的 <code>pyproject.toml</code> 不同，锁文件包含项目环境中已安装的精确解析版本。此文件应纳入版本控制，以便在不同机器上实现一致且可重复的安装。</p></li></ul><p>注意：<code>uv.lock</code> 是一个人类可读的 TOML 文件，但由 uv 管理，不应手动编辑。</p><h2 id="管理依赖项"><a href="#管理依赖项" class="headerlink" title="管理依赖项"></a>管理依赖项</h2><h3 id="添加依赖项"><a href="#添加依赖项" class="headerlink" title="添加依赖项"></a>添加依赖项</h3><p>可以使用 <code>uv add</code> 命令向 <code>pyproject.toml</code> 文件添加依赖项。这也会更新锁文件和项目环境：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv add requests</span><br></pre></td></tr></tbody></table></figure><p>可以指定版本约束或替代来源：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定版本约束</span></span><br><span class="line">uv add <span class="string">'requests==2.31.0'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加git依赖</span></span><br><span class="line">uv add git+https://github.com/psf/requests</span><br></pre></td></tr></tbody></table></figure><p>也可以使用带有 <code>-r</code> 标志的 <code>uv add</code> 从文件添加所有依赖项：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从requirements.txt添加所有依赖</span></span><br><span class="line">uv add -r requirements.txt -c constraints.txt</span><br></pre></td></tr></tbody></table></figure><h3 id="删除依赖项"><a href="#删除依赖项" class="headerlink" title="删除依赖项"></a>删除依赖项</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv remove requests</span><br></pre></td></tr></tbody></table></figure><h3 id="升级软件包"><a href="#升级软件包" class="headerlink" title="升级软件包"></a>升级软件包</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv lock --upgrade-package requests</span><br></pre></td></tr></tbody></table></figure><h2 id="运行命令"><a href="#运行命令" class="headerlink" title="运行命令"></a>运行命令</h2><p><code>uv run</code> 可用于在您的项目环境中运行任意脚本或命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv run example.py</span><br></pre></td></tr></tbody></table></figure><p>也可以先使用 <code>uv sync</code> 命令手动更新环境，激活环境，再执行命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uv <span class="built_in">sync</span></span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate</span><br><span class="line">flask run -p 3000</span><br><span class="line">python example.py</span><br></pre></td></tr></tbody></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>uv 官网指南：<a href="https://docs.astral.sh/uv/guides/projects/">https://docs.astral.sh/uv/guides/projects/</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>全期望定理公式推导</title>
      <link href="/2025/07/13/quan-qi-wang-ding-li-gong-shi-tui-dao/"/>
      <url>/2025/07/13/quan-qi-wang-ding-li-gong-shi-tui-dao/</url>
      
        <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>最近推导强化学习的<code>Bellman equation</code>，在化解第二项<code>Future Reward</code>项时，需要用到<code>全期望定理</code>，秉承费曼学习法的理念，这里从两个方面对<code>全期望定理</code>公式进行介绍。首先，我们以一个简单的例子从感性上理解该公式，然后再从数学的角度对其进行较为严谨的推导。</p><h1 id="全期望定理公式"><a href="#全期望定理公式" class="headerlink" title="全期望定理公式"></a>全期望定理公式</h1><ol><li>假设$B_1, B_2, …, B_n$ 是一组互不相容的事件，并且形成样本空间的一个分割；</li><li>$C$是一个确定事件，且 $p(C) &gt; 0$；</li><li>$A$是一个随机变量。</li></ol><p>则有：<br>$$E[A | C] = \sum_{i=1}^{n} p(B_i | C) E[A |B_i, C] $$<br>上述公式即为全期望定理公式。</p><h1 id="对公式的感性理解"><a href="#对公式的感性理解" class="headerlink" title="对公式的感性理解"></a>对公式的感性理解</h1><p>用大白话来说就是： <font color="red">我想知道，在已知发生了$C$ 的条件下，随机变量$A$的的平均值是多少？那我们可以先看看，在$C$里，各个子情况$B_i$发生的概率有多少，然后在每个小情况里算一下$A$的平均值，最后加权求和就好了。<br></font><br><br><br>就像是：</p><p>假如我们做一个实验：</p><ul><li>$C$表示“你进入了一所大学”</li><li>$B_1$表示“你进的是数学系”，$B_2$表示“你进的是物理系”…… (这些系把大学分成了划分)</li><li>$A$表示“你的未来收入”</li></ul><p>那么问题是： <strong>在你已经进入大学（B）的前提下，你的未来收入的平均值是多少？</strong></p><p>答案就是：</p><ul><li><p>你在数学系的概率 x 数学系的平均收入</p></li><li><p>你在物理系的概率 x 物理系的平均收入</p></li><li><p>…</p><p>以上加起来就是你在大学的平均收入。</p></li></ul><blockquote><p>Note: 不想看枯燥数学公式的同学看到这里就好了，可以跳过下面的数学证明部分。</p></blockquote><h1 id="对公式的证明"><a href="#对公式的证明" class="headerlink" title="对公式的证明"></a>对公式的证明</h1><h2 id="全期望定理公式的推导"><a href="#全期望定理公式的推导" class="headerlink" title="全期望定理公式的推导"></a>全期望定理公式的推导</h2><p>下面，我们来证明全期望定理公式：$$E[A | C] = \sum_{i=1}^{n} p(B_i | C) E[A |B_i, C] $$</p><p>我们从条件概率的全概率公式（稍后我们再对该公式进行推导）：</p><p>$$<br>\begin{align}<br>p(A=a|C) = \sum_{i=1}^{n} p(A=a|B_i, C) p(B_i|C)<br>\end{align}<br>$$</p><p>出发，进行推导。</p><p>首先，对公式(1) 的左边进行加权求和，得到期望表达式：</p><p>$$<br>\begin{align*}<br>    E[A | C] &amp;= \sum_{a\in A} P(a |C)a \<br>\end{align*}<br>$$<br>接下来，代入公式(1) 的右边，得到：<br>$$\begin{align*}<br>    E[A | C] &amp;= \sum_{a\in A} \sum_{i=1}^{n} p(A=a|B_i, C) p(B_i|C) a \<br>    &amp;= \sum_{i=1}^{n}  p(B_i|C) \sum_{a\in A} p(A=a|B_i, C) a \<br>    &amp;= \sum_{i=1}^{n}  p(B_i|C) E[A | B_i, C] \<br>\end{align*}<br>$$<br>最终，我们得到了全期望定理公式：<br>$$E[A | C] = \sum_{i=1}^{n} p(B_i | C) E[A |B_i, C] $$</p><p>至此，我们从条件概率的全概率公式出发，推导出了全期望定理公式。下面我们从更一般的概念，推导条件概率的全概率公式。</p><h2 id="条件概率的全概率公式的推导"><a href="#条件概率的全概率公式的推导" class="headerlink" title="条件概率的全概率公式的推导"></a>条件概率的全概率公式的推导</h2><ul><li>假设$B_1, B_2, …, B_n$ 是一组互不相容的事件，并且形成样本空间的一个分割；</li><li>$C$是一个确定事件，且 $p(C) &gt; 0$；</li><li>$A$是一个随机变量。</li></ul><p>我们需要推导出下面的等式：<br>$$p(A | C) = \sum_{i=1}^{n} p(A | B_i, C) P(B_i | C)$$</p><p>推导过程：</p><ol><li>我们从条件概率的定义出发：<br>$p(A | C) = \frac{p(A \cap C)}{p(C)}$，<br>我们希望把$p(A|C)$表达为关于$B_i$的加权和。</li></ol> <img src="https://raw.githubusercontent.com/Skylyong/i/main/20250713155940.jpeg" alt="Bellman公式推导" style="zoom: 67%;"><ol start="2"><li><p>使用全概率公式计算$p(A \cap C)$：因为$B_1, B_2, …$ 是一组互不相容的事件，并形成样本空间的一个分割，所以 $A  \cap C$ = $\bigcup_{i=1}^{n} (A \cap B_i \cap C)$(如图所示)， 同时，这些$A \cap B_i \cap C$<br>两两两互不相容，因此：<br>$$p(A \cap C) = \sum_{i=1}^{n} p(A \cap B_i \cap C)$$</p></li><li><p>根据概率的乘法公式，我们对每一项 $p(A \cap B_i \cap C)$进行展开：<br>$$p(A \cap B_i \cap C) = p(A | B_i \cap C) p(B_i \cap C) $$<br>代入上面的公式，得到：<br>$$p(A \cap C) = \sum_{i=1}^{n} p(A | B_i \cap C) p(B_i \cap C)$$</p></li><li><p>将上式，代入 $p(A | C) = \frac{p(A \cap C)}{p(C)}$，得到：<br>$$<br>\begin{align*}<br>p(A | C) &amp;= \frac{\sum_{i=1}^{n} p(A | B_i \cap C) p(B_i \cap C)}{p(C)} \<br>&amp;= \sum_{i=1}^{n} p(A | B_i \cap C) \frac{p(B_i \cap C)}{p(C)} \<br>&amp;= \sum_{i=1}^{n} p(A | B_i, C) p(B_i | C)<br>\end{align*}<br>$$</p></li><li><p>综上，我们得到了条件概率的全概率公式：<br>$$p(A | C) = \sum_{i=1}^{n} p(A | B_i, C) P(B_i | C)$$</p></li></ol><p>推导完毕。<br><br></p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol><li>Bertsekas D, Tsitsiklis J N. Introduction to probability[M]. Athena Scientific, 2008.</li></ol>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 概率论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贝尔曼等式介绍及推导</title>
      <link href="/2025/07/12/bei-er-man-deng-shi-jie-shao-ji-tui-dao/"/>
      <url>/2025/07/12/bei-er-man-deng-shi-jie-shao-ji-tui-dao/</url>
      
        <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p><code>Bellman equation</code> 是强化学习的基石，以前为了快速应用，这部分的知识没有吃透，总是有一种不踏实的感觉，这次从费曼学习法的思想出发，力求完全透彻理解该公式及其推导过程。接下来，我们分三个部分对<code>Bellman equation</code>进行讲述。</p><h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><p>贝尔曼等式推导的前置知识，主要包含条件概率的全概率公式，以及全期望定理，相关介绍在<a href="https://eggplant.wiki/2025/07/13/quan-qi-wang-ding-li-gong-shi-tui-dao/">这里</a>。</p><h1 id="Bellman-equation-推导"><a href="#Bellman-equation-推导" class="headerlink" title="Bellman equation 推导"></a>Bellman equation 推导</h1><h1 id="两个使用-Bellman-equation-的例子"><a href="#两个使用-Bellman-equation-的例子" class="headerlink" title="两个使用 Bellman equation 的例子"></a>两个使用 Bellman equation 的例子</h1>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 强化学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Docker构建Webdav服务器</title>
      <link href="/2025/06/17/shi-yong-docker-gou-jian-webdav-fu-wu-qi/"/>
      <url>/2025/06/17/shi-yong-docker-gou-jian-webdav-fu-wu-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>半年前，我曾基于 Apache2 搭建了一套 <a href="https://eggplant.wiki/2025/01/26/da-jian-webdav-fu-wu-qi-shi-xian-obsidian-he-zotero-duo-duan-tong-bu/">WebDAV 服务</a>，用于实现 Obsidian 和 Zotero 的多端同步。那次部署过程可谓一波三折，尤其是在配置 SSL 签名和 Apache2 时遇到了不少麻烦。由于当时我没有备案的域名，只能使用公网 IP 申请 SSL 证书，而且免费证书只有 3 个月有效期，到期后还需要手动续签。虽然最终勉强配置成功，但也花了我不少时间和精力。</p><p>遗憾的是，这套服务没能持续使用太久。等 SSL 证书过期之后，我因为忙于其他事务也就没有再去续签。而当我想重新启用这套同步方案时，却发现当时使用的华为云廉价服务器（仅 1GB 内存）卡顿严重，连 SSH 登录都成问题。即便重启系统，性能也没有好转，于是这件事便被我搁置了下来。</p><p>直到最近，我再次感受到 Obsidian 与 Zotero 多端同步的强烈需求。恰好这段时间我也深入学习了 Docker 的使用，便想到或许可以通过 Docker 来部署 WebDAV。通过容器化部署，既可以简化配置流程，又能保证未来迁移或重建时的复用性，大大提升效率。</p><p>于是，我选择使用了现成的 WebDAV Docker 镜像，并将服务器迁移到了腾讯云的海外节点。通过购买廉价轻量化域名和海外 IP，我可以在无需备案的情况下正常使用域名访问。更令人欣喜的是，这一次我通过自动化工具配置了 HTTPS，SSL 证书可以自动续签，彻底解决了上一次的痛点。</p><p>这次部署过程整体顺利许多，但中途仍然踩了一些坑。因此，我决定将整个过程记录下来，既是对自己的总结，也希望能为有类似需求的朋友提供参考。</p><h1 id="2-概述"><a href="#2-概述" class="headerlink" title="2. 概述"></a>2. 概述</h1><p>这次配置的基于Docker的WebDAV文件共享服务，主要有如下特点：</p><ul><li>使用Traefik作为反向代理和SSL证书管理</li><li>部署在Docker环境中</li></ul><br><h1 id="3-部署指南"><a href="#3-部署指南" class="headerlink" title="3. 部署指南"></a>3. 部署指南</h1><h2 id="3-1-前提条件"><a href="#3-1-前提条件" class="headerlink" title="3.1 前提条件"></a>3.1 前提条件</h2><ul><li>已安装Docker和Docker Compose</li><li>域名DNS已正确解析到服务器IP</li></ul><h2 id="3-2-配置说明"><a href="#3-2-配置说明" class="headerlink" title="3.2 配置说明"></a>3.2 配置说明</h2><p>主要的配置文件有三个，分别是docker-compose.yml、traefik.toml以及.env。</p><ul><li><p><strong>docker-compose.yml</strong><br>主要负责定义整个服务栈的容器组成和网络配置。包括每个服务使用的镜像、端口映射、卷挂载、环境变量引用、依赖服务等。</p></li><li><p><strong>traefik.toml</strong><br>Traefik 的主配置文件，负责定义 Traefik 本身的行为。例如是否启用 Web UI、监听哪些 entrypoints（如 HTTP/HTTPS）、证书自动申请（Let’s Encrypt）方式、日志输出级别等。</p></li><li><p><strong>.env</strong><br>用于存放环境变量，供 docker-compose.yml 中引用。这样可以实现配置的灵活管理和版本控制的安全性，避免在 compose 文件中硬编码敏感信息（如密码、域名、端口等）。</p></li></ul><blockquote><p><strong>注意</strong>：需要手动修改 <code>traefik.toml</code>中的邮箱地址，因为traefik.toml 不支持使用 .env 文件中的 ACME_EMAIL 变量。</p></blockquote><h2 id="3-3-docker-compose-yml-配置"><a href="#3-3-docker-compose-yml-配置" class="headerlink" title="3.3 docker-compose.yml 配置"></a>3.3 docker-compose.yml 配置</h2><p>下面是 <code>docker-compose.yml</code>中应该填写的配置，这个配置经过多次修改，按照操作一步步下来，是可以直接跑通的。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line"><span class="comment"># See https://docs.docker.com/compose/overview/ for more information.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you make changes to this file or any related files, apply them by</span></span><br><span class="line"><span class="comment"># navigating to the directory that holds this file and run this as root:</span></span><br><span class="line"><span class="comment">#   docker-compose down; docker-compose up -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create two networks: one for front-end containers that we'll make</span></span><br><span class="line"><span class="comment"># publicly accessible to the internet, and one for private back-end.</span></span><br><span class="line">networks:</span><br><span class="line">  frontend:</span><br><span class="line">    name: webdav_frontend  <span class="comment"># Explicitly set network name</span></span><br><span class="line">  backend:</span><br><span class="line">    name: webdav_backend  <span class="comment"># Explicitly set network name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create persistent Docker volumes to preserve important data.</span></span><br><span class="line"><span class="comment"># We don't want our data to be lost when restarting containers.</span></span><br><span class="line">volumes:</span><br><span class="line">  vol-webdav:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create our containers.</span></span><br><span class="line">services:</span><br><span class="line">  <span class="comment"># Traefik is a reverse proxy. It handles SSL and passes traffic to</span></span><br><span class="line">  <span class="comment"># Docker containers via rules you define in docker-compose labels.</span></span><br><span class="line">  <span class="comment"># Its dashboard is at http://example.com/traefik/ (behind a login).</span></span><br><span class="line">  traefik:</span><br><span class="line">    <span class="comment"># https://hub.docker.com/_/traefik/</span></span><br><span class="line">    image: ${BASE_IMAGE_URL}/traefik:latest</span><br><span class="line">    command: </span><br><span class="line">      <span class="comment"># --api --docker --acme.email="${ACME_EMAIL}"</span></span><br><span class="line">      - <span class="string">"--api.dashboard=true"</span></span><br><span class="line">      - <span class="string">"--providers.docker=true"</span></span><br><span class="line">      - <span class="string">"--providers.docker.exposedbydefault=false"</span></span><br><span class="line">      - <span class="string">"--entrypoints.web.address=:80"</span></span><br><span class="line">      - <span class="string">"--entrypoints.websecure.address=:443"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.letsencrypt.acme.httpchallenge=true"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.letsencrypt.acme.email=${ACME_EMAIL}"</span></span><br><span class="line">      - <span class="string">"--certificatesresolvers.letsencrypt.acme.storage=/acme.json"</span></span><br><span class="line">    restart: always</span><br><span class="line">    networks:</span><br><span class="line">      - backend</span><br><span class="line">      - frontend</span><br><span class="line">    volumes:</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock <span class="comment"># Access to Docker</span></span><br><span class="line">      - ./traefik.toml:/traefik.toml              <span class="comment"># Traefik configuration</span></span><br><span class="line">      - ./acme.json:/acme.json                    <span class="comment"># SSL certificates</span></span><br><span class="line">    ports:</span><br><span class="line">      <span class="comment"># Map port 80 and 443 on the host to this container.</span></span><br><span class="line">      - <span class="string">"801:80"</span></span><br><span class="line">      - <span class="string">"4431:443"</span></span><br><span class="line">    labels:</span><br><span class="line">      <span class="comment"># - "traefik.docker.network=webdav_frontend"</span></span><br><span class="line">      <span class="comment"># - "traefik.enable=true"</span></span><br><span class="line">      <span class="comment"># - "traefik.frontend.rule=Host:${TRAEFIK_DOMAINS}; PathPrefixStrip:/traefik"</span></span><br><span class="line">      <span class="comment"># - "traefik.port=8080"</span></span><br><span class="line">      <span class="comment"># - "traefik.protocol=http"</span></span><br><span class="line">      <span class="comment"># # Remove next line to disable login prompt for the dashboard.</span></span><br><span class="line">      <span class="comment"># - "traefik.frontend.auth.basic=${BASIC_AUTH}"</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># - "traefik.enable=true"</span></span><br><span class="line">      <span class="comment"># - "traefik.http.routers.webdav.rule=Host(`eggabc.site`)"</span></span><br><span class="line">      <span class="comment"># - "traefik.http.routers.webdav.entrypoints=websecure"</span></span><br><span class="line">      <span class="comment"># - "traefik.http.routers.webdav.tls.certresolver=letsencrypt"</span></span><br><span class="line">      <span class="comment"># - "traefik.http.services.webdav.loadbalancer.server.port=80"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        - <span class="string">"traefik.enable=true"</span></span><br><span class="line">        - <span class="string">"traefik.http.routers.dashboard.rule=Host(`${TRAEFIK_DOMAINS}`)"</span></span><br><span class="line">        - <span class="string">"traefik.http.routers.dashboard.service=api@internal"</span></span><br><span class="line">        - <span class="string">"traefik.http.routers.dashboard.entrypoints=websecure"</span></span><br><span class="line">        - <span class="string">"traefik.http.routers.dashboard.tls.certresolver=letsencrypt"</span></span><br><span class="line">        - <span class="string">"traefik.http.routers.dashboard.middlewares=auth"</span></span><br><span class="line">        - <span class="string">"traefik.http.middlewares.auth.basicauth.users=${BASIC_AUTH}"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Watchtower detects if any linked containers have an new image</span></span><br><span class="line">  <span class="comment"># available, automatically updating &amp; restarting them if needed.</span></span><br><span class="line">  <span class="comment"># watchtower:</span></span><br><span class="line">  <span class="comment">#   # https://hub.docker.com/r/centurylink/watchtower/</span></span><br><span class="line">  <span class="comment">#   image: v2tec/watchtower:latest</span></span><br><span class="line">  <span class="comment">#   # https://github.com/v2tec/watchtower#options</span></span><br><span class="line">  <span class="comment">#   # This schedule applies updates (if available) at midnight.</span></span><br><span class="line">  <span class="comment">#   command: --cleanup --schedule "0 0 0 * * *"</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - /var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The main WebDAV container.</span></span><br><span class="line">  webdav:</span><br><span class="line">    <span class="comment"># https://hub.docker.com/r/bytemark/webdav/</span></span><br><span class="line">    image: ${BASE_IMAGE_URL}/bytemark/webdav</span><br><span class="line">    restart: always</span><br><span class="line">    networks:</span><br><span class="line">      - frontend</span><br><span class="line">    volumes:</span><br><span class="line">      <span class="comment"># - ./user.passwd:/user.passwd</span></span><br><span class="line">      - <span class="built_in">type</span>: bind</span><br><span class="line">        source: ./user.passwd</span><br><span class="line">        target: /user.passwd</span><br><span class="line">        read_only: true</span><br><span class="line">      - vol-webdav:/var/lib/dav</span><br><span class="line">    environment:</span><br><span class="line">      SERVER_NAMES: ${WEBDAV_DOMAINS}</span><br><span class="line">      LOCATION: ${WEBDAV_LOCATION}</span><br><span class="line">    labels:</span><br><span class="line">      <span class="comment"># - "traefik.docker.network=webdav_frontend"</span></span><br><span class="line">      <span class="comment"># - "traefik.enable=true"</span></span><br><span class="line">      <span class="comment"># - "traefik.frontend.rule=Host:${WEBDAV_DOMAINS}"</span></span><br><span class="line">      <span class="comment"># - "traefik.port=80"</span></span><br><span class="line">      <span class="comment"># - "traefik.protocol=http"</span></span><br><span class="line">      - <span class="string">"traefik.enable=true"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.webdav.rule=Host(`${WEBDAV_DOMAINS}`) &amp;&amp; PathPrefix(`${WEBDAV_LOCATION}`)"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.webdav.entrypoints=websecure"</span></span><br><span class="line">      - <span class="string">"traefik.http.routers.webdav.tls.certresolver=letsencrypt"</span></span><br><span class="line">      - <span class="string">"traefik.http.services.webdav.loadbalancer.server.port=80"</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="3-4-Traefik-配置"><a href="#3-4-Traefik-配置" class="headerlink" title="3.4 Traefik 配置"></a>3.4 Traefik 配置</h2><h3 id="3-4-1-新建-acme-json-文件"><a href="#3-4-1-新建-acme-json-文件" class="headerlink" title="3.4.1 新建  acme.json 文件"></a>3.4.1 新建  acme.json 文件</h3><p> Traefik 需要一个 JSON 文件保存证书信息，请在根目录下新建该空文件，并设置权限：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> acme.json</span><br><span class="line"><span class="built_in">chmod</span> 600 acme.json</span><br></pre></td></tr></tbody></table></figure><h3 id="3-4-2-创建-traefik-toml-文件，并添加如下内容："><a href="#3-4-2-创建-traefik-toml-文件，并添加如下内容：" class="headerlink" title="3.4.2 创建 traefik.toml 文件，并添加如下内容："></a>3.4.2 创建 traefik.toml 文件，并添加如下内容：</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">  checkNewVersion = <span class="literal">false</span></span><br><span class="line">  sendAnonymousUsage = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[entryPoints]</span><br><span class="line">  [entryPoints.web]</span><br><span class="line">    address = <span class="string">":80"</span></span><br><span class="line">  [entryPoints.websecure]</span><br><span class="line">    address = <span class="string">":443"</span></span><br><span class="line"></span><br><span class="line">[api]</span><br><span class="line">  dashboard = <span class="literal">true</span></span><br><span class="line">  insecure = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[providers]</span><br><span class="line">  [providers.docker]</span><br><span class="line">    endpoint = <span class="string">"unix:///var/run/docker.sock"</span></span><br><span class="line">    exposedByDefault = <span class="literal">false</span></span><br><span class="line">    watch = <span class="literal">true</span></span><br><span class="line">    network = <span class="string">"webdav_frontend"</span></span><br><span class="line"></span><br><span class="line">[certificatesResolvers.letsencrypt]</span><br><span class="line">  [certificatesResolvers.letsencrypt.acme]</span><br><span class="line">    email = <span class="string">"your_email_address"</span></span><br><span class="line">    storage = <span class="string">"acme.json"</span></span><br><span class="line">    [certificatesResolvers.letsencrypt.acme.httpChallenge]</span><br><span class="line">      entryPoint = <span class="string">"web"</span></span><br><span class="line"></span><br><span class="line">[<span class="built_in">log</span>]</span><br><span class="line">  level = <span class="string">"INFO"</span></span><br></pre></td></tr></tbody></table></figure><p>提示： 需要将 <code>your_email_address</code> 替换为你自己的邮箱地址。</p><h2 id="3-5-配置环境变量"><a href="#3-5-配置环境变量" class="headerlink" title="3.5 配置环境变量"></a>3.5 配置环境变量</h2><h3 id="3-5-1-设置基本认证"><a href="#3-5-1-设置基本认证" class="headerlink" title="3.5.1 设置基本认证"></a>3.5.1 设置基本认证</h3><ul><li>使用 <code>htpasswd</code> 命令生成用户密码文件 <code>user.passwd</code>：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c user.passwd username</span><br></pre></td></tr></tbody></table></figure><blockquote><p>提示：如果系统中没有安装 htpasswd，可通过安装 apache2-utils（Debian/Ubuntu）或 httpd-tools（CentOS）获得该命令。</p></blockquote><ul><li>设置文件权限<br>设置 user.passwd 文件权限为 644 （不安全，临时快速解决方案）：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 644 user.passwd</span><br></pre></td></tr></tbody></table></figure><p>然后将生成的哈希密码复制到 .env 文件中的 BASIC_AUTH 变量中。</p><h3 id="3-5-2-创建-env文件，并根据提示进行设置"><a href="#3-5-2-创建-env文件，并根据提示进行设置" class="headerlink" title="3.5.2 创建 .env文件，并根据提示进行设置"></a>3.5.2 创建 <code>.env</code>文件，并根据提示进行设置</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker Compose can read environment variables from this file.</span></span><br><span class="line"><span class="comment"># See https://docs.docker.com/compose/env-file/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Put admin areas behind a login prompt, with username and password</span></span><br><span class="line"><span class="comment"># specified here. Run `htpasswd -n admin` to create a password hash</span></span><br><span class="line"><span class="comment"># for user "admin". Paste the output here. SSL strongly recommended.</span></span><br><span class="line"><span class="comment"># 使用 `htpasswd -n username` 命令生成密码哈希。</span></span><br><span class="line">BASIC_AUTH=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Let's Encrypt needs an email address for registration.</span></span><br><span class="line"><span class="comment"># 配置 Let's Encrypt 的注册邮箱，不需要在 Let's Encrypt 网站上注册。</span></span><br><span class="line">ACME_EMAIL=</span><br><span class="line"><span class="comment"># The Traefik dashboard will be available at these domains.</span></span><br><span class="line"><span class="comment"># The URL is http://example.com/traefik/</span></span><br><span class="line"><span class="comment"># You'll need to fill in BASIC_AUTH above.</span></span><br><span class="line"><span class="comment"># Traefik 的仪表盘将可通过这些域名访问，要确保该域名能够被解析，不然会报错</span></span><br><span class="line">TRAEFIK_DOMAINS=</span><br><span class="line"><span class="comment"># Your WebDAV site will be available at these domains. Every domain</span></span><br><span class="line"><span class="comment"># needs DNS records pointing to your server for SSL to work.</span></span><br><span class="line"><span class="comment"># 你的 WebDAV 站点将可通过这些域名访问。每个域名都需要 DNS 记录指向你的服务器，以便 SSL 工作。</span></span><br><span class="line">WEBDAV_DOMAINS=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the URL path where you want your WebDAV site to be.</span></span><br><span class="line"><span class="comment"># 设置 WebDAV 站点的 URL 路径，要以 斜杠结尾，否则报错</span></span><br><span class="line">WEBDAV_LOCATION=/webdav/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置docker镜像的地址</span></span><br><span class="line">BASE_IMAGE_URL=docker.1ms.run</span><br></pre></td></tr></tbody></table></figure><blockquote><p>提示：在上面的配置中，等号右边的变量值都不要加引号，直接填写变量值即可。</p></blockquote><h1 id="4-服务管理"><a href="#4-服务管理" class="headerlink" title="4. 服务管理"></a>4. 服务管理</h1><table><thead><tr><th>操作</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>启动服务</td><td><code>docker-compose up -d</code></td><td>后台启动所有容器</td></tr><tr><td>停止服务</td><td><code>docker-compose down</code></td><td>停止并移除所有容器</td></tr><tr><td>查看日志</td><td><code>docker-compose logs -f</code></td><td>实时查看容器日志</td></tr><tr><td>更新服务</td><td><code>docker-compose pull &amp;&amp; docker-compose up -d</code></td><td>拉取最新镜像并重启服务</td></tr></tbody></table><h1 id="5-注意事项"><a href="#5-注意事项" class="headerlink" title="5. 注意事项"></a>5. 注意事项</h1><p>⚠️ <strong>重要提示</strong>:</p><ul><li>首次启动可能需要几分钟获取SSL证书</li><li>修改配置后需要重启服务生效</li><li>确保<code>.env</code>和<code>user.passwd</code>文件已正确配置</li><li>定期备份<code>acme.json</code>文件以防止证书丢失</li><li>建议使用强密码保护WebDAV访问</li></ul>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webdav, docker, obsidian, zotero </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git_team_collab_workflow</title>
      <link href="/2025/05/14/git-team-collab-workflow/"/>
      <url>/2025/05/14/git-team-collab-workflow/</url>
      
        <content type="html"><![CDATA[<h1 id="🛠️-团队-Git-协作流程规范"><a href="#🛠️-团队-Git-协作流程规范" class="headerlink" title="🛠️ 团队 Git 协作流程规范"></a>🛠️ 团队 Git 协作流程规范</h1><p>为确保多人协作开发的高效与规范，团队统一采用如下 Git 工作流流程， 记录如下：</p><h2 id="🛠️-0-克隆远程仓库"><a href="#🛠️-0-克隆远程仓库" class="headerlink" title="🛠️ 0. 克隆远程仓库"></a>🛠️ 0. 克隆远程仓库</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:xxx.git</span><br></pre></td></tr></tbody></table></figure><h2 id="🚀-1-创建个人开发分支"><a href="#🚀-1-创建个人开发分支" class="headerlink" title="🚀 1. 创建个人开发分支"></a>🚀 1. 创建个人开发分支</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;your_branch_name&gt;</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="🛠️-2-本地开发与提交"><a href="#🛠️-2-本地开发与提交" class="headerlink" title="🛠️ 2. 本地开发与提交"></a>🛠️ 2. 本地开发与提交</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git diff                   <span class="comment"># 查看变更（可选）</span></span><br><span class="line">git add &lt;file&gt;             <span class="comment"># 添加到暂存区</span></span><br><span class="line">git commit -m <span class="string">"说明内容"</span>    <span class="comment"># 提交</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="☁️-3-推送到远程仓库"><a href="#☁️-3-推送到远程仓库" class="headerlink" title="☁️ 3. 推送到远程仓库"></a>☁️ 3. 推送到远程仓库</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;your_branch_name&gt;</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="🔄-4-同步主分支最新代码"><a href="#🔄-4-同步主分支最新代码" class="headerlink" title="🔄 4. 同步主分支最新代码"></a>🔄 4. 同步主分支最新代码</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line">git pull origin main       <span class="comment"># 更新主分支</span></span><br><span class="line">git checkout &lt;your_branch_name&gt;</span><br><span class="line">git rebase main            <span class="comment"># 将主分支改动应用到当前分支</span></span><br></pre></td></tr></tbody></table></figure><p>如有冲突，解决后执行：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;conflicted_files&gt;</span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>⚠️ 最后强制推送更新分支：</p></blockquote><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;your_branch_name&gt; -f</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="🔁-5-发起-Pull-Request"><a href="#🔁-5-发起-Pull-Request" class="headerlink" title="🔁 5. 发起 Pull Request"></a>🔁 5. 发起 Pull Request</h2><ul><li>GitHub 点击 <strong>“Compare &amp; pull request”</strong></li><li>设置：<ul><li>目标分支：<code>main</code></li><li>源分支：你的开发分支</li></ul></li><li>填写说明，点击 <strong>“Create pull request”</strong></li></ul><hr><h2 id="✅-6-审核与合并"><a href="#✅-6-审核与合并" class="headerlink" title="✅ 6. 审核与合并"></a>✅ 6. 审核与合并</h2><ul><li>团队成员审查代码</li><li>审核通过后，使用 <strong>Squash and merge</strong> 方式合并</li></ul><blockquote><p>✅ 合并成一次提交，保持主分支整洁</p></blockquote><hr><h2 id="🧹-7-删除合并后的分支"><a href="#🧹-7-删除合并后的分支" class="headerlink" title="🧹 7. 删除合并后的分支"></a>🧹 7. 删除合并后的分支</h2><h3 id="远程删除："><a href="#远程删除：" class="headerlink" title="远程删除："></a>远程删除：</h3><ul><li>在 GitHub 上点击 <strong>“Delete branch”</strong></li></ul><h3 id="本地删除："><a href="#本地删除：" class="headerlink" title="本地删除："></a>本地删除：</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line">git branch -D &lt;your_branch_name&gt;</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="🔄-8-同步主分支"><a href="#🔄-8-同步主分支" class="headerlink" title="🔄 8. 同步主分支"></a>🔄 8. 同步主分支</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin main</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="📌-建议"><a href="#📌-建议" class="headerlink" title="📌 建议"></a>📌 建议</h2><ul><li>避免多人操作同一分支</li><li>每次开发任务使用新分支</li><li>合并前务必同步主分支，解决冲突</li><li>提交信息建议规范命名，如：<ul><li><code>feat: add login modal</code></li><li><code>fix: correct time format</code></li></ul></li></ul><hr><h2 id="📚-参考资料"><a href="#📚-参考资料" class="headerlink" title="📚 参考资料"></a>📚 参考资料</h2><p>-<a href="https://www.bilibili.com/video/BV19e4y1q7JJ/?spm_id_from=333.337.search-card.all.click&amp;vd_source=23a5f90103c28e0016184059a052d467">高天的教程</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本地构建docker镜像并上传至阿里云镜像服务站</title>
      <link href="/2025/04/24/ben-di-gou-jian-docker-jing-xiang-bing-shang-chuan-zhi-a-li-yun-jing-xiang-fu-wu-zhan/"/>
      <url>/2025/04/24/ben-di-gou-jian-docker-jing-xiang-bing-shang-chuan-zhi-a-li-yun-jing-xiang-fu-wu-zhan/</url>
      
        <content type="html"><![CDATA[<p>最近比赛需要构建<code>docker</code>镜像，上传至阿里云镜像服务站，以便于官方复现测评，这是一个繁琐的过程，以后也会用到，所以记录一下。</p><p>主要分为以下几步：</p><p>1） 开通阿里云镜像服务</p><p>2） 在本地电脑或者服务器上面安装docker</p><p>3） 构建docker镜像</p><p>4） 将本地 docker 镜像推送至阿里云镜像服务站</p><p>5）本地一键镜像创建和上传脚本</p><p>下面为详细的步骤描述：</p><h2 id="1）-开通阿里云镜像服务"><a href="#1）-开通阿里云镜像服务" class="headerlink" title="1） 开通阿里云镜像服务"></a>1） 开通阿里云镜像服务</h2><p>阿里云镜像服务站的开通过程比较繁琐，根据<a href="https://www.datawhale.cn/activity/185/27/116?rankingPage=1">DataWhale的教程</a>操作如下：</p><p>a. 点击<a href="https://www.aliyun.com/product/acr">链接</a>并登录阿里云账号</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250424152224.png" alt="1. 打开管理控制台"></p><p>b. 创建个人版实例</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250424152336.png" alt="img"></p><p>c. 创建命名空间</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250424152445.png" alt="img"></p><p>d.  创建镜像仓库</p><p>创建镜像仓库时，代码源选择本地镜像上传，然后会跳转到基本信息页面，查看操作指南，这里写明了，如何将本地镜像上传到镜像服务站的详细步奏。</p><h2 id="2）-在本地电脑或者服务器上面安装docker"><a href="#2）-在本地电脑或者服务器上面安装docker" class="headerlink" title="2） 在本地电脑或者服务器上面安装docker"></a>2） 在本地电脑或者服务器上面安装docker</h2><p>此处略，详见docker官网。</p><h2 id="3）-构建docker镜像"><a href="#3）-构建docker镜像" class="headerlink" title="3） 构建docker镜像"></a>3） 构建docker镜像</h2><p>a. 构建 <code>docker-file</code> 文件</p><p>根据自己的需求编辑好<code>docker-file</code>文件，以下是一个示例：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM registry.cn-hangzhou.aliyuncs.com/sais-public/pytorch:2.0.0-py3.9.12-cuda11.8.0-u22.04</span><br><span class="line"></span><br><span class="line">ADD . /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新pip</span></span><br><span class="line"></span><br><span class="line">RUN pip install --upgrade pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置pip国内源</span></span><br><span class="line">RUN pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line">RUN pip install torch_scatter-2.1.1+pt20cu118-cp39-cp39-linux_x86_64.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义容器启动时默认执行的命令</span></span><br><span class="line">CMD [<span class="string">"sh"</span>, <span class="string">"/app/run.sh"</span>]</span><br></pre></td></tr></tbody></table></figure><p>b. 执行构建<code>docker</code>镜像的命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t <span class="built_in">test</span>:v4 -f Dockerfile .</span><br></pre></td></tr></tbody></table></figure><p>c. 查看构建好的 <code>docker</code> 镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></tbody></table></figure><h2 id="4-将本地-docker-镜像推送至阿里云镜像服务站"><a href="#4-将本地-docker-镜像推送至阿里云镜像服务站" class="headerlink" title="4) 将本地 docker 镜像推送至阿里云镜像服务站"></a>4) 将本地 docker 镜像推送至阿里云镜像服务站</h2><p>执行下面的命令，为本地镜像打标签，并且将本地镜像推送到阿里云镜像服务站（下面是一个示例，具体的可以在1.d步骤 “创建镜像仓库-操作指南”中查看 ）</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker login --username=[用户名] [镜像站点]</span><br><span class="line">$ docker tag [ImageId] [镜像站点]/[命名空间]/[镜像仓库名]:[镜像版本号]</span><br><span class="line">$ docker push [镜像站点]/[命名空间]/[镜像仓库名]:[镜像版本号]</span><br></pre></td></tr></tbody></table></figure><h2 id="5）-本地一键镜像创建和上传脚本"><a href="#5）-本地一键镜像创建和上传脚本" class="headerlink" title="5） 本地一键镜像创建和上传脚本"></a>5） 本地一键镜像创建和上传脚本</h2><p>为了方便，下面给出了<code>本地一键镜像创建和上传脚本</code>示例：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># docker的标签</span></span><br><span class="line">TAG=<span class="variable">${1:-"v4"}</span></span><br><span class="line"><span class="comment"># docker的用户名和密码</span></span><br><span class="line">USER=<span class="string">""</span></span><br><span class="line">PASSWORD=<span class="string">""</span></span><br><span class="line"><span class="comment"># 推送的docker仓库</span></span><br><span class="line">REGISTRY=<span class="string">"[镜像站点]/[命名空间]/[镜像仓库名]"</span></span><br><span class="line"><span class="comment"># 使用变量进行 Docker 登录</span></span><br><span class="line">docker login -u <span class="variable">$USER</span> -p <span class="variable">$PASSWORD</span> [镜像站点]</span><br><span class="line"><span class="comment"># 打包代码</span></span><br><span class="line">docker build -t <span class="built_in">test</span>:v4 -f Dockerfile .</span><br><span class="line"><span class="comment"># 修改镜像</span></span><br><span class="line">docker tag <span class="built_in">test</span>:v4 <span class="variable">$REGISTRY</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="comment"># 推送镜像</span></span><br><span class="line">docker push <span class="variable">$REGISTRY</span>:<span class="variable">$TAG</span></span><br><span class="line"><span class="comment"># 打印信息</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"推送成功，请到比赛官方提交作品"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"镜像路径：<span class="variable">$REGISTRY</span>:<span class="variable">$TAG</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"用户名：<span class="variable">$USER</span> / 密码：<span class="variable">$PASSWORD</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一键化脚本打包使用：</span></span><br><span class="line"><span class="comment">## 1. 将所有的代码 模型 运行脚本放在同一个文件夹</span></span><br><span class="line"><span class="comment">## 2. 修改上述脚本中的 账号 密码 仓库</span></span><br><span class="line"><span class="comment">## 3. 执行推送脚本：sh push.sh (默认tag为v1，如需要修改可命令后添加，如：sh push.sh v2)</span></span><br><span class="line"><span class="comment">## 4. 等待成功及打印</span></span><br></pre></td></tr></tbody></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.datawhale.cn/activity/185/27/116?rankingPage=1">Datawhale开通阿里云镜像服务教程 </a></p><p>完！ enjoy 😄</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装torch-scatter时遇到的坑</title>
      <link href="/2025/04/18/an-zhuang-torch-scatter-shi-yu-dao-de-keng/"/>
      <url>/2025/04/18/an-zhuang-torch-scatter-shi-yu-dao-de-keng/</url>
      
        <content type="html"><![CDATA[<p>今天在使用 <code>pip</code> 安装<code> torch-scatter</code> 包时报错，然后使用 <code>conda</code> 成功安装了，但是运行代码的时候报错，并且是一个底层的错误。</p><p>查询之后发现，是因为<strong>在使用 <code>torch_scatter</code>、<code>torch_sparse</code>、<code>torch_cluster</code> 等基于 C++ 的扩展模块时，如果 <code>PyTorch</code> 版本和系统环境不完全匹配，就容易发生这类底层编译失败。</strong></p><p>解决方法最稳定也最省事的方式是<strong>不要从源码编译 torch_scatter</strong>，而是使用预编译好的 <code>.whl</code> 包进行安装。步骤如下：</p><ol><li>确认 <code>PyTorch</code> 和 <code>Python</code> 版本</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"import torch; print(torch.__version__)"</span></span><br><span class="line">python -V</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>访问 <a href="https://data.pyg.org/whl/">https://data.pyg.org/whl/</a> 下载对应版本的 <code>*.whl</code> 到本地</li></ol>  <img src="https://raw.githubusercontent.com/Skylyong/i/main/20250418231208.png" alt="image-20250418222818844" style="zoom:100%;"><ol start="3"><li>使用<code>pip</code>安装下载的 <code>whl</code> 包</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install xxx.whl</span><br></pre></td></tr></tbody></table></figure><p>这样问题就解决了，开心😄</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>neo4j导入节点和边的python代码</title>
      <link href="/2025/03/17/neo4j-dao-ru-jie-dian-he-bian-de-python-dai-ma/"/>
      <url>/2025/03/17/neo4j-dao-ru-jie-dian-he-bian-de-python-dai-ma/</url>
      
        <content type="html"><![CDATA[<p>在做知识图谱相关的项目时，经常需要将数据导入到neo4j中，这里分享一下导入节点和边的python代码，以便于以后查阅。</p><p>需要注意的是，下面的代码是在neo4j 5.x 版本上测试通过的，如果是其他版本，可能需要做一些调整。</p><ol><li>neo4j 导入节点和边的类实现</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> neo4j <span class="keyword">import</span> GraphDatabase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_properties</span>(<span class="params"> properties</span>):</span><br><span class="line">    <span class="comment"># 将属性字典转换为不带引号的字符串</span></span><br><span class="line">        formatted_properties = []</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> properties.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">                formatted_properties.append(<span class="string">f"<span class="subst">{key}</span>: '<span class="subst">{value}</span>'"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                formatted_properties.append(<span class="string">f"<span class="subst">{key}</span>: '<span class="subst">{value}</span>'"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'{'</span> + <span class="string">', '</span>.join(formatted_properties) + <span class="string">'}'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Neo4jClass</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, uri, auth</span>):</span><br><span class="line">        <span class="variable language_">self</span>.driver = GraphDatabase.driver(uri, auth=auth)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.driver.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_node</span>(<span class="params">self, label, properties</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.driver.session() <span class="keyword">as</span> session:</span><br><span class="line">            session.write_transaction(<span class="variable language_">self</span>._create_node, label, properties)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">del_all</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.driver.session() <span class="keyword">as</span> session:</span><br><span class="line">            query = <span class="string">f'MATCH (n) DETACH DELETE n'</span></span><br><span class="line">            session.run(query)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_node</span>(<span class="params">tx, label, properties</span>):</span><br><span class="line">        query = <span class="string">f"CREATE (n:<span class="subst">{label}</span> $properties) RETURN n"</span></span><br><span class="line">        tx.run(query, properties=properties)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_relationship</span>(<span class="params">self, label1, properties1, label2, properties2, relationship</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.driver.session() <span class="keyword">as</span> session:</span><br><span class="line">            session.write_transaction(<span class="variable language_">self</span>._create_relationship, label1, properties1, label2, properties2, relationship)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_relationship</span>(<span class="params">tx, label1, properties1, label2, properties2, relationship</span>):</span><br><span class="line">        properties1 = format_properties(properties1)</span><br><span class="line">        properties2 = format_properties(properties2)</span><br><span class="line">        query = <span class="string">f"MATCH (a:<span class="subst">{label1}</span> <span class="subst">{properties1}</span>), (b:<span class="subst">{label2}</span> <span class="subst">{properties2}</span>) \</span></span><br><span class="line"><span class="string">                 CREATE (a)-[r:<span class="subst">{relationship}</span>]-&gt;(b) RETURN r"</span></span><br><span class="line">        tx.run(query)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_relationship_with_properties</span>(<span class="params">self, label1, properties1, label2, properties2, relationship, properties</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.driver.session() <span class="keyword">as</span> session:</span><br><span class="line">            session.write_transaction(<span class="variable language_">self</span>._create_relationship_with_properties, label1, properties1, label2, properties2, relationship, properties)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_relationship_with_properties</span>(<span class="params">tx, label1, properties1, label2, properties2, relationship, properties</span>):</span><br><span class="line">        properties1 = format_properties(properties1)</span><br><span class="line">        properties2 = format_properties(properties2)</span><br><span class="line">        properties = format_properties(properties)</span><br><span class="line">        query = <span class="string">f"MATCH (a:<span class="subst">{label1}</span> <span class="subst">{properties1}</span>), (b:<span class="subst">{label2}</span> <span class="subst">{properties2}</span>) \</span></span><br><span class="line"><span class="string">                 CREATE (a)-[r:<span class="subst">{relationship}</span> <span class="subst">{properties}</span>]-&gt;(b) RETURN r"</span></span><br><span class="line">        tx.run(query)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_query</span>(<span class="params">self, query</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.driver.session() <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">return</span> session.run(query)</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'__main__'</span> == __name__:</span><br><span class="line">    url = <span class="string">r'bolt://localhost:7687'</span></span><br><span class="line">    auth = (<span class="string">"neo4j"</span>, <span class="string">"neo4j-key"</span>)</span><br><span class="line"></span><br><span class="line">    neo4j = Neo4jClass(uri=url, auth=auth)</span><br><span class="line"></span><br><span class="line">    neo4j.del_all()</span><br><span class="line">    neo4j.create_node(<span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"age"</span>: <span class="number">30</span>})</span><br><span class="line">    neo4j.create_node(<span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Bob"</span>, <span class="string">"age"</span>: <span class="number">25</span>})</span><br><span class="line">    neo4j.create_relationship(<span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Alice"</span>}, <span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Bob"</span>}, <span class="string">"KNOWS"</span>)</span><br><span class="line">    </span><br><span class="line">    neo4j.create_node(<span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Tom"</span>, <span class="string">"age"</span>: <span class="number">30</span>})</span><br><span class="line">    neo4j.create_relationship_with_properties(<span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Alice"</span>}, <span class="string">"Person"</span>, {<span class="string">"name"</span>: <span class="string">"Tom"</span>}, <span class="string">"KW"</span>, {<span class="string">"since"</span>: <span class="string">"2021-01-01"</span>, <span class="string">"weight"</span>: <span class="number">0.8</span>})</span><br><span class="line"></span><br><span class="line">    neo4j.close()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>实际使用示例</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">@author: eggplant</span></span><br><span class="line"><span class="string">@project: TCM_KG</span></span><br><span class="line"><span class="string">@time: 2024年07月30日13:16:04</span></span><br><span class="line"><span class="string">@function: 将预处理好的节点和三元组导入 Neo4j 数据库</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">JSON 文件格式说明:</span></span><br><span class="line"><span class="string">JSON 文件应包含以下键:</span></span><br><span class="line"><span class="string">- `entity_nodes` (list): 实体节点列表，每个元素是一个字典，包含:</span></span><br><span class="line"><span class="string">  - `name` (str): 实体名称</span></span><br><span class="line"><span class="string">  - `type` (str): 实体类型</span></span><br><span class="line"><span class="string">  - 其他属性 (可选)</span></span><br><span class="line"><span class="string">- `relation_nodes` (list): 关系节点列表，每个元素是一个字典，包含:</span></span><br><span class="line"><span class="string">  - `name` (str): 关系名称</span></span><br><span class="line"><span class="string">  - `property` (dict, 可选): 关系属性</span></span><br><span class="line"><span class="string">- `triples` (list): 三元组列表，每个元素是一个三元组 (e1_idx, rel_idx, e2_idx)，索引指向 `entity_nodes` 和 `relation_nodes`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">示例 JSON 文件:</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">    "entity_nodes": [</span></span><br><span class="line"><span class="string">        {"name": "感冒", "type": "疾病", "症状": "发热"},</span></span><br><span class="line"><span class="string">        {"name": "发热", "type": "症状"}</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    "relation_nodes": [</span></span><br><span class="line"><span class="string">        {"name": "具有症状", "property": {"强度": "高"}}</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    "triples": [</span></span><br><span class="line"><span class="string">        [0, 0, 1]  # 代表 "感冒" -&gt; "具有症状" -&gt; "发热"</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> .neo4j_tools <span class="keyword">import</span> Neo4jClass</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dict_to_string</span>(<span class="params">entity: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    将实体字典中的嵌套字典转换为 JSON 字符串</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    - entity (dict): 需要转换的实体字典</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">    - dict: 处理后的字典，嵌套字典转换为 JSON 字符串</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    示例:</span></span><br><span class="line"><span class="string">    输入: {"name": "感冒", "属性": {"病因": "病毒感染"}}</span></span><br><span class="line"><span class="string">    输出: {"name": "感冒", "属性": '{"病因": "病毒感染"}'}</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> {key: json.dumps(value, ensure_ascii=<span class="literal">False</span>) <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>) <span class="keyword">else</span> value <span class="keyword">for</span> key, value <span class="keyword">in</span> entity.items()}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">import_entity_nodes</span>(<span class="params">neo4j, entity_nodes: <span class="built_in">list</span>, debug_n: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    导入实体节点</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    - neo4j (Neo4jClass): Neo4j 数据库操作实例</span></span><br><span class="line"><span class="string">    - entity_nodes (list): 实体节点列表</span></span><br><span class="line"><span class="string">    - debug_n (int): 调试模式下最大导入数量 (-1 表示不限制)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    示例:</span></span><br><span class="line"><span class="string">    entity_nodes = [{"name": "感冒", "type": "疾病"}, {"name": "发热", "type": "症状"}]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"导入实体节点..."</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, entity <span class="keyword">in</span> tqdm.tqdm(<span class="built_in">enumerate</span>(entity_nodes)):</span><br><span class="line">        neo4j.create_node(entity[<span class="string">'type'</span>], dict_to_string(entity))</span><br><span class="line">        <span class="keyword">if</span> debug_n != -<span class="number">1</span> <span class="keyword">and</span> idx &gt;= debug_n:</span><br><span class="line">            <span class="keyword">break</span>  <span class="comment"># Debug 模式限制导入数量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">import_triples</span>(<span class="params">neo4j, data: <span class="built_in">dict</span>, debug_n: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    导入三元组关系</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    - neo4j (Neo4jClass): Neo4j 数据库操作实例</span></span><br><span class="line"><span class="string">    - data (dict): 包含 `entity_nodes`, `relation_nodes`, `triples` 的 JSON 数据</span></span><br><span class="line"><span class="string">    - debug_n (int): 调试模式下最大导入数量 (-1 表示不限制)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    示例:</span></span><br><span class="line"><span class="string">    data = {</span></span><br><span class="line"><span class="string">        "entity_nodes": [{"name": "感冒", "type": "疾病"}, {"name": "发热", "type": "症状"}],</span></span><br><span class="line"><span class="string">        "relation_nodes": [{"name": "具有症状"}],</span></span><br><span class="line"><span class="string">        "triples": [[0, 0, 1]]</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"导入三元组..."</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, (e1_idx, rel_idx, e2_idx) <span class="keyword">in</span> tqdm.tqdm(<span class="built_in">enumerate</span>(data[<span class="string">'triples'</span>])):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            entity1 = {<span class="string">'name'</span>: data[<span class="string">'entity_nodes'</span>][e1_idx][<span class="string">'name'</span>], <span class="string">'type'</span>: data[<span class="string">'entity_nodes'</span>][e1_idx][<span class="string">'type'</span>]}</span><br><span class="line">            entity2 = {<span class="string">'name'</span>: data[<span class="string">'entity_nodes'</span>][e2_idx][<span class="string">'name'</span>], <span class="string">'type'</span>: data[<span class="string">'entity_nodes'</span>][e2_idx][<span class="string">'type'</span>]}</span><br><span class="line">            relation = data[<span class="string">'relation_nodes'</span>][rel_idx]</span><br><span class="line"></span><br><span class="line">            entity1, entity2 = <span class="built_in">map</span>(dict_to_string, (entity1, entity2))</span><br><span class="line">            entity1_clean = {k: v.replace(<span class="string">"'"</span>, <span class="string">"_"</span>) <span class="keyword">for</span> k, v <span class="keyword">in</span> entity1.items() <span class="keyword">if</span> k != <span class="string">'type'</span>}</span><br><span class="line">            entity2_clean = {k: v.replace(<span class="string">"'"</span>, <span class="string">"_"</span>) <span class="keyword">for</span> k, v <span class="keyword">in</span> entity2.items() <span class="keyword">if</span> k != <span class="string">'type'</span>}</span><br><span class="line">            </span><br><span class="line">            neo4j.create_relationship_with_properties(</span><br><span class="line">                entity1[<span class="string">'type'</span>], entity1_clean, entity2[<span class="string">'type'</span>], entity2_clean, relation[<span class="string">'name'</span>], relation.get(<span class="string">'property'</span>, {})</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"跳过错误三元组 <span class="subst">{idx}</span>: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">if</span> debug_n != -<span class="number">1</span> <span class="keyword">and</span> idx &gt;= debug_n:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">import_data_to_neo4j</span>(<span class="params">neo4j, file_paths: <span class="built_in">list</span>, debug_n: <span class="built_in">int</span> = -<span class="number">1</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    从 JSON 文件导入数据到 Neo4j</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">    - neo4j (Neo4jClass): Neo4j 数据库操作实例</span></span><br><span class="line"><span class="string">    - file_paths (list): JSON 文件路径列表</span></span><br><span class="line"><span class="string">    - debug_n (int): 调试模式下最大导入数量 (-1 表示不限制)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> file_path <span class="keyword">in</span> file_paths:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"处理文件: <span class="subst">{file_path}</span>"</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = json.load(f)</span><br><span class="line">        </span><br><span class="line">        import_entity_nodes(neo4j, data.get(<span class="string">'entity_nodes'</span>, []), debug_n)</span><br><span class="line">        import_triples(neo4j, data, debug_n)</span><br><span class="line">    </span><br><span class="line">    neo4j.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"数据导入完成！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    DEBUG_N = -<span class="number">1</span>  <span class="comment"># 调试模式，设置导入的最大数量，-1 表示不限制</span></span><br><span class="line">    </span><br><span class="line">    NEO4J_CONFIG = {</span><br><span class="line">        <span class="string">"uri"</span>: <span class="string">"bolt://localhost:7687"</span>,</span><br><span class="line">        <span class="string">"auth"</span>: (<span class="string">"neo4j"</span>, <span class="string">"neo4j-key"</span>)</span><br><span class="line">    }</span><br><span class="line">    FILE_PATHS = [</span><br><span class="line">        <span class="string">r'data.json'</span>,</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    neo4j = Neo4jClass(**NEO4J_CONFIG)</span><br><span class="line">    neo4j.del_all()</span><br><span class="line">    </span><br><span class="line">    import_data_to_neo4j(neo4j, FILE_PATHS, debug_n=DEBUG_N)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>enjoy it! 🎉</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> neo4j </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>街拍合集</title>
      <link href="/2025/03/09/jie-pai-he-ji/"/>
      <url>/2025/03/09/jie-pai-he-ji/</url>
      
        <content type="html"><![CDATA[<p>整理了一些以前的街拍照片，陆陆续续拍了几万张，后面会持续更新 …</p><div class="multiple-breaks" style="height: 30px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011045.png" alt="image-20250309011043469"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011143.png" alt="image-20250309011141761"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011206.png" alt="image-20250309011204621"></p><p><span class="image-caption  ">「冬日图书馆前的树。」</span></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011221.png" alt="image-20250309011218660"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011240.png" alt="image-20250309011238240"></p><p><span class="image-caption  ">「校园里面树上的鸟巢。」</span></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011302.png" alt="image-20250309011300579"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011318.png" alt="image-20250309011316987"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011345.png" alt="image-20250309011344050"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011402.png" alt="image-20250309011400836"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011422.png" alt="image-20250309011420372"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011500.png" alt="image-20250309011459223"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011514.png" alt="image-20250309011512562"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012213.png" alt="image-20250309012212232"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012238.png" alt="image-20250309012237636"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012254.png" alt="image-20250309012253051"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012310.png" alt="image-20250309012308962"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012336.png" alt="image-20250309012335634"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012358.png" alt="image-20250309012357276"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012420.png" alt="image-20250309012419510"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012445.png" alt="image-20250309012443963"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012506.png" alt="image-20250309012504640"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012529.png" alt="image-20250309012528296"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012544.png" alt="image-20250309012542797"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012601.png" alt="image-20250309012559789"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012618.png" alt="image-20250309012617264"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012638.png" alt="image-20250309012637503"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011603.png" alt="image-20250309011601530"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011617.png" alt="image-20250309011615470"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011649.png" alt="image-20250309011648512"></p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011707.png" alt="image-20250309011706058"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011722.png" alt="image-20250309011720467"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011736.png" alt="image-20250309011735331"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011804.png" alt="image-20250309011802854"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011826.png" alt="image-20250309011825391"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011842.png" alt="image-20250309011840388"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011903.png" alt="image-20250309011902068"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011917.png" alt="image-20250309011916350"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309011934.png" alt="image-20250309011933590"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012001.png" alt="image-20250309012000387"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012029.png" alt="image-20250309012028556"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012046.png" alt="image-20250309012044991"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012117.png" alt="image-20250309012117"></p><div class="multiple-breaks" style="height: 360px;"></div><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309012133.png" alt="image-20250309012124306"></p><div class="multiple-breaks" style="height: 360px;"></div><style>.multiple-breaks {    display: block;    margin-top: 20px;}.image-caption {          font-family: 'Inter', 'Noto Sans SC', sans-serif; /* 简约无衬线字体 */    font-size: 15px; /* 适中的字体大小 */    color: #666; /* 低对比度灰色，避免喧宾夺主 */    text-align: center; /* 文字居中，提高对称感 */    font-weight: 400; /* 适中的字重，保持简洁 */    margin-top: 12px; /* 与图片保持合适留白 */    line-height: 1.8; /* 增加行间距，让文字更通透 */    letter-spacing: 0.5px; /* 适当增加字间距，增强呼吸感 */} </style>]]></content>
      
      
      <categories>
          
          <category> 摄影 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 街拍 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人像摄影合集</title>
      <link href="/2025/03/09/ren-xiang-she-ying-he-ji/"/>
      <url>/2025/03/09/ren-xiang-she-ying-he-ji/</url>
      
        <content type="html"><![CDATA[<p>后面会持续更新 …<br><br><br><br><br><br><br><br></p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001405.png" alt="image-20250309000801077"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309000843.png" alt="image-20250309000834470"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309000903.png" alt="image-20250309000900685"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309000927.png" alt="image-20250309000925088"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001529.png" alt="image-20250309001006265"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001548.png" alt="image-20250309001047780"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001716.png" alt="image-20250309001715109"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001122.png" alt="image-20250309001120875"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250309001237.png" alt="image-20250309001156888"></p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>]]></content>
      
      
      <categories>
          
          <category> 摄影 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摄影 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python多进程示例</title>
      <link href="/2025/03/08/python-duo-jin-cheng-shi-li/"/>
      <url>/2025/03/08/python-duo-jin-cheng-shi-li/</url>
      
        <content type="html"><![CDATA[<ol><li>导入依赖的包</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor, as_completed</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>定义处理内容的函数，该函数要是全局函数，不能放在函数或者类里面<br>函数的参数只有一个，可以用元组包装起来，然后再解包</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_record</span>(<span class="params">args</span>):</span><br><span class="line">    text = args[<span class="number">0</span>][<span class="string">"text"</span>]</span><br><span class="line">    CONTENT = args[<span class="number">1</span>]</span><br><span class="line">    extract_info = inference(text, model=<span class="string">"deepseek-chat"</span>, CONTENT=CONTENT)</span><br><span class="line">    <span class="keyword">return</span> {</span><br><span class="line">        <span class="string">"text"</span>: text,</span><br><span class="line">        <span class="string">"extract_info"</span>: extract_info</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>使用多进程处理数据<br>在 with 下面一共有两个for，第一个for负责将数据和处理函数放在一个 futures 中， 第二个for负责处理和返回处理结果。</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> ProcessPoolExecutor(max_workers=max_workers) <span class="keyword">as</span> executor:</span><br><span class="line">       futures = []</span><br><span class="line">       <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">           args = (d, CONTENT)</span><br><span class="line">           futures.append(executor.submit(process_record, args))</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 使用 as_completed 迭代返回已经完成的任务</span></span><br><span class="line">       <span class="comment"># tqdm 用于显示进度条</span></span><br><span class="line">       <span class="keyword">for</span> idx, future <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm.tqdm(as_completed(futures), total=<span class="built_in">len</span>(futures), desc=<span class="string">"Extracting info"</span>)):</span><br><span class="line">           result = future.result()</span><br><span class="line">           new_data.append(result)</span><br><span class="line"></span><br><span class="line">           <span class="comment"># 每完成 100 个样本，保存一次临时文件</span></span><br><span class="line">           <span class="keyword">if</span> (idx + <span class="number">1</span>) % <span class="number">500</span> == <span class="number">0</span>:</span><br><span class="line">               <span class="keyword">with</span> <span class="built_in">open</span>(save_path, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">                   json.dump(new_data, f, indent=<span class="number">4</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">                   <span class="built_in">print</span>(<span class="string">f"Extracted information from <span class="subst">{idx+<span class="number">1</span>}</span> medical records, and saved to <span class="subst">{save_path}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><p>enjoy ! </p>]]></content>
      
      
      <categories>
          
          <category> 编程经验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>matplotlib 设置显示中文</title>
      <link href="/2025/03/08/matplotlib-xian-shi-zhong-wen/"/>
      <url>/2025/03/08/matplotlib-xian-shi-zhong-wen/</url>
      
        <content type="html"><![CDATA[<p>先从网络上下载 <code>SimHei.ttf</code>  文件放在某个位置，然后用下面的代码，设置字体的位置。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 从 data/original/SylvanL/Exam/tcm_exam_1.csv 读取数据</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> font_manager</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> rcParams</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> matplotlib </span><br><span class="line"><span class="comment"># 设置当前目录</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.chdir(<span class="string">'/cpfs01/projects-SSD/cfff-bafab61057ac_SSD/zyt_09215/liyong/TCM-EMBEDDING'</span>)</span><br><span class="line"></span><br><span class="line">my_font = font_manager.FontProperties(fname=<span class="string">"fonts/SimHei.ttf"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局设置字体</span></span><br><span class="line">matplotlib.rcParams[<span class="string">'font.sans-serif'</span>]=my_font.get_name()  <span class="comment"># 用黑体显示中文</span></span><br><span class="line">matplotlib.rcParams[<span class="string">'axes.unicode_minus'</span>]=<span class="literal">False</span> </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>使用</p><p>在需要使用中文的地方，指定上面设置好的字体</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.title(<span class="string">"描述长度分布"</span>, fontproperties=my_font)</span><br><span class="line">plt.xlabel(<span class="string">"长度"</span>, fontproperties=my_font)</span><br><span class="line">plt.ylabel(<span class="string">"数量"</span>, fontproperties=my_font)</span><br></pre></td></tr></tbody></table></figure><p>enjoy！ </p>]]></content>
      
      
      <categories>
          
          <category> 编程经验 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用BERT得到短语向量表示并进行层次聚类实现相似性去重</title>
      <link href="/2025/03/06/shi-yong-bert-de-dao-duan-yu-xiang-liang-biao-shi-bing-jin-xing-ceng-ci-ju-lei-shi-xian-xiang-si-xing-qu-chong/"/>
      <url>/2025/03/06/shi-yong-bert-de-dao-duan-yu-xiang-liang-biao-shi-bing-jin-xing-ceng-ci-ju-lei-shi-xian-xiang-si-xing-qu-chong/</url>
      
        <content type="html"><![CDATA[<p>在自然语言处理（NLP）中，短语的相似性分析是一个常见且重要的任务。传统的文本相似性计算方法往往依赖于手工设计的特征，但随着深度学习和预训练语言模型的出现，BERT（Bidirectional Encoder Representations from Transformers）及其衍生模型为我们提供了更强大的表达能力。在本文中，我们将介绍如何使用BERT模型对短语进行向量化，并结合层次聚类算法对相似短语进行去重。</p><h1 id="任务背景"><a href="#任务背景" class="headerlink" title="任务背景"></a>任务背景</h1><p>在很多应用场景下，我们往往需要从大量的短语数据中去除重复或者相似的内容，以便于进一步分析。例如，在传统中医（TCM）数据分析中，可能有大量的类似任务相关查询或医疗术语需要进行聚类处理。这里，我们通过以下步骤来实现相似性去重：</p><ol><li><strong>使用BERT模型获取短语的向量表示</strong>：BERT及其变体能够通过上下文信息准确地捕捉短语的语义。</li><li><strong>计算短语之间的相似度</strong>：通过计算短语向量之间的余弦相似度，得到短语之间的相似性。</li><li><strong>进行层次聚类</strong>：层次聚类可以根据相似度将相似短语分到同一个类别，进而实现去重。</li></ol><h1 id="关键步骤"><a href="#关键步骤" class="headerlink" title="关键步骤"></a>关键步骤</h1><h2 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h2><p>在处理短语之前，我们首先需要加载包含短语的原始数据。假设数据已经保存在CSV文件中，每一行代表一个短语。我们通过Pandas库读取文件并提取短语列。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_data</span>(<span class="params">self, file_path</span>):</span><br><span class="line">    df = pd.read_csv(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"text"</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"CSV 文件必须包含 'text' 列"</span>)</span><br><span class="line">    <span class="keyword">return</span> df[<span class="string">"text"</span>].dropna().tolist()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="使用BERT模型获取短语向量"><a href="#使用BERT模型获取短语向量" class="headerlink" title="使用BERT模型获取短语向量"></a>使用BERT模型获取短语向量</h2><p>通过加载一个预训练的BERT模型（例如 thenlper/gte-base-zh），我们可以将每个短语转换为一个固定维度的向量。这些向量能够捕捉短语的语义信息，后续的相似性计算将依赖这些向量。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode_phrases</span>(<span class="params">self, phrases</span>):</span><br><span class="line">    embeddings = <span class="variable language_">self</span>.model.encode(phrases, convert_to_numpy=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> embeddings</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="计算短语之间的相似度并进行聚类"><a href="#计算短语之间的相似度并进行聚类" class="headerlink" title="计算短语之间的相似度并进行聚类"></a>计算短语之间的相似度并进行聚类</h2><p>短语的相似度可以通过计算它们的余弦相似度来衡量。为了对短语进行聚类，我们将计算短语向量之间的距离（使用余弦距离）。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cluster_phrases</span>(<span class="params">self, embeddings</span>):</span><br><span class="line">    Z = linkage(<span class="number">1</span> - np.inner(embeddings, embeddings), method=<span class="string">'average'</span>)</span><br><span class="line">    labels = fcluster(Z, t=<span class="variable language_">self</span>.eps, criterion=<span class="string">'distance'</span>)</span><br><span class="line">    <span class="keyword">return</span> labels</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="将相似的短语分到同一类别"><a href="#将相似的短语分到同一类别" class="headerlink" title="将相似的短语分到同一类别"></a>将相似的短语分到同一类别</h2><p>下面，我们将相似的短语分到同一类别。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">group_clusters</span>(<span class="params">self, phrases, labels</span>):</span><br><span class="line">    cluster_dict = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    <span class="keyword">for</span> phrase, label <span class="keyword">in</span> <span class="built_in">zip</span>(phrases, labels):</span><br><span class="line">        cluster_dict[label].append(phrase)</span><br><span class="line">    <span class="keyword">return</span> cluster_dict</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="保存聚类结果"><a href="#保存聚类结果" class="headerlink" title="保存聚类结果"></a>保存聚类结果</h2><p>最后，将聚类结果保存为CSV文件，每一列对应一个类别，方便后续的分析。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">save_clusters</span>(<span class="params">self, cluster_dict, output_path</span>):</span><br><span class="line">    filtered_clusters = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> cluster_dict.items() <span class="keyword">if</span> k != -<span class="number">1</span>}</span><br><span class="line">    max_len = <span class="built_in">max</span>(<span class="built_in">len</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> filtered_clusters.values())</span><br><span class="line">    cluster_columns = [v + [<span class="string">""</span>] * (max_len - <span class="built_in">len</span>(v)) <span class="keyword">for</span> v <span class="keyword">in</span> filtered_clusters.values()]</span><br><span class="line">    df = pd.DataFrame(cluster_columns).T</span><br><span class="line">    df.to_csv(output_path, index=<span class="literal">False</span>, encoding=<span class="string">"utf-8-sig"</span>)</span><br></pre></td></tr></tbody></table></figure><br><br><h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> DBSCAN</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> scipy.cluster.hierarchy <span class="keyword">import</span> linkage, fcluster</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhraseClustering</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name=<span class="string">"thenlper/gte-base-zh"</span>, eps=<span class="number">0.3</span>, min_samples=<span class="number">2</span></span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化 BERT 模型和 DBSCAN 参数</span></span><br><span class="line"><span class="string">        :param model_name: 预训练 BERT 模型名称（默认使用轻量级 SBERT）</span></span><br><span class="line"><span class="string">        :param eps: DBSCAN 聚类的半径参数</span></span><br><span class="line"><span class="string">        :param min_samples: DBSCAN 的最小样本数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="variable language_">self</span>.model = SentenceTransformer(model_name)</span><br><span class="line">        <span class="variable language_">self</span>.eps = eps</span><br><span class="line">        <span class="variable language_">self</span>.min_samples = min_samples</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_data</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        读取 CSV 文件中的短语</span></span><br><span class="line"><span class="string">        :param file_path: CSV 文件路径</span></span><br><span class="line"><span class="string">        :return: 短语列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        df = pd.read_csv(file_path)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"细粒度_任务相关查询"</span> <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"CSV 文件必须包含 'text' 列"</span>)</span><br><span class="line">        <span class="keyword">return</span> df[<span class="string">"细粒度_任务相关查询"</span>].dropna().tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode_phrases</span>(<span class="params">self, phrases</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        使用 BERT 编码短语</span></span><br><span class="line"><span class="string">        :param phrases: 短语列表</span></span><br><span class="line"><span class="string">        :return: 短语的向量表示（NumPy 数组）</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        embeddings = <span class="variable language_">self</span>.model.encode(phrases, convert_to_numpy=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> embeddings</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cluster_phrases</span>(<span class="params">self, embeddings</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        使用层次聚类进行聚类</span></span><br><span class="line"><span class="string">        :param embeddings: 短语的向量表示</span></span><br><span class="line"><span class="string">        :return: 聚类标签</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 使用cosine距离计算层次聚类</span></span><br><span class="line">        Z = linkage(<span class="number">1</span> - np.inner(embeddings, embeddings), method=<span class="string">'average'</span>)  <span class="comment"># 1 - cosine similarity = cosine distance</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 根据距离阈值来形成聚类</span></span><br><span class="line">        labels = fcluster(Z, t=<span class="variable language_">self</span>.eps, criterion=<span class="string">'distance'</span>)  <span class="comment"># t表示聚类的距离阈值</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">group_clusters</span>(<span class="params">self, phrases, labels</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        根据 DBSCAN 结果将短语分组</span></span><br><span class="line"><span class="string">        :param phrases: 原始短语列表</span></span><br><span class="line"><span class="string">        :param labels: 聚类标签</span></span><br><span class="line"><span class="string">        :return: 以字典形式存储的聚类结果 {类别ID: 短语列表}</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        cluster_dict = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">        <span class="keyword">for</span> phrase, label <span class="keyword">in</span> <span class="built_in">zip</span>(phrases, labels):</span><br><span class="line">            cluster_dict[label].append(phrase)</span><br><span class="line">        <span class="keyword">return</span> cluster_dict</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_clusters</span>(<span class="params">self, cluster_dict, output_path</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        将聚类结果保存到 CSV 文件，每一列对应一个类别</span></span><br><span class="line"><span class="string">        :param cluster_dict: 聚类后的短语字典</span></span><br><span class="line"><span class="string">        :param output_path: 输出 CSV 文件路径</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 过滤掉噪声点（DBSCAN 中噪声点的 label 为 -1）</span></span><br><span class="line">        filtered_clusters = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> cluster_dict.items() <span class="keyword">if</span> k != -<span class="number">1</span>}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 按列对齐</span></span><br><span class="line">        max_len = <span class="built_in">max</span>(<span class="built_in">len</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> filtered_clusters.values())</span><br><span class="line">        cluster_columns = [v + [<span class="string">""</span>] * (max_len - <span class="built_in">len</span>(v)) <span class="keyword">for</span> v <span class="keyword">in</span> filtered_clusters.values()]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 转置存入 DataFrame</span></span><br><span class="line">        df = pd.DataFrame(cluster_columns).T</span><br><span class="line">        df.to_csv(output_path, index=<span class="literal">False</span>, encoding=<span class="string">"utf-8-sig"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, input_csv, output_csv</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        完整执行流程：加载数据 -&gt; 计算向量 -&gt; 聚类 -&gt; 保存结果</span></span><br><span class="line"><span class="string">        :param input_csv: 输入 CSV 文件路径</span></span><br><span class="line"><span class="string">        :param output_csv: 输出 CSV 文件路径</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"1. 加载数据..."</span>)</span><br><span class="line">        phrases = <span class="variable language_">self</span>.load_data(input_csv)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"2. 计算短语向量..."</span>)</span><br><span class="line">        embeddings = <span class="variable language_">self</span>.encode_phrases(phrases)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"3. 进行 层次 聚类..."</span>)</span><br><span class="line">        labels = <span class="variable language_">self</span>.cluster_phrases(embeddings)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"4. 整理聚类结果..."</span>)</span><br><span class="line">        cluster_dict = <span class="variable language_">self</span>.group_clusters(phrases, labels)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"5. 发现 <span class="subst">{<span class="built_in">len</span>(cluster_dict)}</span> 个类别，保存到 <span class="subst">{output_csv}</span> ..."</span>)</span><br><span class="line">        <span class="variable language_">self</span>.save_clusters(cluster_dict, output_csv)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"✅ 处理完成！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 配置参数</span></span><br><span class="line">    input_file = <span class="string">"taskPhraseClustering/second_fine_grained_tasks_new_sorted.csv"</span>  <span class="comment"># 输入文件</span></span><br><span class="line">    output_file = <span class="string">"taskPhraseClustering/output_clusters.csv"</span>  <span class="comment"># 输出文件</span></span><br><span class="line">    clustering = PhraseClustering(eps=<span class="number">3</span>, min_samples=<span class="number">2</span>)  <span class="comment"># 可调节 eps 影响聚类效果 eps 值越大 类别数越少</span></span><br><span class="line">    clustering.run(input_file, output_file)</span><br></pre></td></tr></tbody></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过本教程，我们展示了如何使用BERT模型对短语进行语义向量化，并结合层次聚类算法实现短语相似性去重。此方法可以有效地将相似的短语分组，帮助我们在大规模文本数据中提取有用的信息。在实际应用中，我们还可以根据需要调整聚类的参数，以适应不同的数据集和需求。</p><p>值得一提的是，在上述的代码中， <code>eps</code> 参数是一个关键参数，它的值越大则类别数越少，反之，类别数越多。</p><p>enjoy it!</p>]]></content>
      
      
      <categories>
          
          <category> 自然语言处理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文本聚类 bert向量表示 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于编辑距离的文本层次聚类</title>
      <link href="/2025/03/06/ji-yu-bian-ji-ju-chi-de-wen-ben-ceng-ci-ju-lei/"/>
      <url>/2025/03/06/ji-yu-bian-ji-ju-chi-de-wen-ben-ceng-ci-ju-lei/</url>
      
        <content type="html"><![CDATA[<p>在自然语言处理（NLP）和数据清洗过程中，处理相似文本的聚类问题是一个常见的挑战。例如，在搜索日志、医学术语、客户查询等文本数据中，我们经常会遇到拼写相似或近似表达的词汇。为了更好地对这些数据进行分类和管理，我们可以使用 编辑距离（Levenshtein Distance） 结合 层次聚类（Hierarchical Clustering） 进行文本聚类。</p><p>本文介绍了一种基于 Python 的 编辑距离层次聚类 方法，并提供了一个完整的实现代码。该方法的核心思想是：</p><ul><li><p>计算编辑距离矩阵：通过 Levenshtein 距离衡量文本之间的相似性。</p></li><li><p>层次聚类：使用层次聚类，将相似的文本归类到相同的簇中。</p></li><li><p>排序和输出：按照聚类结果对数据进行排序，并将结果保存为 CSV 文件，便于后续分析。</p></li></ul><br>下面是实现代码:<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> scipy.cluster.hierarchy <span class="keyword">import</span> linkage, fcluster</span><br><span class="line"><span class="keyword">from</span> scipy.spatial.distance <span class="keyword">import</span> pdist, squareform</span><br><span class="line"><span class="keyword">import</span> Levenshtein  <span class="comment"># 用于计算编辑距离</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EditDistanceClustering</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_csv: <span class="built_in">str</span>, output_csv: <span class="built_in">str</span>, column_name: <span class="built_in">str</span>, threshold: <span class="built_in">int</span> = <span class="number">5</span></span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化类</span></span><br><span class="line"><span class="string">        :param input_csv: 输入CSV文件路径</span></span><br><span class="line"><span class="string">        :param output_csv: 输出CSV文件路径</span></span><br><span class="line"><span class="string">        :param column_name: 需要聚类的列名</span></span><br><span class="line"><span class="string">        :param threshold: 距离阈值，决定簇的划分</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="variable language_">self</span>.input_csv: <span class="built_in">str</span> = input_csv</span><br><span class="line">        <span class="variable language_">self</span>.output_csv: <span class="built_in">str</span> = output_csv</span><br><span class="line">        <span class="variable language_">self</span>.column_name: <span class="built_in">str</span> = column_name</span><br><span class="line">        <span class="variable language_">self</span>.threshold: <span class="built_in">int</span> = threshold</span><br><span class="line">        <span class="variable language_">self</span>.df: pd.DataFrame | <span class="literal">None</span> = <span class="literal">None</span>  <span class="comment"># 初始化DataFrame变量</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_csv</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""读取CSV文件到DataFrame中"""</span></span><br><span class="line">        <span class="variable language_">self</span>.df = pd.read_csv(<span class="variable language_">self</span>.input_csv)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lev_distance</span>(<span class="params">self, s1: <span class="built_in">str</span>, s2: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        计算两个字符串之间的Levenshtein编辑距离</span></span><br><span class="line"><span class="string">        :param s1: 第一个字符串</span></span><br><span class="line"><span class="string">        :param s2: 第二个字符串</span></span><br><span class="line"><span class="string">        :return: 编辑距离</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> Levenshtein.distance(s1, s2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute_edit_distance_matrix</span>(<span class="params">self</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        计算字符串列表的编辑距离矩阵</span></span><br><span class="line"><span class="string">        :return: 计算得到的编辑距离矩阵（二维数组）</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 获取指定列的所有字符串并转换为列表</span></span><br><span class="line">        strings: <span class="built_in">list</span>[<span class="built_in">str</span>] = <span class="variable language_">self</span>.df[<span class="variable language_">self</span>.column_name].astype(<span class="built_in">str</span>).tolist()</span><br><span class="line">        <span class="comment"># 将字符串列表转换为NumPy数组，并调整为二维格式</span></span><br><span class="line">        strings_array: np.ndarray = np.array(strings).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 计算编辑距离矩阵</span></span><br><span class="line">        <span class="keyword">return</span> squareform(pdist(strings_array, <span class="keyword">lambda</span> u, v: <span class="variable language_">self</span>.lev_distance(u[<span class="number">0</span>], v[<span class="number">0</span>])))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cluster_and_sort</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        执行层次聚类，并根据聚类结果排序</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># 计算编辑距离矩阵</span></span><br><span class="line">        distance_matrix: np.ndarray = <span class="variable language_">self</span>.compute_edit_distance_matrix()</span><br><span class="line">        <span class="comment"># 使用层次聚类方法（Ward方法）进行聚类</span></span><br><span class="line">        linkage_matrix: np.ndarray = linkage(distance_matrix, method=<span class="string">'ward'</span>)</span><br><span class="line">        <span class="comment"># 根据设定的阈值进行聚类划分</span></span><br><span class="line">        clusters: np.ndarray = fcluster(linkage_matrix, <span class="variable language_">self</span>.threshold, criterion=<span class="string">'distance'</span>)</span><br><span class="line">        <span class="comment"># 将簇编号添加到DataFrame中</span></span><br><span class="line">        <span class="variable language_">self</span>.df[<span class="string">'Cluster'</span>] = clusters</span><br><span class="line">        <span class="comment"># 按簇编号排序，并去掉Cluster列</span></span><br><span class="line">        <span class="variable language_">self</span>.df = <span class="variable language_">self</span>.df.sort_values(by=[<span class="string">'Cluster'</span>]).drop(columns=[<span class="string">'Cluster'</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_csv</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""将处理后的DataFrame保存回CSV文件"""</span></span><br><span class="line">        <span class="variable language_">self</span>.df.to_csv(<span class="variable language_">self</span>.output_csv, index=<span class="literal">False</span>, encoding=<span class="string">'utf-8-sig'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        运行完整的数据处理流程，包括读取CSV、聚类排序、保存CSV</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="variable language_">self</span>.read_csv()</span><br><span class="line">        <span class="variable language_">self</span>.cluster_and_sort()</span><br><span class="line">        <span class="variable language_">self</span>.save_csv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例用法</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 指定输入和输出CSV文件路径以及需要聚类的列</span></span><br><span class="line">    clustering: EditDistanceClustering = EditDistanceClustering(</span><br><span class="line">        <span class="string">'data/second_fine_grained_tasks_new.csv'</span>, </span><br><span class="line">        <span class="string">'data/second_fine_grained_tasks_new_sorted1.csv'</span>, </span><br><span class="line">        <span class="string">'细粒度_任务相关查询'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 运行聚类流程</span></span><br><span class="line">    clustering.run()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><br><p>以上代码运行完之后，会将 <code>data/second_fine_grained_tasks_new.csv</code> 文件中的文本数据按照编辑距离进行层次聚类，并根据聚类结果进行排序，<br>最后将结果保存到 <code>data/second_fine_grained_tasks_new_sorted1.csv</code> 。</p>]]></content>
      
      
      <categories>
          
          <category> 自然语言处理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文本聚类 编辑距离 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ai竞赛平台</title>
      <link href="/2025/02/27/ai-jing-sai-ping-tai/"/>
      <url>/2025/02/27/ai-jing-sai-ping-tai/</url>
      
        <content type="html"><![CDATA[<p>最近对常见的Ai竞赛平台做了整理，记录如下：</p><ul><li>Kaggle:  <a href="https://www.kaggle.com/">https://www.kaggle.com/</a></li><li>AIcrowd: <a href="https://www.aicrowd.com/">https://www.aicrowd.com/</a></li><li>Codalab :  <a href="https://codalab.lisn.upsaclay.fr/">https://codalab.lisn.upsaclay.fr/</a></li><li>DrivenData: <a href="https://www.drivendata.org/">https://www.drivendata.org/</a></li><li>Grand Challenge: <a href="https://grand-challenge.org/">https://grand-challenge.org/</a></li><li>Topcoder:  <a href="https://www.topcoder.com/challenges">https://www.topcoder.com/challenges</a></li><li>Zindi: <a href="https://zindi.africa/">https://zindi.africa/</a></li><li>天池:  <a href="https://tianchi.aliyun.com/">https://tianchi.aliyun.com/</a></li><li>DataCastle: <a href="http://www.dcjingsai.com/">http://www.dcjingsai.com/</a></li><li>AI Studio:  <a href="https://aistudio.baidu.com/">https://aistudio.baidu.com/</a></li></ul><p>各赛事平台的特点汇总如下：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250228094452.png" alt="image-20250228094442500"></p><p>注： 上面的信息来自于大模型，但对给出的链接做了人工验证，其中除 Topcoder 平台页面显示不全以外，其他平台给出的链接地址均可以正常访问。</p>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ai竞赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python日常开发杂记</title>
      <link href="/2025/02/19/python-ri-chang-kai-fa-za-ji/"/>
      <url>/2025/02/19/python-ri-chang-kai-fa-za-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="mac系统-pandas存储为csv-在excel中打开乱码"><a href="#mac系统-pandas存储为csv-在excel中打开乱码" class="headerlink" title="mac系统 pandas存储为csv 在excel中打开乱码"></a>mac系统 pandas存储为csv 在excel中打开乱码</h1><blockquote><p>在使用pandas存储数据为csv文件后，在excel中打开会出现乱码问题，解决方法如下：<br>指定编码格式为<code>utf-8-sig</code>，即可解决问题。</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_csv(<span class="string">'output.csv'</span>, index=<span class="literal">False</span>, encoding=<span class="string">'utf-8-sig'</span>)</span><br></pre></td></tr></tbody></table></figure><h1 id="api-调用大模型时，指定返回json格式数据"><a href="#api-调用大模型时，指定返回json格式数据" class="headerlink" title="api 调用大模型时，指定返回json格式数据"></a>api 调用大模型时，指定返回json格式数据</h1><blockquote><p>解决方法如下： 指定 response_format 为 <code>{"type":"json_object"}</code>，但是这个方法在deepseek中不适用。</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">client = openai = OpenAI(api_key=gpt_api_key,</span><br><span class="line">        base_url=gpt_base_url</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">                model= model,</span><br><span class="line">                messages=[</span><br><span class="line">                    {<span class="string">"role"</span>: <span class="string">"system"</span>, <span class="string">"content"</span>: <span class="string">"你是一名中医药专家"</span>},</span><br><span class="line">                    {<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: prompt}</span><br><span class="line">                ],</span><br><span class="line">                max_tokens=<span class="number">2048</span>,</span><br><span class="line">                response_format={<span class="string">"type"</span>:<span class="string">"json_object"</span>}</span><br><span class="line">            )</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><blockquote><p> openAi 官方解释：</p><p> <img src="https://raw.githubusercontent.com/Skylyong/i/main/20250219171031.png" alt="image-20250219171024040"></p><p> 参考链接：<a href="https://beta.openai.com/docs/api-reference/completions/create">openai官方文档</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 编程开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过docker部署doccano标注工具</title>
      <link href="/2025/02/12/tong-guo-docker-bu-shu-doccano-biao-zhu-gong-ju/"/>
      <url>/2025/02/12/tong-guo-docker-bu-shu-doccano-biao-zhu-gong-ju/</url>
      
        <content type="html"><![CDATA[<p>上半年使用了 <code>doccano</code> 标注工具对命名实体识别任务做了标注，感觉很好用。<br>最近准备将其部署到服务器上，通过 <code>docker</code> 容器的方式进行，以便于以后可以快速部署。</p><p>许久不用也是遇到了不少问题，主要是部署好系统后，上传数据一直转圈，没有反应，后面发现是因为没有启动 <code>doccano task</code>,<br>而task需要和 <code>doccano webserver</code> 一起启动， <code>openai</code> 给我的建议是启动两个 <code>docker</code> 服务，我还是选用了常规的 <code>screen</code> 方式。</p><p>下面是自己编写的可以使用的 <code>docker-compose</code> 文件，记录在此，方便以后调用。</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.8'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">doccano:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker-0.unsee.tech/python:3.9</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">doccano</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./doccano_data:/app/doccano_data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8000:8000"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PIP_NO_CACHE_DIR=off</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">      sh -c "apt-get update &amp;&amp; apt-get install -y screen &amp;&amp;</span></span><br><span class="line"><span class="string">             pip install --no-cache-dir doccano &amp;&amp;</span></span><br><span class="line"><span class="string">             pip install numpy==1.24.0 pandas==1.5.3 &amp;&amp;</span></span><br><span class="line"><span class="string">             doccano init &amp;&amp;</span></span><br><span class="line"><span class="string">             doccano createuser --username admin --password admin &amp;&amp;</span></span><br><span class="line"><span class="string">             screen -dmS doccano_server doccano webserver --port 8000 &amp;&amp;</span></span><br><span class="line"><span class="string">             screen -dmS doccano_task doccano task &amp;&amp;</span></span><br><span class="line"><span class="string">             tail -f /dev/null"</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker, doccano </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在呈贡的日子——复习资料不见了</title>
      <link href="/2025/02/06/zai-cheng-gong-de-ri-zi-fu-xi-zi-liao-bu-jian-liao/"/>
      <url>/2025/02/06/zai-cheng-gong-de-ri-zi-fu-xi-zi-liao-bu-jian-liao/</url>
      
        <content type="html"><![CDATA[<p>又翻到了一篇当时的记录，起因是复习资料太多，不方便随身携带，我将书藏在了图书馆的顶楼消防通道（阅览室在二楼，书藏在12楼附近），结果，被保安收走了。还依稀记得，午夜的保安们打着手电筒，在过道、门窗旮旯角、花瓶后面到处翻找考研er书的情节，好一波猫鼠游戏。</p><p>下面是当时的记录：</p><blockquote><p>一早上来图书馆，发现书不见了。从7点多折腾到现在（8:55）才从管理员处拿到了我的复习资料。数了数应该是没有丢失，悬着的一颗心总算放了下来。已经过了早点的时间，早点是吃不成了。</p><p>可是接下来的晚上我应该如何安置我的书呢？住的地方离图书馆近5公里，将全部的书背进背出是断然不行的。</p><p>Plan 1:把书精减一下，每天只带当天要看的书，这样的量现阶段背进背出应该是没有问题的。只是看到一个知识点想要找参考的话，就不能了。也许我可以把书都扫描一下做成电子的，但是阅读体验怎么样呢？会不会很差？扫描也需要很多时间。</p><p>Plan2:继续冒着风险，再想办法找一个更隐蔽的地方，把书藏在图书馆内。优点：轻装出行，不累，方便随时翻阅参考，有紧迫感，有利于保持不放松的复习状态。缺点：风险大，如果再被发现，有可能拿不了书，因为有历史，在保安那里不好交代。</p><p>Plan3:对保安、物业人员进行公关，看能否将书放在其办公室或者工具室。优点：具有2的所有优点，外加零风险。缺点：公关精力耗费大，不一定能成功，从最近的接触下来，感觉难度很大。（这里的工作人员执行收书很彻底，但也并不是没有人情味，还需要一段时间来观察。）</p><p>Plan4:联合学校的同学一起向图书馆领导反映，希望能够放宽收书的条件。这个难度未知，没有尝试过，耗费精力最大。</p><p>Plan5:在就近非图书馆的地方找一个放书点，优点：不用来回搬很多书，有紧迫感。缺点：不够便捷，有丢失找不到的可能。这个需要再考察考察，再具体问题具体分析。</p><p>总记：现阶段先按Plan1执行，看看两周内对复习的影响有多大。同时在今天确认plan2是否可行(是否有更加隐蔽的放书点？）？一周内确认plan5是否可行(是否有离图书馆近的安全可靠的放书点?）两周内确认plan3是否可行(能否公关）？对plan4保持关注。</p></blockquote><p>后记：想起来，当时是暑假，座位有很大余量，不存在占位的问题。一开始保安是允许学生将书放在座位上过夜的，后来似乎是某些学生因为”好”位置一直被别人占用，得不到换位置的机会，就把问题反应给了某领导。领导大为光火，随下令禁止留书过夜，所以出现了前文 “严打”的画面。其实，这位领导，只要是稍微动点脑子，划分出一小块区域，拿几张桌子专门放书就是皆大欢喜的事儿了。</p><p>也是挺怀念，当时一点不内耗，碰到问题积极列计划，想办法的自己。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206170912.png" alt="image-20250206170909967"></p>]]></content>
      
      
      <categories>
          
          <category> 生活情感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 呈贡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在呈贡的日子——捞鱼河</title>
      <link href="/2025/02/06/zai-cheng-gong-de-ri-zi-lao-yu-he/"/>
      <url>/2025/02/06/zai-cheng-gong-de-ri-zi-lao-yu-he/</url>
      
        <content type="html"><![CDATA[<p>今日写论文写乏了，就去翻了翻以前记的笔记，翻到了在呈贡学习生活时期的记录。想当初，我为了逃避家人亲戚带来的压力、独自一人去呈贡寻求一片清净之地复习备考，时光匆匆，一晃几年过去了，令人感叹。</p><p>虽看以前记录的文字略显幼稚，但为了保证记录的真实性，我一字不落的照搬了过来，下面是当时的记录：</p><p>不知不觉就到了月末，在呈贡已经快一个月了。最近天天泡图书馆，感觉效率有点下降，而我对除校园之外的周边环境还一无所知，趁着没下雨的周六就出去看了看。</p><p>上午配置好无线AP找了个共享车就骑了出去，没多久（约30分钟）就到了滇池边上的捞鱼河公园。虽然是周末由于随时会下雨的样子，公园里面人不多，很是清静。</p><p>公园依滇池东边的湖岸线而建，因有一条小河在此注入滇池，小河里可以捞到小鱼小虾，因此取名为捞鱼河公园。</p><p>这里种植最多的要数水衫了，大片大片的水衫，行走其中，犹如身在绿海一般，令人心旷神怡。水衫对我而言并不陌生，在平原地区的湖边湿地大多有种植，但是如此密集的水衫林我是第一次见到，觉得很震撼，用密不透光来形容也一点不为过。回来的路上一直在想，在这样密集的树林中，树与树之间为何不会遮挡掉阳光，或者因竞争养料而造成某些树苗死亡呢？</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206142919.png" alt="image-20250206142908312"></p><p> 犹如身处绿海之中 令人心旷神怡（后记：在后来的日子里，这片绿色，时常出现在我的脑子里，在我心中种下了一片绿色之海）</p><p>琢磨来琢磨去，我觉得首先得益于滇池的存在，造就了周边的湿地生态，使得空气能够一直保持很高的湿度，水衫喜水喜湿，这提供了它们必要的生长条件；另外，高原地区不同平原，这里光照充足，昆明更是四季阳光明媚，单位面积上提供了比平原地区更多的光能量，所以水衫如此密集的情况下还能保持很好的长势。</p><p>比起水衫大军，公园中也种植了一些柳树，水衫的挺拔俏丽，柳条可谓千姿百态、婀娜多姿，很多柳树的根须都暴露在外，看起来像老人的胡须，只是颜色是朱红色的，远远看去还有点吓人。</p><p>在林间散落着零星的杂草，北边临近滇池的区域芦苇丛生。另外，自行车道的两边零零散散种植了一些美人蕉。</p><p>为了保护湿地，减少垃圾减轻污染，林区和芦苇荡里禁止设摊开店，栈道或步道上每相隔不远的地方就设了一个垃圾桶。这样的环境引来了不少鸟儿在此安家。水衫林里面，不时会传出猫头鹰的叫声，估计里面住了不少。芦苇和杂草从中，偶尔有野鸟飞出，运气好点的话，还能看到白天鹅在水面划水。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143043.png" alt="image-20250206143039109"></p><p>最西临湖的栈道 能够看到滇池</p><p>公园北的芦苇荡有栈道穿插其中，在最西临湖的栈道上能够欣赏到滇池的美景，很适合情侣约会闲游。公园的最南端是一小块人造砂石滩（公园的地图上叫沙滩，但是地面上铺的砂石粒径已经达到砾石的级别了，磨圆度也很差，我觉得叫砂石滩更为妥当），这里聚集了许多家长和小孩，小孩们或是嬉戏打闹，或是同家长一道眺望远方的湖面；有几个学生模样的女孩，特意化了美美的妆，穿上漂亮的衣服来这里游玩拍照，总之好不惬意。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206150910.png" alt="image-20250206143208654"></p><p>眺望远方（一）</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143304.png" alt="image-20250206143302496"></p><p> 眺望远方（二）</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143405.png" alt="image-20250206143403672"></p><p> 眺望远方（三）</p><p>（由于当时的天气并不好，上面三张照片拍得并不是很满意，后期特效也没法挽救，索性裁剪了一下就贴出了）</p><p>我过去的时候，湖边有一个大叔正蹲坐在自己的小船上，船头散落着一些小鱼，看他一个人。我好奇他的小鱼，就过去跟他聊了聊。原来大叔的鱼是刚从滇池里面捞起来的，这鱼名叫箭鱼，见风就死，不能养。他正在等着游客来买他的鱼。我们聊了不一会儿，就来了一对带小孩的家长来打听他的鱼怎么卖，后续又有不少游客凑了过来，好不热闹。大叔也不用秤，抓起小鱼颠了颠。“一共35块钱” 孩子母亲犹豫了一下，没多说就买了下来，就这样我看他很轻松就完成了一笔交易。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143520.png" alt="image-20250206143517964"></p><p>见风就死的箭鱼</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143601.png" alt="image-20250206143559093"></p><p>凑过来的游客 好不热闹</p><p>然后他又滑着小船向湖面漂去了，只见他在离岸边十多米开外的地方停了下来，然后开始收之前埋好的网。见他一连收了几个网都没啥收获，我有的不耐烦了，就往远处的亭子走去，歇了歇，之后在岸边拍起了湖水。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143701.png" alt="image-20250206143659749"></p><p>正在捕鱼的大叔</p><p>虽然近年来在各方的治理之下，滇池的水质已经有了很大的改善。但是比起我之前见过的一些湖泊来说，还是差了很多，清澈见底更是不能提。也许是因为这里是公园，人的活动比较频繁，所以导致附近区域水质不好，但愿湖中心区域水质更好点。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250206143901.png" alt="image-20250206143754522"></p><p>滇池的水（为了拍出波涛汹涌的感觉，我把镜头放得很低）</p><p>就在我忙于拍照的时候，大叔的船已经再次靠岸了。我赶忙大步走过去，看看他这次收获怎么样。可是还是晚了，等我走到跟前，他的鱼已经被一个中年人全部买了，这次捕上来的全是白鲦，不像上次的箭鱼拿上来就死了，这次的白鲦个个活蹦乱跳，比上次的还多。令我感动惊讶的是这次他一共才买25块钱。我觉得好亏，一打听才知道原来白鲦没有箭鱼值钱。</p><p>大叔很健谈，后面趁他在等游客买鱼的间隙我们又聊了许多。据他说，滇池里面除了上面的箭鱼和白鲦外，还能捕到鲢鱼、鲤鱼、黄颡鱼，其中黄颡鱼卖得最贵。捕鱼也是靠天气吃饭，下雨天风大的时候，一天到晚也网不了几条鱼；晴天风平浪静的时候就比较好网到鱼了，像这样的天气大概1小时左右就能收一次网。我跟他说他这鱼刚捞起来的，比市场上的新鲜，来玩的游客也不太会在意价钱，可以卖贵点。大叔倒是很实在，他说他出去收一波网有多有少，看着差不多的钱就卖了，他因为卖得便宜，有不少回头客嘞。</p><p>在这里捞鱼除了看天气，还得随时注意有关部门的管理人员，如果不幸被逮到一次，六七百块钱就没了，这要好几天才挣得回来。按他的说法就是跟相关人员“打游击”，打好了就能挣钱。我跟他粗略算了一下当天的收入，大概有150左右，如果每天都这样，一个月的收入就在4000上下了。</p><p>除了捕鱼之外，我对他的生活也产生了兴趣。进一步交谈中，了解到由于呈贡新城建设，大叔家已经办理了拆迁补偿手续。政府给了他们每人100平米的回迁安置房（前提是原住房有100平米，不足的额外花钱购买，价钱大概是目前市场价的4折）；另外为了让他们能尽早搬离原住房每人给10万元的补助，回迁过渡期间每人每年有1万元的生活补助，我很羡慕并表示他们碰上了好政策。可是他并不以为然，觉得以后搬去新房要交物业费，水电也比现在高，增加了生活成本，因为没有固定工作，他觉得10万块很快也会花完，所以不无担心。</p><p>他有一个儿子，今年已经高二了，按他的说法马上就要高考了，说到孩子的教育问题，他还是一种放养状态，按他的说法，能读的不管他也读得进去，不能读的打也没用。他们这里小孩上学生活费普遍给的比较充裕，一个小孩每个月光生活费就要给到一千多。我说我现在的生活费也没有一千，他笑了笑表示不信。</p><p>最后，看天已经很晚了，跟大叔道别后，我就匆匆骑车回赶了，回到云大已经接近21点了，不无收获的一天。</p><p>后记：虽然我仅在呈贡呆了半年多，在日常的生活中，我们都会觉得半年很快就过去了。直到后面我才发现，这半年的生活，给我的精神上留下了很深的烙印，一些经历历历在目。等有空的时候，再慢慢写吧。</p>]]></content>
      
      
      <categories>
          
          <category> 生活情感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 呈贡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode开发技巧记录</title>
      <link href="/2025/01/28/vscode-kai-fa-ji-qiao-ji-lu/"/>
      <url>/2025/01/28/vscode-kai-fa-ji-qiao-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>日常编写代码中，vscode是用的最多的编辑器，经常会遇见一些问题，定期总结一下，方便以后查阅。<br><br></p><h1 id="在不能连接外网的远程服务器上用copilot"><a href="#在不能连接外网的远程服务器上用copilot" class="headerlink" title="在不能连接外网的远程服务器上用copilot"></a>在不能连接外网的远程服务器上用copilot</h1><blockquote><p>打开settings.json文件在里面添加如下内容：</p></blockquote><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"remote.extensionKind"</span>: {</span><br><span class="line">       <span class="string">"GitHub.copilot"</span>: [<span class="string">"ui"</span>],</span><br><span class="line">       <span class="string">"GitHub.copilot-chat"</span>: [<span class="string">"ui"</span>],</span><br><span class="line">   },</span><br></pre></td></tr></tbody></table></figure><br><h1 id="启用latex的pdf预览"><a href="#启用latex的pdf预览" class="headerlink" title="启用latex的pdf预览"></a>启用latex的pdf预览</h1><blockquote><p>按下 Ctrl+Alt+V 快捷键，即可。</p><br></blockquote><h1 id="切换居中模式，令显示内容更多"><a href="#切换居中模式，令显示内容更多" class="headerlink" title="切换居中模式，令显示内容更多"></a>切换居中模式，令显示内容更多</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Toggle Centered Layout</span><br></pre></td></tr></tbody></table></figure><br><h1 id="使用插件快速生成cypher查询语句"><a href="#使用插件快速生成cypher查询语句" class="headerlink" title="使用插件快速生成cypher查询语句"></a>使用插件快速生成cypher查询语句</h1><h2 id="安装相关插件"><a href="#安装相关插件" class="headerlink" title="安装相关插件"></a>安装相关插件</h2><blockquote><p>首先安装两个插件：</p><ul><li>Neo4j for VS Code</li><li>Cypher Query Language</li></ul></blockquote><h2 id="使用插件"><a href="#使用插件" class="headerlink" title="使用插件"></a>使用插件</h2><blockquote><p>安装好插件之后，按 <code>crl+shift+p</code> 弹出设置：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250128211729.png" alt="image-20250128211727292"></p><p>选择 <code>Manage Connection</code> 进行数据库配置，下面是一个简单的配置示例：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250128211911.png" alt="image-20250128211909556"></p><p>配置好后，新建一个*.cypher后缀的文件 </p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250128212040.png" alt="image-20250128212037885"></p><p>在其中输入<code>cypher</code> 命令：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250128212125.png" alt="image-20250128212122981"></p><p>按<code>crl+shift+p</code>弹出设置，选择<code>Run Cypher Statements</code> 即可运行命令，运行完之后会返回字典形式的结果。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 编程开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客维护日志</title>
      <link href="/2025/01/28/bo-ke-wei-hu-ri-zhi/"/>
      <url>/2025/01/28/bo-ke-wei-hu-ri-zhi/</url>
      
        <content type="html"><![CDATA[<ul><li><p>2025年07月14日 新增友链功能，更改main title为 “LY’s Space”</p></li><li><p>2025年03月09日 新增相册功能，使用 <a href="https://eggplant.wiki/photography/#photo-19">地址</a></p></li><li><p>2025年03月08日 更新 hexo 至 7.3.0。  新增搜索功能，使用 <a href="https://dashboard.algolia.com/">algolia</a>， 上次失败原因为没有同时安装 <code>hexo-algolia</code> 和 <code>hexo-algoliasearch</code>插件  ， 前者是主题插件，后者实现全文搜索。 参考<a href="https://blog.xiabee.cn/posts/archer-algolia/#/%E6%B3%A8%E5%86%8CAlgolia">教程1</a> </p></li><li><p>2025年03月07日 尝试 增加搜索功能 <strong>失败</strong>， 使用 <a href="https://dashboard.algolia.com/">algolia</a> , 插件为 <a href="https://github.com/LouisBarranqueiro/hexo-algoliasearch"><code>Hexo-Algoliasearch</code></a> , 参考<a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/ALGOLIA-SEARCH.md">教程1</a> <a href="https://www.linkinstars.com/post/fddf9055.html">教程2</a></p></li><li><p>2025年02月10日 新增 “NEWS” 模块， 记录成长历程</p></li><li><p>2025年02月04日 支持评论功能, 添加<a href="https://hugenye.github.io/2020/07/21/hexo-deploy/">utterance评论系统</a> </p></li><li><p>2025年02月02日 更新域名为 <a href="https://ailyong.cn/">ailyong.cn</a></p></li><li><p>2025年02月01日 更新域名为 <a href="https://eggplant.wiki/">eggplant.wiki</a></p></li><li><p>2025年01月28日 更新主题为 <a href="https://github.com/fi3ework/hexo-theme-archer">Archer</a></p><ul><li>支持文章字数统计</li><li>支持文章置顶功能</li><li>支持Latex公式和Mermaid图表</li><li>更名为 ”茄子的个人空间“</li></ul></li><li><p>2025年01月 重启博客  更新域名为 <a href="https://ailyong.cn/">ailyong.cn</a> </p></li><li><p>2024年03月 原域名到期，暂停维护</p></li><li><p>2022年04月09日 更新主题为 Matery</p><ul><li>支持文章字数统计</li><li>开通donate页面</li><li>支持评论</li></ul></li><li><p>2021年02月01日 首次开通博客</p><ul><li>使用 <a href="https://hexo.io/">hexo</a> 搭建</li><li>使用 next 主题</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Webdav服务器实现Obsidian和Zotero多端同步</title>
      <link href="/2025/01/26/da-jian-webdav-fu-wu-qi-shi-xian-obsidian-he-zotero-duo-duan-tong-bu/"/>
      <url>/2025/01/26/da-jian-webdav-fu-wu-qi-shi-xian-obsidian-he-zotero-duo-duan-tong-bu/</url>
      
        <content type="html"><![CDATA[<h1 id="前-言"><a href="#前-言" class="headerlink" title="前 言"></a>前 言</h1><p>很长一段时间以来，都比较苦恼自己的obsidian和zotero在多端同步的时候经常碰到问题，有时候想在手机上面查看某篇paper的时候，正好发现pdf附件没被同步，导致不能查看。加之，最近给女朋友推荐了obsidian，她觉得非常好用，但由于设备原因不能实现多端同步。她采用幕布记录笔记，再导入obsidian的方法，以实现多端同步和笔记本地保存，我认为该种方式较为繁琐，不符合技术人的气质。</p><p>思考再三，我决定好好解决多端配置的问题，网络上搜索了一圈资料下来，发现很多手机端软件均支持以Webdav协议进行文件共享，遂决定搭建Webdav协议服务器实现多端共享。</p><p>虽有坚果云等支持Webdav协议的现成云盘，但坚果云限制不少，既然要彻底解决该问题，自然不能忍受。所以决定搭建一个属于自己的Webdav协议服务器，以实现多端丝滑共享同步。</p><p>由于要和女友一起使用共享服务器，那么网上常见的单一账号的Webdav服务教程，自然不能满足要求。期望的是，分别设置user1和user2，以达到各自有不同的文件存储空间，并设置一个shared存储空间，方便共享文件，共享文件只有user1和user2能够进行编辑，但可以被guest用户查看，方便我们共享资料给朋友。</p><p>网络上面搜寻了一圈，发现Apache2能够很好的满足上述需求，并且具有想对成熟的教程资源，遂采用Apache2进行服务搭建。服务搭建的详细步骤记录如下：</p><h1 id="环境及软件版本-："><a href="#环境及软件版本-：" class="headerlink" title="环境及软件版本 ："></a>环境及软件版本 ：</h1><ul><li>服务器操作系统： Ubuntu 22.04.4 LTS</li><li>zotero版本：7.0.9</li><li>obsidian版本：Version 1.5.8</li></ul><h1 id="安装Apache2并配置webdav协议"><a href="#安装Apache2并配置webdav协议" class="headerlink" title="安装Apache2并配置webdav协议"></a><a href="https://reintech.io/blog/installing-configuring-webdav-server-ubuntu-22">安装Apache2并配置webdav协议</a></h1><p>这里，我们对一般的WebDav配置进行了扩展，以达到多用户的要求，详细内容体现在配置文件里面。</p><ol><li>安装 Apache2 HTTP 服务并开通webdav协议</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install apache2</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> apache2</span><br><span class="line"><span class="built_in">sudo</span> systemctl start apache2</span><br><span class="line"><span class="built_in">sudo</span> a2enmod dav dav_fs auth_digest</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart apache2</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>创建WebDav文件夹，设置权限</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /var/www/webdav/user1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /var/www/webdav/user2</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /var/www/webdav/shared</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R www-data:www-data /var/www/webdav</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> -R 775 /var/www/webdav</span><br></pre></td></tr></tbody></table></figure><p>通过上面的设置，webdav服务在服务器上面的路径为: /var/www/webdav<br>, 可以改为自己的。</p><ol start="3"><li>创建用户认证文件<br>根据提示输入密码并确认</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> htdigest -c /etc/apache2/webdav.passwd <span class="string">"WebDAV Realm"</span> user1</span><br><span class="line"><span class="built_in">sudo</span> htdigest /etc/apache2/webdav.passwd <span class="string">"WebDAV Realm"</span> user2</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><p>获取SSL证书<br>由于iso要求只能以https协议方式进行文件传输，所以要使得搭建的webdav服务能够用于电脑端和iPhone、ipad同步，必须配置SSL证书，以启用https协议。<br>SSL证书有两种获取方式，一种是自签名证书，该种证书只适合测试环境，不适合生产环境，因为简单笔者一开始采用的是该种方式，但经过了大量尝试，最终得到的自签名证书，并不能用于iso端。因此，不推荐自签名证书。<br>网络上的SSL证书颁发机构，一般仅针对于域名进行证书颁发，但是国内域名备案流程繁琐。笔者经过大量的查询，最终找到了一家可以为ip地址颁发免费证书的机构 <a href="https://app.zerossl.com/dashboard">ZeroSSL</a>，虽然一次申请使用期仅为三个月，但是足以解决燃煤之急。<br>ZeroSSL的网站上有较为详细的证书申请及使用方法，这里不做赘述。</p></li><li><p>配置WebDav<br>完成上述操作之后，我们开始对WebDav服务进行配置，打开配置文件</p></li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/apache2/sites-available/000-default.conf</span><br></pre></td></tr></tbody></table></figure><p>   往配置文件中添加以下完整配置内容</p><pre><code><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:443&gt;</span><br><span class="line">ServerAdmin webmaster@localhost</span><br><span class="line">DocumentRoot /var/www/webdav</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置ssl证书，路径表示证书的存放位置</span></span><br><span class="line"><span class="comment"># ServerName webdav.local</span></span><br><span class="line">SSLEngine on</span><br><span class="line">SSLCertificateFile /etc/ssl/certs/certificate.crt</span><br><span class="line">SSLCertificateKeyFile /etc/ssl/private/private.key</span><br><span class="line">SSLCertificateChainFile /etc/ssl/certs/ca_bundle.crt</span><br><span class="line"></span><br><span class="line">Alias /webdav /var/www/webdav</span><br><span class="line">&lt;Directory /home/webdav&gt;</span><br><span class="line">Options Indexes FollowSymLinks</span><br><span class="line">AllowOverride None</span><br><span class="line"><span class="comment"># Require all granted</span></span><br><span class="line"><span class="comment"># Dav On</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;Location /webdav/user1&gt;</span><br><span class="line">AuthType Digest</span><br><span class="line">AuthName <span class="string">"WebDAV Realm"</span></span><br><span class="line">AuthDigestProvider file</span><br><span class="line">AuthUserFile /etc/apache2/webdav.passwd</span><br><span class="line">Require user user1</span><br><span class="line">Dav On</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">&lt;Location /webdav/user2&gt;</span><br><span class="line">AuthType Digest</span><br><span class="line">AuthName <span class="string">"WebDAV Realm"</span></span><br><span class="line">AuthDigestProvider file</span><br><span class="line">AuthUserFile /etc/apache2/webdav.passwd</span><br><span class="line">Require user user2</span><br><span class="line">Dav On</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置共享路径的权限</span></span><br><span class="line">&lt;Location /webdav/shared&gt;</span><br><span class="line">Dav On</span><br><span class="line">Allow from all</span><br><span class="line">&lt;LimitExcept OPTIONS GET&gt;</span><br><span class="line">AuthType Digest</span><br><span class="line">AuthName <span class="string">"WebDAV Realm"</span></span><br><span class="line">AuthDigestProvider file</span><br><span class="line">AuthUserFile /etc/apache2/webdav.passwd</span><br><span class="line">Require valid-user</span><br><span class="line">&lt;/LimitExcept&gt;</span><br><span class="line">&lt;LimitExcept PUT POST DELETE MOVE&gt;</span><br><span class="line">Require all granted</span><br><span class="line">&lt;/LimitExcept&gt;</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">ErrorLog <span class="variable">${APACHE_LOG_DIR}</span>/error.log</span><br><span class="line">CustomLog <span class="variable">${APACHE_LOG_DIR}</span>/access.log combined</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"><span class="comment"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span></span><br></pre></td></tr></tbody></table></figure></code></pre><ol start="6"><li>重启Apache2并测试</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart apache2</span><br></pre></td></tr></tbody></table></figure><p>如果使用云服务器，需要在安全组中开通443端口，才能够正常访问服务。</p><ul><li>访问方式<br>  地址为 <code>http://your-server-ip/webdav</code></li><li>预期效果<ul><li>用户 <code>user1</code> 只能访问 <code>/webdav/user1</code>。</li><li>用户 <code>user2</code> 只能访问 <code>/webdav/user2</code>。</li><li>所有人均可访问 <code>/webdav/shared</code>，无需密码，但只有查看权限，user1和user2通过登录验证，有查看、编辑和删除权限。</li></ul></li></ul><h1 id="Zotero-配置"><a href="#Zotero-配置" class="headerlink" title="Zotero 配置"></a>Zotero 配置</h1><p>zotero 中的配置很简单，只要打开设置-&gt;同步，附件同步方式选择”WebDAV”填入在配置文件中设置的网址、用户名、密码即可，填写好之后通过点击”验证服务器”按钮，对服务进行验证，验证通过即表示zotero已经与服务器建立了连接。然后关闭设置界面，点击右上角的同步图标即可将文件附件同步到远程服务器。手机端和ipad端的设置类似，此处略。</p><p>值得注意的是，如果服务器ip没有获得ssl证书，或者使用自签名证书，此处将会报错，在电脑端的解决方法在<a href="https://www.zotero.org/support/kb/cert_override">这里</a>, 手机端和ipad端笔者暂未找到合适的解决方法，笔者在配置的时候，在这里耗费了大量心力，最终才找到了 <a href="https://app.zerossl.com/dashboard">ZeroSSL</a> 这个免费为ip地址颁发ssl证书的机构，并获得了ssl证书。</p><h1 id="Obsidian-配置"><a href="#Obsidian-配置" class="headerlink" title="Obsidian 配置"></a>Obsidian 配置</h1><p>obsidian 配置远程同步，主要使用了remotely-save这个插件，该插件的配置使用可以参考<a href="https://forum-zh.obsidian.md/t/topic/5291">这里</a> 和 <a href="https://forum-zh.obsidian.md/t/topic/16390">这里</a>, 细节这里不赘述。</p><p>由于我们在上述配置中，使用了htdigest生成用户密码，因此，鉴权类型要选择digest，否则连接失败。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250126211142.png" alt="image-20250126211130501"></p><p>此外，在obsidian中下载插件需要科学上网，由于手机或ipad不具备科学上网的条件，这使得无法在手机或ipad上的obsidian中安装remotely-save。一种简单的解决方法是，将手机或ipad端obsidian根目录下的.obsidian替换成电脑端obsidian根目录下的.obsidian，重启之后就会发现手机端的配置和电脑上一模一样了。</p><h1 id="其-他"><a href="#其-他" class="headerlink" title="其 他"></a>其 他</h1><p>只要能够支持WebDAV协议备份文件的App均可通过类似上述的设置，将资料备份到云端服务器，并实现多端共享访问。</p><h1 id="总-结"><a href="#总-结" class="headerlink" title="总 结"></a>总 结</h1><p>本文详细介绍了，在一台Ubuntu 22.04服务器上通过Apache2配置多用户的webdav服务，给出了经过笔者实践过的详细配置文件，并提供了获取免费ip地址ssl证书的方法。同时，给出了简单的zotero和obsidian配置指导。</p>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 干货 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sentence-transformers sampler bug 之 set 不一定是无序的</title>
      <link href="/2025/01/07/sentence-transformers-sampler-bug-zhi-set-bu-yi-ding-shi-wu-xu-de/"/>
      <url>/2025/01/07/sentence-transformers-sampler-bug-zhi-set-bu-yi-ding-shi-wu-xu-de/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>问  题： 最近准备训练一个基于对比学习的模型， 用 huggface 的 trainer 训练器，在官方给的源代码中，有一个现成的 sampler 用于数据采样，我需要改写这个 sampler 以保证能够用于自己的数据上。</p><h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><p>改完之后，发现采样出来的 indices 竟然是有序的，实际在一个批次中需要打乱样本的顺序，仔细阅读了官方给的源码，发现问题出在如下图所示的 第187行。这里先用 torch.randperm生成了一个乱序的下标，然后转换为set。按理说set是无序的，转换之后也是无序的，看起来很正确。</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250107163459.png"></p><p>当我做了小测试后，发现并不是：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250107163527.png"><br>从上面的结果，可以看到：torch.randperm() 生成的序列是乱序的，但经过 set() 处理之后似乎变成了有序。</p><p>我们又做了一组测试：<br><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250107163635.png"><br>可以看到：当list中的元素全部是数字，且没有重复值的时候，set()出来后的序列变成了有序，而中间的那个试验，序列是无序的。</p><p>所以很多python的教程说set的无序的，这点并不具体。更加具体的说法应该是：set是一个集合，它没有序惯性质，如果任务要求的数据结构需要包含元素的序列，则不能采用set作为数据结构。上面的bug就是一个错误例子。</p><h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1><p>我检查了一下所使用的库是最新版，找到了官方的github地址，准备提交issue。才发现官方2个月前就已经在github源码中修改这个 <a href="https://github.com/UKPLab/sentence-transformers/pull/3073">bug</a>，但是由于依赖原因，并没有提交到代码仓库。下面是修改后的版本的关键代码(关键代码在190行)：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20250107164427.png"></p><p>小结一下： 这是一个非常隐蔽的bug，如果不是因为我要实现自己的sampler，一定不会发现不同epoch中相同的batch的下标是一样的，所以说当模型性能不够好的时候，可以去溯源一下代码，看看具体的代码实现是否和自己所设想的一致。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu上安装NIVIDIA驱动和CUDA_Tookit</title>
      <link href="/2023/09/12/ubuntu-shang-an-zhuang-nividia-qu-dong-he-cuda-tookit/"/>
      <url>/2023/09/12/ubuntu-shang-an-zhuang-nividia-qu-dong-he-cuda-tookit/</url>
      
        <content type="html"><![CDATA[<p>每一次安装NIVIDIA驱动或CUDA Tookit时，都要经过一番折腾，才能够安装成功，这里把过程记录一下，以便以后可以参考。</p><p>本次安装遇到的最大问题是：pytorch所能支持的最高cuda版本为11.8，而安装后的cuda为最新12.2版本，pytorch没法识别cuda。<br>导致这一问题的主要原因在于两点：</p><ol><li>安装的NIVIDIA驱动版本过高，导致CUDA Tookit版本也过高，无法降级</li><li>使用网络方式安装CUDA Tookit，安装之后得到的是最新版的CUDA Tookit，不是我想要的11.8版本</li></ol><p>接下来是安装过程：</p><ul><li><p>删除已安装的NIVIDIA驱动或CUDA Tookit</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/apt/sources.list.d/cuda*</span><br><span class="line"><span class="built_in">sudo</span> apt-get --purge remove <span class="string">"*cublas*"</span> <span class="string">"cuda*"</span> <span class="string">"nsight*"</span> </span><br><span class="line"><span class="built_in">sudo</span> apt-get --purge remove <span class="string">"*nvidia*"</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get autoremove</span><br><span class="line"><span class="built_in">sudo</span> apt-get autoclean</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/cuda*</span><br></pre></td></tr></tbody></table></figure></li><li><p>查看ubuntu系统版本和驱动器型号，并下载对应驱动安装</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/os-release <span class="comment"># 查看系统版本</span></span><br><span class="line"></span><br><span class="line">lspci | grep VGA    <span class="comment"># 查看显卡型号</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>  查看好版本之后，在<a href="https://www.nvidia.com/Download/Find.aspx?lang=en-us">这里</a>下载对应的驱动程序并安装。</p><p>  本次安装，服务器的版本为Ubuntu 22.04.2 LTS，显卡型号为GeForce RTX 3090.</p></li><li><p>查看驱动安装结果</p><p>  驱动程序安装好之后，使用”nividia smi”命令查看安装结果，这里如果显示错误信息，重启系统就好了。</p><p>  需要注意的是，这里出来的cuda的版本号不能大于pytorch所能支持的最大cuda版本号。</p><p>  比如这次安装的时候，pytorch所能支持的最大cuda版本号为11.8，而我安装后，这里显示的版本号是12.2，最终导致无论如何pytorch都不能识别cuda。原因就是因为这里安装的驱动太新，nividia设置成了最新的cuda toolkit,后面安装cuda toolkit软件包的时候不能降级，导致pytorch没法识别。</p><p>  在本次安装过程中，最终成功安装的驱动器版本为<a href="https://www.nvidia.com/download/driverResults.aspx/194569/en-us/">510</a>，安装成功之后查询到的cuda版本为11.04， 由于最新的pytorch支持的cuda版本为11.8，所以后面我们还需要安装11.8版本的cuda toolkit，才能让pytorch使用cuda。</p></li><li><p>安装cuda toolkit</p><p>  在<a href="https://developer.nvidia.com/cuda-toolkit-archive">这里</a>找到对应版本的cuda toolkit，点进去之后，选择操作系统、操作系统版本等信息，下载类型选择第三个，安装包下载好之后，根据提示安装就好了。</p><p>  完成之后，再用”nividia smi”查询cuda信息，这次版本应该就是pytorch支持的了。</p><p>  这里有个疑问，貌似以本次包方式，安装cuda toolkit的时候可以勾选安装nividia驱动程序，也就是说可以省去前面安装驱动这一步。</p><p>  这里遇到的<strong>大坑</strong>是，下载类型一定要选择第三个”runfile(local)”,之前好几次选择第二个”deb(network)”，安装完，一查询cuda信息，得到的都是12.2的版本， 但是pytorch不支持12.2的cuda，所以没法用。</p><p>  本次安装过程中，下载的是11.8版本的cuda toolkit,下载和安装脚本如下</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run</span><br><span class="line"><span class="built_in">sudo</span> sh cuda_11.8.0_520.61.05_linux.run</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li><li><p>安装对应版本的pytorch</p><p>  在<a href="https://pytorch.org/get-started/locally/">这里</a>找到对应的pytorch版本，然后安装就好了。</p></li><li><p>最后，查看cuda是否能够被pytorch识别</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import torch</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br></pre></td></tr></tbody></table></figure><p>  如果显示为ture，则表示安装成功。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NIVIDIA驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在mac上使用pybind11实现c++与python互通的demo</title>
      <link href="/2023/07/23/zai-mac-shang-shi-yong-pybind11-shi-xian-c-yu-python-hu-tong-de-demo/"/>
      <url>/2023/07/23/zai-mac-shang-shi-yong-pybind11-shi-xian-c-yu-python-hu-tong-de-demo/</url>
      
        <content type="html"><![CDATA[<h4 id="在mac上使用pybind11实现c-与python互通的demo"><a href="#在mac上使用pybind11实现c-与python互通的demo" class="headerlink" title="在mac上使用pybind11实现c++与python互通的demo"></a>在mac上使用pybind11实现c++与python互通的demo</h4><h5 id="0-问题描述"><a href="#0-问题描述" class="headerlink" title="0. 问题描述"></a>0. 问题描述</h5><p>下面的python代码定义了一个类，类中有一个名为analyze_data的函数，其采用递归的方法解析json格式的data数据，由于处理速度达不到要求，我们希望用c++改写该类，并封装成可供python代码调用的库，以达到加速的效果。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="comment"># 待解析的数据deom</span></span><br><span class="line">&nbsp;data_demo = {<span class="string">"resbody"</span>: {<span class="string">"data"</span>: {<span class="string">"name"</span>: <span class="string">"John"</span>, <span class="string">"age"</span>: <span class="number">30</span>, <span class="string">"address"</span>: {<span class="string">"city"</span>: <span class="string">"New York"</span>, <span class="string">"zipcode"</span>: <span class="number">10001</span>}}}}</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># 需要转换为c++代码的类</span></span><br><span class="line">&nbsp;<span class="keyword">class</span> <span class="title class_">AnalyzeDataUtil</span>:</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, datas</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.datas = datas</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">def</span> <span class="title function_">analyze_data</span>(<span class="params">self, data, result=<span class="string">"resbody"</span>, depth=<span class="number">0</span></span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> depth == <span class="number">5</span>:</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">return</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">dict</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">for</span> k, v <span class="keyword">in</span> data.items():</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.analyze_data(v, result + <span class="string">"$%s"</span> % <span class="built_in">str</span>(k), depth+<span class="number">1</span>)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> <span class="built_in">isinstance</span>(data, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.analyze_data(data[i], result, depth+<span class="number">1</span>)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">else</span>:</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.datas[result] = <span class="built_in">str</span>(data)</span><br></pre></td></tr></tbody></table></figure><p><strong>问题分析</strong>：</p><p>根据问题描述，首先，我们要用c++对python定义的类进行改写，由于传入的变量data类型不固定，且涉及到类型判断，一种比较简单的方式是采用pybind11，它针对python的常见数据类型，都有对应的c++实现版本，代码改写工作大大减少。其次，类改写好之后，我们需要打通c++与python之间的隔阂，使用pybind11实现起来也非常方便，只需要在c++源码中添加少量代码即可。最后，我们还需要将c++源码编译成共享库，供下游代码调用。</p><h5 id="1-安装必要的工具和包"><a href="#1-安装必要的工具和包" class="headerlink" title="1. 安装必要的工具和包"></a>1. 安装必要的工具和包</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;brew install cmake</span><br><span class="line">&nbsp;conda install pybind11</span><br></pre></td></tr></tbody></table></figure><p>注意：安装pybind11的时候要用conda来安装，用pip方式安装，编译的时候会报路径错误。</p><h5 id="2-创建c-源文件"><a href="#2-创建c-源文件" class="headerlink" title="2. 创建c++源文件"></a>2. 创建c++源文件</h5><p>下面的代码实现了AnalyzeDataUtil类的c++版本，第54行到第60行的作用是打通c++与python之间的隔阂。</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="comment">//path: analyze_data_util/analyze_data_util.cpp</span></span><br><span class="line">&nbsp;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line">&nbsp;<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="keyword">namespace</span> py = pybind11;</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="keyword">struct</span> <span class="title class_">AnalyzeDataUtil</span></span><br><span class="line">&nbsp;{</span><br><span class="line">&nbsp;<span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="built_in">AnalyzeDataUtil</span>(py::dict datas) : <span class="built_in">datas</span>(datas) {}</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="function"><span class="type">void</span> <span class="title">analyze_data</span><span class="params">(<span class="type">const</span> py::object &amp;data, std::string result = <span class="string">""</span>, <span class="type">int</span> depth = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp;  </span>{</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> (depth == <span class="number">5</span>)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">return</span>;</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> (py::<span class="built_in">isinstance</span>&lt;py::dict&gt;(data))</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;py::dict dict_data = py::<span class="built_in">cast</span>&lt;py::dict&gt;(data);</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;item : dict_data)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">auto</span> key = py::<span class="built_in">reinterpret_borrow</span>&lt;py::object&gt;(item.first);</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">auto</span> value = py::<span class="built_in">reinterpret_borrow</span>&lt;py::object&gt;(item.second);</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="built_in">analyze_data</span>(value, result + <span class="string">"$"</span> + py::<span class="built_in">str</span>(key).<span class="built_in">cast</span>&lt;std::string&gt;(), depth + <span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  }</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">if</span> (py::<span class="built_in">isinstance</span>&lt;py::list&gt;(data) || py::<span class="built_in">isinstance</span>&lt;py::tuple&gt;(data))</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;py::list list_data = py::<span class="built_in">cast</span>&lt;py::list&gt;(data);</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;item : list_data)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="built_in">analyze_data</span>(py::<span class="built_in">cast</span>&lt;py::object&gt;(item), result, depth + <span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  }</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">else</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  {</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;datas[py::<span class="built_in">str</span>(result)] = py::<span class="built_in">str</span>(data).<span class="built_in">cast</span>&lt;std::string&gt;();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  }</span><br><span class="line">&nbsp; &nbsp;  }</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="function">py::dict <span class="title">get_datas</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp;  </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">return</span> datas;</span><br><span class="line">&nbsp; &nbsp;  }</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; &nbsp;py::dict datas;</span><br><span class="line">&nbsp;};</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="built_in">PYBIND11_MODULE</span>(analyze_data_util, m)</span><br><span class="line">&nbsp;{</span><br><span class="line">&nbsp; &nbsp; &nbsp;py::<span class="built_in">class_</span>&lt;AnalyzeDataUtil&gt;(m, <span class="string">"AnalyzeDataUtil"</span>)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  .<span class="built_in">def</span>(py::<span class="built_in">init</span>&lt;py::dict&gt;())</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  .<span class="built_in">def</span>(<span class="string">"analyze_data"</span>, &amp;AnalyzeDataUtil::analyze_data)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp;  .<span class="built_in">def</span>(<span class="string">"get_datas"</span>, &amp;AnalyzeDataUtil::get_datas);</span><br><span class="line">&nbsp;}</span><br><span class="line">&nbsp;</span><br></pre></td></tr></tbody></table></figure><h5 id="4-创建CMakeLists-txt文件编译C-模块"><a href="#4-创建CMakeLists-txt文件编译C-模块" class="headerlink" title="4. 创建CMakeLists.txt文件编译C++模块"></a>4. 创建CMakeLists.txt文件编译C++模块</h5><p>创建文件analyze_data_util/CMakeLists.txt， 然后将下面的脚本拷贝到文件中。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;cmake_minimum_required(VERSION 3.12)</span><br><span class="line"></span><br><span class="line">&nbsp;project(analyze_data_util LANGUAGES CXX)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="built_in">set</span>(CMAKE_CXX_STANDARD 14)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;find_package(pybind11 REQUIRED)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;pybind11_add_module(analyze_data_util analyze_data_util.cpp)</span><br></pre></td></tr></tbody></table></figure><h5 id="5-编译C-模块"><a href="#5-编译C-模块" class="headerlink" title="5. 编译C++模块"></a>5. 编译C++模块</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="built_in">mkdir</span> build</span><br><span class="line">&nbsp;<span class="built_in">cd</span> build</span><br><span class="line">&nbsp;cmake ..</span><br><span class="line">&nbsp;cmake --build .</span><br></pre></td></tr></tbody></table></figure><p>将工作目录切换到analyze_data_util中，分别执行上面的代码。将会创建共享库文件，在Mac或Linux中名为：analyze_data_util.so，在Windows中为analyze_data_util.pyd</p><h5 id="6-构造接口"><a href="#6-构造接口" class="headerlink" title="6. 构造接口"></a>6. 构造接口</h5><p>因为在c++中不允许直接访问私有成员，因此我们实现了get_datas()方法来间接访问成员，但是这不符合python的使用习惯，因此我们构造一个同名的AnalyzeDataUtil类将这一细节隐藏起来。也可以省去该步奏，但必须通过get_datas()函数访问解析后的数据。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="comment"># path: demo/analyze_data_tool.py</span></span><br><span class="line">&nbsp;<span class="keyword">import</span> analyze_data_util</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># Wrapper for AnalyzeDataUtil class</span></span><br><span class="line">&nbsp;<span class="keyword">class</span> <span class="title class_">AnalyzeDataUtil</span>:</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, datas</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.analyzer = analyze_data_util.AnalyzeDataUtil(datas)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.datas = datas</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">def</span> <span class="title function_">analyze_data</span>(<span class="params">self, data, result=<span class="string">"resbody"</span>, depth=<span class="number">0</span></span>): &nbsp; </span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.analyzer.analyze_data(data, result, depth)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="variable language_">self</span>.datas = <span class="variable language_">self</span>.analyzer.get_datas()</span><br></pre></td></tr></tbody></table></figure><h5 id="7-在python中使用C-模块"><a href="#7-在python中使用C-模块" class="headerlink" title="7. 在python中使用C++模块"></a>7. 在python中使用C++模块</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="comment"># path: demo/test.py</span></span><br><span class="line">&nbsp;<span class="keyword">from</span> analyze_data_tool <span class="keyword">import</span> AnalyzeDataUtil</span><br><span class="line">&nbsp;<span class="keyword">import</span> json</span><br><span class="line">&nbsp;<span class="keyword">import</span> time</span><br><span class="line">&nbsp;<span class="keyword">import</span> pprint</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="built_in">print</span>(<span class="string">'示例用法,c++版本:'</span>)</span><br><span class="line">&nbsp;json_data = <span class="string">'{"resbody": {"data": {"name": "John", "age": 30, "address": {"city": "New York", "zipcode": 10001}}}}'</span></span><br><span class="line">&nbsp;data_dict = json.loads(json_data)</span><br><span class="line">&nbsp;time1 = time.time()</span><br><span class="line">&nbsp;analyzer2 = AnalyzeDataUtil({})</span><br><span class="line">&nbsp;analyzer2.analyze_data(data_dict, <span class="string">"resbody"</span>, <span class="number">0</span>)</span><br><span class="line">&nbsp;time2 = time.time()</span><br><span class="line">&nbsp;all_keys1 = analyzer2.datas.keys()</span><br><span class="line">&nbsp;keys_list1 = <span class="string">' '</span>.join(<span class="built_in">list</span>(all_keys1))</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;result = time2 - time1</span><br><span class="line">&nbsp;formatted_result = <span class="string">f"<span class="subst">{result:<span class="number">.10</span>f}</span>"</span></span><br><span class="line">&nbsp;pp.pprint(all_keys1)</span><br><span class="line">&nbsp;<span class="built_in">print</span>(formatted_result)</span><br></pre></td></tr></tbody></table></figure><p>创建以上代码，然后将生成的.so or .pyd文件拷贝到demo/目录下，运行python test.py。</p><h5 id="8-后记"><a href="#8-后记" class="headerlink" title="8. 后记"></a>8. 后记</h5><p>虽然上面的解决方案实现了c++与python的互通，但我在对单个文件进行测试比较的时候，得到如下结果：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20230723015325.png" alt="image-20230723015325241"></p><p>从结果中我们发现，对于相同的json文件，c++版本与python版本处理结果是一致的，但对于速度的提升并不理想，对于单个文件的处理c++的版本甚至比python的低，可能是因为python调用c++包的时候占用了更多的时间，因此，处理速度的提升体现不出来。针对这个问题，我们至少可以从以下两个方面进行考虑：首先，从算法层面上来看，我们可以将递归改为动态规划，或者对递归过程进行剪枝处理，因为递归虽然好用，但是效率往往不高，它重复的过程实比较多。其次，我们还可以尝试使用一些能够快速解析json格式的优秀库(比如<a href="https://rapidjson.org/zh-cn/">RapidJSON</a>)，这或许会比使用我们自己写的粗糙代码效率来的更快。</p><p>最后，虽然上面讲解中涉及到的每个脚本，我都给出了它所在的文件名和位置，但是并不直观，为了方便大家更直观的理解(我跑别人博客代码的时候，经常因为位置放错，浪费时间去调试)，我把工程目录粘贴出来：</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20230723022224.png" alt="image-20230723022223900"></p><p>以上就是使用pybind11实现c++与python互通的demo啦，希望能够帮到你，想要了解更多，可以去看下面的官方文档喔。</p><ul><li><strong>参考资料</strong><ul><li><strong>pybind11文档：</strong><a href="https://pybind11.readthedocs.io/en/stable/">https://pybind11.readthedocs.io/en/stable/</a></li><li><strong>pybind11中文文档：</strong><a href="https://github.com/charlotteLive/pybind11-Chinese-docs">https://github.com/charlotteLive/pybind11-Chinese-docs</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python_c++_互通 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac系统制作win10启动U盘</title>
      <link href="/2022/09/07/mac-xi-tong-zhi-zuo-win10-qi-dong-u-pan/"/>
      <url>/2022/09/07/mac-xi-tong-zhi-zuo-win10-qi-dong-u-pan/</url>
      
        <content type="html"><![CDATA[<h5 id="Mac系统下制作win10安装盘"><a href="#Mac系统下制作win10安装盘" class="headerlink" title="Mac系统下制作win10安装盘"></a>Mac系统下制作win10安装盘</h5><h6 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h6><ul><li><p>一台mac电脑</p></li><li><p>一个大于8G的U盘</p></li><li><p>win10镜像文件</p></li><li><p>Boot Camp ISO Converter软件（这个软件可以解决FAT32格式的u盘单个文件大小不能超过4GB的问题），下载<a href="https://macdownload.informer.com/boot-camp-iso-converter/download/">链接</a></p></li></ul><h6 id="制作步骤"><a href="#制作步骤" class="headerlink" title="制作步骤"></a>制作步骤</h6><ul><li><p>打开Boot Camp ISO Converter软件对下载好的iso镜像文件进行处理，目的是将镜像文件insta.win分配为大小小于4GB的文件</p></li><li><p>在插入U盘的状态下，打开终端，输入：</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br></pre></td></tr></tbody></table></figure><p>  找到U盘对应的盘符，本例中U盘对应的盘符为：disk2</p></li><li><p>将U盘(disk2)格式化为FAT32格式</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil eraseDisk FAT32 <span class="string">"WINDOWS10"</span> MBR disk2</span><br></pre></td></tr></tbody></table></figure></li><li><p>找到经过Boot Camp ISO Converter处理后的镜像文件，然后双击挂载镜像文件</p></li><li><p>输入命令，将挂载的镜像盘拷贝至U盘中(disk2)</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rp /Volumes/CPBA_X64FRE_ZH-CN_DV9/* /Volumes/WINDOWS10/</span><br></pre></td></tr></tbody></table></figure></li></ul><p> 这里的CPBA_X64FRE_ZH是刚刚挂载的镜像的名称,大约等待10分钟，命令运行结束之后，启动盘就做好了。</p><h6 id="win10系统安装过程中报错解决方法"><a href="#win10系统安装过程中报错解决方法" class="headerlink" title="win10系统安装过程中报错解决方法"></a>win10系统安装过程中报错解决方法</h6><p>在磁盘格式步骤可能会报“windows无法安装到这个磁盘，选中的磁盘采用的GPT/MBR分区形式”错误，解决方法有2种，这里只列举其中一种方法：</p><ul><li><p>转换磁盘格式为MBR，但是会清除所有磁盘分区</p><p>  在错误提示的时候，不要重启电脑，直接按”Shift+F10”组合键，这个时候会弹出CMD提示框，然后依次输入如下命令：</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">list disk <span class="comment"># 回车键确定；（会列出所有的磁盘，记住自己硬盘的磁盘号，通过容量大小就可以分辨了，如下图所示，磁盘0就是我们的硬盘，磁盘1就是U盘）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> disk 0 <span class="comment"># 回车键确定；（选择磁盘0，也就是我们的硬盘，就是准备做系统的硬盘）</span></span><br><span class="line"></span><br><span class="line">clean <span class="comment"># 回车键确定；（清空磁盘，相当于格式化全盘）</span></span><br><span class="line"></span><br><span class="line">convert mbr <span class="comment"># 回车键确定；（将该硬盘转换为mbr格式，如果想要将硬盘转化为gpt，那就是输入“convert gpt”）</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h6 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><a href="https://blog.csdn.net/h21396577548/article/details/125572053">参考链接</a></h6>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 启动U盘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电磁比赛总结</title>
      <link href="/2022/09/05/dian-ci-bi-sai-zong-jie/"/>
      <url>/2022/09/05/dian-ci-bi-sai-zong-jie/</url>
      
        <content type="html"><![CDATA[<p>电磁比赛总结</p><p>代码总结</p><ol><li>要会静态分析资源占有率，特别是当服务器内存资源不足的时候，提前做好静态分析，设置合理的运行参数，才能提升效率。比如本次实验过程中，做数据增强预处理数据时需要占用大量内存资源，参数设置过大，会导致运行一半后因为内存不足，进程被killed掉，参数设置过小效率又变得很低。</li><li>当数据很多，需要占用大量内存时，不要将数据转换为pandas的DataFrame对象，因为它会吃掉更多的内存，此外使用apply方法对数据进行逐行处理的时候，即使使用了加速方法，也没有将数据存储为list然后使用多进程方法处理高效。在本次实验中，后者的速度至少是前者的5倍。</li><li>尽量使用class对代码进行封装，而不是使用一个个单独的函数</li><li>尽量保证函数的功能单一，这样的函数更容易被复用，多写几个函数没有关系</li><li>几种常用的保存/读取数据方式：</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&nbsp; <span class="keyword">import</span> pickle</span><br><span class="line">&nbsp; <span class="keyword">import</span> json</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># 使用pickle </span></span><br><span class="line">&nbsp;pickle.dump(data, file=<span class="built_in">open</span>(file_name,<span class="string">"wb"</span>))</span><br><span class="line">&nbsp;data = pickle.load(file=<span class="built_in">open</span>(file_name, <span class="string">"rb"</span>))</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># 使用json</span></span><br><span class="line">&nbsp;json.dump(data, file=<span class="built_in">open</span>(file_name,<span class="string">"w"</span>))</span><br><span class="line">&nbsp;data = json.load(file=<span class="built_in">open</span>(file_name, <span class="string">"r"</span>))</span><br></pre></td></tr></tbody></table></figure><ol start="6"><li>使用coment来可视化训练过程</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&nbsp; <span class="keyword">from</span> comet_ml <span class="keyword">import</span> Experiment</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;experiment = Experiment(project_name=args.project_name,</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;api_key=args.api_key)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;experiment.log_parameters(<span class="built_in">vars</span>(args))</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="keyword">with</span> experiment.train():</span><br><span class="line">&nbsp; &nbsp; &nbsp;experiment.log_metric(<span class="string">'epoch_loss'</span>, train_loss, step=epoch)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="keyword">with</span> experiment.validate():</span><br><span class="line">&nbsp; &nbsp; &nbsp;experiment.log_metric(<span class="string">'epoch_loss'</span>, val_loss, step=epoch)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;experiment.end()</span><br></pre></td></tr></tbody></table></figure><ol start="7"><li>使用argparse来构建超参数管理入口</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&nbsp; <span class="keyword">import</span> argparse</span><br><span class="line">&nbsp; parser = argparse.ArgumentParser()</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp;parser.add_argument(<span class="string">"--drop_data_rate"</span>, default=<span class="number">0.9</span>, <span class="built_in">type</span>=<span class="built_in">float</span>,required=<span class="literal">False</span>)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp;args = parser.parse_args() <span class="comment">#将参数变成可调用对象</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp;pp.pprint(<span class="built_in">vars</span>(args)) <span class="comment"># 打印参数</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; &nbsp;<span class="keyword">def</span> <span class="title function_">str2bool</span>(<span class="params">v</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">if</span> v.lower() <span class="keyword">in</span> (<span class="string">'yes'</span>, <span class="string">'true'</span>, <span class="string">'t'</span>, <span class="string">'y'</span>, <span class="string">'1'</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">elif</span> v.lower() <span class="keyword">in</span> (<span class="string">'no'</span>, <span class="string">'false'</span>, <span class="string">'f'</span>, <span class="string">'n'</span>, <span class="string">'0'</span>):</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">&nbsp; &nbsp; &nbsp;<span class="keyword">else</span>:</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="keyword">raise</span> argparse.ArgumentTypeError(<span class="string">'Unsupported value encountered.'</span>)</span><br></pre></td></tr></tbody></table></figure><p>注： 使用add_argument()添加参数的时候有一个大坑，=当添加参数的type为bool的时候，不能设置type=bool，需要自定义str2bool函数，然后设置type=str2bool。</p><ol start="8"><li>使用multiprocessing提高处理速度：凡是能够并行处理且数据量巨大的任务，应尽量使用多进程编程</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line">&nbsp;<span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp; <span class="keyword">with</span> Pool(n_workers) <span class="keyword">as</span> p: <span class="comment"># n_workers表示进程数</span></span><br><span class="line">&nbsp; &nbsp; &nbsp;result = <span class="built_in">list</span>(tqdm(p.imap(function, data), total=<span class="built_in">len</span>(data))) <span class="comment"># 这里使用tqdm显示进度条，需要调用imap，如果不用显示进度条调用map函数</span></span><br></pre></td></tr></tbody></table></figure><ol start="9"><li>使用plt将图片保存到内存中，提高处理效率</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line">&nbsp;<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;p_bytes = BytesIO() <span class="comment">#申请内存</span></span><br><span class="line">&nbsp;plt.savefig(p_bytes, <span class="built_in">format</span>=<span class="string">'png'</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="10"><li>关于采样的函数</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">&nbsp;<span class="keyword">import</span> random</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;indents = np.random.choice(<span class="number">2</span>, n,replace=<span class="literal">True</span>,p=[pro1, pro2]) <span class="comment"># 有放回的从[0,1]中取n个值，取0的概率为pro1，取1的概率为pro2</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;random.shuffle(data)</span><br><span class="line">&nbsp;sample_resulut = random.sample(data, n)</span><br></pre></td></tr></tbody></table></figure><p>11.PIL库读取图片</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="keyword">import</span> PIL</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;img = PIL.Image.<span class="built_in">open</span>(image_byte)</span><br><span class="line">&nbsp;img = img.convert(<span class="string">'RGB'</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="12"><li>plt 画散点图和图片画布设置</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&nbsp;<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">4</span>, <span class="number">4</span>) <span class="comment"># 设置图片大小</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;plt.rcParams[<span class="string">'savefig.dpi'</span>] = <span class="number">56</span> <span class="comment">#设置像素</span></span><br><span class="line">&nbsp;plt.rcParams[<span class="string">'figure.dpi'</span>] = <span class="number">56</span> <span class="comment">#设置像素</span></span><br><span class="line">&nbsp;plt.axis(<span class="string">'off'</span>) <span class="comment">#关闭坐标</span></span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># 多张子图</span></span><br><span class="line">&nbsp;fig, axs = plt.subplots(n, <span class="number">1</span>)</span><br><span class="line">&nbsp;<span class="keyword">for</span> idx, dim <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">range</span>(n)):</span><br><span class="line">&nbsp; &nbsp; &nbsp;axs[idx].axis(<span class="string">'off'</span>)</span><br><span class="line">&nbsp; &nbsp; &nbsp;axs[idx].scatter(x, y, s=<span class="number">0.1</span>)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;<span class="comment"># 单张子图</span></span><br><span class="line">&nbsp;fig, axs = plt.subplots(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">&nbsp;axs.axis(<span class="string">'off'</span>)</span><br><span class="line">&nbsp;axs.scatter(x, y, s=<span class="number">0.1</span>)</span><br><span class="line">&nbsp;</span><br><span class="line">&nbsp;plt.savefig(file_name) <span class="comment"># 保存到磁盘</span></span><br><span class="line">&nbsp;p_bytes = BytesIO()</span><br><span class="line">&nbsp;plt.savefig(p_bytes, <span class="built_in">format</span>=<span class="string">'png'</span>) <span class="comment"># 保存到内存</span></span><br><span class="line">&nbsp;plt.cla()</span><br><span class="line">&nbsp;plt.close(<span class="string">'all'</span>) <span class="comment"># 清空缓存</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 竞赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远程访问服务器Jupyter-Notebook</title>
      <link href="/2022/04/29/yuan-cheng-fang-wen-fu-wu-qi-jupyter-notebook/"/>
      <url>/2022/04/29/yuan-cheng-fang-wen-fu-wu-qi-jupyter-notebook/</url>
      
        <content type="html"><![CDATA[<h4 id="方法：-ssh远程使用jupyter-notebook"><a href="#方法：-ssh远程使用jupyter-notebook" class="headerlink" title="方法： ssh远程使用jupyter notebook"></a>方法： ssh远程使用jupyter notebook</h4><p>在远程服务器上，启动jupyter notebooks服务：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --no-browser --port=8889</span><br></pre></td></tr></tbody></table></figure><p>在本地终端中启动SSH：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -N -f -L localhost:8888:localhost:8889 username@serverIP</span><br></pre></td></tr></tbody></table></figure><p>其中： -N 告诉SSH没有命令要被远程执行； -f 告诉SSH在后台执行； -L 是指定port forwarding的配置，远端端口是8889，本地的端口号的8888。</p><p>注意：username@serverIP替换成服务器的对应账号。</p><p>最后打开浏览器，访问：<a href="http://localhost:8888/">http://localhost:8888/</a></p>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jupyter notebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++多线程编程</title>
      <link href="/2021/12/10/c-duo-xian-cheng-bian-cheng/"/>
      <url>/2021/12/10/c-duo-xian-cheng-bian-cheng/</url>
      
        <content type="html"><![CDATA[<h4 id="常用线程函数"><a href="#常用线程函数" class="headerlink" title="常用线程函数"></a>常用线程函数</h4><ul><li><p>join() :</p><blockquote><p>阻塞主线程，让主线程等待子线程执行完，当子线程执行完毕，这个join（）就执行完毕，主线程继续执行</p></blockquote></li><li><p>detach() :</p><blockquote><p>从主线程中将子线程分离，主线程不必等待子线程执行完，一旦detach()之后子线程将失去与主线程的关联，<br>此时这个子线程就会驻留在后台运行，被c++运行时接管，当这个子线程执行完成后，由运行时库负责清理线程相关的资源。</p></blockquote></li></ul><h4 id="线程创建方法"><a href="#线程创建方法" class="headerlink" title="线程创建方法"></a>线程创建方法</h4><ul><li><p>通过函数创建线程</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span>  std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">do_something</span><span class="params">()</span></span>{</span><br><span class="line">    cout &lt;&lt; <span class="string">"线程开始"</span>&lt;&lt; endl;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">    cout &lt;&lt; <span class="string">"线程结束"</span> &lt;&lt; endl;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="function">thread <span class="title">myjob</span> <span class="params">(do_something)</span></span>; </span><br><span class="line">    myjob.<span class="built_in">join</span>(); <span class="comment">//阻塞主线程，等待子线程结束</span></span><br><span class="line">    cout &lt;&lt; <span class="string">"The End"</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>通过类创建线程</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span>  std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">myClass</span>{</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myClass</span>(<span class="type">int</span> d):<span class="built_in">data</span>(d){</span><br><span class="line">        cout &lt;&lt; <span class="string">"构造函数"</span> &lt;&lt;endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">myClass</span>(<span class="type">const</span> myClass&amp;myClass1):<span class="built_in">data</span>(myClass<span class="number">1.</span>data){</span><br><span class="line">        cout &lt;&lt; <span class="string">"拷贝构造函数"</span> &lt;&lt;endl;</span><br><span class="line">    }</span><br><span class="line">    ~<span class="built_in">myClass</span>(){</span><br><span class="line">        cout &lt;&lt; <span class="string">"析构函数"</span> &lt;&lt;endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">//线程的入口</span></span><br><span class="line">        cout &lt;&lt; <span class="string">"线程开始"</span> &lt;&lt;endl;</span><br><span class="line"><span class="comment">//        do something</span></span><br><span class="line">        cout &lt;&lt; <span class="string">"线程结束"</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="function">myClass <span class="title">myclass</span><span class="params">(a)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">myjob</span> <span class="params">(myclass)</span></span>; <span class="comment">// 复制一次myclass</span></span><br><span class="line">    myjob.<span class="built_in">join</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">"The End"</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>通过lambda表达式创建线程</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span>  std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">auto</span> myLambdaThread = []{</span><br><span class="line">        cout &lt;&lt; <span class="string">"线程开始"</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//        do something</span></span><br><span class="line">        cout &lt;&lt; <span class="string">"线程结束"</span> &lt;&lt; endl;</span><br><span class="line">    };</span><br><span class="line">    <span class="function">thread <span class="title">myjob</span> <span class="params">(myLambdaThread)</span></span>;</span><br><span class="line">    myjob.<span class="built_in">join</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">"The End"</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul><h4 id="传递临时对象作为线程参数"><a href="#传递临时对象作为线程参数" class="headerlink" title="传递临时对象作为线程参数"></a>传递临时对象作为线程参数</h4><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span>  std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">do_something_with_parameters</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; a, <span class="type">char</span> *buff)</span></span>{</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; buff &lt;&lt; endl;<span class="comment">//传指针危险</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="type">int</span> val = <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> buff[] = <span class="string">"this is a test!"</span>;</span><br><span class="line">    <span class="function">thread <span class="title">myjob</span> <span class="params">(do_something_with_parameters, val, buff)</span></span>;</span><br><span class="line">    myjob.<span class="built_in">join</span>(); <span class="comment">//阻塞主线程，等待子线程结束</span></span><br><span class="line">    cout &lt;&lt; <span class="string">"The End"</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="线程id"><a href="#线程id" class="headerlink" title="线程id"></a>线程id</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">获取线程<span class="built_in">id</span>：get_id（）</span><br><span class="line">获取当前线程<span class="built_in">id</span>：std::this_thread::get_id()</span><br></pre></td></tr></tbody></table></figure><h4 id="线程间的值传递"><a href="#线程间的值传递" class="headerlink" title="线程间的值传递"></a>线程间的值传递</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::ref()</span><br><span class="line">std::move()</span><br></pre></td></tr></tbody></table></figure><h4 id="最多可以使用的线程数"><a href="#最多可以使用的线程数" class="headerlink" title="最多可以使用的线程数"></a>最多可以使用的线程数</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::thread::hardware_concurrency()</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>将微信聊天中的语音转换为mp3</title>
      <link href="/2021/09/29/jiang-wei-xin-liao-tian-zhong-de-yu-yin-zhuan-huan-wei-mp3/"/>
      <url>/2021/09/29/jiang-wei-xin-liao-tian-zhong-de-yu-yin-zhuan-huan-wei-mp3/</url>
      
        <content type="html"><![CDATA[<ol><li><p>找到语音文件将其导出</p><ul><li>找到MAC微信图片，鼠标放在图片上面按下右键调出如下图所示的提示框，然后点击“在Finder中显示”，打开音频、图片等文件在本地保存的位置。</li></ul> <img src="https://raw.githubusercontent.com/Skylyong/i/main/20210929173234.png" alt="image-20210929173226533" style="zoom:50%;"><p> ​            这个地方需要注意的是，微信保存到本地的记录是按照聊天会话存储的，不同会话的内容保存的位置不一样。我们应该先定位到要获取音频的会话，在该会话中调出“在Finder”中显示才行。</p><ul><li><p>如下图所示Audio目录就是存储会话语音</p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210929173725.png" alt="image-20210929173725735" style="zoom:45%;"></li></ul></li><li><p>将silk格式文件转换为mp3格式文件</p><ul><li><p>安装silk-v3</p><p>silk-v3依赖gcc和FFmpeg来运行，如果没有这两个依赖项，通过如下命令安装依赖：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install gcc</span><br><span class="line">brew install ffmpeg</span><br></pre></td></tr></tbody></table></figure><p>安装好依赖之后，在<a href="https://github.com/kn007/silk-v3-decoder">这里</a>将silk-v3克隆到本地电脑。</p></li><li><p>用silk-v3进行格式转换</p><p>按照<a href="https://github.com/Skylyong/silk-v3-decoder">silk-v3项目说明</a>运行命令，完成格式转换。</p><ul><li><p>转换单个文件</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh converter.sh xxx.slk mp3</span><br></pre></td></tr></tbody></table></figure></li><li><p>批量转换文件夹中的多个文件</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh converter.sh inputFolder ouputFolder mp3</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li><li><p>参考资料</p></li></ol><p><a href="https://www.jianshu.com/p/fbccd8a52374">微信语音silk格式文件转换处理记录</a></p><p><a href="https://blog.csdn.net/henryhu712/article/details/89852514">将微信语音消息转换为 mp3</a></p>]]></content>
      
      
      <categories>
          
          <category> 生活总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习参考资料</title>
      <link href="/2021/09/19/ji-qi-xue-xi-can-kao-zi-liao/"/>
      <url>/2021/09/19/ji-qi-xue-xi-can-kao-zi-liao/</url>
      
        <content type="html"><![CDATA[<p>机器学习参考资料：</p><ul><li><p>机器学习参考书籍：</p><ul><li>《神经网络与深度学习》书籍及PPT：<a href="https://nndl.github.io/">https://nndl.github.io/</a></li><li>《统计学习方法》李航著</li><li>《机器学习》周志华著</li><li>《南瓜书》：<a href="https://datawhalechina.github.io/pumpkin-book/%EF%BC%8C">https://datawhalechina.github.io/pumpkin-book/，</a> <a href="https://github.com/datawhalechina/pumpkin-book">https://github.com/datawhalechina/pumpkin-book</a></li><li>《迁移学习》杨强等著</li><li>《联邦学习》杨强等著</li><li>Python Machine Learning： <a href="https://github.com/rasbt/python-machine-learning-book">https://github.com/rasbt/python-machine-learning-book</a></li><li>深度学习：英文版（ <a href="https://www.deeplearningbook.org/%EF%BC%89%E3%80%81%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%88">https://www.deeplearningbook.org/）、中文版（</a> <a href="https://github.com/exacity/deeplearningbook-chinese%EF%BC%89">https://github.com/exacity/deeplearningbook-chinese）</a></li><li>《强化学习Reinforcement Learning（第2版）》[加]Richard S.Sutton [美]Andrew G. Barto著，俞凯等译</li></ul></li><li><p>数学类参考书籍：</p><ul><li>凸优化Convex Optimization（<a href="http://stanford.edu/~boyd/cvxbook/%EF%BC%89%E3%80%81">http://stanford.edu/~boyd/cvxbook/）、</a></li><li>线性代数 <a href="https://ocw.mit.edu/courses/mathematics/18-06sc-linear-algebra-fall-2011/index.htm">https://ocw.mit.edu/courses/mathematics/18-06sc-linear-algebra-fall-2011/index.htm</a></li><li>概率论与统计：1）斯坦福课程CS109 Probability for Computer Scientists： <a href="http://web.stanford.edu/class/cs109/%EF%BC%9B2%EF%BC%89Introduction">http://web.stanford.edu/class/cs109/；2）Introduction</a> to Probability, Statistics, and Random Processes： <a href="https://www.probabilitycourse.com/">https://www.probabilitycourse.com/</a></li></ul></li><li><p>机器学习库/平台：</p><ul><li>SKlearn（<a href="https://scikit-learn.org/stable/%EF%BC%89%EF%BC%8CSKlearn%E7%9A%84User">https://scikit-learn.org/stable/），SKlearn的User</a> Guide里总结了很多机器学习模型，可以学习下<a href="https://scikit-learn.org/stable/user_guide.html%E3%80%82%E4%B8%8A%E9%9D%A2%E6%8F%90%E5%88%B0%E7%9A%84Python">https://scikit-learn.org/stable/user_guide.html。上面提到的Python</a> Machine Learning书籍中就大量使用SKlearn的API。</li><li>Pytorch： <a href="https://pytorch.org/tutorials/">https://pytorch.org/tutorials/</a></li><li>TensorFlow</li><li>Keras（ <a href="https://keras.io/%EF%BC%89%E7%AD%89%E3%80%82">https://keras.io/）等。</a></li></ul></li><li><p>线上课程：</p><ul><li>吴恩达教授的视频教学课程（ <a href="https://www.coursera.org/learn/machine-learning%EF%BC%89">https://www.coursera.org/learn/machine-learning）</a></li><li>李宏毅-台湾大学（<a href="http://speech.ee.ntu.edu.tw/~tlkagk/courses_ML20.html%EF%BC%89">http://speech.ee.ntu.edu.tw/~tlkagk/courses_ML20.html）</a></li><li>Google的深度学习课程（<a href="https://www.udacity.com/course/intro-to-tensorflow-for-deep-learning--ud187%EF%BC%89">https://www.udacity.com/course/intro-to-tensorflow-for-deep-learning--ud187）</a></li><li>李飞飞教授的计算机视觉课程（<a href="http://cs231n.stanford.edu)/">http://cs231n.stanford.edu）</a></li><li>Richard Socher 的自然语言处理课程（<a href="http://cs224d.stanford.edu/">http://cs224d.stanford.edu</a>)</li><li>University of Chicago Mathematical Foundations of Machine Learning(<a href="https://voices.uchicago.edu/willett/teaching/mathematical-foundations-of-machine-learning-fall-2020/">https://voices.uchicago.edu/willett/teaching/mathematical-foundations-of-machine-learning-fall-2020/</a>)</li></ul></li><li><p>其他资料：</p><ul><li>Machine Learning and Artificial Intelligence and their role in networking： <a href="https://www.bilibili.com/video/av70398058/">https://www.bilibili.com/video/av70398058/</a></li><li>链接：<a href="https://pan.baidu.com/s/1qgYRbtfCLZE8d0MuCSrRLw">https://pan.baidu.com/s/1qgYRbtfCLZE8d0MuCSrRLw</a>  密码:1am4</li><li>链接：<a href="https://pan.baidu.com/s/1YAujUyivMKZcOCUxB9GZlw">https://pan.baidu.com/s/1YAujUyivMKZcOCUxB9GZlw</a> 提取码：wru7</li></ul></li></ul><!-- + 博客： --><blockquote><p>声明： 内容摘自<a href="https://tingwang1122.github.io/">王老师</a>的个人主页。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习资料 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>有用的资源</title>
      <link href="/2021/09/19/you-yong-de-zi-yuan/"/>
      <url>/2021/09/19/you-yong-de-zi-yuan/</url>
      
        <content type="html"><![CDATA[<p>有用的资源</p><!-- <br> --><ul><li><p><a href="https://github.com/Skylyong/Skylyong.github.io/tree/main/files/paper-reading.pdf">How to Read a Paper</a>, by <a href="http://blizzard.cs.uwaterloo.ca/keshav/wiki/index.php/Main_Page">Prof. Srinivasan Keshav</a>.</p></li><li><p><a href="http://dustintran.com/blog/a-research-to-engineering-workflow">A Research to Engineering Workflow</a>, by <a href="http://dustintran.com/">Dr. Dustin Tran</a>.</p></li><li><p><a href="https://github.com/Skylyong/Skylyong.github.io/tree/main/files/mathwriting.pdf">Mathematical Writing</a>, by <a href="https://www-cs-faculty.stanford.edu/~knuth/">Donald E. Knuth</a>,<a href="https://larrabee.soe.ucsc.edu/">Tracy Larrabee</a> and <a href="http://www.math.utah.edu/~roberts/">Paul M. Roberts</a>.</p></li></ul><!-- + [Whitesides' Group: Writing a Paper](), by [George M. Whitesides](https://gmwgroup.harvard.edu/people/george-m-whitesides). --><ul><li><p><a href="https://github.com/Skylyong/Skylyong.github.io/tree/main/files/review-writing.pdf">Writing reviews for systems conferences</a>, by <a href="http://people.inf.ethz.ch/troscoe/">Timothy Roscoe</a>.</p></li><li><p><a href="https://github.com/Skylyong/Skylyong.github.io/tree/main/files/how-to-write-a-paper.pdf">How to write a paper</a>, by <a href="http://www-edc.eng.cam.ac.uk/people/mfa2.html">Mike Ashby</a>.</p></li><li><p><a href="https://github.com/Skylyong/Skylyong.github.io/tree/main/files/Leading_Paper_Discussions.pdf">Pointers for Leading Paper Discussions</a>, by <a href="https://www2.eecs.berkeley.edu/Faculty/Homepages/katz.html">Randy H. Katz</a>.</p></li><li><p><a href="https://ailyong.cn/2021/09/19/ji-qi-xue-xi-can-kao-zi-liao/">Machine Learning Materials for Beginners</a>.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习资料 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 资源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信标签整理</title>
      <link href="/2021/08/14/wei-xin-biao-qian-zheng-li/"/>
      <url>/2021/08/14/wei-xin-biao-qian-zheng-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近对微信通讯录做了一次比较彻底的整理，记录一下。</p></blockquote><p>我根据兴趣、人生阶段、亲疏关系和生活四个维度来分类，每个维度的具体分类标签如下：</p><ul><li>按兴趣： 兴趣-户外，兴趣-跑步，兴趣-阅读，兴趣-美食等</li><li>按人生阶段划分为：中学，本科，研究生，兼职等，每一个阶段又可以做进一步划分。<ul><li>中学-同学，中学-校友，中学-老师</li><li>本科-同学，本科-校友，本科-老师</li><li>研究生-同学，研究生-校友，研究生-老师</li><li>兼职-同事，兼职-同行</li></ul></li><li>按亲疏关系可分为：<ul><li>家人</li><li>亲戚</li><li>朋友</li><li>有缘相逢</li></ul></li><li>生活涉及的东西比较杂，我是把“照相、打印和水电等”都放在了“生活便利”这一个标签里面，然后在名字上面做备注，比如“张三|打印”。此外，我把医生、法律人士做了单独的标签，最后加了一个“大佬”标签，方便时刻关注大佬的动态、向大佬靠齐。<ul><li>生活便利</li><li>生活-医务</li><li>生活-法律</li><li>大佬</li></ul></li></ul><p>分好之后才感觉这种二级分类有点繁琐，先用一段时间看看，不行的话再做优化。</p>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>工具箱</title>
      <link href="/2021/08/14/gong-ju-xiang/"/>
      <url>/2021/08/14/gong-ju-xiang/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://www.jibing57.com/2019/03/24/share-ShadowsocksX-NG-to-iOS/">Mac下共享ShadowsocksX-NG的梯子给iOS</a></li><li><a href="https://www.cnblogs.com/jserhub/p/11770585.html">GitHub 设置和取消代理，加速 git clone</a></li><li><a href="https://www.zxgj.cn/g/rznl">在线智商测试</a></li></ul><ul><li><a href="https://ailyong.cn/2022/09/07/mac-xi-tong-zhi-zuo-win10-qi-dong-u-pan/">Mac系统制作win10启动U盘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 收藏 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 干货 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Google访问助手安装</title>
      <link href="/2021/08/13/google-fang-wen-zhu-shou-an-zhuang/"/>
      <url>/2021/08/13/google-fang-wen-zhu-shou-an-zhuang/</url>
      
        <content type="html"><![CDATA[<h3 id="Google访问助手安装"><a href="#Google访问助手安装" class="headerlink" title="Google访问助手安装"></a>Google访问助手安装</h3><p>今天用图书馆电脑的时候发现不能访问google，非常不方便搜索文献，因此研究了一下google上网助手，记录一下。</p><ul><li><h3 id="IGG谷歌访问助手"><a href="#IGG谷歌访问助手" class="headerlink" title="IGG谷歌访问助手"></a><a href="https://iguge.app/">IGG谷歌访问助手</a></h3><blockquote><p>该助手具有如下特点：</p><ul><li>免费提供谷歌搜索</li><li>微软onedrive加速</li><li>不包含YouTube，谷歌网盘</li></ul></blockquote></li><li><h3 id="google上网助手"><a href="#google上网助手" class="headerlink" title="google上网助手"></a><a href="https://chrome.google.com/webstore/detail/%E8%B0%B7%E6%AD%8C%E4%B8%8A%E7%BD%91%E5%8A%A9%E6%89%8B/nonmafimegllfoonjgplbabhmgfanaka?utm_source=chrome-ntp-icon">google上网助手</a></h3><blockquote><p>该助手具备IGG谷歌访问助手的特点，但是安装的时候需要登录Chrome商店才能够下载，如果没有KX上网，建议读者选择安装“IGG谷歌访问助手”方式访问谷歌。</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> 干货 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Google访问助手 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用数据集整理</title>
      <link href="/2021/08/13/chang-yong-shu-ju-ji-zheng-li/"/>
      <url>/2021/08/13/chang-yong-shu-ju-ji-zheng-li/</url>
      
        <content type="html"><![CDATA[<h3 id="常用数据集整理"><a href="#常用数据集整理" class="headerlink" title="常用数据集整理"></a>常用数据集整理</h3><p>前沿：所谓”巧妇难为无米之炊“，作为人工智能领域的学习者，免不了要跟数据打交道，有时候我们不得不耗费大量的精力来收集相关数据集。因此， 整理一些常用的数据集，以便不时之需。</p><h4 id="对话数据集"><a href="#对话数据集" class="headerlink" title="对话数据集"></a>对话数据集</h4><h4 id="nlp方向的生物医学"><a href="#nlp方向的生物医学" class="headerlink" title="nlp方向的生物医学"></a>nlp方向的生物医学</h4><ul><li>Symcat’s database</li><li>mz database</li><li>dxy database</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【课程设计】图的创建和遍历</title>
      <link href="/2021/08/13/tu-de-chuang-jian-he-bian-li/"/>
      <url>/2021/08/13/tu-de-chuang-jian-he-bian-li/</url>
      
        <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>本课程设计主要完成邻接矩阵和邻接表两种不同存储方式的图的建立和遍历，其中遍历部分分别进行了DFS和BFS两种不同形式的遍历。</p><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include&lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;string.h&gt; </span></span><br><span class="line"><span class="comment">#include&lt;stack&gt;</span></span><br><span class="line"><span class="comment">#include&lt;queue&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">/********************************图的存储结构定义***********************/</span><br><span class="line"><span class="comment">#define MaxVerNum 30           </span></span><br><span class="line"><span class="comment">#define Vextype char</span></span><br><span class="line"><span class="comment">#define EdgeInfoType int</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#define INF 999      //无穷大 </span></span><br><span class="line"><span class="comment">#define MAXSIZE 100</span></span><br><span class="line"> </span><br><span class="line">typedef  struct</span><br><span class="line">{</span><br><span class="line">    Vextype  vexs[MaxVerNum];</span><br><span class="line">    EdgeInfoType edges[MaxVerNum][MaxVerNum];</span><br><span class="line">    <span class="built_in">int</span> n, e;</span><br><span class="line">}MGragh;</span><br><span class="line"> </span><br><span class="line">typedef  struct node</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> adjvex;</span><br><span class="line">    EdgeInfoType  Info;</span><br><span class="line">    struct node * <span class="built_in">next</span>;</span><br><span class="line">}EdgeNode;</span><br><span class="line"> </span><br><span class="line">typedef struct vnode</span><br><span class="line">{</span><br><span class="line">    Vextype  vertex;</span><br><span class="line">    EdgeNode *firstedge;</span><br><span class="line">}VertexNode;</span><br><span class="line"> </span><br><span class="line">typedef  struct</span><br><span class="line">{</span><br><span class="line">    VertexNode  adjlist[MaxVerNum];</span><br><span class="line">    <span class="built_in">int</span>   n, e;</span><br><span class="line">}ALGraph;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> visited[MaxVerNum];   //顶点访问标记 </span><br><span class="line"> </span><br><span class="line">/*建立图G的邻接矩阵  */</span><br><span class="line"><span class="built_in">int</span> returnId(MGragh *g, char c){</span><br><span class="line">//返回c在数组中的下标</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;MaxVerNum; ++i)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (g-&gt;vexs[i] == c) <span class="keyword">return</span> i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line">void CreateGraph(MGragh *g)</span><br><span class="line">{</span><br><span class="line">    scanf(<span class="string">"%d %d\n"</span>, &amp;(g-&gt;n), &amp;(g-&gt;e));</span><br><span class="line"> </span><br><span class="line">    char c;</span><br><span class="line">    <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">while</span> ((c = getchar()) == <span class="string">' '</span>);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">'\n'</span>) <span class="keyword">break</span>;</span><br><span class="line">        g-&gt;vexs[i++] = c;</span><br><span class="line">    }</span><br><span class="line">    Vextype s, e;</span><br><span class="line">    EdgeInfoType cost;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j&lt;g-&gt;n; j++)</span><br><span class="line">        {</span><br><span class="line">            g-&gt;edges[i][j] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;g-&gt;e; ++i)</span><br><span class="line">    {</span><br><span class="line">        scanf(<span class="string">"%c %c %d\n"</span>, &amp;s, &amp;e, &amp;cost);</span><br><span class="line">        g-&gt;edges[returnId(g, s)][returnId(g, e)] = cost;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/* 根据图的邻接矩阵建立图的邻接表 */</span><br><span class="line">void CreateALGraph(MGragh *mg, ALGraph *alg)</span><br><span class="line">{</span><br><span class="line">    alg-&gt;n = mg-&gt;n; alg-&gt;e = mg-&gt;e;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;alg-&gt;n; ++i)</span><br><span class="line">    {</span><br><span class="line">        alg-&gt;adjlist[i].vertex = mg-&gt;vexs[i];</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">int</span> i, j;</span><br><span class="line">    EdgeNode *s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; alg-&gt;n; ++i)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; alg-&gt;n; ++j)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (mg-&gt;edges[i][j] != <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                s = (EdgeNode*)malloc(sizeof(EdgeNode));</span><br><span class="line">                s-&gt;adjvex = j;</span><br><span class="line">                s-&gt;Info = mg-&gt;edges[i][j];</span><br><span class="line">                s-&gt;<span class="built_in">next</span> = NULL;</span><br><span class="line">                EdgeNode*p = alg-&gt;adjlist[i].firstedge;</span><br><span class="line">                s-&gt;<span class="built_in">next</span> = p;</span><br><span class="line">                alg-&gt;adjlist[i].firstedge = s;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//打印图(邻接矩阵) </span><br><span class="line">void printGragh(MGragh *g)</span><br><span class="line">{</span><br><span class="line">    printf(<span class="string">"\n图G的邻接矩阵\n"</span>);</span><br><span class="line">    printf(<span class="string">"顶点：\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;g-&gt;n; i++)</span><br><span class="line">    {</span><br><span class="line">        printf(<span class="string">"%c\t"</span>, g-&gt;vexs[i]);</span><br><span class="line">    }</span><br><span class="line">    printf(<span class="string">"\n邻接矩阵：\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;g-&gt;n; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j&lt;g-&gt;n; j++)</span><br><span class="line">        {</span><br><span class="line">            printf(<span class="string">"%d\t"</span>, g-&gt;edges[i][j]);</span><br><span class="line">        }</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//打印图(邻接表) </span><br><span class="line">void printALGragh(ALGraph *g)</span><br><span class="line">{</span><br><span class="line">    printf(<span class="string">"\n图G的邻接表\n"</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;g-&gt;n; i++)</span><br><span class="line">    {</span><br><span class="line">        printf(<span class="string">"%c:"</span>, g-&gt;adjlist[i].vertex);</span><br><span class="line"> </span><br><span class="line">        EdgeNode* edge = g-&gt;adjlist[i].firstedge;</span><br><span class="line">        <span class="keyword">while</span> (edge)</span><br><span class="line">        {</span><br><span class="line">            printf(<span class="string">"--&gt;"</span>);</span><br><span class="line">            printf(<span class="string">"%d:%d\t"</span>, edge-&gt;adjvex, edge-&gt;Info);</span><br><span class="line">            edge = edge-&gt;<span class="built_in">next</span>;</span><br><span class="line">        }</span><br><span class="line">        printf(<span class="string">"%\n"</span>);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">/**********************DFS*********************/</span><br><span class="line">//从顶点v开始图(邻接矩阵)的深度遍历 </span><br><span class="line">void DFS_MG(MGragh *g, <span class="built_in">int</span> v)</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> j;</span><br><span class="line">    visited[v] = <span class="number">1</span>;</span><br><span class="line">    printf(<span class="string">"%c "</span>, g-&gt;vexs[v]);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j&lt;g-&gt;n; ++j)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (g-&gt;edges[v][j] != <span class="number">0</span>  &amp;&amp;  !visited[j])</span><br><span class="line">            DFS_MG(g, j);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//图的(邻接矩阵)的深度遍历 </span><br><span class="line">void DFSTranverse_MG(MGragh *g)</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        visited[i] = <span class="number">0</span>;  //初始化访问数组visited的元素值为false</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]){ //节点尚未访问</span><br><span class="line">            DFS_MG(g, i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//从顶点v开始图(邻接表)的深度遍历</span><br><span class="line">void DFS_ALG(ALGraph *g, <span class="built_in">int</span> v)</span><br><span class="line">{</span><br><span class="line">    visited[v] = <span class="number">1</span>;</span><br><span class="line">    printf(<span class="string">"%c "</span>, g-&gt;adjlist[v].vertex);</span><br><span class="line"> </span><br><span class="line">    EdgeNode *p =g-&gt;adjlist[v].firstedge;</span><br><span class="line">    <span class="keyword">while</span> (p){</span><br><span class="line">        <span class="keyword">if</span> (!visited[p-&gt;adjvex]){</span><br><span class="line">            DFS_ALG(g, p-&gt;adjvex); //递归深度遍历</span><br><span class="line">        }</span><br><span class="line">        p = p-&gt;<span class="built_in">next</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//图(邻接表)的深度遍历</span><br><span class="line">void DFSTranverse_ALG(ALGraph *g)</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        visited[i] = <span class="number">0</span>;  //初始化访问数组visited的元素值为false</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]){ //节点尚未访问</span><br><span class="line">            DFS_ALG(g, i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**************************BFS****************************/</span><br><span class="line"> </span><br><span class="line">//从顶点v开始图(邻接矩阵)的广度遍历 </span><br><span class="line">void BFS_MG(MGragh *g, <span class="built_in">int</span> v)</span><br><span class="line">{</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">int</span> j;</span><br><span class="line">    queue&lt;<span class="built_in">int</span>&gt; Q;</span><br><span class="line">    visited[v] = <span class="number">1</span>;</span><br><span class="line">    printf(<span class="string">"%c "</span>, g-&gt;vexs[v]);</span><br><span class="line"> </span><br><span class="line">    Q.push(v);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span> (!Q.empty())</span><br><span class="line">    {</span><br><span class="line">            </span><br><span class="line">        v = Q.front();</span><br><span class="line">        Q.pop();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j&lt;g-&gt;n; ++j)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (!visited[j] &amp;&amp; g-&gt;edges[v][j] !=<span class="number">0</span>)// INFINITY)</span><br><span class="line">            {</span><br><span class="line">                visited[j] = <span class="number">1</span>;</span><br><span class="line">                printf(<span class="string">"%c "</span>, g-&gt;vexs[j]);</span><br><span class="line">                Q.push(j);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//图(邻接矩阵)的广度遍历</span><br><span class="line">void BFSTranverse_MG(MGragh *g)</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        visited[i] = <span class="number">0</span>;  //初始化访问数组visited的元素值为false</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]){ //节点尚未访问</span><br><span class="line">            BFS_MG(g, i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//从顶点v开始图(邻接表)的广度遍历 </span><br><span class="line">void BFS_ALG(ALGraph *g, <span class="built_in">int</span> v)</span><br><span class="line">{</span><br><span class="line">    queue&lt;<span class="built_in">int</span> &gt; Q;</span><br><span class="line">    visited[v] = <span class="number">1</span>;</span><br><span class="line">    printf(<span class="string">"%c "</span>, g-&gt;adjlist[v].vertex);</span><br><span class="line">            </span><br><span class="line">    Q.push(v);</span><br><span class="line">    <span class="keyword">while</span> (!Q.empty()){     </span><br><span class="line">        v = Q.front();</span><br><span class="line">        Q.pop();</span><br><span class="line">        EdgeNode *p = g-&gt;adjlist[v].firstedge;</span><br><span class="line">        <span class="keyword">while</span> (p){</span><br><span class="line">            <span class="keyword">if</span> (!visited[p-&gt;adjvex]){</span><br><span class="line">            visited[p-&gt;adjvex] = <span class="number">1</span>;</span><br><span class="line">            printf(<span class="string">"%c "</span>, g-&gt;adjlist[p-&gt;adjvex].vertex);            </span><br><span class="line">            Q.push(p-&gt;adjvex);</span><br><span class="line">            }</span><br><span class="line">            p = p-&gt;<span class="built_in">next</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">//图(邻接表)的广度遍历 </span><br><span class="line">void BFSTranverse_ALG(ALGraph *g)</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        visited[i] = <span class="number">0</span>;  //初始化访问数组visited的元素值为false</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;g-&gt;n; ++i){</span><br><span class="line">        <span class="keyword">if</span> (!visited[i]){ //节点尚未访问</span><br><span class="line">            BFS_ALG(g, i);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/************************初始化与销毁********************************/</span><br><span class="line">MGragh *init_MGraph()</span><br><span class="line">{</span><br><span class="line">    MGragh *mg = (MGragh *)malloc(sizeof(MGragh));</span><br><span class="line">    <span class="keyword">if</span> (mg)</span><br><span class="line">    {</span><br><span class="line">        mg-&gt;n = <span class="number">0</span>;</span><br><span class="line">        mg-&gt;e = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> mg;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">ALGraph *init_ALGraph()</span><br><span class="line">{</span><br><span class="line">    ALGraph *alg = (ALGraph *)malloc(sizeof(ALGraph));</span><br><span class="line">    <span class="keyword">if</span> (alg)</span><br><span class="line">    {</span><br><span class="line">        alg-&gt;n = <span class="number">0</span>;</span><br><span class="line">        alg-&gt;e = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt;MaxVerNum; i++)</span><br><span class="line">            alg-&gt;adjlist[i].firstedge = NULL;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> alg;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void destroy_MGraph(MGragh **g)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">if</span> (*g)</span><br><span class="line">    {</span><br><span class="line">        free(*g);</span><br><span class="line">        *g = NULL;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void destroy_ALGraph(ALGraph **g)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; (*g)-&gt;n; ++i)</span><br><span class="line">    {</span><br><span class="line">        EdgeNode *p = (*g)-&gt;adjlist[i].firstedge;</span><br><span class="line">        <span class="keyword">while</span> (p)</span><br><span class="line">        {</span><br><span class="line">            EdgeNode *q = p-&gt;<span class="built_in">next</span>;</span><br><span class="line">            free(p);</span><br><span class="line">            p = q;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (*g)</span><br><span class="line">    {</span><br><span class="line">        free(*g);</span><br><span class="line">        *g = NULL;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/****main函数*************/</span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">{</span><br><span class="line">    freopen(<span class="string">"数据.txt"</span>, <span class="string">"r"</span>, stdin);</span><br><span class="line">    //创建图（邻接矩阵） </span><br><span class="line">    MGragh *mG = init_MGraph();</span><br><span class="line">    CreateGraph(mG);</span><br><span class="line">    printGragh(mG);</span><br><span class="line"> </span><br><span class="line">    //创建图（邻接表） </span><br><span class="line">    ALGraph *alG = init_ALGraph();</span><br><span class="line">    CreateALGraph(mG, alG);</span><br><span class="line">    printALGragh(alG);</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    //DFS遍历</span><br><span class="line">    printf(<span class="string">"\nDFS遍历:\n"</span>);</span><br><span class="line">    printf(<span class="string">"邻接矩阵:\n"</span>);</span><br><span class="line">    DFSTranverse_MG(mG);</span><br><span class="line">    printf(<span class="string">"\n邻接表:\n"</span>);</span><br><span class="line">    DFSTranverse_ALG(alG);</span><br><span class="line"> </span><br><span class="line">    //BFS遍历</span><br><span class="line">    printf(<span class="string">"\n\nBFS遍历:\n"</span>);</span><br><span class="line">    printf(<span class="string">"邻接矩阵:\n"</span>);</span><br><span class="line">    BFSTranverse_MG(mG);</span><br><span class="line">    printf(<span class="string">"\n邻接表:\n"</span>);</span><br><span class="line">    BFSTranverse_ALG(alG);</span><br><span class="line"> </span><br><span class="line">    //销毁图</span><br><span class="line">    destroy_MGraph(&amp;mG);</span><br><span class="line">    destroy_ALGraph(&amp;alG);</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line">//运行成功 <span class="number">2019</span>年<span class="number">5</span>月<span class="number">14</span>日<span class="number">0</span>:<span class="number">19</span>:<span class="number">36</span></span><br></pre></td></tr></tbody></table></figure><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210813224449.png" alt="img" style="zoom: 67%;">]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>论文写作</title>
      <link href="/2021/08/13/li-bao-chun-writing-perfect-papers/"/>
      <url>/2021/08/13/li-bao-chun-writing-perfect-papers/</url>
      
        <content type="html"><![CDATA[<h3 id="李葆春——Writing-Perfect-Papers"><a href="#李葆春——Writing-Perfect-Papers" class="headerlink" title="李葆春——Writing Perfect Papers"></a>李葆春——<a href="https://www.bilibili.com/video/BV18v411n7mr?share_source=copy_web">Writing Perfect Papers</a></h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210720225101.png" alt="WechatIMG19487" style="zoom:200%;">]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 论文写作 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVM学习笔记</title>
      <link href="/2021/08/09/svm-xue-xi-bi-ji/"/>
      <url>/2021/08/09/svm-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="SVM学习笔记"><a href="#SVM学习笔记" class="headerlink" title="SVM学习笔记"></a>SVM学习笔记</h2><p><a href="https://www.deeplearningbook.org/">https://www.deeplearningbook.org/</a></p><p><a href="http://page.mi.fu-berlin.de/rojas/neural/neuron.pdf">http://page.mi.fu-berlin.de/rojas/neural/neuron.pdf</a></p><p><a href="https://www.svm-tutorial.com/2014/11/svm-understanding-math-part-1/">https://www.svm-tutorial.com/2014/11/svm-understanding-math-part-1/</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> svm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pandas学习</title>
      <link href="/2021/08/06/pandas-xue-xi/"/>
      <url>/2021/08/06/pandas-xue-xi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Video url: <a href="https://www.youtube.com/watch?v=vmEHCJofslg">https://www.youtube.com/watch?v=vmEHCJofslg</a></p><p>Pandas document: <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html#api">https://pandas.pydata.org/pandas-docs/stable/reference/index.html#api</a></p><p>Pracice Pandas:   <a href="https://stratascratch.com/?via=keith">https://stratascratch.com/?via=keith</a></p></blockquote><h3 id="1-Loading-data-into-Pandas"><a href="#1-Loading-data-into-Pandas" class="headerlink" title="1. Loading data into Pandas"></a>1. Loading data into Pandas</h3><blockquote><p>1.1 Loading data from csv format file</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read data from csv format file</span></span><br><span class="line">df = pd.read_csv(<span class="string">'pokemon_data.csv'</span>)</span><br><span class="line"><span class="built_in">print</span>(df.head(<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure></blockquote><blockquote><p> 1.2 Loading data from txt format file</p></blockquote><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read data from txt format file</span></span><br><span class="line">df_txt = pd.read_csv(<span class="string">'pokemon_data.txt'</span>, delimiter=<span class="string">'\t'</span>)</span><br><span class="line"><span class="built_in">print</span>(df_txt.head(<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="2-Read-Data-in-Pandas"><a href="#2-Read-Data-in-Pandas" class="headerlink" title="2. Read Data in Pandas"></a>2. Read Data in Pandas</h3><blockquote><p>2.1 Read head</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df.columns)</span><br></pre></td></tr></tbody></table></figure><p>2.2 Read each Column</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df[<span class="string">'Name'</span>][<span class="number">0</span>:<span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(df.Name[<span class="number">0</span>:<span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(df[[<span class="string">'Name'</span>, <span class="string">'Type 1'</span>, <span class="string">'HP'</span>]][<span class="number">0</span>:<span class="number">5</span>])</span><br></pre></td></tr></tbody></table></figure><p>2.3 Read each Row</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># print the top 4 rows</span></span><br><span class="line"><span class="built_in">print</span>(df.head(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.iloc[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> index, row <span class="keyword">in</span> df.iterrows():</span><br><span class="line">    <span class="built_in">print</span>(index, row[<span class="string">'Name'</span>])</span><br></pre></td></tr></tbody></table></figure><p>2.4 Read a specific location(R,C)</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df.iloc[<span class="number">2</span>,<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="3-Sorting-Describing-Data"><a href="#3-Sorting-Describing-Data" class="headerlink" title="3. Sorting/Describing Data"></a>3. Sorting/Describing Data</h3><blockquote><p> 3.1 View data describe</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df.describe())</span><br></pre></td></tr></tbody></table></figure><p>3.2 Sorting</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort_res = df.sort_values([<span class="string">'Name'</span>,<span class="string">'HP'</span>], ascending=[<span class="number">1</span>, <span class="number">0</span>])</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="4-Making-changes-to-the-data"><a href="#4-Making-changes-to-the-data" class="headerlink" title="4. Making changes to the data"></a>4. Making changes to the data</h3><blockquote><p>4.1 Create a new column</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'Total'</span>] = df[<span class="string">'HP'</span>] + df[<span class="string">'Attack'</span>]</span><br><span class="line">df[<span class="string">'Total'</span>] = df.iloc[:,<span class="number">4</span>:<span class="number">10</span>].<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure><p>4.2 Delete one column</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.drop(columns=[<span class="string">'Total'</span>])</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="5-Save-data-to-file"><a href="#5-Save-data-to-file" class="headerlink" title="5. Save data to file"></a>5. Save data to file</h3><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_csv(<span class="string">'new_data.csv'</span>, index=<span class="literal">False</span>, sep=<span class="string">'\t'</span>)</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="6-Filtering-Data"><a href="#6-Filtering-Data" class="headerlink" title="6. Filtering Data"></a>6. Filtering Data</h3><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 过滤出满足条件的数据，过滤出来的数据会保留原来的序号</span></span><br><span class="line">new_df = df.loc[(df[<span class="string">'Type 1'</span>] == <span class="string">'Grass'</span>) &amp; (df[<span class="string">'Type 2'</span>] == <span class="string">'Poison'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将过滤出来的数据的序号进行重置</span></span><br><span class="line">new_df.reset_index(drop=<span class="literal">True</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤出“Name”列中包含“Mega”字段的数据</span></span><br><span class="line">new_df = df.loc[~df[<span class="string">'Name'</span>].<span class="built_in">str</span>.contains(<span class="string">'Mega'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤出“Type 1”列中包含“first”和“grass”字段是数据，并且不区别大小写</span></span><br><span class="line">df.loc[df[<span class="string">'Type 1'</span>].<span class="built_in">str</span>.contains(<span class="string">'fire|Grass'</span>,flags=re.I, regex=<span class="literal">True</span>)] <span class="comment"># Ignore case</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用正则表达式过滤“Name”列中满足条件的数据</span></span><br><span class="line">df.loc[df[<span class="string">'Name'</span>].<span class="built_in">str</span>.contains(<span class="string">'^pi[a-z]*'</span>, flags=re.I, regex=<span class="literal">True</span>)]</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="7-Conditional-changes"><a href="#7-Conditional-changes" class="headerlink" title="7. Conditional changes"></a>7. Conditional changes</h3><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把type 1 列中满足条件(等于'Fire')的内容改为Flamer</span></span><br><span class="line">df.loc[df[<span class="string">'Type 1'</span>] == <span class="string">'Fire'</span>, <span class="string">'Type 1'</span>] = <span class="string">'Flamer'</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="8-Aggregate-Statistics-Groupby"><a href="#8-Aggregate-Statistics-Groupby" class="headerlink" title="8. Aggregate Statistics(Groupby)"></a>8. Aggregate Statistics(Groupby)</h3><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = df.groupby([<span class="string">'Type 1'</span>]).mean().sort_values(<span class="string">'HP'</span>, ascending=<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="9-Working-with-large-amounts-of-data"><a href="#9-Working-with-large-amounts-of-data" class="headerlink" title="9. Working with large amounts of data"></a>9. Working with large amounts of data</h3><blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分批读取数据，一次读100行</span></span><br><span class="line"><span class="keyword">for</span> df <span class="keyword">in</span> pd.read_csv(<span class="string">'pokemon_data.csv'</span>, chunk_size=<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(df)</span><br></pre></td></tr></tbody></table></figure></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch学习</title>
      <link href="/2021/08/05/pytorch-xue-xi/"/>
      <url>/2021/08/05/pytorch-xue-xi/</url>
      
        <content type="html"><![CDATA[<p>课程[链接](https: // <a href="http://www.youtube.com/">www.youtube.com</a> / watch?v = c36lUUr864M)</p><h3 id="1-Tensor"><a href="#1-Tensor" class="headerlink" title="1. Tensor"></a>1. Tensor</h3><h4 id="1-1-How-to-create-tensor"><a href="#1-1-How-to-create-tensor" class="headerlink" title="1.1 How to create tensor"></a>1.1 How to create tensor</h4><blockquote><p>构造tensor的方法主要有六种，分别如下：</p><ol><li><p>x = torch.ones(3, 5, dtype=torch.float, requires_grad = True )</p></li><li><p>x = torch.zeros(3, 5, dtype=torch.float, requires_grad = True )</p></li><li><p>x = torch.rand(3, 5, dtype=torch.float, requires_grad = True )</p></li><li><p>x = torch.empty(3, 5, dtype=torch.float, requires_grad = True )</p></li><li><p>x = torch.tensor([1,2,3], dtype=torch.float, requires_grad = True )</p></li><li><p>x_numpy = np.array([1,2,3])<br>x = torch.from_numpy(x_numpy)</p></li></ol></blockquote><h4 id="1-2-对Tensor的各种操作"><a href="#1-2-对Tensor的各种操作" class="headerlink" title="1.2 对Tensor的各种操作"></a>1.2 对Tensor的各种操作</h4><blockquote><ol><li><p>查看数据类型：x.dtype</p></li><li><p>查看size：x.size()</p></li><li><p>如果tensor只有一个值，查看实数值：x.item()</p></li><li><p>改变tensor的形状大小：x = x.view(num_row, num_col)</p></li><li><p>将tensor转为numpy: z = x.detach().numpy()</p></li></ol><p> ​       注意：numpy只能存放到cpu上面,并且不能是包含梯度的tensor，转换之后共享相同的内存</p><ol start="6"><li>构造新的不包含梯度的tensor：z = x.detach()</li></ol><ol start="7"><li>对tensor进行各种转换： .to() eg: x.to(int)</li></ol></blockquote><h4 id="1-3-基本运算"><a href="#1-3-基本运算" class="headerlink" title="1.3 基本运算"></a>1.3 基本运算</h4><blockquote><ol><li>add: z = x+y</li><li>minus: z = x-y</li><li>multi: z = x*y</li><li>div: z = x/y</li><li>切片操作：切片操作十分灵活，用到的时候查询文档</li></ol></blockquote><h3 id="2-Autograd"><a href="#2-Autograd" class="headerlink" title="2. Autograd"></a>2. Autograd</h3><h4 id="2-1-Calculate-the-gradients"><a href="#2-1-Calculate-the-gradients" class="headerlink" title="2.1 Calculate the gradients"></a>2.1 Calculate the gradients</h4><blockquote><p>用 z.backward() 来计算z关于变量的梯度，如果正向计算出来的z是一个实数值，则backward的参数为默认值就好，如果z是一个向量，则调用backward()的时候需要传入一个与z的size相同的向量.</p><p>  如下面的示例所示。  </p>  <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">x = torch.randn(<span class="number">3</span>, dtype=<span class="built_in">float</span>, requires_grad = <span class="literal">True</span>)</span><br><span class="line">y=x*x+<span class="number">2</span>*x+<span class="number">5</span></span><br><span class="line">z = torch.mean(y)</span><br><span class="line">z.backward() <span class="comment"># dz/dx jacobian matrix to get the grad</span></span><br><span class="line"><span class="comment"># z.backward()这一步是用雅可比矩阵来计算梯度，如果正向计算出来的z是</span></span><br><span class="line"><span class="comment"># 一个实数值，则backward的参数为默认值就好，如果z是一个向量，则调用</span></span><br><span class="line"><span class="comment"># backward()的时候需要传入一个与z的size相同的向量</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># y = x*x*2+x</span></span><br><span class="line"><span class="comment"># v = torch.tensor([1.00,0.10,0.200], dtype=torch.float32)</span></span><br><span class="line"><span class="comment"># y.backward(v)</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="built_in">print</span>(x.grad)</span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="2-2-How-to-prevent-pytorch-from-tracking-the-history-and-calculating-this-grad-fn-attribute"><a href="#2-2-How-to-prevent-pytorch-from-tracking-the-history-and-calculating-this-grad-fn-attribute" class="headerlink" title="2.2 How to prevent pytorch from tracking the history and calculating this grad fn attribute."></a>2.2 How to prevent pytorch from tracking the history and calculating this grad fn attribute.</h4><blockquote><p>一共有三种方法让tensor不被计算图追踪梯度，分别是：</p><p>1） x.requires_grad_(False)</p><p>2） x.detach()</p><p>3） with torch.no_grad(): pass</p><p>具体示例如下所示：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x = torch.randn(<span class="number">3</span>, requires_grad = <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># 让张量x不在追踪梯度的方法有三种</span></span><br><span class="line"><span class="comment"># x.requires_grad_(False)</span></span><br><span class="line"><span class="comment"># x.detach()</span></span><br><span class="line"><span class="comment"># with torch.no_grad():</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    y = x+<span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(x) <span class="comment"># x with grad</span></span><br><span class="line">    <span class="built_in">print</span>(y) <span class="comment"># y without grad</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="2-3-梯度累积"><a href="#2-3-梯度累积" class="headerlink" title="2.3 梯度累积"></a>2.3 梯度累积</h4><blockquote><p>调用backward()来计算梯度的时候，当前轮次的梯度，是之前所有轮次梯度的累积和，在梯度下降学习中这是我们不想看到的，可以调用zero_()函数来将梯度变为0.</p><p>示例如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">weights = torch.ones(<span class="number">3</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    model_output = (weights*<span class="number">3</span>).<span class="built_in">sum</span>()</span><br><span class="line">    model_output.backward()</span><br><span class="line">    <span class="built_in">print</span>(weights.grad)</span><br><span class="line"><span class="comment">#     weights.grad.zero_()</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 输出结果为：</span></span><br><span class="line"><span class="comment"># tensor([3., 3., 3.])</span></span><br><span class="line"><span class="comment"># tensor([6., 6., 6.])</span></span><br><span class="line"><span class="comment"># 第一个epoch为3，第二个epoch为6，说明梯度在累加</span></span><br><span class="line"><span class="comment"># 因为梯度累积是我们不希望看到的，所以每次迭代的时候我们希望梯度</span></span><br><span class="line"><span class="comment"># 能够清零，梯度清零用.grad.zero_()函数</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="3-Backpropagation"><a href="#3-Backpropagation" class="headerlink" title="3. Backpropagation"></a>3. Backpropagation</h3><blockquote><p>调用backward()函数来进行反向传播，计算梯度，示例如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x = torch.tensor(<span class="number">1</span>, dtype=torch.float32, requires_grad=<span class="literal">False</span>)</span><br><span class="line">y = torch.tensor(<span class="number">2</span>, dtype=torch.float32, requires_grad=<span class="literal">False</span>)</span><br><span class="line">w = torch.tensor(<span class="number">1</span>, dtype=torch.float32, requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">loss = (x*w-y)**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(loss)</span><br><span class="line"></span><br><span class="line">loss.backward()</span><br><span class="line"><span class="built_in">print</span>(w.grad)</span><br><span class="line"></span><br><span class="line"><span class="comment">## output:</span></span><br><span class="line"><span class="comment"># tensor(1., grad_fn=&lt;PowBackward0&gt;)</span></span><br><span class="line"><span class="comment"># tensor(-2.)</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="4-Optimize-model-with-automatic-gradient-computation"><a href="#4-Optimize-model-with-automatic-gradient-computation" class="headerlink" title="4. Optimize model with automatic gradient computation"></a>4. Optimize model with automatic gradient computation</h3><h4 id="4-1-用numpy实现回归算法"><a href="#4-1-用numpy实现回归算法" class="headerlink" title="4.1 用numpy实现回归算法"></a>4.1 用numpy实现回归算法</h4><blockquote><p>实现回归算法分为如下几步：</p><p>​1） 数据准备</p><p>​2）定义function</p><p>​3）定义loss function</p><p>​4） 定义梯度计算公式</p><p>​5） 编写training loop部分代码</p><p>实现代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># f = w * x </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># f = 2 * x</span></span><br><span class="line"><span class="comment"># 1. 用numpy手动实现</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare dataset</span></span><br><span class="line">X = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>], dtype=np.float32)</span><br><span class="line">y = np.array([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">20</span>], dtype=np.float32)</span><br><span class="line"></span><br><span class="line">w = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># model prediction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> w*x</span><br><span class="line"></span><br><span class="line"><span class="comment"># loss = MSE</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loss</span>(<span class="params">y, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> ((y_pred - y)**<span class="number">2</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="comment"># gradient</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient</span>(<span class="params">x,y,y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">2</span>*x*(y_pred - y)).mean()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction before training: f(5) = <span class="subst">{forward(<span class="number">5</span>):<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Training</span></span><br><span class="line">learning_rate = <span class="number">0.1</span></span><br><span class="line">n_iters = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_iters):</span><br><span class="line">    y_pred = forward(X)</span><br><span class="line">    l = loss(y, y_pred)</span><br><span class="line">    dw = gradient(x, y, y_pred)</span><br><span class="line">    w -= learning_rate*dw</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'epoch <span class="subst">{i+<span class="number">1</span>}</span>: w = <span class="subst">{w:<span class="number">.3</span>f}</span>, loss = <span class="subst">{l:<span class="number">.10</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction after training: f(5) = <span class="subst">{forward(<span class="number">5</span>):<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="4-2-用pytorch替换数据类型和梯度计算"><a href="#4-2-用pytorch替换数据类型和梯度计算" class="headerlink" title="4.2 用pytorch替换数据类型和梯度计算"></a>4.2 用pytorch替换数据类型和梯度计算</h4><blockquote><p>代码实现思路与4.1一样，没有做任何变化。</p><p>示例代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. Do with pytorch</span></span><br><span class="line">X = torch.tensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">10</span>], dtype=torch.float32)</span><br><span class="line">y = torch.tensor([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>,<span class="number">20</span>], dtype=torch.float32)</span><br><span class="line"></span><br><span class="line">w = torch.tensor(<span class="number">0.0</span>, dtype=torch.float32, requires_grad = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># model prediction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> w*x</span><br><span class="line"></span><br><span class="line"><span class="comment"># loss = MSE</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loss</span>(<span class="params">y, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> ((y_pred - y)**<span class="number">2</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction before training: f(5) = <span class="subst">{forward(<span class="number">5</span>):<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Training</span></span><br><span class="line">learning_rate = <span class="number">0.0001</span></span><br><span class="line">n_iters = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_iters):</span><br><span class="line">    y_pred = forward(X)</span><br><span class="line">    </span><br><span class="line">    l = loss(y, y_pred)</span><br><span class="line">    </span><br><span class="line">    l.backward()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        w -= learning_rate*w.grad</span><br><span class="line">    </span><br><span class="line">    w.grad.zero_()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) %<span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'epoch <span class="subst">{i+<span class="number">1</span>}</span>: w = <span class="subst">{w:<span class="number">.3</span>f}</span>, loss = <span class="subst">{l:<span class="number">.10</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction after training: f(5) = <span class="subst">{forward(<span class="number">5</span>):<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="4-3-用pytorch来做梯度计算和优化"><a href="#4-3-用pytorch来做梯度计算和优化" class="headerlink" title="4.3 用pytorch来做梯度计算和优化"></a>4.3 用pytorch来做梯度计算和优化</h4><blockquote><p>4.2 我们用了backward()函数来自动计算梯度，但是梯度下降优化算法依然是我们在4.1版本中的手工编写的公式，这里我们在之前的基础上面更进一步，用pytorch框架中的optimizer来替换掉手工编写的梯度下降方法，代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1） Design model (input, output size, forward pass)</span></span><br><span class="line"><span class="comment"># 2) Construct loss and optimizer</span></span><br><span class="line"><span class="comment"># 3) Training loop</span></span><br><span class="line"><span class="comment">#    - forward pass: compute prediction</span></span><br><span class="line"><span class="comment">#    - backward pass: gradients</span></span><br><span class="line"><span class="comment">#    - update weight</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line">X = torch.tensor([[<span class="number">1</span>],[<span class="number">2</span>],[<span class="number">3</span>],[<span class="number">4</span>],[<span class="number">5</span>],[<span class="number">6</span>],[<span class="number">10</span>]], dtype=torch.float32)</span><br><span class="line">y = torch.tensor([[<span class="number">2</span>],[<span class="number">4</span>],[<span class="number">6</span>],[<span class="number">8</span>],[<span class="number">10</span>],[<span class="number">12</span>],[<span class="number">20</span>]], dtype=torch.float32)</span><br><span class="line">x_test = torch.tensor([<span class="number">5</span>], dtype=torch.float32)</span><br><span class="line"></span><br><span class="line">n_samples, n_features = X.shape</span><br><span class="line"><span class="built_in">print</span>(n_samples, n_features)</span><br><span class="line"></span><br><span class="line">input_size = n_features</span><br><span class="line">output_size = n_features</span><br><span class="line"></span><br><span class="line">model = nn.Linear(input_size, output_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction before training: f(5) = <span class="subst">{model(x_test).item():<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Training</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line">n_iters = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">loss = nn.MSELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_iters):</span><br><span class="line">    y_pred = model(X)</span><br><span class="line">    </span><br><span class="line">    l = loss(y, y_pred)</span><br><span class="line">    </span><br><span class="line">    l.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#     w.grad.zero_()</span></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) %<span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        [w, b] = model.parameters()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'epoch <span class="subst">{i+<span class="number">1</span>}</span>: w = <span class="subst">{w[<span class="number">0</span>][<span class="number">0</span>].item():<span class="number">.3</span>f}</span>, loss = <span class="subst">{l:<span class="number">.10</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction after training: f(5) = <span class="subst">{model(x_test).item():<span class="number">.5</span>f}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="4-4-定义更加复杂的模型"><a href="#4-4-定义更加复杂的模型" class="headerlink" title="4.4 定义更加复杂的模型"></a>4.4 定义更加复杂的模型</h4><blockquote><p>4.3 及其之前的工作，我们对model的定义都及其的简单，这里我们对model进行改进，通过自定义一个LinearRegress对象来定义一个包含两层全连接的网络建模我们的model，隐藏层的激活函数我们选用了relu()激活函数。代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1） Design model (input, output size, forward pass)</span></span><br><span class="line"><span class="comment"># 2) Construct loss and optimizer</span></span><br><span class="line"><span class="comment"># 3) Training loop</span></span><br><span class="line"><span class="comment">#    - forward pass: compute prediction</span></span><br><span class="line"><span class="comment">#    - backward pass: gradients</span></span><br><span class="line"><span class="comment">#    - update weight</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line">X = torch.tensor([[<span class="number">1</span>],[<span class="number">2</span>],[<span class="number">3</span>],[<span class="number">4</span>],[<span class="number">5</span>],[<span class="number">6</span>],[<span class="number">10</span>]], dtype=torch.float32)</span><br><span class="line">y = torch.tensor([[<span class="number">2</span>],[<span class="number">4</span>],[<span class="number">6</span>],[<span class="number">8</span>],[<span class="number">10</span>],[<span class="number">12</span>],[<span class="number">20</span>]], dtype=torch.float32)</span><br><span class="line">x_test = torch.tensor([<span class="number">5</span>], dtype=torch.float32)</span><br><span class="line"></span><br><span class="line">n_samples, n_features = X.shape</span><br><span class="line"><span class="built_in">print</span>(n_samples, n_features)</span><br><span class="line"></span><br><span class="line">input_size = n_features</span><br><span class="line">output_size = n_features</span><br><span class="line"></span><br><span class="line"><span class="comment"># model = nn.Linear(input_size, output_size)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinearRegress</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, output_size</span>):</span><br><span class="line">        <span class="built_in">super</span>(LinearRegress, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="comment"># define layers</span></span><br><span class="line">        <span class="variable language_">self</span>.lin1 = nn.Linear(input_size, <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.lin2 = nn.Linear(<span class="number">2</span>, output_size)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x =  <span class="variable language_">self</span>.lin1(x)</span><br><span class="line">        x = torch.relu(x)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.lin2(x)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">model = LinearRegress(input_size, output_size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction before training: f(5) = <span class="subst">{model(x_test).item():<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Training</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line">n_iters = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">loss = nn.MSELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n_iters):</span><br><span class="line">    y_pred = model(X)</span><br><span class="line">    </span><br><span class="line">    l = loss(y, y_pred)</span><br><span class="line">    </span><br><span class="line">    l.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#     w.grad.zero_()</span></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) %<span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line"><span class="comment">#         [w, b] = model.parameters()</span></span><br><span class="line"><span class="comment">#         print(f'epoch {i+1}: parameters = {model.parameters()}, loss = {l:.10f}')</span></span><br><span class="line">        <span class="keyword">for</span> parameters <span class="keyword">in</span> model.parameters():</span><br><span class="line">            <span class="built_in">print</span>(parameters)</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Prediction after training: f(5) = <span class="subst">{model(x_test).item():<span class="number">.5</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now pytorch can do most of the work for us, of course we still have to design our model</span></span><br><span class="line"><span class="comment"># and have to know which loss and optimizer we want to use but we don't have to worry about</span></span><br><span class="line"><span class="comment"># the underlying algorithms anymore.</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="4-5-综合示例1"><a href="#4-5-综合示例1" class="headerlink" title="4.5 综合示例1"></a>4.5 综合示例1</h4><blockquote><p>学习完了4.1-4.3的内容，我们对如何手工建模一个模型有了初步的了解，并且知道了pytorch建模深度学习的一般过程，以及它对应的每一个部分的作用，下面我们通过一个综合的示例来加深对所学知识的理解。</p><p>在该示例中，我们首先调用sklearn的datasets库来构建带噪声的逻辑回归数据集，然后构造一个线性模型，并对线性模型进行训练。代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5. 综合示例1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0) create data</span></span><br><span class="line">x_numpy, y_numpy = datasets.make_regression(n_samples=<span class="number">500</span>, n_features=<span class="number">1</span>, noise=<span class="number">20</span>, random_state=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">x,y = torch.from_numpy(x_numpy.astype(np.float32)), torch.from_numpy(y_numpy.astype(np.float32))</span><br><span class="line"><span class="comment"># print(x.shape)</span></span><br><span class="line"><span class="comment"># print(y.shape)</span></span><br><span class="line">y = y.view(y.shape[<span class="number">0</span>], -<span class="number">1</span>)</span><br><span class="line"><span class="comment"># print(y.shape)</span></span><br><span class="line">n_sample, n_features = x.shape</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) model</span></span><br><span class="line">input_size = n_features</span><br><span class="line">output_size = <span class="number">1</span></span><br><span class="line">model = nn.Linear(input_size, output_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2）loss and optimizer</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) training loop</span></span><br><span class="line">num_epochs = <span class="number">1000</span></span><br><span class="line">num_iter = <span class="number">100</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line"> <span class="comment"># foreard pass and loss</span></span><br><span class="line"> y_pred = model(x)</span><br><span class="line"> loss = criterion(y_pred, y)</span><br><span class="line"> <span class="comment"># backward pass</span></span><br><span class="line"> loss.backward()</span><br><span class="line"> <span class="comment"># updata</span></span><br><span class="line"> optimizer.step()</span><br><span class="line"></span><br><span class="line"> optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(epoch+<span class="number">1</span>)%num_iter == <span class="number">0</span>:</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">f'epoch:<span class="subst">{epoch+<span class="number">1</span>}</span>, loss=<span class="subst">{loss.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"><span class="comment"># plot</span></span><br><span class="line">predicted = model(x).detach().numpy()</span><br><span class="line">plt.plot(x_numpy, y_numpy, <span class="string">'ro'</span>)</span><br><span class="line">plt.plot(x_numpy, predicted, <span class="string">'b'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure><p>运行结果如下：</p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805210347.png" alt="image-20210805210341931" style="zoom:50%;"></blockquote><h4 id="4-6-综合示例2"><a href="#4-6-综合示例2" class="headerlink" title="4.6  综合示例2"></a>4.6  综合示例2</h4><blockquote><p>之前的示例中我们没有对训练后的模型进行测试，在这个例子中我们增加了模型测试，并且调用sklearn中内置的“乳腺癌”数据集来完成示例，并且对输入特征做了归一化处理。</p><p>代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5. 综合示例2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0) prepare data</span></span><br><span class="line">bc = datasets.load_breast_cancer()</span><br><span class="line">X,y = bc.data, bc.target</span><br><span class="line"></span><br><span class="line">n_samples, n_features = X.shape</span><br><span class="line"><span class="comment"># print(X.shape)</span></span><br><span class="line"><span class="comment"># print(y.shape)</span></span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X,y,test_size=<span class="number">0.2</span>, random_state=<span class="number">1234</span>)</span><br><span class="line"><span class="comment"># scale 对每一列的特征做均值方差归一化处理，如果不做的话学习出来的模型的准确率大大降低</span></span><br><span class="line">sc = StandardScaler()</span><br><span class="line"><span class="comment"># print('X_test before transform:', X_test)</span></span><br><span class="line">X_train = sc.fit_transform(X_train)</span><br><span class="line">X_test = sc.fit_transform(X_test)</span><br><span class="line"><span class="comment"># print('X_test after transform:', X_test.mean(), X_test.std())</span></span><br><span class="line"></span><br><span class="line">X_train = torch.from_numpy(X_train.astype(np.float32))</span><br><span class="line">X_test = torch.from_numpy(X_test.astype(np.float32))</span><br><span class="line">y_train = torch.from_numpy(y_train.astype(np.float32))</span><br><span class="line">y_test = torch.from_numpy(y_test.astype(np.float32))</span><br><span class="line"></span><br><span class="line">y_train = y_train.view(y_train.shape[<span class="number">0</span>], <span class="number">1</span>)</span><br><span class="line">y_test = y_test.view(y_test.shape[<span class="number">0</span>], <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) model</span></span><br><span class="line"><span class="comment"># f = wx + b, sigmoid at the end</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogisticRegression</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_input_features</span>):</span><br><span class="line">        <span class="built_in">super</span>(LogisticRegression, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.linear = nn.Linear(n_input_features, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        y_pred = torch.sigmoid(<span class="variable language_">self</span>.linear(x))</span><br><span class="line">        <span class="keyword">return</span> y_pred</span><br><span class="line">    </span><br><span class="line">model = LogisticRegression(n_features)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) loss and optimizer</span></span><br><span class="line">learning_rate = <span class="number">0.001</span></span><br><span class="line"></span><br><span class="line">criterion = nn.BCELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr = learning_rate)</span><br><span class="line"><span class="comment"># 3) training loop</span></span><br><span class="line">num_epochs = <span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="comment"># foreard pass and loss</span></span><br><span class="line">    y_pred = model(X_train)</span><br><span class="line">    loss = criterion(y_pred, y_train)</span><br><span class="line">    <span class="comment"># backward pass</span></span><br><span class="line">    loss.backward()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># updates</span></span><br><span class="line">    optimizer.step()</span><br><span class="line">    </span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(epoch+<span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'epoch:<span class="subst">{epoch+<span class="number">1</span>}</span>, loss = <span class="subst">{loss.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    y_pred = model(X_test)</span><br><span class="line">    y_pred_cls = y_pred.<span class="built_in">round</span>() <span class="comment"># 对sigmoid出来的值进行四舍五入</span></span><br><span class="line"><span class="comment">#     print(f'y_pred={y_pred}, y_pred_cls={y_pred_cls}')</span></span><br><span class="line">    acc = y_pred_cls.eq(y_test).<span class="built_in">sum</span>()/<span class="built_in">float</span>(y_test.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'acc = <span class="subst">{acc:<span class="number">.4</span>f}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="5-Dataset-and-Dataload-Class"><a href="#5-Dataset-and-Dataload-Class" class="headerlink" title="5. Dataset and Dataload Class"></a>5. Dataset and Dataload Class</h3><h4 id="5-1-Dataset-and-Dataload"><a href="#5-1-Dataset-and-Dataload" class="headerlink" title="5.1 Dataset and Dataload"></a>5.1 Dataset and Dataload</h4><blockquote><p>pytorch中由dataset类管理数据集，可以通过继承dataset类来自定义数据集，代码模板如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line"> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line"> <span class="keyword">return</span> a signel data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line"> <span class="keyword">return</span> length of dataset</span><br></pre></td></tr></tbody></table></figure><p>定义好dataset之后，可以通过DataLoader来构造可供训练的迭代器，代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataloader = DataLoader(dataset=dataset, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>, num_workers=<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure><p>示例如下所示：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">epoch = 1 forward and backward pass of ALL training samples</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bach_size = number of training samples in one forward &amp; backward pass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">number of iterations = number of passes, each pass using [batch_size] number of samples</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">e.g. 100 samples, batch_size = 20 --&gt; 100/20 = 5 iterations for 1 epoch</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.getcwd().endswith(<span class="string">'pytorchLearning'</span>):</span><br><span class="line"> os.chdir(os.getcwd()+<span class="string">'/Desktop/pytorchLearning'</span>)</span><br><span class="line"><span class="comment"># print (os.getcwd())</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WineDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">     <span class="comment"># data loading</span></span><br><span class="line">     xy = np.loadtxt(<span class="string">'./data/wine/wine.csv'</span>, delimiter=<span class="string">','</span>, dtype=np.float32, skiprows=<span class="number">1</span>)</span><br><span class="line">     <span class="variable language_">self</span>.x = torch.from_numpy(xy[:,<span class="number">1</span>:])</span><br><span class="line">     <span class="variable language_">self</span>.y = torch.from_numpy(xy[:, [<span class="number">0</span>]])</span><br><span class="line">     <span class="variable language_">self</span>.n_samples = xy.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">self</span>.x[index], <span class="variable language_">self</span>.y[index]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">     <span class="keyword">return</span> <span class="variable language_">self</span>.n_samples</span><br><span class="line"><span class="comment"># # How we can use dataset</span></span><br><span class="line"><span class="comment"># dataset = WineDataset()</span></span><br><span class="line"><span class="comment"># first_data = dataset[0]</span></span><br><span class="line"><span class="comment"># features, label = first_data</span></span><br><span class="line"><span class="comment"># print(features, label)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # How we can use dataload</span></span><br><span class="line"><span class="comment"># dataloader = DataLoader(dataset=dataset, batch_size=4, shuffle=True, num_workers=2)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># dataiter = iter(dataloader)</span></span><br><span class="line"><span class="comment"># data = dataiter.next()</span></span><br><span class="line"><span class="comment"># features, label = data</span></span><br><span class="line"><span class="comment"># print(features, label)</span></span><br><span class="line"></span><br><span class="line">dataset = WineDataset()</span><br><span class="line">dataloader = DataLoader(dataset=dataset, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>, num_workers=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># training loop</span></span><br><span class="line">num_epochs=<span class="number">2</span></span><br><span class="line">total_samples = <span class="built_in">len</span>(dataset)</span><br><span class="line">n_iterations = math.ceil(total_samples/<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(total_samples, n_iterations)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line"> <span class="keyword">for</span> i,(inputs, label) <span class="keyword">in</span> <span class="built_in">enumerate</span>(dataloader):</span><br><span class="line">     <span class="comment"># forward backward, update</span></span><br><span class="line">     <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">5</span> == <span class="number">0</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f'epoch <span class="subst">{epoch+<span class="number">1</span>}</span>/<span class="subst">{num_epochs}</span>, step <span class="subst">{i+<span class="number">1</span>}</span>/<span class="subst">{n_iterations}</span>, inputs <span class="subst">{inputs.shape}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure></blockquote><h4 id="5-2-Transforms-for-the-dataset"><a href="#5-2-Transforms-for-the-dataset" class="headerlink" title="5.2 Transforms for the dataset"></a>5.2 Transforms for the dataset</h4><blockquote><p>pytorch通过传入transforms类来对输入的数据进行某种变化，transforms类可以调用库定义好的，也可以根据需要自定义。</p><p>示例代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Transforms can be applied to PIL images, tensor, ndarrays, or custom data</span></span><br><span class="line"><span class="string">during criterion of the dataset</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">complete list of built-in transforms:</span></span><br><span class="line"><span class="string">https://pytorch.org/docs/stable/torchvision/transforms.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">On images</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">CenterCrop, Grayscale, Pad, RandomAffine,</span></span><br><span class="line"><span class="string">RandomCrop, RandomHorizontalFlip, RandomHorizon</span></span><br><span class="line"><span class="string">Resize, scale</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">On Tensors</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string">LinearTransformation, Normalize, RandomErasing</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Conversion</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string">ToPILIamage: from tensor or ndarray</span></span><br><span class="line"><span class="string">ToTensor: from numpy.ndarray or PILImage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generic</span></span><br><span class="line"><span class="string">-------</span></span><br><span class="line"><span class="string">Use Lambda</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Custom</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">Write own Class</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Compose mutiple Transforms</span></span><br><span class="line"><span class="string">--------------------------</span></span><br><span class="line"><span class="string">composed = transforms.Compose([Rescale(256),</span></span><br><span class="line"><span class="string">                                RandomCrop(224)])</span></span><br><span class="line"><span class="string">torchvision.transforms.Rescale(256)</span></span><br><span class="line"><span class="string">torchvision.transforms.ToTensor()</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WineDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, transform=<span class="literal">None</span></span>):</span><br><span class="line">        xy = np.loadtxt(<span class="string">'./data/wine/wine.csv'</span>, delimiter=<span class="string">','</span>, dtype=np.float32, skiprows=<span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.n_samples = xy.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># note that we do not convert to tensor here</span></span><br><span class="line">        <span class="variable language_">self</span>.x = xy[:,<span class="number">1</span>:]</span><br><span class="line">        <span class="variable language_">self</span>.y = xy[:, [<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.transform = transform</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        sample = <span class="variable language_">self</span>.x[index], <span class="variable language_">self</span>.y[index]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.transform:</span><br><span class="line">            sample = <span class="variable language_">self</span>.transform(sample)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sample</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.n_samples</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToTensor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, sample</span>):</span><br><span class="line">        inputs, targets = sample</span><br><span class="line">        <span class="keyword">return</span> torch.from_numpy(inputs), torch.from_numpy(targets)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MulTransform</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, factor</span>):</span><br><span class="line">        <span class="variable language_">self</span>.factor = factor</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, sample</span>):</span><br><span class="line">        inputs, target = sample</span><br><span class="line">        inputs *= <span class="variable language_">self</span>.factor</span><br><span class="line">        <span class="keyword">return</span> inputs, target</span><br><span class="line"></span><br><span class="line">dataset = WineDataset(transform=ToTensor())</span><br><span class="line">first_data = dataset[<span class="number">0</span>]</span><br><span class="line">features, label = first_data</span><br><span class="line"><span class="built_in">print</span>(features)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(features), <span class="built_in">type</span>(label))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">composed = torchvision.transforms.Compose([ToTensor(), MulTransform(<span class="number">2</span>)]) <span class="comment"># 把两个transforms合并一起应用</span></span><br><span class="line">dataset = WineDataset(transform=composed)</span><br><span class="line">first_data = dataset[<span class="number">0</span>]</span><br><span class="line">features, label = first_data</span><br><span class="line"><span class="built_in">print</span>(features)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(features), <span class="built_in">type</span>(label))</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="6-Softmax-and-Cross-Entropy"><a href="#6-Softmax-and-Cross-Entropy" class="headerlink" title="6. Softmax and Cross-Entropy"></a>6. Softmax and Cross-Entropy</h3><h4 id="6-1-Softmax"><a href="#6-1-Softmax" class="headerlink" title="6.1 Softmax"></a>6.1 Softmax</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Softmax</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> np.exp(x) / np.<span class="built_in">sum</span>(np.exp(x), axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">x = np.array([-<span class="number">2</span>, <span class="number">1</span>, <span class="number">0.1</span>])</span><br><span class="line">outputs = softmax(x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'softmax numpy:'</span>, outputs)</span><br><span class="line"></span><br><span class="line">x = torch.from_numpy(x)</span><br><span class="line">outputs = torch.softmax(x, axis=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'softmax torch:'</span>, outputs)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="6-2-Cross-entropy"><a href="#6-2-Cross-entropy" class="headerlink" title="6.2 Cross entropy"></a>6.2 Cross entropy</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Cross entropy</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cross_entropy</span>(<span class="params">actual, predicted</span>):</span><br><span class="line">    <span class="keyword">return</span> -np.<span class="built_in">sum</span>(actual*np.log(predicted)).mean()</span><br><span class="line"></span><br><span class="line"><span class="comment"># y must be one hot encoded</span></span><br><span class="line"><span class="comment"># if class 0: [1 0 0]</span></span><br><span class="line"><span class="comment"># if class 1: [0 1 0]</span></span><br><span class="line"><span class="comment"># if class 2: [0 0 1]</span></span><br><span class="line">Y = np.array([<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_pred has probabilities</span></span><br><span class="line">y_pred_good = np.array([<span class="number">0.7</span>,<span class="number">0.2</span>,<span class="number">0.1</span>])</span><br><span class="line">y_pred_bad = np.array([<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.6</span>])</span><br><span class="line">l1 = cross_entropy(Y, y_pred_good)</span><br><span class="line">l2 = cross_entropy(Y, y_pred_bad)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss1 numpy:<span class="subst">{l1:<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss2 numpy:<span class="subst">{l2:<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cross entropy by pytorch</span></span><br><span class="line"><span class="comment"># in pytorch: Use nn.CrossEntropyLoss()</span></span><br><span class="line"><span class="comment"># No softmax at the end!</span></span><br><span class="line">loss = nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line"><span class="comment"># nsamples x nclasses = 1x3</span></span><br><span class="line">y = torch.tensor([<span class="number">0</span>])</span><br><span class="line">y_pred_good = torch.tensor([[<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">0.1</span>]])</span><br><span class="line">y_pred_bad = torch.tensor([[<span class="number">0.5</span>, <span class="number">2.0</span>, <span class="number">0.3</span>]])</span><br><span class="line"></span><br><span class="line">l1 = loss(y_pred_good, y)</span><br><span class="line">l2 = loss(y_pred_bad, y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss1 numpy:<span class="subst">{l1:<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss2 numpy:<span class="subst">{l2:<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line">_, prediction1 = torch.<span class="built_in">max</span>(y_pred_good, <span class="number">1</span>)</span><br><span class="line">_, prediction2 = torch.<span class="built_in">max</span>(y_pred_bad, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(prediction1)</span><br><span class="line"><span class="built_in">print</span>(prediction2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 samples</span></span><br><span class="line">y = torch.tensor([<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">y_pred_good = torch.tensor([[<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">2.0</span>],</span><br><span class="line">                            [<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">0.5</span> ],</span><br><span class="line">                            [<span class="number">0.1</span>, <span class="number">2.0</span>, <span class="number">1.0</span>]])</span><br><span class="line">y_pred_bad = torch.tensor([[<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">0.1</span>],</span><br><span class="line">                            [<span class="number">1.0</span>, <span class="number">0.1</span>, <span class="number">2.0</span> ],</span><br><span class="line">                            [<span class="number">0.1</span>, <span class="number">1.0</span>, <span class="number">2.0</span>]])</span><br><span class="line"></span><br><span class="line">l1 = loss(y_pred_good, y)</span><br><span class="line">l2 = loss(y_pred_bad, y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss1 numpy:<span class="subst">{l1.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Loss2 numpy:<span class="subst">{l2.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line">_, prediction1 = torch.<span class="built_in">max</span>(y_pred_good, <span class="number">1</span>)</span><br><span class="line">_, prediction2 = torch.<span class="built_in">max</span>(y_pred_bad, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(prediction1)</span><br><span class="line"><span class="built_in">print</span>(prediction2)</span><br></pre></td></tr></tbody></table></figure><h3 id="7-Activation-function"><a href="#7-Activation-function" class="headerlink" title="7. Activation function"></a>7. Activation function</h3><blockquote><p>Activation functions apply a non-linear transform and decide whether a neural should be activated or not.</p><h4 id="Most-popular-activation-functions"><a href="#Most-popular-activation-functions" class="headerlink" title="Most popular activation functions"></a>Most popular activation functions</h4><ol><li>Step function –&gt; Not used in practice</li><li>Sigmoid</li><li>TanH</li><li>ReLU</li><li>Leaky ReLU</li><li>Softmax</li></ol></blockquote><h3 id="8-综合练习-MNIST"><a href="#8-综合练习-MNIST" class="headerlink" title="8. 综合练习 MNIST"></a>8. 综合练习 MNIST</h3><blockquote><ol><li><p>MNIST</p></li><li><p>DataLoader, Transformation</p></li><li><p>Multilayer Neural Net, activation function</p></li><li><p>Loss and Optimizer</p></li><li><p>Tra</p><p>代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># device config</span></span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> optimizer</span><br><span class="line">                                 </span><br><span class="line">device =torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># hyper parameters</span></span><br><span class="line">input_size = <span class="number">784</span> <span class="comment"># 28x28</span></span><br><span class="line">hidden_size = <span class="number">128</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line">num_epochs = <span class="number">2</span></span><br><span class="line">batch_size = <span class="number">100</span></span><br><span class="line">learning_rate = <span class="number">0.001</span></span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># MNIST DataSet</span></span><br><span class="line">train_dataset = torchvision.datasets.MNIST(root=<span class="string">'./data'</span>, train=<span class="literal">True</span>,</span><br><span class="line">                                           transform=transforms.ToTensor(),download=<span class="literal">True</span>)</span><br><span class="line">test_dataset = torchvision.datasets.MNIST(root=<span class="string">'./data'</span>, train=<span class="literal">False</span>,</span><br><span class="line">                                           transform=transforms.ToTensor())</span><br><span class="line">train_loader = torch.utils.data.DataLoader(dataset=train_dataset,batch_size=batch_size,</span><br><span class="line">                                           shuffle=<span class="literal">True</span>)</span><br><span class="line">test_loader = torch.utils.data.DataLoader(dataset=test_dataset,batch_size=batch_size,</span><br><span class="line">                                           shuffle=<span class="literal">False</span>)</span><br><span class="line">examples = <span class="built_in">iter</span>(train_loader)</span><br><span class="line">features, label = examples.<span class="built_in">next</span>()</span><br><span class="line"><span class="built_in">print</span>(features.shape)</span><br><span class="line"><span class="built_in">print</span>(label.shape)</span><br><span class="line">                                 </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    plt.subplot(<span class="number">2</span>,<span class="number">3</span>, i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(features[i][<span class="number">0</span>], cmap=<span class="string">'gray'</span>)</span><br><span class="line">plt.show()</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># model</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NeuralNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, num_classes</span>):</span><br><span class="line">        <span class="built_in">super</span>(NeuralNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.l1 = nn.Linear(input_size, hidden_size)</span><br><span class="line">        <span class="variable language_">self</span>.l2 = nn.Linear(hidden_size, num_classes)</span><br><span class="line">                                 </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = F.relu(<span class="variable language_">self</span>.l1(x))</span><br><span class="line">        out = <span class="variable language_">self</span>.l2(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">                                 </span><br><span class="line">model = NeuralNet(input_size, hidden_size, num_classes)</span><br><span class="line"><span class="comment"># loss and optimizer</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate)</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># training loop</span></span><br><span class="line">n_total_steps = <span class="built_in">len</span>(train_loader)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> i, (images, label) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        <span class="comment"># 100, 1, 28, 28</span></span><br><span class="line">        <span class="comment"># 100, 784</span></span><br><span class="line">        images = images.reshape(-<span class="number">1</span>, <span class="number">28</span>*<span class="number">28</span>).to(device)</span><br><span class="line">        label = label.to(device)</span><br><span class="line">                                 </span><br><span class="line">        <span class="comment"># forward</span></span><br><span class="line">        outputs = model(images)</span><br><span class="line">        loss = criterion(outputs, label)</span><br><span class="line">                                 </span><br><span class="line">        <span class="comment"># backward</span></span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">                                 </span><br><span class="line">        <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">100</span> ==<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f'epoch <span class="subst">{epoch+<span class="number">1</span>}</span> / <span class="subst">{num_epochs}</span>, step <span class="subst">{i+<span class="number">1</span>}</span> / <span class="subst">{n_total_steps}</span>, loss <span class="subst">{loss.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    n_correct = <span class="number">0</span></span><br><span class="line">    n_sample = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> images, label <span class="keyword">in</span> test_loader:</span><br><span class="line">        images = images.reshape(-<span class="number">1</span>, <span class="number">28</span>*<span class="number">28</span>).to(device)</span><br><span class="line">        label = label.to(device)</span><br><span class="line">        outputs = model(images)</span><br><span class="line">        <span class="comment"># print(outputs)</span></span><br><span class="line">                                 </span><br><span class="line">        <span class="comment"># value, index</span></span><br><span class="line">        _, prdiction = torch.<span class="built_in">max</span>(outputs, <span class="number">1</span>)</span><br><span class="line">        n_correct += torch.<span class="built_in">sum</span>(torch.eq(prdiction, label)).item()</span><br><span class="line">        n_sample += label.shape[<span class="number">0</span>]</span><br><span class="line">                                 </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Acc: <span class="subst">{<span class="number">100.0</span>*n_correct / n_sample}</span>'</span>)</span><br><span class="line">                                 </span><br></pre></td></tr></tbody></table></figure><p>运行结果：</p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805213343.png" alt="image-20210805213343033" style="zoom:50%;"></li></ol></blockquote><h3 id="9-Convolutional-Neural-Net-CNN"><a href="#9-Convolutional-Neural-Net-CNN" class="headerlink" title="9.  Convolutional Neural Net(CNN)"></a>9.  Convolutional Neural Net(CNN)</h3><blockquote><p>这里我们通过构造CNN模型并对图片进行分类，采用“CIFAR10”数据集，然后自定义Model，调用“交叉熵损失函数”和“SGD”优化器来对模型训练，模型训练结束之后对分类器的分类准确率进行了测试。</p><p>实验代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment"># device config</span></span><br><span class="line">device =torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hyper parameters</span></span><br><span class="line">num_epochs = <span class="number">4</span></span><br><span class="line">batch_size = <span class="number">4</span></span><br><span class="line">learning_rate =<span class="number">0.001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dataset has PILImage images of range[0,1]</span></span><br><span class="line"><span class="comment"># We transform them to Tensor of normalised range[-1, 1]</span></span><br><span class="line">transform = transforms.Compose(</span><br><span class="line">    [</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize((<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>),(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>))</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">train_dataset = torchvision.datasets.CIFAR10(root=<span class="string">'./data'</span>, train=<span class="literal">True</span>,</span><br><span class="line">                                             download=<span class="literal">True</span>, transform=transform)</span><br><span class="line">test_dataset = torchvision.datasets.CIFAR10(root=<span class="string">'./data'</span>, train=<span class="literal">False</span>,</span><br><span class="line">                                             download=<span class="literal">True</span>, transform=transform)</span><br><span class="line">train_loader = torch.utils.data.DataLoader(dataset=train_dataset, batch_size=batch_size,</span><br><span class="line">                                           shuffle=<span class="literal">True</span>)</span><br><span class="line">test_loader = torch.utils.data.DataLoader(dataset=test_dataset, batch_size=batch_size,</span><br><span class="line">                                           shuffle=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">classes =(<span class="string">'plane'</span>, <span class="string">'car'</span>,<span class="string">'bird'</span>,<span class="string">'cat'</span>,<span class="string">'deer'</span>,<span class="string">'dog'</span>,<span class="string">'frog'</span>,</span><br><span class="line">          <span class="string">'horse'</span>,<span class="string">'ship'</span>,<span class="string">'truck'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imshow</span>(<span class="params">img</span>):</span><br><span class="line">    img = img / <span class="number">2</span> + <span class="number">0.5</span>  <span class="comment"># unnormalize</span></span><br><span class="line">    npimg = img.numpy()</span><br><span class="line">    plt.imshow(np.transpose(npimg, (<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>)))</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># model</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConvNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(ConvNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>)</span><br><span class="line">        <span class="variable language_">self</span>.pool = nn.MaxPool2d(<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="number">6</span>,<span class="number">16</span>,<span class="number">5</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc1 = nn.Linear(<span class="number">16</span>*<span class="number">5</span>*<span class="number">5</span>, <span class="number">120</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc2 = nn.Linear(<span class="number">120</span>, <span class="number">84</span>)</span><br><span class="line">        <span class="variable language_">self</span>.fc3 = nn.Linear(<span class="number">84</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x</span>):</span><br><span class="line">        x = <span class="variable language_">self</span>.pool( F.relu(<span class="variable language_">self</span>.conv1(x)))</span><br><span class="line">        x = <span class="variable language_">self</span>.pool(F.relu(<span class="variable language_">self</span>.conv2(x)))</span><br><span class="line">        x = x.view(-<span class="number">1</span>,<span class="number">16</span>*<span class="number">5</span>*<span class="number">5</span>)</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc1(x))</span><br><span class="line">        x = F.relu(<span class="variable language_">self</span>.fc2(x))</span><br><span class="line">        x = <span class="variable language_">self</span>.fc3(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = ConvNet().to(device)</span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line">n_total_steps = <span class="built_in">len</span>(train_loader)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> i,(images, labels) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        <span class="comment"># origin shape:[4,3,32,32] = 4,3, 1024</span></span><br><span class="line">        <span class="comment"># input_layer:3 input channels, 6 output channels, 5 kernel size</span></span><br><span class="line">        images = images.to(device)</span><br><span class="line">        labels = labels.to(device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Forward pass</span></span><br><span class="line">        outputs = model(images)</span><br><span class="line">        loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Backward and optimizer</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">2000</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f'Epoch [<span class="subst">{epoch+<span class="number">1</span>}</span>/<span class="subst">{num_epochs}</span>], Step [<span class="subst">{i+<span class="number">1</span>}</span>/<span class="subst">{n_total_steps}</span>], Loss: <span class="subst">{loss.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    n_correct = <span class="number">0</span></span><br><span class="line">    n_samples = <span class="number">0</span></span><br><span class="line">    n_class_correct = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    n_class_samples = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    <span class="keyword">for</span> images, labels <span class="keyword">in</span> test_loader:</span><br><span class="line">        images = images.to(device)</span><br><span class="line">        labels = labels.to(device)</span><br><span class="line">        outputs = model(images)</span><br><span class="line">        <span class="comment"># max returns (value ,index)</span></span><br><span class="line">        _, predicted = torch.<span class="built_in">max</span>(outputs, <span class="number">1</span>)</span><br><span class="line">        n_samples += labels.size(<span class="number">0</span>)</span><br><span class="line">        n_correct += (predicted == labels).<span class="built_in">sum</span>().item()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(batch_size):</span><br><span class="line">            label = labels[i]</span><br><span class="line">            pred = predicted[i]</span><br><span class="line">            <span class="keyword">if</span> (label == pred):</span><br><span class="line">                n_class_correct[label] += <span class="number">1</span></span><br><span class="line">            n_class_samples[label] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    acc = <span class="number">100.0</span> * n_correct / n_samples</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Accuracy of the network: <span class="subst">{acc}</span> %'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        acc = <span class="number">100.0</span> * n_class_correct[i] / n_class_samples[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'Accuracy of <span class="subst">{classes[i]}</span>: <span class="subst">{acc}</span> %'</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="10-Transfer-Learning"><a href="#10-Transfer-Learning" class="headerlink" title="10. Transfer Learning"></a>10. Transfer Learning</h3><blockquote><p>这里我们学习迁移学习，主要学习如下三个知识点：</p><ol><li><p>ImageFolder: how we can use ImageFolder</p></li><li><p>Scheduler: how we use a scheduler to change the learning rate</p></li><li><p>Transfer Learning</p><p>迁移学习是指在某一个任务上训练好模型，然后将训练好的模型迁移到另外一个任务中，固定模型的某些参数，对另外一些参数进行学习，以便模型能够适应新的任务。</p><p>实验代码如下：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Transfer Learning</span></span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># 1) ImageFolder: how we can use ImageFolder</span></span><br><span class="line"><span class="comment"># 2) Scheduler: how we use a scheduler to change the learning rate</span></span><br><span class="line"><span class="comment"># 3) Transfer Learning:</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch.optim <span class="keyword">import</span> lr_scheduler</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> datasets, models, transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># device config</span></span><br><span class="line">device =torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line">                                 </span><br><span class="line">mean = np.array([<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>])</span><br><span class="line">std = np.array([<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line">                                 </span><br><span class="line">data_transforms = {</span><br><span class="line">    <span class="string">'train'</span>:transforms.Compose([</span><br><span class="line">        transforms.RandomResizedCrop(<span class="number">224</span>),</span><br><span class="line">        transforms.RandomHorizontalFlip(),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize(mean, std)</span><br><span class="line">    ]),</span><br><span class="line">    <span class="string">'val'</span>:transforms.Compose([</span><br><span class="line">        transforms.Resize(<span class="number">256</span>),</span><br><span class="line">        transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">        transforms.ToTensor(),</span><br><span class="line">        transforms.Normalize(mean, std)</span><br><span class="line">    ])</span><br><span class="line">}</span><br><span class="line">                                 </span><br><span class="line"><span class="comment"># import data</span></span><br><span class="line">data_dir = <span class="string">'data/hymenoptera_data'</span></span><br><span class="line">sets = [<span class="string">'train'</span>, <span class="string">'val'</span>]</span><br><span class="line">image_datasets = {x:datasets.ImageFolder(os.path.join(data_dir, x),</span><br><span class="line">                                         data_transforms[x])</span><br><span class="line">                    <span class="keyword">for</span> x <span class="keyword">in</span> sets}</span><br><span class="line">dataloaders = {x: torch.utils.data.DataLoader(image_datasets[x], batch_size=<span class="number">4</span>,</span><br><span class="line">                                            shuffle=<span class="literal">True</span>, num_workers=<span class="number">0</span>)</span><br><span class="line">               <span class="keyword">for</span> x <span class="keyword">in</span> sets}</span><br><span class="line">dataset_sizes = {x: <span class="built_in">len</span>(image_datasets[x]) <span class="keyword">for</span> x <span class="keyword">in</span> sets}</span><br><span class="line">class_names = image_datasets[<span class="string">'train'</span>].classes</span><br><span class="line"><span class="built_in">print</span>(class_names)</span><br><span class="line">                             </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imshow</span>(<span class="params">inp, title</span>):</span><br><span class="line">    <span class="string">"""Imshow for Tensor."""</span></span><br><span class="line">    inp = inp.numpy().transpose((<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>))</span><br><span class="line">    inp = std * inp + mean</span><br><span class="line">    inp = np.clip(inp, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    plt.imshow(inp)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.show()</span><br><span class="line">                              </span><br><span class="line"><span class="comment"># Get a batch of training data</span></span><br><span class="line">inputs, classes = <span class="built_in">next</span>(<span class="built_in">iter</span>(dataloaders[<span class="string">'train'</span>]))</span><br><span class="line">                              </span><br><span class="line"><span class="comment"># Make a grid from batch</span></span><br><span class="line">out = torchvision.utils.make_grid(inputs)</span><br><span class="line">                              </span><br><span class="line">imshow(out, title=[class_names[x] <span class="keyword">for</span> x <span class="keyword">in</span> classes])</span><br><span class="line">                              </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_model</span>(<span class="params">model, criterion, optimizer, scheduler, num_epochs=<span class="number">25</span></span>):</span><br><span class="line">    since = time.time()</span><br><span class="line">                              </span><br><span class="line">    best_model_wts = copy.deepcopy(model.state_dict())</span><br><span class="line">    best_acc = <span class="number">0.0</span></span><br><span class="line">                                  </span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'Epoch <span class="subst">{epoch+<span class="number">1</span>}</span> / <span class="subst">{num_epochs}</span>'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'-'</span>*<span class="number">15</span>)</span><br><span class="line">                                  </span><br><span class="line">        <span class="comment"># Each epoch has a training and validation phase</span></span><br><span class="line">        <span class="keyword">for</span> phase <span class="keyword">in</span> sets:</span><br><span class="line">            <span class="keyword">if</span> phase ==<span class="string">'train'</span>:</span><br><span class="line">                model.train()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                model.<span class="built_in">eval</span>()</span><br><span class="line">                                  </span><br><span class="line">            running_loss = <span class="number">0.0</span></span><br><span class="line">            running_correct = <span class="number">0.0</span></span><br><span class="line">                                  </span><br><span class="line">            <span class="comment"># Iterate over data.</span></span><br><span class="line">            <span class="keyword">for</span> inputs, labels <span class="keyword">in</span> dataloaders[phase]:</span><br><span class="line">                inputs = inputs.to(device)</span><br><span class="line">                labels = labels.to(device)</span><br><span class="line">                                  </span><br><span class="line">                <span class="comment"># forward</span></span><br><span class="line">                <span class="comment"># track history if only training</span></span><br><span class="line">                <span class="keyword">with</span> torch.set_grad_enabled(phase == <span class="string">'train'</span>):</span><br><span class="line">                    outputs = model(inputs)</span><br><span class="line">                    loss = criterion(outputs, labels)</span><br><span class="line">                    _, preds = torch.<span class="built_in">max</span>(outputs, <span class="number">1</span>)</span><br><span class="line">                                  </span><br><span class="line">                    <span class="comment"># backward + optimizer only if in training phase</span></span><br><span class="line">                    <span class="keyword">if</span> phase == <span class="string">'train'</span>:</span><br><span class="line">                        optimizer.zero_grad()</span><br><span class="line">                        loss.backward()</span><br><span class="line">                        optimizer.step()</span><br><span class="line">                                  </span><br><span class="line">                <span class="comment"># statistics</span></span><br><span class="line">                running_loss += loss.item()*inputs.size(<span class="number">0</span>)</span><br><span class="line">                running_correct += torch.<span class="built_in">sum</span>(preds == labels.data)</span><br><span class="line">                                  </span><br><span class="line">            <span class="keyword">if</span> phase == <span class="string">'train'</span>:</span><br><span class="line">                scheduler.step()</span><br><span class="line">                                  </span><br><span class="line">            epoch_loss = running_loss / dataset_sizes[phase]</span><br><span class="line">            epoch_acc = running_correct.double() / dataset_sizes[phase]</span><br><span class="line">                                  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f'<span class="subst">{phase}</span> Loss: <span class="subst">{epoch_loss:<span class="number">.4</span>f}</span> Acc: <span class="subst">{epoch_acc:<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line">                                  </span><br><span class="line">            <span class="comment"># deep copy the model to</span></span><br><span class="line">            <span class="keyword">if</span> phase == <span class="string">'val'</span> <span class="keyword">and</span> epoch_acc &gt; best_acc:</span><br><span class="line">                best_acc = epoch_acc</span><br><span class="line">                best_model_wts = copy.deepcopy(model.state_dict())</span><br><span class="line">                                  </span><br><span class="line">    time_elapsed = time.time()-since</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Training complete in <span class="subst">{time_elapsed//<span class="number">60</span>:<span class="number">.0</span>f}</span>m <span class="subst">{time_elapsed%<span class="number">60</span>:<span class="number">.0</span>fs}</span>'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Best val Acc: <span class="subst">{best_acc:4f}</span>'</span>)</span><br><span class="line">                                  </span><br><span class="line">    <span class="comment">#load best model weights</span></span><br><span class="line">    model.load_state_dic(best_model_wts)</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line">                              </span><br><span class="line">model = models.resnet18(pretrained=<span class="literal">True</span>)</span><br><span class="line">                              </span><br><span class="line"><span class="comment"># Here, we need to freeze all the network except the final layer.</span></span><br><span class="line"><span class="comment"># We need to set requires_grad == False to freeze the parameters so that the gradients are not computed in backward()</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> model.parameters():</span><br><span class="line">    param.requires_grad = <span class="literal">False</span></span><br><span class="line">                              </span><br><span class="line">num_ftrs = model.fc.in_features</span><br><span class="line">                              </span><br><span class="line">model.fc = nn.Linear(num_ftrs, <span class="number">2</span>)</span><br><span class="line">model.to(device)</span><br><span class="line">                              </span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">                              </span><br><span class="line"><span class="comment"># Observe that all parameters are being optimized</span></span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line">                              </span><br><span class="line"><span class="comment"># scheduler</span></span><br><span class="line">step_lr_schedule = lr_scheduler.StepLR(optimizer, step_size=<span class="number">7</span>, gamma=<span class="number">0.1</span>) <span class="comment"># Every 7 step， learning rate multiple by 0.1</span></span><br><span class="line">                              </span><br><span class="line">model = train_model(model, criterion, optimizer, step_lr_schedule, num_epochs=<span class="number">7</span>)</span><br></pre></td></tr></tbody></table></figure></li></ol></blockquote><h3 id="11-Tensorboard"><a href="#11-Tensorboard" class="headerlink" title="11. Tensorboard"></a>11. Tensorboard</h3><blockquote><p>Tensorbard是很好的可视化工具，具体可以参考如下的代码。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tensorboard</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment">############## TENSORBOARD ########################</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment"># default `log_dir` is "runs" - we'll be more specific here</span></span><br><span class="line">writer = SummaryWriter(<span class="string">'runs/mnist1'</span>)</span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device configuration</span></span><br><span class="line">device = torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hyper-parameters</span></span><br><span class="line">input_size = <span class="number">784</span>  <span class="comment"># 28x28</span></span><br><span class="line">hidden_size = <span class="number">500</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line">num_epochs = <span class="number">1</span></span><br><span class="line">batch_size = <span class="number">64</span></span><br><span class="line">learning_rate = <span class="number">0.001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MNIST dataset</span></span><br><span class="line">train_dataset = torchvision.datasets.MNIST(root=<span class="string">'./data'</span>,</span><br><span class="line">                                           train=<span class="literal">True</span>,</span><br><span class="line">                                           transform=transforms.ToTensor(),</span><br><span class="line">                                           download=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">test_dataset = torchvision.datasets.MNIST(root=<span class="string">'./data'</span>,</span><br><span class="line">                                          train=<span class="literal">False</span>,</span><br><span class="line">                                          transform=transforms.ToTensor())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data loader</span></span><br><span class="line">train_loader = torch.utils.data.DataLoader(dataset=train_dataset,</span><br><span class="line">                                           batch_size=batch_size,</span><br><span class="line">                                           shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">test_loader = torch.utils.data.DataLoader(dataset=test_dataset,</span><br><span class="line">                                          batch_size=batch_size,</span><br><span class="line">                                          shuffle=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">examples = <span class="built_in">iter</span>(test_loader)</span><br><span class="line">example_data, example_targets = examples.<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">3</span>, i + <span class="number">1</span>)</span><br><span class="line">    plt.imshow(example_data[i][<span class="number">0</span>], cmap=<span class="string">'gray'</span>)</span><br><span class="line"><span class="comment"># plt.show()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############## TENSORBOARD ########################</span></span><br><span class="line">img_grid = torchvision.utils.make_grid(example_data)</span><br><span class="line">writer.add_image(<span class="string">'mnist_images'</span>, img_grid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># writer.close()</span></span><br><span class="line"><span class="comment"># sys.exit()</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fully connected neural network with one hidden layer</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NeuralNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size, hidden_size, num_classes</span>):</span><br><span class="line">        <span class="built_in">super</span>(NeuralNet, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.input_size = input_size</span><br><span class="line">        <span class="variable language_">self</span>.l1 = nn.Linear(input_size, hidden_size)</span><br><span class="line">        <span class="variable language_">self</span>.relu = nn.ReLU()</span><br><span class="line">        <span class="variable language_">self</span>.l2 = nn.Linear(hidden_size, num_classes)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.l1(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.relu(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.l2(out)</span><br><span class="line">        <span class="comment"># no activation and no softmax at the end</span></span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = NeuralNet(input_size, hidden_size, num_classes).to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Loss and optimizer</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="comment">############## TENSORBOARD ########################</span></span><br><span class="line">writer.add_graph(model, example_data.reshape(-<span class="number">1</span>, <span class="number">28</span> * <span class="number">28</span>))</span><br><span class="line"><span class="comment"># writer.close()</span></span><br><span class="line"><span class="comment"># sys.exit()</span></span><br><span class="line"><span class="comment">###################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the model</span></span><br><span class="line">running_loss = <span class="number">0.0</span></span><br><span class="line">running_correct = <span class="number">0</span></span><br><span class="line">n_total_steps = <span class="built_in">len</span>(train_loader)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> i, (images, labels) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader):</span><br><span class="line">        <span class="comment"># origin shape: [100, 1, 28, 28]</span></span><br><span class="line">        <span class="comment"># resized: [100, 784]</span></span><br><span class="line">        images = images.reshape(-<span class="number">1</span>, <span class="number">28</span> * <span class="number">28</span>).to(device)</span><br><span class="line">        labels = labels.to(device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Forward pass</span></span><br><span class="line">        outputs = model(images)</span><br><span class="line">        loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Backward and optimize</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        running_loss += loss.item()</span><br><span class="line"></span><br><span class="line">        _, predicted = torch.<span class="built_in">max</span>(outputs.data, <span class="number">1</span>)</span><br><span class="line">        running_correct += (predicted == labels).<span class="built_in">sum</span>().item()</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f'Epoch [<span class="subst">{epoch + <span class="number">1</span>}</span>/<span class="subst">{num_epochs}</span>], Step [<span class="subst">{i + <span class="number">1</span>}</span>/<span class="subst">{n_total_steps}</span>], Loss: <span class="subst">{loss.item():<span class="number">.4</span>f}</span>'</span>)</span><br><span class="line">            <span class="comment">############## TENSORBOARD ########################</span></span><br><span class="line">            writer.add_scalar(<span class="string">'training loss'</span>, running_loss / <span class="number">100</span>, epoch * n_total_steps + i)</span><br><span class="line">            running_accuracy = running_correct / <span class="number">100</span> / predicted.size(<span class="number">0</span>)</span><br><span class="line">            writer.add_scalar(<span class="string">'accuracy'</span>, running_accuracy, epoch * n_total_steps + i)</span><br><span class="line">            running_correct = <span class="number">0</span></span><br><span class="line">            running_loss = <span class="number">0.0</span></span><br><span class="line">            <span class="comment">###################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test the model</span></span><br><span class="line"><span class="comment"># In test phase, we don't need to compute gradients (for memory efficiency)</span></span><br><span class="line">class_labels = []</span><br><span class="line">class_preds = []</span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    n_correct = <span class="number">0</span></span><br><span class="line">    n_samples = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> images, labels <span class="keyword">in</span> test_loader:</span><br><span class="line">        images = images.reshape(-<span class="number">1</span>, <span class="number">28</span> * <span class="number">28</span>).to(device)</span><br><span class="line">        labels = labels.to(device)</span><br><span class="line">        outputs = model(images)</span><br><span class="line">        <span class="comment"># max returns (value ,index)</span></span><br><span class="line">        values, predicted = torch.<span class="built_in">max</span>(outputs.data, <span class="number">1</span>)</span><br><span class="line">        n_samples += labels.size(<span class="number">0</span>)</span><br><span class="line">        n_correct += (predicted == labels).<span class="built_in">sum</span>().item()</span><br><span class="line"></span><br><span class="line">        class_probs_batch = [F.softmax(output, dim=<span class="number">0</span>) <span class="keyword">for</span> output <span class="keyword">in</span> outputs]</span><br><span class="line"></span><br><span class="line">        class_preds.append(class_probs_batch)</span><br><span class="line">        class_labels.append(predicted)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 10000, 10, and 10000, 1</span></span><br><span class="line">    <span class="comment"># stack concatenates tensors along a new dimension</span></span><br><span class="line">    <span class="comment"># cat concatenates tensors in the given dimension</span></span><br><span class="line">    class_preds = torch.cat([torch.stack(batch) <span class="keyword">for</span> batch <span class="keyword">in</span> class_preds])</span><br><span class="line">    class_labels = torch.cat(class_labels)</span><br><span class="line"></span><br><span class="line">    acc = <span class="number">100.0</span> * n_correct / n_samples</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Accuracy of the network on the 10000 test images: <span class="subst">{acc}</span> %'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">############## TENSORBOARD ########################</span></span><br><span class="line">    classes = <span class="built_in">range</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> classes:</span><br><span class="line">        labels_i = class_labels == i</span><br><span class="line">        preds_i = class_preds[:, i]</span><br><span class="line">        writer.add_pr_curve(<span class="built_in">str</span>(i), labels_i, preds_i, global_step=<span class="number">0</span>)</span><br><span class="line">        writer.close()</span><br><span class="line">    <span class="comment">###################################################</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="12-Saving-and-Loading-model"><a href="#12-Saving-and-Loading-model" class="headerlink" title="12. Saving and Loading model"></a>12. Saving and Loading model</h3><blockquote> <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2 DIFFERENT WAYS OF SAVING</span><br><span class="line"># 1) lazy way: save whole model</span><br><span class="line">torch.save(model, PATH)</span><br><span class="line"></span><br><span class="line"># model class must be defined somewhere</span><br><span class="line">model = torch.load(PATH)</span><br><span class="line">model.eval()</span><br><span class="line"></span><br><span class="line"># 2) recommended way: save only the state_dict</span><br><span class="line">torch.save(model.state_dict(), PATH)</span><br><span class="line"></span><br><span class="line"># model must be created again with parameters</span><br><span class="line">model = Model(*args, **kwargs)</span><br><span class="line">model.load_state_dict(torch.load(PATH))</span><br><span class="line">model.eval()</span><br></pre></td></tr></tbody></table></figure><p> 示例代码如下:</p> <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(nn.Module):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_input_features</span>):</span><br><span class="line">    <span class="built_in">super</span>(Model, <span class="variable language_">self</span>).__init__()</span><br><span class="line">    <span class="variable language_">self</span>.linear = nn.Linear(n_input_features, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">    y_pred = torch.sigmoid(<span class="variable language_">self</span>.linear(x))</span><br><span class="line">    <span class="keyword">return</span> y_pred</span><br><span class="line"></span><br><span class="line">model = Model(n_input_features=<span class="number">6</span>)</span><br><span class="line"><span class="comment"># train your model...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################save all ######################################</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> model.parameters():</span><br><span class="line"><span class="built_in">print</span>(param)</span><br><span class="line"></span><br><span class="line"><span class="comment"># save and load entire model</span></span><br><span class="line"></span><br><span class="line">FILE = <span class="string">"model.pth"</span></span><br><span class="line">torch.save(model, FILE)</span><br><span class="line"></span><br><span class="line">loaded_model = torch.load(FILE)</span><br><span class="line">loaded_model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> loaded_model.parameters():</span><br><span class="line"><span class="built_in">print</span>(param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############save only state dict #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># save only state dict</span></span><br><span class="line">FILE = <span class="string">"model.pth"</span></span><br><span class="line">torch.save(model.state_dict(), FILE)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(model.state_dict())</span><br><span class="line">loaded_model = Model(n_input_features=<span class="number">6</span>)</span><br><span class="line">loaded_model.load_state_dict(torch.load(FILE)) <span class="comment"># it takes the loaded dictionary, not the path file itself</span></span><br><span class="line">loaded_model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(loaded_model.state_dict())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########load checkpoint#####################</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=learning_rate)</span><br><span class="line"></span><br><span class="line">checkpoint = {</span><br><span class="line"><span class="string">"epoch"</span>: <span class="number">90</span>,</span><br><span class="line"><span class="string">"model_state"</span>: model.state_dict(),</span><br><span class="line"><span class="string">"optim_state"</span>: optimizer.state_dict()</span><br><span class="line">}</span><br><span class="line"><span class="built_in">print</span>(optimizer.state_dict())</span><br><span class="line">FILE = <span class="string">"checkpoint.pth"</span></span><br><span class="line">torch.save(checkpoint, FILE)</span><br><span class="line"></span><br><span class="line">model = Model(n_input_features=<span class="number">6</span>)</span><br><span class="line">optimizer = optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">checkpoint = torch.load(FILE)</span><br><span class="line">model.load_state_dict(checkpoint[<span class="string">'model_state'</span>])</span><br><span class="line">optimizer.load_state_dict(checkpoint[<span class="string">'optim_state'</span>])</span><br><span class="line">epoch = checkpoint[<span class="string">'epoch'</span>]</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">eval</span>()</span><br><span class="line"><span class="comment"># - or -</span></span><br><span class="line"><span class="comment"># model.train()</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(optimizer.state_dict())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Remember that you must call model.eval() to set dropout and batch normalization layers </span></span><br><span class="line"><span class="comment"># to evaluation mode before running inference. Failing to do this will yield </span></span><br><span class="line"><span class="comment"># inconsistent inference results. If you wish to resuming training, </span></span><br><span class="line"><span class="comment"># call model.train() to ensure these layers are in training mode.</span></span><br><span class="line"></span><br><span class="line"><span class="string">""" SAVING ON GPU/CPU </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 1) Save on GPU, Load on CPU</span></span><br><span class="line"><span class="string">device = torch.device("cuda")</span></span><br><span class="line"><span class="string">model.to(device)</span></span><br><span class="line"><span class="string">torch.save(model.state_dict(), PATH)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">device = torch.device('cpu')</span></span><br><span class="line"><span class="string">model = Model(*args, **kwargs)</span></span><br><span class="line"><span class="string">model.load_state_dict(torch.load(PATH, map_location=device))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 2) Save on GPU, Load on GPU</span></span><br><span class="line"><span class="string">device = torch.device("cuda")</span></span><br><span class="line"><span class="string">model.to(device)</span></span><br><span class="line"><span class="string">torch.save(model.state_dict(), PATH)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">model = Model(*args, **kwargs)</span></span><br><span class="line"><span class="string">model.load_state_dict(torch.load(PATH))</span></span><br><span class="line"><span class="string">model.to(device)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Note: Be sure to use the .to(torch.device('cuda')) function </span></span><br><span class="line"><span class="string"># on all model inputs, too!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 3) Save on CPU, Load on GPU</span></span><br><span class="line"><span class="string">torch.save(model.state_dict(), PATH)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">device = torch.device("cuda")</span></span><br><span class="line"><span class="string">model = Model(*args, **kwargs)</span></span><br><span class="line"><span class="string">model.load_state_dict(torch.load(PATH, map_location="cuda:0"))  # Choose whatever GPU device number you want</span></span><br><span class="line"><span class="string">model.to(device)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># This loads the model to a given GPU device. </span></span><br><span class="line"><span class="string"># Next, be sure to call model.to(torch.device('cuda')) to convert the model’s parameter tensors to CUDA tensors</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="13-Summary"><a href="#13-Summary" class="headerlink" title="13. Summary"></a>13. Summary</h3><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210805230250.png" alt="pytorch" style="zoom:50%;">]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Huggingface 预训练模型权重下载的问题</title>
      <link href="/2021/07/01/huggingface-yu-xun-lian-mo-xing-quan-chong-xia-zai-de-wen-ti/"/>
      <url>/2021/07/01/huggingface-yu-xun-lian-mo-xing-quan-chong-xia-zai-de-wen-ti/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文转自<a href="https://www.bilibili.com/read/cv8231417">Hugging face预训练模型</a>和<a href="https://cloud.tencent.com/developer/article/1745037">Huggingface 预训练模型权重下载的问题</a></p></blockquote><p>Hugging face是一个专注于NLP的公司，拥有一个开源的预训练模型库&nbsp;Transformers&nbsp;，里面囊括了非常多的模型例如&nbsp;BERT&nbsp;GPT&nbsp;等.</p><h4 id="模型库"><a href="#模型库" class="headerlink" title="模型库"></a>模型库</h4><p>官网的模型库的地址如下：<a href="https://huggingface.co/models">https://huggingface.co/models</a> </p><h4 id="使用模型"><a href="#使用模型" class="headerlink" title="使用模型"></a>使用模型</h4><p>首先需要安装transformers库，使用以下命令安装：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install transformers</span><br></pre></td></tr></tbody></table></figure><p>接下来在代码中调用 <font color="red"> AutoTokenizer.from_pretrained</font> 和 <font color="red"> AutoModel.from_pretrained </font>即可, 例如：</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> *</span><br><span class="line">model_name = <span class="string">'hfl/chinese-xlnet-base'</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line">model = AutoModel.from_pretrained(model_name)</span><br></pre></td></tr></tbody></table></figure><p>运行后系统会自动下载相关的模型文件并存放在电脑中。使用Windows模型保存的路径在 <font color="red"> C:\Users[用户名].cache\torch\transformers</font>目录下，根据模型的不同下载的东西也不相同</p><p>使用Linux模型保存的路径在 <font color="red"> ~/.cache/torch/transformers/ </font>目录下。</p><h4 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h4><p>这些前提是你的电脑有网络可以直接使用代码下载相应的模型文件，但是问题是有些机器是没有外网连接权限或者下载速度非常慢。</p><p>这时候就需要把模型文件下载后在导入代码中，还是以刚才的  <font color="red"> hfl/chinese-xlnet-base </font>模型为例，直接在官网搜索模型，点击进入模型的详情界面</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210701024119.png" alt="20210701024119"></p><p>在界面中找到 Files</p><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210701024235.png" alt="20210701024235"></p><p>把弹窗内的文件全部下载下来</p><p>我们假设文件保存在<font color="red"> E:\models\hfl\chinese-xlnet-base\ </font>目录下</p><p>我们只需要把<font color="red">model_name </font>修改为下载的文件夹即可</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> *</span><br><span class="line">model_name = <span class="string">'E:/models/hfl/chinese-xlnet-base/'</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line">model = AutoModel.from_pretrained(model_name)</span><br></pre></td></tr></tbody></table></figure><p>这样问题就解决了。</p>]]></content>
      
      
      <categories>
          
          <category> 人工智能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 预训练模型 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jupyter notebook 本地服务器搭建</title>
      <link href="/2021/06/21/jupyter-notebook-ben-di-fu-wu-qi-da-jian/"/>
      <url>/2021/06/21/jupyter-notebook-ben-di-fu-wu-qi-da-jian/</url>
      
        <content type="html"><![CDATA[<p>今天在实验室的服务器主机上面搭建了jupyter notebook服务器，记录一下搭建步骤，方便以后查看。</p><h4 id="服务器端操作"><a href="#服务器端操作" class="headerlink" title="服务器端操作"></a>服务器端操作</h4><h5 id="生成Jupyter-Notebook配置文件"><a href="#生成Jupyter-Notebook配置文件" class="headerlink" title="生成Jupyter Notebook配置文件"></a>生成Jupyter Notebook配置文件</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br></pre></td></tr></tbody></table></figure><h5 id="设置登录密码"><a href="#设置登录密码" class="headerlink" title="设置登录密码"></a>设置登录密码</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在命令行输入python命令，进入python交互界面，输入如下命令</span></span><br><span class="line">from notebook.auth import passwd</span><br><span class="line">passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[2]: <span class="string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>将生成的代码添加到配置文件中</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = u<span class="string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span></span><br></pre></td></tr></tbody></table></figure><h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.jupyter/jupyter_notebook_config.py</span><br></pre></td></tr></tbody></table></figure><p>在配置文件中添加如下内容</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.allow_origin = <span class="string">'*'</span></span><br><span class="line">c.NotebookApp.ip = <span class="string">'0.0.0.0'</span> <span class="comment">#所有绑定服务器的IP都能访问，若想只在特定ip访问，输入ip地址即可</span></span><br><span class="line">c.NotebookApp.port = 2021 <span class="comment">#将端口设置为自己喜欢的吧，默认是8888</span></span><br><span class="line">c.NotebookApp.open_browser = False <span class="comment">#我们并不想在服务器上直接打开Jupyter Notebook，所以设置成False</span></span><br><span class="line">c.NotebookApp.notebook_dir = <span class="string">'/home/jupyter_projects'</span> <span class="comment">#这里是设置Jupyter的根目录，若不设置将默认root的根目录，不安全</span></span><br><span class="line">c.NotebookApp.allow_root = True <span class="comment"># 为了安全，Jupyter默认不允许以root权限启动jupyter</span></span><br><span class="line">c.NotebookApp.allow_remote_access = True</span><br><span class="line">c.NotebookApp.password = u<span class="string">'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h5 id="启动jupyter-notebook"><a href="#启动jupyter-notebook" class="headerlink" title="启动jupyter notebook"></a>启动jupyter notebook</h5><p>在终端输入如下命令启动jupyter notebook：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></tbody></table></figure><h4 id="客服端电脑操作"><a href="#客服端电脑操作" class="headerlink" title="客服端电脑操作"></a>客服端电脑操作</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ssh username@ipaddress -L 2021:127.0.0.1:2021</span><br></pre></td></tr></tbody></table></figure><p>最后在本地浏览器输入地址：127.0.0.1:2021 访问</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jupyter notebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习中的各种熵</title>
      <link href="/2021/04/16/ji-qi-xue-xi-zhong-de-ge-chong-shang/"/>
      <url>/2021/04/16/ji-qi-xue-xi-zhong-de-ge-chong-shang/</url>
      
        <content type="html"><![CDATA[<h3 id="概念和定义"><a href="#概念和定义" class="headerlink" title="概念和定义"></a>概念和定义</h3><h4 id="熵"><a href="#熵" class="headerlink" title="熵"></a>熵</h4><h4 id="条件熵"><a href="#条件熵" class="headerlink" title="条件熵"></a>条件熵</h4><h4 id="交叉熵"><a href="#交叉熵" class="headerlink" title="交叉熵"></a>交叉熵</h4><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h3 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h3><ul><li><p><a href="https://www.cnblogs.com/Arborday/p/10727147.html">https://www.cnblogs.com/Arborday/p/10727147.html</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/35379531">https://zhuanlan.zhihu.com/p/35379531</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 熵 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常用命令</title>
      <link href="/2021/04/08/git-chang-yong-ming-ling/"/>
      <url>/2021/04/08/git-chang-yong-ming-ling/</url>
      
        <content type="html"><![CDATA[<h4 id="git基于历史commit创建分支"><a href="#git基于历史commit创建分支" class="headerlink" title="git基于历史commit创建分支"></a>git基于历史commit创建分支</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br><span class="line">git branch &lt;branch name&gt; &lt;SHA1&gt; </span><br><span class="line">git checkout &lt;branch name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#也可以直接执行下面的命令</span></span><br><span class="line">git checkout -b &lt;branch name&gt; &lt;SHA1&gt; </span><br></pre></td></tr></tbody></table></figure><h4 id="git对分支的操作"><a href="#git对分支的操作" class="headerlink" title="git对分支的操作"></a>git对分支的操作</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看远程分支</span></span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看本地分支</span></span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建分支</span></span><br><span class="line">git branch branch_name</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换到分支</span></span><br><span class="line">git checkout branch_name</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除本地分支</span></span><br><span class="line">git branch -d branch_name</span><br><span class="line"></span><br><span class="line"><span class="comment">#重命名本地分支</span></span><br><span class="line">git branch -m old new</span><br><span class="line"></span><br><span class="line"><span class="comment">#重命名远程分支：将远程分支删除，然后将本地分支重命名，最后将本地分支推到远程</span></span><br><span class="line">git push --delete origin old <span class="comment">#删除远程分支</span></span><br><span class="line">git branch -m old new <span class="comment">#重命名本地分支</span></span><br><span class="line">git push origin new <span class="comment">#将本地分支推送到远程</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="git对比两个分支差异"><a href="#git对比两个分支差异" class="headerlink" title="git对比两个分支差异"></a><a href="https://www.jianshu.com/p/bb97fabb475e">git对比两个分支差异</a></h4>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP知识体系</title>
      <link href="/2021/04/08/nlp-zhi-shi-ti-xi/"/>
      <url>/2021/04/08/nlp-zhi-shi-ti-xi/</url>
      
        <content type="html"><![CDATA[<h3 id="第一部分：机器学习基础篇"><a href="#第一部分：机器学习基础篇" class="headerlink" title="第一部分：机器学习基础篇"></a>第一部分：机器学习基础篇</h3><h4 id="第一章：自然语言处理概述"><a href="#第一章：自然语言处理概述" class="headerlink" title="第一章：自然语言处理概述"></a>第一章：自然语言处理概述</h4><ul><li><p>自然语言处理的现状与前景</p></li><li><p>自然语言处理应用</p></li><li><p>自然语言处理经典任务</p></li></ul><h4 id="第二章：数据结构与算法基础"><a href="#第二章：数据结构与算法基础" class="headerlink" title="第二章：数据结构与算法基础"></a>第二章：数据结构与算法基础</h4><ul><li><p>时间复杂度、空间复杂度</p></li><li><p>动态规划</p></li><li><p>贪心算法</p></li><li><p>各种排序算法</p></li></ul><h4 id="第三章：分类与逻辑回归"><a href="#第三章：分类与逻辑回归" class="headerlink" title="第三章：分类与逻辑回归"></a>第三章：分类与逻辑回归</h4><ul><li><p>逻辑回归</p></li><li><p>最大似然估计</p></li><li><p>优化与梯度下降法</p></li><li><p>随机梯度下降法</p></li></ul><h4 id="第四章：模型泛化与调参"><a href="#第四章：模型泛化与调参" class="headerlink" title="第四章：模型泛化与调参"></a>第四章：模型泛化与调参</h4><ul><li><p>理解过拟合、防止过拟合</p></li><li><p>L1与L2正则</p></li><li><p>交叉验证</p></li><li><p>正则与MAP估计</p></li></ul><h3 id="第二部分：文本处理篇"><a href="#第二部分：文本处理篇" class="headerlink" title="第二部分：文本处理篇"></a>第二部分：文本处理篇</h3><h4 id="第五章：文本预处理与表示"><a href="#第五章：文本预处理与表示" class="headerlink" title="第五章：文本预处理与表示"></a>第五章：文本预处理与表示</h4><ul><li><p>各类分词算法</p></li><li><p>词的标准化</p></li><li><p>拼写纠错、停用词</p></li><li><p>独热编码表示</p></li><li><p>tf-idf与相似度</p></li><li><p>分布式表示与词向量</p></li><li><p>词向量可视化与评估</p></li></ul><h4 id="第六章：词向量技术"><a href="#第六章：词向量技术" class="headerlink" title="第六章：词向量技术"></a>第六章：词向量技术</h4><ul><li><p>独热编码的优缺点</p></li><li><p>分布式表示的优点</p></li><li><p>静态词向量与动态词向量</p></li><li><p>SkipGram与CBOW</p></li><li><p>SkipGram详解</p></li><li><p>Negative  Sampling</p></li></ul><h4 id="第七章：语言模型"><a href="#第七章：语言模型" class="headerlink" title="第七章：语言模型"></a>第七章：语言模型</h4><ul><li><p>语言模型的作用</p></li><li><p>马尔科夫假设</p></li><li><p>UniGram, BiGram, NGram模型</p></li><li><p>语言模型的评估</p></li><li><p>语言模型的平滑技术</p></li></ul><h3 id="第三部分：序列模型篇"><a href="#第三部分：序列模型篇" class="headerlink" title="第三部分：序列模型篇"></a>第三部分：序列模型篇</h3><h4 id="第八章：隐马尔科夫模型"><a href="#第八章：隐马尔科夫模型" class="headerlink" title="第八章：隐马尔科夫模型"></a>第八章：隐马尔科夫模型</h4><ul><li><p>HMM的应用</p></li><li><p>HMM的Inference</p></li><li><p>维特比算法</p></li><li><p>前向、后向算法</p></li><li><p>HMM的参数估计详解</p></li></ul><h4 id="第九章：线性条件随机场"><a href="#第九章：线性条件随机场" class="headerlink" title="第九章：线性条件随机场"></a>第九章：线性条件随机场</h4><ul><li><p>有向图与无向图</p></li><li><p>生成模型与判别模型</p></li><li><p>从HMM与MEMM</p></li><li><p>MEMM中的标签偏置</p></li><li><p>Log-Linear模型介绍</p></li><li><p>从Log-Linear到LinearCRF</p></li><li><p>LinearCRF的参数估计</p></li></ul><h3 id="第四部分：深度学习与预训练篇"><a href="#第四部分：深度学习与预训练篇" class="headerlink" title="第四部分：深度学习与预训练篇"></a>第四部分：深度学习与预训练篇</h3><h4 id="第十章：深度学习基础"><a href="#第十章：深度学习基础" class="headerlink" title="第十章：深度学习基础"></a>第十章：深度学习基础</h4><ul><li><p>理解神经网络</p></li><li><p>各种常见的激活函数</p></li><li><p>反向传播算法</p></li><li><p>浅层模型与深度模型对比</p></li><li><p>深度学习中的层次表示</p></li><li><p>深度学习中的过拟合</p></li></ul><h4 id="第十一章：RNN与LSTM"><a href="#第十一章：RNN与LSTM" class="headerlink" title="第十一章：RNN与LSTM"></a>第十一章：RNN与LSTM</h4><ul><li><p>从HMM到RNN模型</p></li><li><p>RNN中的梯度问题</p></li><li><p>梯度消失与LSTM</p></li><li><p>LSTM到GRU</p></li><li><p>双向LSTM</p></li><li><p>双向深度LSTM</p></li></ul><h4 id="第十二章：Seq2Seq模型与注意力机制"><a href="#第十二章：Seq2Seq模型与注意力机制" class="headerlink" title="第十二章：Seq2Seq模型与注意力机制"></a>第十二章：Seq2Seq模型与注意力机制</h4><ul><li><p>Seq2Seq模型</p></li><li><p>Greedy Decoding</p></li><li><p>Beam Search</p></li><li><p>长依赖所存在的问题</p></li><li><p>注意力机制的实现</p></li></ul><h4 id="第十三章：动态词向量与ELMo技术"><a href="#第十三章：动态词向量与ELMo技术" class="headerlink" title="第十三章：动态词向量与ELMo技术"></a>第十三章：动态词向量与ELMo技术</h4><ul><li><p>基于上下文的词向量技术</p></li><li><p>图像识别中的层次表示</p></li><li><p>文本领域中的层次表示</p></li><li><p>ELMo模型</p></li><li><p>ELMo的预训练与测试</p></li><li><p>ELMo的优缺点</p></li></ul><h4 id="第十四章：自注意力机制与Transformer"><a href="#第十四章：自注意力机制与Transformer" class="headerlink" title="第十四章：自注意力机制与Transformer"></a>第十四章：自注意力机制与Transformer</h4><ul><li><p>LSTM模型的缺点</p></li><li><p>Transformer概述</p></li><li><p>理解自注意力机制</p></li><li><p>位置信息的编码</p></li><li><p>理解Encoder和Decoder区别</p></li><li><p>理解Transformer的训练与预测</p></li><li><p>Transformer的缺点</p></li></ul><h4 id="第十五章：BERT与ALBERT"><a href="#第十五章：BERT与ALBERT" class="headerlink" title="第十五章：BERT与ALBERT"></a>第十五章：BERT与ALBERT</h4><ul><li><p>自编码介绍</p></li><li><p>Transformer Encoder</p></li><li><p>Masked语言模型</p></li><li><p>BERT模型</p></li><li><p>BERT的不同训练方式</p></li><li><p>ALBERT</p></li></ul><h4 id="第十六章：BERT的其他变种"><a href="#第十六章：BERT的其他变种" class="headerlink" title="第十六章：BERT的其他变种"></a>第十六章：BERT的其他变种</h4><ul><li><p>RoBERTa模型</p></li><li><p>SpanBERT模型</p></li><li><p>FinBERT模型</p></li><li><p>引入先验知识</p></li><li><p>K-BERT</p></li><li><p>KG-BERT</p></li></ul><h4 id="第十七章：GPT与XLNet"><a href="#第十七章：GPT与XLNet" class="headerlink" title="第十七章：GPT与XLNet"></a>第十七章：GPT与XLNet</h4><ul><li><p>Transformer Encoder回顾</p></li><li><p>GPT-1, GPT-2,  GPT-3</p></li><li><p>ELMo的缺点</p></li><li><p>语言模型下同时考虑上下文</p></li><li><p>Permutation LM</p></li><li><p>双流自注意力机制</p></li></ul><h3 id="第五部分：信息抽取与知识图谱篇"><a href="#第五部分：信息抽取与知识图谱篇" class="headerlink" title="第五部分：信息抽取与知识图谱篇"></a>第五部分：信息抽取与知识图谱篇</h3><h4 id="第十八章：命名识别与实体消歧"><a href="#第十八章：命名识别与实体消歧" class="headerlink" title="第十八章：命名识别与实体消歧"></a>第十八章：命名识别与实体消歧</h4><ul><li><p>信息抽取的应用和关键技术</p></li><li><p>命名实体识别</p></li><li><p>NER识别常用技术</p></li><li><p>实体统一技术</p></li><li><p>实体消歧技术</p></li><li><p>指代消解</p></li></ul><h4 id="第十九章：关系抽取"><a href="#第十九章：关系抽取" class="headerlink" title="第十九章：关系抽取"></a>第十九章：关系抽取</h4><ul><li><p>关系抽取的应用</p></li><li><p>基于规则的方法</p></li><li><p>基于监督学习的方法</p></li><li><p>Bootstrap方法</p></li><li><p>Distant Supervision方法</p></li></ul><h4 id="第二十章：句法分析"><a href="#第二十章：句法分析" class="headerlink" title="第二十章：句法分析"></a>第二十章：句法分析</h4><ul><li><p>句法分析的应用</p></li><li><p>CFG介绍</p></li><li><p>从CFG到PCFG</p></li><li><p>评估语法树</p></li><li><p>寻找最好的语法树</p></li><li><p>CKY算法</p></li></ul><h4 id="第二十一章：依存文法分析"><a href="#第二十一章：依存文法分析" class="headerlink" title="第二十一章：依存文法分析"></a>第二十一章：依存文法分析</h4><ul><li><p>从语法分析到依存文法分析</p></li><li><p>依存文法分析的应用</p></li><li><p>基于图算法的依存文法分析</p></li><li><p>基于Transition-based的依存文法分析</p></li><li><p>依存文法的应用案例</p></li></ul><h4 id="第二十二章：知识图谱"><a href="#第二十二章：知识图谱" class="headerlink" title="第二十二章：知识图谱"></a>第二十二章：知识图谱</h4><ul><li><p>知识图谱的重要性</p></li><li><p>知识图谱中的实体与关系</p></li><li><p>非结构化数据与构造知识图谱</p></li><li><p>知识图谱设计</p></li><li><p>图算法的应用</p></li></ul><h3 id="第六部分：模型压缩与图神经网络篇"><a href="#第六部分：模型压缩与图神经网络篇" class="headerlink" title="第六部分：模型压缩与图神经网络篇"></a>第六部分：模型压缩与图神经网络篇</h3><h4 id="第二十三章：模型的压缩"><a href="#第二十三章：模型的压缩" class="headerlink" title="第二十三章：模型的压缩"></a>第二十三章：模型的压缩</h4><ul><li><p>模型压缩重要性</p></li><li><p>常见的模型压缩总览</p></li><li><p>基于矩阵分解的压缩技术</p></li><li><p>基于蒸馏的压缩技术</p></li><li><p>基于贝叶斯模型的压缩技术</p></li><li><p>模型的量化</p></li></ul><h4 id="第二十四章：基于图的学习"><a href="#第二十四章：基于图的学习" class="headerlink" title="第二十四章：基于图的学习"></a>第二十四章：基于图的学习</h4><ul><li><p>图的表示</p></li><li><p>图与知识图谱</p></li><li><p>关于图的常见算法</p></li><li><p>Deepwalk和Node2vec</p></li><li><p>TransE图嵌入算法</p></li><li><p>DSNE图嵌入算法</p></li></ul><h4 id="第二十五章：图神经网络"><a href="#第二十五章：图神经网络" class="headerlink" title="第二十五章：图神经网络"></a>第二十五章：图神经网络</h4><ul><li><p>卷积神经网络回顾</p></li><li><p>在图中设计卷积操作</p></li><li><p>图中的信息传递</p></li><li><p>图卷积神经网络</p></li><li><p>图卷积神经网络的经典应用</p></li></ul><h4 id="第二十六章：GraphSage与GAT"><a href="#第二十六章：GraphSage与GAT" class="headerlink" title="第二十六章：GraphSage与GAT"></a>第二十六章：GraphSage与GAT</h4><ul><li><p>从GCN到GraphSAge</p></li><li><p>注意力机制回归</p></li><li><p>GAT模型详解</p></li><li><p>GAT与GCN比较</p></li><li><p>对于异构数据的处理</p></li></ul><h4 id="第二十七章：图神经网络的其他应用"><a href="#第二十七章：图神经网络的其他应用" class="headerlink" title="第二十七章：图神经网络的其他应用"></a>第二十七章：图神经网络的其他应用</h4><ul><li><p>Node Classification</p></li><li><p>Graph Classification</p></li><li><p>Link Prediction</p></li><li><p>社区挖掘</p></li><li><p>推荐系统</p></li><li><p>图神经网络的未来发展</p></li></ul><h3 id="部分可练习的案例"><a href="#部分可练习的案例" class="headerlink" title="部分可练习的案例"></a>部分可练习的案例</h3><ol><li>实现一个拼写纠错器</li><li>从零实现Word2Vec词向量</li><li>利用SkipGram做推荐</li><li>从零实现HMM模型</li><li>基于Linear-CRF的词性分类器实现</li><li>从零实现深度学习反向传播算法</li><li>实现AI程序帮助写程序</li><li>实现AI程序帮助写文章</li><li>基于Transformer的机器翻译</li><li>基于KG-BERT的知识图谱学习</li><li>基于知识图谱的风控系统</li><li>基于知识图谱的个性化教学</li><li>利用蒸馏算法压缩Transformer</li><li>利用GCN实现社交推荐</li><li>基于GAT的虚假新闻检测</li></ol><h3 id="项目作业"><a href="#项目作业" class="headerlink" title="项目作业"></a>项目作业</h3><ol><li><p>豆瓣电影评分预测</p><p> 涉及到的知识点：</p><ul><li><p>中文分词技术</p></li><li><p>独热编码、tf-idf</p></li><li><p>分布式表示与Word2Vec</p></li><li><p>BERT向量、句子向量</p></li></ul></li><li><p>智能客服问答系统</p><p> 涉及到的知识点：</p><ul><li><p>问答系统搭建流程</p></li><li><p>文本的向量化表示</p></li><li><p>FastText</p></li><li><p>倒排表</p></li><li><p>问答系统中的召回、排序</p></li></ul></li><li><p>基于Linear-CRF的医疗实体识别</p><p> 涉及到的知识点：</p><ul><li><p>命名实体识别</p></li><li><p>特征工程</p></li><li><p>评估标准</p></li><li><p>过拟合</p></li></ul></li><li><p>基于闲聊的对话系统搭建</p><p> 涉及到的知识点：</p><ul><li><p>常见的对话系统技术</p></li><li><p>闲聊型对话系统框架</p></li><li><p>数据的处理技术</p></li><li><p>BERT的使用</p></li><li><p>Transformer的使用</p></li></ul></li><li><p>搭建基于医疗知识图谱的问答系统</p><p> 涉及到的知识点：</p><ul><li><p>医疗专业词汇的使用</p></li><li><p>获取问句的意图</p></li><li><p>问句的解释、提取关键实体</p></li><li><p>转化为查询语句</p></li></ul></li><li><p>搭建基于医疗知识图谱的问答系统</p><p> 涉及到的知识点：</p><ul><li><p>文本摘要生成介绍</p></li><li><p>关键词提取技术</p></li><li><p>图神经网络的摘要生成</p></li><li><p>基于生成式的摘要提取技术</p></li><li><p>文本摘要质量的评估</p></li></ul></li></ol><h3 id="论文"><a href="#论文" class="headerlink" title="论文"></a>论文</h3><table><thead><tr><th>主题</th><th>论文名称</th></tr></thead><tbody><tr><td>机器学习</td><td>XGBoost: A Scalable Tree Boosting System</td></tr><tr><td>机器学习</td><td>Regularization and Variable Selection via the Elastic Net</td></tr><tr><td>词向量</td><td>Evaluation methods for unsupervised word embeddings</td></tr><tr><td>词向量</td><td>Evaluation methods for unsupervised word embeddings</td></tr><tr><td>词向量</td><td>GloVe: Global Vectors for Word Representation</td></tr><tr><td>词向量</td><td>Deep Contexualized Word Representations</td></tr><tr><td>词向量</td><td>Attention is All You Need</td></tr><tr><td>词向量</td><td>BERT: Pretraining of Deep Bidirectional Transformers for Language Understanding</td></tr><tr><td>词向量</td><td>XLNet: Generalized Autoregressive Pretraining for Language Understanding</td></tr><tr><td>词向量</td><td>KG-BERT: BERT for Knowledge Graph Completion</td></tr><tr><td>词向量</td><td>Language Models are Few-shot Learners</td></tr><tr><td>图学习</td><td>Semi-supervised Classification with Graph Convolutional Networks</td></tr><tr><td>图学习</td><td>Graph Attention Networks</td></tr><tr><td>图学习</td><td>GraphSAGE: Inductive Representation Learning on Large Graphs</td></tr><tr><td>图学习</td><td>Node2Vec: Scalable Feature Learning for Networks</td></tr></tbody></table><p>参考链接: <a href="https://mp.weixin.qq.com/s/GPCmLavk7NjHVwgWIb02-g">https://mp.weixin.qq.com/s/GPCmLavk7NjHVwgWIb02-g</a></p>]]></content>
      
      
      <categories>
          
          <category> 知识框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nlp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【每日算法】2021年03月31日 小雨 最小路径和</title>
      <link href="/2021/04/01/zui-xiao-lu-jing-he/"/>
      <url>/2021/04/01/zui-xiao-lu-jing-he/</url>
      
        <content type="html"><![CDATA[<p>这道题是LeeCode第<a href="https://leetcode-cn.com/problems/minimum-path-sum/">64</a>题，和之前的第62题一样，属于动态规划中的中等难度题目。</p><span id="more"></span><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210401021549.png"></p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p>本题的解题思路和之前的第<a href="https://ailyong.cn/2021/03/30/bu-tong-lu-jing/">62题</a>很相似，定义dp[i][j]为从第(i, j)点走到右下角的最短路径，则有dp[i][j] = dp[i+1][j] + dp[i][j+1].</p><p>然后我们来考虑边界条件，此题的边际和第62题的边际一样，不同的是边界上面dp值，当在下边界的时候dp[m-1][j] = sum(gird[m-1][j:-1]), 在左边界的时候<br>dp[i][n-1] = sum(grid[i:-1][n-1])， dp[m-1][n-1] = grid[m-1][n-1].</p><p>最终答案为: dp[0][0]</p><h4 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minPathSum</span>(<span class="params">self, grid: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        m = <span class="built_in">len</span>(grid)</span><br><span class="line">        n = <span class="built_in">len</span>(grid[<span class="number">0</span>])</span><br><span class="line">        dp = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m)] <span class="comment">#这里纠结了不少时间</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            dp[m-<span class="number">1</span>][j] = <span class="built_in">sum</span>(grid[m-<span class="number">1</span>]) - <span class="built_in">sum</span>(grid[m-<span class="number">1</span>][<span class="number">0</span>:j]) </span><br><span class="line">        col = [x[n-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> grid]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            dp[i][n-<span class="number">1</span>] = <span class="built_in">sum</span>(col)-<span class="built_in">sum</span>(col[<span class="number">0</span>:i])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">                dp[i][j] = grid[i][j] + <span class="built_in">min</span>(dp[i+<span class="number">1</span>][j], dp[i][j+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure><h4 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h4><p>一开始声明二维数组的时候用了浅拷贝，改变某一行的值的时候，其他行的值也会跟着改变，但是我这么搞，竟然通过了60多个样例，好像是在第63个样例的时候卡住了（挠头），后面一个个的把dp里面的值打印出来看，才发现原来是用了浅拷贝，导致这样的问题，换成了迭代生成式后，终于AC了。</p>]]></content>
      
      
      <categories>
          
          <category> 算法笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLab搭建笔记</title>
      <link href="/2021/03/31/gitlab-da-jian-bi-ji/"/>
      <url>/2021/03/31/gitlab-da-jian-bi-ji/</url>
      
        <content type="html"><![CDATA[<h4 id="安装gitlab："><a href="#安装gitlab：" class="headerlink" title="安装gitlab："></a><a href="https://packages.gitlab.com/gitlab/gitlab-ee/packages/ubuntu/focal/gitlab-ee_13.8.7-ee.0_amd64.deb">安装gitlab</a>：</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/</span><br><span class="line">script.deb.sh | <span class="built_in">sudo</span> bash</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h4 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h4><p> 之前已经配置好了，略</p><h4 id="gitlab配置"><a href="#gitlab配置" class="headerlink" title="gitlab配置"></a><a href="https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab">gitlab配置</a></h4><p>打开/etc/gitlab/gitlab.rb</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">external_url <span class="string">'http://gitlab.bytenlp.site'</span></span><br><span class="line"><span class="comment"># 系统端口冲突，我把端口改为了85</span></span><br><span class="line">nginx[<span class="string">'listen_port'</span>] = 85</span><br></pre></td></tr></tbody></table></figure><h4 id="让配置生效，并重启gitlab服务"><a href="#让配置生效，并重启gitlab服务" class="headerlink" title="让配置生效，并重启gitlab服务"></a>让配置生效，并重启gitlab服务</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新配置gitlab</span></span><br><span class="line"><span class="built_in">sudo</span> gitlab-ctl reconfigure</span><br><span class="line"><span class="comment"># 重启gitlab</span></span><br><span class="line">gitlab-ctl restart </span><br></pre></td></tr></tbody></table></figure><h4 id="在浏览器输入”ip-端口号”查看效果，详细参考这里"><a href="#在浏览器输入”ip-端口号”查看效果，详细参考这里" class="headerlink" title="在浏览器输入”ip:端口号”查看效果，详细参考这里"></a>在浏览器输入”ip:端口号”查看效果，详细参考<a href="https://www.jianshu.com/p/ade38a53b1ac">这里</a></h4><p>参考教程：</p><ul><li><a href="https://www.jianshu.com/p/bf7b09e234c8">https://www.jianshu.com/p/bf7b09e234c8</a></li><li><a href="https://lil-xing.top/2019/08/26/GitLab%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">https://lil-xing.top/2019/08/26/GitLab%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</a><br>sudo apt-get install gitlab-ee=13.8.7-ee.0</li><li><a href="https://www.jianshu.com/p/ade38a53b1ac">https://www.jianshu.com/p/ade38a53b1ac</a></li></ul><p>测试一下</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>英语口语练习电影推荐</title>
      <link href="/2021/03/31/ying-yu-kou-yu-lian-xi-dian-ying-tui-jian/"/>
      <url>/2021/03/31/ying-yu-kou-yu-lian-xi-dian-ying-tui-jian/</url>
      
        <content type="html"><![CDATA[<p>我是从喜马拉雅路转粉过来听课的，<a href="https://www.ximalaya.com/waiyu/19111514/">张老师</a>推荐的东西必然是干货。因此利用周末时间搜集整理了一些老师课上推荐的视频资源，方便自己也分享给大家。</p><h4 id="电影推荐"><a href="#电影推荐" class="headerlink" title="电影推荐"></a>电影推荐</h4><ul><li><p><a href="https://pan.baidu.com/s/1f1MKRhiGnhXPakdql9BFcQ">The Queen</a> (提取码:gysn)</p></li><li><p><a href="https://pan.baidu.com/s/1thHrc_mUaHD8pFyZwI4g2g">The King’s Speech</a> (提取码:gr42）</p></li><li><p><a href="https://pan.baidu.com/s/1hIyXIJ53H-p_rsCxR0f22Q">Downton Abbey</a> (提取码:cyb9)</p></li><li><p><a href="https://pan.baidu.com/s/1cFcyl3ZZ5TomwZnk0IbbTg">The Holiday</a> (提取码:48ks) 字幕 (提取码:4vix)</p></li><li><p><a href="https://pan.baidu.com/s/1PjDRYpgfXw557lkICTZiWQ">Coco</a> (提取码:tkwx)</p></li><li><p><a href="https://pan.baidu.com/s/10o4jLTT9etBVNlhE9pLgEQ">Darkest Hours</a> (提取码:okwz)</p></li><li><p><a href="https://pan.baidu.com/s/1s406g4lKsv2YPreZ3egBPw">Wonder</a> (提取码:yjog)</p></li><li><p><a href="https://pan.baidu.com/s/1cygoZKcHhtBgF3wA46LXHg">Harry Potter</a> (提取码:cg1w)</p></li><li><p><a href="https://pan.baidu.com/s/1Nptp0lnqBEsoWiGygB7Qgw">Big Hero 6</a> (提取码:g4q4)</p></li><li><p><a href="https://pan.baidu.com/s/1iLHz4MQpkWRUAz6ApnM_yA">Zootopia</a>（提取码:8tmm)</p></li><li><p><a href="https://ddrk.me/frozen-2013/">Frozen 1</a></p></li><li><p><a href="https://ddrk.me/frozen-2/">Frozen 2</a></p></li></ul><h4 id="电视剧推荐"><a href="#电视剧推荐" class="headerlink" title="电视剧推荐"></a>电视剧推荐</h4><ul><li><p><a href="https://pan.baidu.com/s/1oLZdVtC2dxQsntKqFpYGzA">Miranda</a> (提取码:ogrp)</p></li><li><p><a href="https://ddrk.me/the-it-crowd/">The IT Crowd</a></p></li><li><p><a href="https://pan.baidu.com/s/1urGHdiTmz4STpnXnGgnw9Q">Friends 磁力链接</a> (提取码: ldlu)（磁力链接可用迅雷下载，具体操作可自行搜索）</p></li><li><p><a href="https://www.zxzj.me/vodsearch/-------------.html?wd=%E6%91%A9%E7%99%BB%E5%AE%B6%E5%BA%AD">Modern Family</a></p></li><li><p><a href="https://www.zxzj.me/vodsearch/-------------.html?wd=%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8">TBBT 生活大爆炸</a>（高清下载磁力<a href="magnet:?xt=urn:btih:49CF1C0B0305D8F5031CB99840C09F06EABB79F6&amp;dn=The+Big+Bang+Theory+Season+1-11+Complete+720p&amp;tr=udp://tracker.coppersurfer.tk:6969/announce&amp;tr=udp://9.rarbg.to:2920/announce&amp;tr=udp://tracker.opentrackr.org:1337&amp;tr=udp://tracker.internetwarriors.net:1337/announce&amp;tr=udp://tracker.leechers-paradise.org:6969/announce&amp;tr=udp://tracker.coppersurfer.tk:6969/announce&amp;tr=udp://tracker.pirateparty.gr:6969/announce&amp;tr=udp://tracker.cyberia.is:6969/announce">链接</a>）</p></li></ul><h4 id="科普记录片推荐"><a href="#科普记录片推荐" class="headerlink" title="科普记录片推荐"></a>科普记录片推荐</h4><ul><li><a href="https://www.bilibili.com/video/av70632732?p=2&amp;spm_id_from=pageDriver">国家地理科普101</a></li></ul><p>资料整理不易，如果觉得好的话，记得打赏支持一波，一块钱也是奖励。</p>]]></content>
      
      
      <categories>
          
          <category> 学习资料 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电影 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习视频整理</title>
      <link href="/2021/03/31/xue-xi-shi-pin-zheng-li/"/>
      <url>/2021/03/31/xue-xi-shi-pin-zheng-li/</url>
      
        <content type="html"><![CDATA[<h4 id="MIT计算机科学导论"><a href="#MIT计算机科学导论" class="headerlink" title="MIT计算机科学导论"></a>MIT计算机科学导论</h4><p>MIT计算机科学导论教学视频，中英文字幕可以随意切换，老师发音很好，强推</p><ul><li><p><a href="https://www.bilibili.com/video/BV1sJ411n7aJ?from=search&amp;seid=18376503429056860180">6.0001基础</a></p></li><li><p><a href="https://www.bilibili.com/video/av83124797?spm_id_from=333.788.b_636f6d6d656e74.4">6.0002进价</a></p></li><li><p><a href="https://book.douban.com/subject/30155590/">教材</a></p></li><li><p><a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-0002-introduction-to-computational-thinking-and-data-science-fall-2016/index.htm">6.0002课后练习</a></p></li><li><p><a href="https://pan.baidu.com/s/1hqxh8ag#list/path=%2F">配套ppt</a></p></li></ul><p>没有找到与最新视频配套的slide，只找到15年的.</p><h4 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h4>]]></content>
      
      
      <categories>
          
          <category> 学习资料 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【课程设计】最小生成树应用</title>
      <link href="/2021/03/31/ke-cheng-she-ji-zui-xiao-sheng-cheng-shu-ying-yong/"/>
      <url>/2021/03/31/ke-cheng-she-ji-zui-xiao-sheng-cheng-shu-ying-yong/</url>
      
        <content type="html"><![CDATA[<h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><p>本次课程设计要求在n个城市之间架设n-1条线路，实现这几个城市之间的网络通信，要求网络经济代价最低。具体要求如下：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNzc4Njc2Mi1iN2U3M2JhMjE3ODgyMWVmLmpwZw?x-oss-process=image/format,png"></p><p>问题分析<br>根据设计要求，我们假设城市之间的距离越大架设网线的经济代价越大，因此可以用两个城市之间的距离作为边的权重。</p><p>n个城市之间最多可以生成 1+2+…+(n-1)条边，分别计算出每条边的长度然后对他们进行升序排序，利用并查集得到由n-1条边组成的最小生成树，问题便得到解决。</p><p>为了解决上述问题，需要构建一个城市结构体CITY来表示城市，并且还需要构建EDGE结构体来表示城市与城市的边，并利用随机函数生成城市的坐标。</p><h4 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize (10000)<span class="comment">//n的取值最大为MaxSize</span></span></span><br><span class="line"><span class="comment">/*---------------------结构体定义---------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">City</span>{</span></span><br><span class="line">    <span class="comment">//城市结构体</span></span><br><span class="line">    <span class="type">int</span> id;<span class="comment">//城市ID</span></span><br><span class="line">    <span class="type">int</span> x, y;<span class="comment">//城市的坐标</span></span><br><span class="line">}CITY;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">edges</span>{</span></span><br><span class="line">    <span class="comment">//边结构体</span></span><br><span class="line">    <span class="type">int</span> s, e;<span class="comment">//s为起始顶点 e为终止顶点</span></span><br><span class="line">    <span class="type">double</span> cost;<span class="comment">//边的权值，即两个顶点之间的距离</span></span><br><span class="line">}EDGE;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*---------------------生成城市并显示---------------------*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">CreateCityPos</span><span class="params">(CITY *&amp; city, <span class="type">int</span> n)</span>{</span><br><span class="line">    <span class="comment">//随机生成城市坐标</span></span><br><span class="line">    city = (CITY*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CITY)* n);</span><br><span class="line">    srand((<span class="type">unsigned</span>)time(<span class="literal">NULL</span>));<span class="comment">//设置随机数的种子</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    {<span class="comment">//随机生成n个城市的x,y坐标值</span></span><br><span class="line">        city[i].id = i + <span class="number">1</span>;</span><br><span class="line">        city[i].x = rand() % <span class="number">100</span>;</span><br><span class="line">        city[i].y = rand() % <span class="number">100</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">ShowCityPos</span><span class="params">(CITY*city, <span class="type">int</span> n)</span></span><br><span class="line">{<span class="comment">//显示城市信息，城市序号、x坐标和y坐标</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n各城市的编号及坐标:\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d:[%d, %d]\n"</span>, city[i].id, city[i].x, city[i].y);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*---------------------计算城市两两之间的距离，生成边数组---------------------*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">Sum</span><span class="params">(<span class="type">int</span> n)</span></span><br><span class="line">{<span class="comment">//计算n的前n项和，用于根据顶点确定边的数目 当顶点为n时 则最多可以产生Sum(n-1)条边</span></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        sum += i;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="type">double</span> <span class="title function_">CityDist</span><span class="params">(<span class="type">const</span> CITY*a, <span class="type">const</span> CITY*b)</span></span><br><span class="line">{<span class="comment">//计算两个城市之间的距离</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="type">double</span>((a-&gt;x - b-&gt;x)*(a-&gt;x - b-&gt;x) + (a-&gt;y - b-&gt;y)*(a-&gt;y - b-&gt;y)));</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">CreateEdges</span><span class="params">(EDGE* &amp; e, CITY* city, <span class="type">int</span> n)</span></span><br><span class="line">{<span class="comment">//根据城市信息生成城市之间的边</span></span><br><span class="line">    e = (EDGE*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(EDGE)*Sum(n - <span class="number">1</span>));<span class="comment">//边的总数为Sum(n-1)</span></span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = i + <span class="number">1</span>; k &lt; n; ++k)</span><br><span class="line">        {</span><br><span class="line">            (e + cnt)-&gt;s = city[i].id;<span class="comment">//起始顶点</span></span><br><span class="line">            (e + cnt)-&gt;e = city[k].id;<span class="comment">//终止顶点</span></span><br><span class="line">            (e + cnt)-&gt;cost = CityDist(&amp;city[i], &amp;city[k]);<span class="comment">//边的权值</span></span><br><span class="line">            ++cnt;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="type">void</span> <span class="title function_">ShowCityEdges</span><span class="params">(EDGE*edges, <span class="type">int</span> n)</span></span><br><span class="line">{<span class="comment">//打印边信息</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n各城市间的距离(城市1-城市2:边权值（距离）)\n"</span>);</span><br><span class="line">    <span class="comment">//show edges:</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Sum(n<span class="number">-1</span>); ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d-%d : %f\n"</span>, edges[i].s, edges[i].e, edges[i].cost);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*--------------------KrusKal求最小生成树----------------------*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">cmp</span><span class="params">(<span class="type">const</span> <span class="type">void</span>*a, <span class="type">const</span> <span class="type">void</span> *b)</span></span><br><span class="line">{<span class="comment">//比较函数 比较两条边的权值 用于排序</span></span><br><span class="line">    EDGE* aa, *bb;</span><br><span class="line">    aa = (EDGE*)a; bb = (EDGE*)b;</span><br><span class="line">    <span class="keyword">if</span> ((aa-&gt;cost - bb-&gt;cost )&gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="comment">//最小生成树</span></span><br><span class="line"><span class="type">int</span> v[MaxSize];</span><br><span class="line"><span class="type">int</span> <span class="title function_">getRoot</span><span class="params">(<span class="type">int</span> a)</span></span><br><span class="line">{<span class="comment">//找到根节点</span></span><br><span class="line">    <span class="keyword">while</span> (a != v[a]) a = v[a];</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">KrusKal</span><span class="params">(EDGE* edges, <span class="type">int</span> n)</span></span><br><span class="line">{<span class="comment">//KrusKal算法生成最小生成树</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> e, a, b;</span><br><span class="line">    </span><br><span class="line">    <span class="type">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line">    e = Sum(n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; ++i) <span class="comment">//初始化并查集</span></span><br><span class="line">        v[i] = i;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n最小生成树的边及权值:\n"</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; e; ++i)</span><br><span class="line">    {</span><br><span class="line">        a = getRoot(edges[i].s);</span><br><span class="line">        b = getRoot(edges[i].e);</span><br><span class="line">        <span class="keyword">if</span> (a != b)</span><br><span class="line">        {<span class="comment">//将边并入生成树</span></span><br><span class="line">            v[a] = b;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d-%d: %f\n"</span>, edges[i].s, edges[i].e, edges[i].cost);<span class="comment">//打印并入生成树的边的两个顶点和权值</span></span><br><span class="line">            sum += edges[i].cost;<span class="comment">//计算生成树的总权值</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n生成树总权值sum =%f\n"</span>, sum);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*------------------------------KrusKal END-------------------------------------*/</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">solve</span><span class="params">(<span class="type">int</span> n)</span></span><br><span class="line">{</span><br><span class="line">    CITY*city;</span><br><span class="line">    EDGE* edges;</span><br><span class="line">    CreateCityPos(city, n);<span class="comment">//创建城市</span></span><br><span class="line">    ShowCityPos(city, n);<span class="comment">//显示城市</span></span><br><span class="line"> </span><br><span class="line">    CreateEdges(edges, city, n);<span class="comment">//创建边（根据所有城市两两之间的距离来创建）</span></span><br><span class="line">    qsort(edges, Sum(n - <span class="number">1</span>), <span class="keyword">sizeof</span>(EDGE), cmp);<span class="comment">//对边按权值进行升序排序</span></span><br><span class="line">    ShowCityEdges(edges, n);<span class="comment">//显示排序后的边</span></span><br><span class="line"> </span><br><span class="line">    KrusKal(edges, n);<span class="comment">//用KrusKal算法生成最小生成树</span></span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"请输入n:"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    solve(n);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}<span class="comment">//运行成功 2019年5月21日10:53:07</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*程序说明：</span></span><br><span class="line"><span class="comment">基本思想：1、首先生成n个城市，每个城市的坐标随机生成，这部分由CreateCityPos（）函数实现；</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">         2、计算n个城市两两之间的距离（距离计算由CityDist()完成），并保存到边数组中，这部分由CreateEdges（）函数实现；</span></span><br><span class="line"><span class="comment">         3、由边数组(edges[])根据KrusKal算法求最小生成树，这部分由KrusKal（）函数实现，要注意的是进行KrusKal算法之前，需要对edges[]中的元素按照</span></span><br><span class="line"><span class="comment">         权值进行升序排序，因此调用了stdlib.h头文件中的qsort()函数来进行排序。</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure><h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNzc4Njc2Mi03MjhiZjIyMGNkYzY5NTIyLnBuZw?x-oss-process=image/format,png"></p><p>n为城市的数量，由用户从终端输入。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【每日算法】2021年03月30日 多云 不同路径</title>
      <link href="/2021/03/30/bu-tong-lu-jing/"/>
      <url>/2021/03/30/bu-tong-lu-jing/</url>
      
        <content type="html"><![CDATA[<p>这道题是LeeCode第<a href="https://leetcode-cn.com/problems/unique-paths/">62</a>题，属于动态规划中的中等难度题目。</p><span id="more"></span><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210330183906.png" style="zoom: 67%;"><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210330184245.png" style="zoom:67%;"><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p>根据题面，假设机器人在位置(i, j), 不考虑边界条件，则它可以采取的动作有两个：向下(i+1)或者向右(j+1),定义dp[i][j]为机器人从(i,j)点走到点(m-1, n-1)的路径数，则有：dp[i][j] = dp[i+1][j] + dp[i][j+1],<br><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210330191859.png" style="zoom:67%;"><br>然后我们再来考虑边界条件，当机器人在红框区域(此时 $i =m-1,  j \in [0 ~, n-2]$ )、蓝框区域（此时 $ i \in [0, m-2] , j=n-1$ )和点(m-1, n-2)时为边界，当机器人在边界上时，它到终点的距离都为1.</p><p>最终答案为dp[0][0]。</p><h4 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">uniquePaths</span>(<span class="params">self, m: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        dp = [[<span class="number">1</span>]*n]*m</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, -<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> i == m-<span class="number">1</span> <span class="keyword">or</span> j == n-<span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                dp[i][j] = dp[i+<span class="number">1</span>][j] + dp[i][j+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>变分学习笔记</title>
      <link href="/2021/03/29/bian-fen-xue-xi-bi-ji/"/>
      <url>/2021/03/29/bian-fen-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="变分推断"><a href="#变分推断" class="headerlink" title="变分推断"></a>变分推断</h1><h3 id="应用举例"><a href="#应用举例" class="headerlink" title="应用举例"></a>应用举例</h3><ul><li>文章LAD题目分析</li></ul><span id="more"></span><p>  对文本进行自动分析，然后自动从中找出topic<br><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325161624.png" style="zoom:50%;"></p><ul><li><p>交通数据分析</p><p>美国湾区出租车数据分析，用变分推断的方法可以在一台笔记本电脑上面完成大量数据的计算</p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325162352.png" style="zoom:50%;"></li></ul><h3 id="贝叶斯推断概述"><a href="#贝叶斯推断概述" class="headerlink" title="贝叶斯推断概述"></a>贝叶斯推断概述</h3><h4 id="目标优缺点"><a href="#目标优缺点" class="headerlink" title="目标优缺点"></a>目标优缺点</h4><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325162622.png"></p><h4 id="Roadmap"><a href="#Roadmap" class="headerlink" title="Roadmap"></a>Roadmap</h4><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325162730.png" style="zoom:67%;"><blockquote><p>接下来主要讲解变分贝叶斯方法，变分贝叶斯方法是近似贝叶斯推断的一大类方法，变分贝叶斯方法又有很多子类，Mean-field变分推断是其中比较有代表性的一类。接下来结合讲解的方法讲三个例子：univariate Gaussian、Mixture of Gaussians和LDA</p></blockquote><h3 id="贝叶斯推断"><a href="#贝叶斯推断" class="headerlink" title="贝叶斯推断"></a><a href="https://www.bilibili.com/video/BV1Qf4y1e7jN?from=search&amp;seid=14715651649240686105">贝叶斯推断</a></h3> <img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325164141.png" style="zoom:67%;"><blockquote><p>Data是观测变量，Parameters是模型的参数，通过对观测变量$x$取值的观测，我们可以更新参数$z$, 这里$p(x) = \int_{z}^{}{p(x,z)dz}$，实际应用中$z$是一个高维的分布，很难计算$p(z|x)$</p></blockquote><h3 id="近似贝叶斯推断"><a href="#近似贝叶斯推断" class="headerlink" title="近似贝叶斯推断_"></a><a href="https://www.bilibili.com/video/BV1a5411H7eW?from=search&amp;seid=14715651649240686105">近似贝叶斯推断</a>_</h3><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325210910.png"></p><blockquote><p>直接计算$p(z|x)$复杂度很高很难，然后就有了近似计算（推断）。常用的近似计算有：MCMC方法和基于优化的方法，MCMC方法虽然精度高但是数据量大时计算很慢，基于随机梯度的优化方法可以使用并行加速，因此可以大大的加速计算速度。<br>基于随机梯度优化方法的思路为：找到一个简单的分布$q^<em>(z) \in Q$来近似p(z|x), 目标$q^</em>(z)$应该是$Q$中，与$p(z|x)$某种距离最小的那个。<br><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325212515.png"><br>为什么要用KL散步来度量两个分布的距离呢？<br>KL满足可导和凸性，使得它的计算更快；<br>我们没法通过上式求得$q^*(z)$，需要通过下面的转换把优化KL最小问题进行转换为求$q(z)$使得ELBO最大的问题.<br><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325214048.png"></p></blockquote><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325214709.png"></p><blockquote><p>这里的$log p(x)$是一个固定的常数。</p></blockquote><h3 id="平均场推断"><a href="#平均场推断" class="headerlink" title="平均场推断"></a><a href="https://www.bilibili.com/video/BV1Ki4y1w7Z9/?spm_id_from=autoNext">平均场推断</a></h3><p><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210325223324.png"></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub加速方法</title>
      <link href="/2021/03/28/github-jia-su-fang-fa/"/>
      <url>/2021/03/28/github-jia-su-fang-fa/</url>
      
        <content type="html"><![CDATA[<h3 id="设置代理加速GitHub"><a href="#设置代理加速GitHub" class="headerlink" title="设置代理加速GitHub"></a>设置代理加速GitHub</h3><p>由于github网站服务器在国外，国内上传和下载数据速度较慢，假如你已经有具备了科学上网的条件，可以通过设置代理的方式来提高数据传输速度。</p><p>以下设置均建立在具备科学上网的前提下，下文中的小飞机指某款用于科学上网的工具。</p><h4 id="设置http代理"><a href="#设置http代理" class="headerlink" title="设置http代理"></a>设置http代理</h4><p>在命令行输入如下的命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:1087</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:1087</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置http代理，端口号对应的是小飞机的http代理端口号</span></span><br><span class="line">git config --global http.proxy http://127.0.0.1:1087</span><br><span class="line">git config --global https.proxy http://127.0.0.1:1087</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置github用户名和邮箱</span></span><br><span class="line">git config --global user.name github_id</span><br><span class="line">git config --global user.email github_email</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#取消代理设置</span></span><br><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看代理设置</span></span><br><span class="line">git config --list</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>http代理端口查询：</p><blockquote><p>在小飞机中找到“http代理 设置”选项，然后点击打开，找到如下图所示的监听窗口。</p></blockquote><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210319193849.png" style="zoom:67%;"><h4 id="设置ssh加速"><a href="#设置ssh加速" class="headerlink" title="设置ssh加速"></a><a href="https://gist.github.com/chuyik/02d0d37a49edc162546441092efae6a1">设置ssh</a>加速</h4><p><code>在~/.ssh/config</code> 文件（不存在则新建）添加如下内容：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">   HostName github.com</span><br><span class="line">   User git</span><br><span class="line">   <span class="comment"># 走 HTTP 代理，需要 brew install socat</span></span><br><span class="line">   <span class="comment"># ProxyCommand socat - PROXY:127.0.0.1:%h:%p,proxyport=1087</span></span><br><span class="line">   <span class="comment"># 走 socks5 代理（如 Shadowsocks）</span></span><br><span class="line">   ProxyCommand nc -v -x 127.0.0.1:1086 %h %p</span><br><span class="line">   <span class="comment">#上面1086这个端口号可以在“小飞机”的高级设置中查看</span></span><br><span class="line">   <span class="comment"># 走 socks5 代理（如 Shadowsocks），Windows 平台没有 nc 命令</span></span><br><span class="line">   <span class="comment"># ProxyCommand connect -S 127.0.0.1:1086 %h %p</span></span><br></pre></td></tr></tbody></table></figure><p>本地Socks5监听窗口查询：</p><blockquote><p>在小飞机中找到“高级设置”，点击打开就可以找到如下图所示的监听窗口。</p></blockquote><img src="https://raw.githubusercontent.com/Skylyong/i/main/20210319194610.png" style="zoom:50%;"><h3 id="通过修改hosts解决浏览器打不开github网站的方法"><a href="#通过修改hosts解决浏览器打不开github网站的方法" class="headerlink" title="通过修改hosts解决浏览器打不开github网站的方法"></a>通过修改hosts解决浏览器打不开github网站的方法</h3><blockquote><p>假如不具备科学上网的条件，也可以通过修改hosts文件来解决浏览器打不开GitHub的问题，但是通过这种方式只能解决浏览器打开慢的问题，不能够解决在终端克隆项目慢的问题，建议通过代理的方式加速。</p></blockquote><span id="more"></span><p>首先从这个<a href="https://zhuanlan.zhihu.com/p/36154464">网站</a>给出的链接中获取(也可以直接用下面的数据)到如下格式的数据：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">140.82.113.4 github.com</span><br><span class="line">199.232.69.194 github.global.ssl.fastly.net</span><br><span class="line">185.199.108.153 assets-cdn.github.com</span><br><span class="line">185.199.110.153 assets-cdn.github.com</span><br><span class="line">185.199.111.153 assets-cdn.github.com</span><br><span class="line">185.199.109.153 assets-cdn.github.com</span><br></pre></td></tr></tbody></table></figure><p>然后将这些数据添加到hosts（mac中的路径为：/private/ect/hosts）文件中就可以了。</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo个人博客搭建</title>
      <link href="/2021/02/21/hexo-ge-ren-bo-ke-da-jian-jiao-cheng/"/>
      <url>/2021/02/21/hexo-ge-ren-bo-ke-da-jian-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<p>前沿： <a href="file:///Users/lyong/Desktop/Skylyong.github.io-main/2021/02/21/build/index.html">hexo</a>和<a href="https://themes.gohugo.io/hugo-swift-theme/">hugo</a>是常用的个人博客搭建框架，hexo技术更成熟稳定，但是速度慢，而基于go语言的hugo拥有速度快的优点，但是由于出现较晚，它的技术还不够成熟，也没有相对稳定的主题。</p><h4 id="首次搭建"><a href="#首次搭建" class="headerlink" title="首次搭建"></a>首次搭建</h4><p>今晚用了3个小时搭建了基于hexo的个人博客，现在记录一下。</p><p>主要参考了下面几个链接</p><ul><li><p>博客搭建链接: <a href="https://zhuanlan.zhihu.com/p/26625249">https://zhuanlan.zhihu.com/p/26625249</a></p></li><li><p>pure主题使用链接: <a href="https://github.com/cofess/hexo-theme-pure/blob/master/README.cn.md">https://github.com/cofess/hexo-theme-pure/blob/master/README.cn.md</a></p></li><li><p>next主题使用教程: <a href="https://theme-next.iissnan.com/theme-settings.html#tags-page">https://theme-next.iissnan.com/theme-settings.html#tags-page</a></p></li><li><p>next主题进一步完善: <a href="https://tding.top/top/">https://tding.top/top/</a></p></li></ul><p>有一点要注意：教程中设置域名解析的时候不应该使用A模式，都应该使用CNAME模式</p><ul><li><p>hexo常用命令</p></li><li><p>新建博客：hexo n “bolg’s name”</p></li><li><p>发布博客用如下三个命令：</p></li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></tbody></table></figure><h4 id="增加功能"><a href="#增加功能" class="headerlink" title="增加功能"></a>增加功能</h4><p>今天为博客增加了<a href="http://www.yangyong.xyz/2018/01/03/add-hexo-next-post-views/">记录阅读次数</a>和<a href="https://vic.kim/2019/05/22/Hexo%20Next%20%E4%B8%BB%E9%A2%98%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/">站内搜索</a>的功能。其中添加记录阅读次数功能相对麻烦，需要注册<a href="https://console.leancloud.cn/">leancloud</a>的账号，并且按照教程进行相应设置，如果遇到不能够正常显示阅读次数，要安装相关插件；站内搜索功能比较简单，按照链接中的教程一步步操作就好了。</p><h4 id="设置github免费图床"><a href="#设置github免费图床" class="headerlink" title="设置github免费图床"></a>设置github免费图床</h4><p>首先在<a href="https://github.com/Molunerfinn/PicGo/releases">这里</a>下载对应版本的PicGo(我选择的是2.2.2版本)，然后根据这个<a href="https://learnku.com/articles/48574">教程</a>设置图床，设置好图床后就可以把本地的图片上传到github服务器，生成链接，方便写markdown的时候引用。</p><h4 id="添加评论功能"><a href="#添加评论功能" class="headerlink" title="添加评论功能"></a>添加评论功能</h4><p>设置好评论，默认是每一篇文章，包括”关于“等页面下面都会生成评论对话框，如果想关闭某一篇文章下面的评论对话框，可以参考<a href="https://nobige.cn/post/20190718-hexoxiavalineguanbijingzhimougewenzhangyemianpinglun/">这里</a>。</p><h4 id="电脑奔溃，我弃用next主题了"><a href="#电脑奔溃，我弃用next主题了" class="headerlink" title="电脑奔溃，我弃用next主题了"></a>电脑奔溃，我弃用next主题了</h4><ul><li>matery主题配置: <a href="https://www.jianshu.com/p/cf9730925b5c">https://www.jianshu.com/p/cf9730925b5c</a></li><li>matery主题深度配置: <a href="https://bbs.huaweicloud.com/blogs/226867">https://bbs.huaweicloud.com/blogs/226867</a></li><li>matery主题优秀博客: <a href="https://notes.zhangxiaocai.cn/">https://notes.zhangxiaocai.cn/</a></li></ul><h4 id="logo设计"><a href="#logo设计" class="headerlink" title="logo设计"></a>logo设计</h4><ul><li>在线免费logo设计：<a href="http://yeelogo.com/#/">http://yeelogo.com/#/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 生活总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>好用的免费无广告电影网站推荐</title>
      <link href="/2021/02/21/hao-yong-de-mian-fei-wu-guang-gao-dian-ying-wang-zhan-tui-jian/"/>
      <url>/2021/02/21/hao-yong-de-mian-fei-wu-guang-gao-dian-ying-wang-zhan-tui-jian/</url>
      
        <content type="html"><![CDATA[<p>今日阳光明媚，中午坐在阳台上面感受着春日暖风拂面，不由得让人想找一部电影伴着暖阳体验一番春日周末的慢生活。相信有不少同学跟我一样，不喜欢充视频网站的会员，更不喜欢看电影之前漫长的广告。好在日常生活中碰到好用的电影网站我都会加在收藏夹中，下面整理一下分享给各位喜欢看电影的同学。</p><ul><li><p><a href="http://www.fenggoudy1.com/list-read-id-1.html">疯狗电影</a></p><p>  春节期间看《曼达洛人》的时候发现的，优点是有最新的片源，刚刚看了一下，竟然有最新大热的《你好，李焕英》，资源质量一般，虽然看视频没有广告，但是浮窗广告有点多，影响观感，适合喜欢尝鲜但是对资源质量要求不高的同学。</p><p>  资源存量指数：★★★☆☆</p><p>  视频质量指数：★★☆☆☆</p><p>  个人推荐指数：★☆☆☆☆</p></li><li><p><a href="https://91kanju.com/vod-play/57173-2-1.html">91看剧</a></p><p>  这个网站的资源以电视剧为主，也有不少电影资源，资源比较多，但是有些资源加载时间比较长，资源质量一般，刚刚测试了一下不用翻墙也可以访问。</p><p>  资源存量指数：★★★★★</p><p>  视频质量指数：★★☆☆☆</p><p>  个人推荐指数：★★☆☆☆</p></li><li><p><a href="https://www.wandouys.com/">豌豆影视</a></p><p>  这是我用得最久的免费电影网站，它片源多，新上映的电影也可以在上面找到。缺点是需要翻墙才能解析到视频网址（网址解析之后不用翻墙可以看），视频质量没有保障，喜欢高清电影的同学可能要失望了；网站有时候不稳定，看视频会卡顿。</p><p>  资源存量指数：★★★★★</p><p>  视频质量指数：★★★☆☆</p><p>  个人推荐指数：★★★☆☆</p></li><li><p><a href="https://速影tv.com/movie/5.html">速影TV</a></p><p>  这个网站个人不常用，不记得是怎么发现的了，它的片源比较多，但是资源质量不高，貌似需要翻墙才可以看。虽不常用，但是找不到片源的时候，在这上面找找也可能有意外收获。</p><p>  资源存量指数：★★★★☆</p><p>  视频质量指数：★★☆☆☆</p><p>  个人推荐指数：★★☆☆☆</p></li><li><p><a href="https://ddrk.me/the-witches/">低端电影</a></p><p>  这个网站是前段时间无意中从google中搜索到的，优点是广告少，片源都是高清的电影，还不用翻墙；缺点是资源量不大，不过许多经典电影和电视剧的资源都可以在里面找到，很不错，十分推荐。</p><p>  资源存量指数：★★☆☆☆</p><p>  视频质量指数：★★★★★</p><p>  个人推荐指数：★★★★★</p></li><li><p><a href="https://www.d123movies.to/">123movies</a></p><p>  这个网站是国外的免费电影、电视剧网站，网站的视频都提供了英文字幕，特别适合于学习英语，非常不错，十分推荐。</p><p>  资源存量指数：★★★★★</p><p>  视频质量指数：★★★★★</p><p>  个人推荐指数：★★★★★</p><p>  上面推荐的网站有时候可能会被封掉，最后再推荐一个存储电影资源网址的<a href="http://www.dyhz1.com/">站点</a>。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 生活总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电影 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
